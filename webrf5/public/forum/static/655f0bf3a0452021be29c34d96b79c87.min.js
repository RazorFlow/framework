

/** File: application/3.0.2/assets/desktop/js/modernizr.js **/

/* Modernizr 2.7.0 (Custom Build) | MIT & BSD
 * Build: http://modernizr.com/download/#-fontface-backgroundsize-borderimage-borderradius-boxshadow-flexbox-flexboxlegacy-hsla-multiplebgs-opacity-rgba-textshadow-cssanimations-csscolumns-generatedcontent-cssgradients-cssreflections-csstransforms-csstransforms3d-csstransitions-applicationcache-canvas-canvastext-draganddrop-hashchange-history-audio-video-indexeddb-input-inputtypes-localstorage-postmessage-sessionstorage-websockets-websqldatabase-webworkers-geolocation-inlinesvg-smil-svg-svgclippaths-touch-webgl-shiv-mq-cssclasses-addtest-prefixed-teststyles-testprop-testallprops-hasevent-prefixes-domprefixes-load
 */
;window.Modernizr=function(a,b,c){function D(a){j.cssText=a}function E(a,b){return D(n.join(a+";")+(b||""))}function F(a,b){return typeof a===b}function G(a,b){return!!~(""+a).indexOf(b)}function H(a,b){for(var d in a){var e=a[d];if(!G(e,"-")&&j[e]!==c)return b=="pfx"?e:!0}return!1}function I(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:F(f,"function")?f.bind(d||b):f}return!1}function J(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+p.join(d+" ")+d).split(" ");return F(b,"string")||F(b,"undefined")?H(e,b):(e=(a+" "+q.join(d+" ")+d).split(" "),I(e,b,c))}function K(){e.input=function(c){for(var d=0,e=c.length;d<e;d++)u[c[d]]=c[d]in k;return u.list&&(u.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),u}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),e.inputtypes=function(a){for(var d=0,e,f,h,i=a.length;d<i;d++)k.setAttribute("type",f=a[d]),e=k.type!=="text",e&&(k.value=l,k.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&k.style.WebkitAppearance!==c?(g.appendChild(k),h=b.defaultView,e=h.getComputedStyle&&h.getComputedStyle(k,null).WebkitAppearance!=="textfield"&&k.offsetHeight!==0,g.removeChild(k)):/^(search|tel)$/.test(f)||(/^(url|email)$/.test(f)?e=k.checkValidity&&k.checkValidity()===!1:e=k.value!=l)),t[a[d]]=!!e;return t}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var d="2.7.0",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k=b.createElement("input"),l=":)",m={}.toString,n=" -webkit- -moz- -o- -ms- ".split(" "),o="Webkit Moz O ms",p=o.split(" "),q=o.toLowerCase().split(" "),r={svg:"http://www.w3.org/2000/svg"},s={},t={},u={},v=[],w=v.slice,x,y=function(a,c,d,e){var f,i,j,k,l=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:h+(d+1),l.appendChild(j);return f=["&#173;",'<style id="s',h,'">',a,"</style>"].join(""),l.id=h,(m?l:n).innerHTML+=f,n.appendChild(l),m||(n.style.background="",n.style.overflow="hidden",k=g.style.overflow,g.style.overflow="hidden",g.appendChild(n)),i=c(l,a),m?l.parentNode.removeChild(l):(n.parentNode.removeChild(n),g.style.overflow=k),!!i},z=function(b){var c=a.matchMedia||a.msMatchMedia;if(c)return c(b).matches;var d;return y("@media "+b+" { #"+h+" { position: absolute; } }",function(b){d=(a.getComputedStyle?getComputedStyle(b,null):b.currentStyle)["position"]=="absolute"}),d},A=function(){function d(d,e){e=e||b.createElement(a[d]||"div"),d="on"+d;var f=d in e;return f||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(d,""),f=F(e[d],"function"),F(e[d],"undefined")||(e[d]=c),e.removeAttribute(d))),e=null,f}var a={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return d}(),B={}.hasOwnProperty,C;!F(B,"undefined")&&!F(B.call,"undefined")?C=function(a,b){return B.call(a,b)}:C=function(a,b){return b in a&&F(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=w.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(w.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(w.call(arguments)))};return e}),s.flexbox=function(){return J("flexWrap")},s.flexboxlegacy=function(){return J("boxDirection")},s.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},s.canvastext=function(){return!!e.canvas&&!!F(b.createElement("canvas").getContext("2d").fillText,"function")},s.webgl=function(){return!!a.WebGLRenderingContext},s.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:y(["@media (",n.join("touch-enabled),("),h,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=a.offsetTop===9}),c},s.geolocation=function(){return"geolocation"in navigator},s.postmessage=function(){return!!a.postMessage},s.websqldatabase=function(){return!!a.openDatabase},s.indexedDB=function(){return!!J("indexedDB",a)},s.hashchange=function(){return A("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},s.history=function(){return!!a.history&&!!history.pushState},s.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},s.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},s.rgba=function(){return D("background-color:rgba(150,255,150,.5)"),G(j.backgroundColor,"rgba")},s.hsla=function(){return D("background-color:hsla(120,40%,100%,.5)"),G(j.backgroundColor,"rgba")||G(j.backgroundColor,"hsla")},s.multiplebgs=function(){return D("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(j.background)},s.backgroundsize=function(){return J("backgroundSize")},s.borderimage=function(){return J("borderImage")},s.borderradius=function(){return J("borderRadius")},s.boxshadow=function(){return J("boxShadow")},s.textshadow=function(){return b.createElement("div").style.textShadow===""},s.opacity=function(){return E("opacity:.55"),/^0.55$/.test(j.opacity)},s.cssanimations=function(){return J("animationName")},s.csscolumns=function(){return J("columnCount")},s.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return D((a+"-webkit- ".split(" ").join(b+a)+n.join(c+a)).slice(0,-a.length)),G(j.backgroundImage,"gradient")},s.cssreflections=function(){return J("boxReflect")},s.csstransforms=function(){return!!J("transform")},s.csstransforms3d=function(){var a=!!J("perspective");return a&&"webkitPerspective"in g.style&&y("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b,c){a=b.offsetLeft===9&&b.offsetHeight===3}),a},s.csstransitions=function(){return J("transition")},s.fontface=function(){var a;return y('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&g.indexOf(d.split(" ")[0])===0}),a},s.generatedcontent=function(){var a;return y(["#",h,"{font:0/0 a}#",h,':after{content:"',l,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a},s.video=function(){var a=b.createElement("video"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}catch(d){}return c},s.audio=function(){var a=b.createElement("audio"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,"")}catch(d){}return c},s.localstorage=function(){try{return localStorage.setItem(h,h),localStorage.removeItem(h),!0}catch(a){return!1}},s.sessionstorage=function(){try{return sessionStorage.setItem(h,h),sessionStorage.removeItem(h),!0}catch(a){return!1}},s.webworkers=function(){return!!a.Worker},s.applicationcache=function(){return!!a.applicationCache},s.svg=function(){return!!b.createElementNS&&!!b.createElementNS(r.svg,"svg").createSVGRect},s.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==r.svg},s.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(m.call(b.createElementNS(r.svg,"animate")))},s.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(m.call(b.createElementNS(r.svg,"clipPath")))};for(var L in s)C(s,L)&&(x=L.toLowerCase(),e[x]=s[L](),v.push((e[x]?"":"no-")+x));return e.input||K(),e.addTest=function(a,b){if(typeof a=="object")for(var d in a)C(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof f!="undefined"&&f&&(g.className+=" "+(b?"":"no-")+a),e[a]=b}return e},D(""),i=k=null,function(a,b){function l(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function m(){var a=s.elements;return typeof a=="string"?a.split(" "):a}function n(a){var b=j[a[h]];return b||(b={},i++,a[h]=i,j[i]=b),b}function o(a,c,d){c||(c=b);if(k)return c.createElement(a);d||(d=n(c));var g;return d.cache[a]?g=d.cache[a].cloneNode():f.test(a)?g=(d.cache[a]=d.createElem(a)).cloneNode():g=d.createElem(a),g.canHaveChildren&&!e.test(a)&&!g.tagUrn?d.frag.appendChild(g):g}function p(a,c){a||(a=b);if(k)return a.createDocumentFragment();c=c||n(a);var d=c.frag.cloneNode(),e=0,f=m(),g=f.length;for(;e<g;e++)d.createElement(f[e]);return d}function q(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return s.shivMethods?o(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+m().join().replace(/[\w\-]+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(s,b.frag)}function r(a){a||(a=b);var c=n(a);return s.shivCSS&&!g&&!c.hasCSS&&(c.hasCSS=!!l(a,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),k||q(a,c),a}var c="3.7.0",d=a.html5||{},e=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,f=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,g,h="_html5shiv",i=0,j={},k;(function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",g="hidden"in a,k=a.childNodes.length==1||function(){b.createElement("a");var a=b.createDocumentFragment();return typeof a.cloneNode=="undefined"||typeof a.createDocumentFragment=="undefined"||typeof a.createElement=="undefined"}()}catch(c){g=!0,k=!0}})();var s={elements:d.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:c,shivCSS:d.shivCSS!==!1,supportsUnknownElements:k,shivMethods:d.shivMethods!==!1,type:"default",shivDocument:r,createElement:o,createDocumentFragment:p};a.html5=s,r(b)}(this,b),e._version=d,e._prefixes=n,e._domPrefixes=q,e._cssomPrefixes=p,e.mq=z,e.hasEvent=A,e.testProp=function(a){return H([a])},e.testAllProps=J,e.testStyles=y,e.prefixed=function(a,b,c){return b?J(a,b,c):J(a,"pfx")},g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+v.join(" "):""),e}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement("script"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement("link"),j,c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};


/** File: application/3.0.2/assets/desktop/js/jquery-1.8.3.min.js **/

/*! jQuery v1.8.3 jquery.com | jquery.org/license */
(function(e,t){function _(e){var t=M[e]={};return v.each(e.split(y),function(e,n){t[n]=!0}),t}function H(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(P,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:+r+""===r?+r:D.test(r)?v.parseJSON(r):r}catch(s){}v.data(e,n,r)}else r=t}return r}function B(e){var t;for(t in e){if(t==="data"&&v.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function et(){return!1}function tt(){return!0}function ut(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function at(e,t){do e=e[t];while(e&&e.nodeType!==1);return e}function ft(e,t,n){t=t||0;if(v.isFunction(t))return v.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return v.grep(e,function(e,r){return e===t===n});if(typeof t=="string"){var r=v.grep(e,function(e){return e.nodeType===1});if(it.test(t))return v.filter(t,r,!n);t=v.filter(t,r)}return v.grep(e,function(e,r){return v.inArray(e,t)>=0===n})}function lt(e){var t=ct.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function At(e,t){if(t.nodeType!==1||!v.hasData(e))return;var n,r,i,s=v._data(e),o=v._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)v.event.add(t,n,u[n][r])}o.data&&(o.data=v.extend({},o.data))}function Ot(e,t){var n;if(t.nodeType!==1)return;t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase(),n==="object"?(t.parentNode&&(t.outerHTML=e.outerHTML),v.support.html5Clone&&e.innerHTML&&!v.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):n==="input"&&Et.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):n==="option"?t.selected=e.defaultSelected:n==="input"||n==="textarea"?t.defaultValue=e.defaultValue:n==="script"&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(v.expando)}function Mt(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function _t(e){Et.test(e.type)&&(e.defaultChecked=e.checked)}function Qt(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Jt.length;while(i--){t=Jt[i]+n;if(t in e)return t}return r}function Gt(e,t){return e=t||e,v.css(e,"display")==="none"||!v.contains(e.ownerDocument,e)}function Yt(e,t){var n,r,i=[],s=0,o=e.length;for(;s<o;s++){n=e[s];if(!n.style)continue;i[s]=v._data(n,"olddisplay"),t?(!i[s]&&n.style.display==="none"&&(n.style.display=""),n.style.display===""&&Gt(n)&&(i[s]=v._data(n,"olddisplay",nn(n.nodeName)))):(r=Dt(n,"display"),!i[s]&&r!=="none"&&v._data(n,"olddisplay",r))}for(s=0;s<o;s++){n=e[s];if(!n.style)continue;if(!t||n.style.display==="none"||n.style.display==="")n.style.display=t?i[s]||"":"none"}return e}function Zt(e,t,n){var r=Rt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function en(e,t,n,r){var i=n===(r?"border":"content")?4:t==="width"?1:0,s=0;for(;i<4;i+=2)n==="margin"&&(s+=v.css(e,n+$t[i],!0)),r?(n==="content"&&(s-=parseFloat(Dt(e,"padding"+$t[i]))||0),n!=="margin"&&(s-=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0)):(s+=parseFloat(Dt(e,"padding"+$t[i]))||0,n!=="padding"&&(s+=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0));return s}function tn(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=!0,s=v.support.boxSizing&&v.css(e,"boxSizing")==="border-box";if(r<=0||r==null){r=Dt(e,t);if(r<0||r==null)r=e.style[t];if(Ut.test(r))return r;i=s&&(v.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+en(e,t,n||(s?"border":"content"),i)+"px"}function nn(e){if(Wt[e])return Wt[e];var t=v("<"+e+">").appendTo(i.body),n=t.css("display");t.remove();if(n==="none"||n===""){Pt=i.body.appendChild(Pt||v.extend(i.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!Ht||!Pt.createElement)Ht=(Pt.contentWindow||Pt.contentDocument).document,Ht.write("<!doctype html><html><body>"),Ht.close();t=Ht.body.appendChild(Ht.createElement(e)),n=Dt(t,"display"),i.body.removeChild(Pt)}return Wt[e]=n,n}function fn(e,t,n,r){var i;if(v.isArray(t))v.each(t,function(t,i){n||sn.test(e)?r(e,i):fn(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&v.type(t)==="object")for(i in t)fn(e+"["+i+"]",t[i],n,r);else r(e,t)}function Cn(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i,s,o=t.toLowerCase().split(y),u=0,a=o.length;if(v.isFunction(n))for(;u<a;u++)r=o[u],s=/^\+/.test(r),s&&(r=r.substr(1)||"*"),i=e[r]=e[r]||[],i[s?"unshift":"push"](n)}}function kn(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u,a=e[s],f=0,l=a?a.length:0,c=e===Sn;for(;f<l&&(c||!u);f++)u=a[f](n,r,i),typeof u=="string"&&(!c||o[u]?u=t:(n.dataTypes.unshift(u),u=kn(e,n,r,i,u,o)));return(c||!u)&&!o["*"]&&(u=kn(e,n,r,i,"*",o)),u}function Ln(e,n){var r,i,s=v.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);i&&v.extend(!0,e,i)}function An(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(s in l)s in r&&(n[l[s]]=r[s]);while(f[0]==="*")f.shift(),i===t&&(i=e.mimeType||n.getResponseHeader("content-type"));if(i)for(s in a)if(a[s]&&a[s].test(i)){f.unshift(s);break}if(f[0]in r)o=f[0];else{for(s in r){if(!f[0]||e.converters[s+" "+f[0]]){o=s;break}u||(u=s)}o=o||u}if(o)return o!==f[0]&&f.unshift(o),r[o]}function On(e,t){var n,r,i,s,o=e.dataTypes.slice(),u=o[0],a={},f=0;e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(o[1])for(n in e.converters)a[n.toLowerCase()]=e.converters[n];for(;i=o[++f];)if(i!=="*"){if(u!=="*"&&u!==i){n=a[u+" "+i]||a["* "+i];if(!n)for(r in a){s=r.split(" ");if(s[1]===i){n=a[u+" "+s[0]]||a["* "+s[0]];if(n){n===!0?n=a[r]:a[r]!==!0&&(i=s[0],o.splice(f--,0,i));break}}}if(n!==!0)if(n&&e["throws"])t=n(t);else try{t=n(t)}catch(l){return{state:"parsererror",error:n?l:"No conversion from "+u+" to "+i}}}u=i}return{state:"success",data:t}}function Fn(){try{return new e.XMLHttpRequest}catch(t){}}function In(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function $n(){return setTimeout(function(){qn=t},0),qn=v.now()}function Jn(e,t){v.each(t,function(t,n){var r=(Vn[t]||[]).concat(Vn["*"]),i=0,s=r.length;for(;i<s;i++)if(r[i].call(e,t,n))return})}function Kn(e,t,n){var r,i=0,s=0,o=Xn.length,u=v.Deferred().always(function(){delete a.elem}),a=function(){var t=qn||$n(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,i=1-r,s=0,o=f.tweens.length;for(;s<o;s++)f.tweens[s].run(i);return u.notifyWith(e,[f,i,n]),i<1&&o?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:v.extend({},t),opts:v.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:qn||$n(),duration:n.duration,tweens:[],createTween:function(t,n,r){var i=v.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(i),i},stop:function(t){var n=0,r=t?f.tweens.length:0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;Qn(l,f.opts.specialEasing);for(;i<o;i++){r=Xn[i].call(f,e,l,f.opts);if(r)return r}return Jn(f,l),v.isFunction(f.opts.start)&&f.opts.start.call(e,f),v.fx.timer(v.extend(a,{anim:f,queue:f.opts.queue,elem:e})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function Qn(e,t){var n,r,i,s,o;for(n in e){r=v.camelCase(n),i=t[r],s=e[n],v.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=v.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function Gn(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},m=[],g=e.nodeType&&Gt(e);n.queue||(l=v._queueHooks(e,"fx"),l.unqueued==null&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,v.queue(e,"fx").length||l.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],v.css(e,"display")==="inline"&&v.css(e,"float")==="none"&&(!v.support.inlineBlockNeedsLayout||nn(e.nodeName)==="inline"?p.display="inline-block":p.zoom=1)),n.overflow&&(p.overflow="hidden",v.support.shrinkWrapBlocks||h.done(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t){s=t[r];if(Un.exec(s)){delete t[r],a=a||s==="toggle";if(s===(g?"hide":"show"))continue;m.push(r)}}o=m.length;if(o){u=v._data(e,"fxshow")||v._data(e,"fxshow",{}),"hidden"in u&&(g=u.hidden),a&&(u.hidden=!g),g?v(e).show():h.done(function(){v(e).hide()}),h.done(function(){var t;v.removeData(e,"fxshow",!0);for(t in d)v.style(e,t,d[t])});for(r=0;r<o;r++)i=m[r],f=h.createTween(i,g?u[i]:0),d[i]=u[i]||v.style(e,i),i in u||(u[i]=f.start,g&&(f.end=f.start,f.start=i==="width"||i==="height"?1:0))}}function Yn(e,t,n,r,i){return new Yn.prototype.init(e,t,n,r,i)}function Zn(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=$t[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function tr(e){return v.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n,r,i=e.document,s=e.location,o=e.navigator,u=e.jQuery,a=e.$,f=Array.prototype.push,l=Array.prototype.slice,c=Array.prototype.indexOf,h=Object.prototype.toString,p=Object.prototype.hasOwnProperty,d=String.prototype.trim,v=function(e,t){return new v.fn.init(e,t,n)},m=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,g=/\S/,y=/\s+/,b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,w=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,E=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,S=/^[\],:{}\s]*$/,x=/(?:^|:|,)(?:\s*\[)+/g,T=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,N=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,C=/^-ms-/,k=/-([\da-z])/gi,L=function(e,t){return(t+"").toUpperCase()},A=function(){i.addEventListener?(i.removeEventListener("DOMContentLoaded",A,!1),v.ready()):i.readyState==="complete"&&(i.detachEvent("onreadystatechange",A),v.ready())},O={};v.fn=v.prototype={constructor:v,init:function(e,n,r){var s,o,u,a;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?s=[null,e,null]:s=w.exec(e);if(s&&(s[1]||!n)){if(s[1])return n=n instanceof v?n[0]:n,a=n&&n.nodeType?n.ownerDocument||n:i,e=v.parseHTML(s[1],a,!0),E.test(s[1])&&v.isPlainObject(n)&&this.attr.call(e,n,!0),v.merge(this,e);o=i.getElementById(s[2]);if(o&&o.parentNode){if(o.id!==s[2])return r.find(e);this.length=1,this[0]=o}return this.context=i,this.selector=e,this}return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}return v.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),v.makeArray(e,this))},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return l.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=v.merge(this.constructor(),e);return r.prevObject=this,r.context=this.context,t==="find"?r.selector=this.selector+(this.selector?" ":"")+n:t&&(r.selector=this.selector+"."+t+"("+n+")"),r},each:function(e,t){return v.each(this,e,t)},ready:function(e){return v.ready.promise().done(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(l.apply(this,arguments),"slice",l.call(arguments).join(","))},map:function(e){return this.pushStack(v.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:[].sort,splice:[].splice},v.fn.init.prototype=v.fn,v.extend=v.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u=="boolean"&&(l=u,u=arguments[1]||{},a=2),typeof u!="object"&&!v.isFunction(u)&&(u={}),f===a&&(u=this,--a);for(;a<f;a++)if((e=arguments[a])!=null)for(n in e){r=u[n],i=e[n];if(u===i)continue;l&&i&&(v.isPlainObject(i)||(s=v.isArray(i)))?(s?(s=!1,o=r&&v.isArray(r)?r:[]):o=r&&v.isPlainObject(r)?r:{},u[n]=v.extend(l,o,i)):i!==t&&(u[n]=i)}return u},v.extend({noConflict:function(t){return e.$===v&&(e.$=a),t&&e.jQuery===v&&(e.jQuery=u),v},isReady:!1,readyWait:1,holdReady:function(e){e?v.readyWait++:v.ready(!0)},ready:function(e){if(e===!0?--v.readyWait:v.isReady)return;if(!i.body)return setTimeout(v.ready,1);v.isReady=!0;if(e!==!0&&--v.readyWait>0)return;r.resolveWith(i,[v]),v.fn.trigger&&v(i).trigger("ready").off("ready")},isFunction:function(e){return v.type(e)==="function"},isArray:Array.isArray||function(e){return v.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):O[h.call(e)]||"object"},isPlainObject:function(e){if(!e||v.type(e)!=="object"||e.nodeType||v.isWindow(e))return!1;try{if(e.constructor&&!p.call(e,"constructor")&&!p.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||p.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){var r;return!e||typeof e!="string"?null:(typeof t=="boolean"&&(n=t,t=0),t=t||i,(r=E.exec(e))?[t.createElement(r[1])]:(r=v.buildFragment([e],t,n?null:[]),v.merge([],(r.cacheable?v.clone(r.fragment):r.fragment).childNodes)))},parseJSON:function(t){if(!t||typeof t!="string")return null;t=v.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(S.test(t.replace(T,"@").replace(N,"]").replace(x,"")))return(new Function("return "+t))();v.error("Invalid JSON: "+t)},parseXML:function(n){var r,i;if(!n||typeof n!="string")return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&v.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&g.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(C,"ms-").replace(k,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,n,r){var i,s=0,o=e.length,u=o===t||v.isFunction(e);if(r){if(u){for(i in e)if(n.apply(e[i],r)===!1)break}else for(;s<o;)if(n.apply(e[s++],r)===!1)break}else if(u){for(i in e)if(n.call(e[i],i,e[i])===!1)break}else for(;s<o;)if(n.call(e[s],s,e[s++])===!1)break;return e},trim:d&&!d.call("\ufeff\u00a0")?function(e){return e==null?"":d.call(e)}:function(e){return e==null?"":(e+"").replace(b,"")},makeArray:function(e,t){var n,r=t||[];return e!=null&&(n=v.type(e),e.length==null||n==="string"||n==="function"||n==="regexp"||v.isWindow(e)?f.call(r,e):v.merge(r,e)),r},inArray:function(e,t,n){var r;if(t){if(c)return c.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if(typeof r=="number")for(;s<r;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,n,r){var i,s,o=[],u=0,a=e.length,f=e instanceof v||a!==t&&typeof a=="number"&&(a>0&&e[0]&&e[a-1]||a===0||v.isArray(e));if(f)for(;u<a;u++)i=n(e[u],u,r),i!=null&&(o[o.length]=i);else for(s in e)i=n(e[s],s,r),i!=null&&(o[o.length]=i);return o.concat.apply([],o)},guid:1,proxy:function(e,n){var r,i,s;return typeof n=="string"&&(r=e[n],n=e,e=r),v.isFunction(e)?(i=l.call(arguments,2),s=function(){return e.apply(n,i.concat(l.call(arguments)))},s.guid=e.guid=e.guid||v.guid++,s):t},access:function(e,n,r,i,s,o,u){var a,f=r==null,l=0,c=e.length;if(r&&typeof r=="object"){for(l in r)v.access(e,n,l,r[l],1,o,i);s=1}else if(i!==t){a=u===t&&v.isFunction(i),f&&(a?(a=n,n=function(e,t,n){return a.call(v(e),n)}):(n.call(e,i),n=null));if(n)for(;l<c;l++)n(e[l],r,a?i.call(e[l],l,n(e[l],r)):i,u);s=1}return s?e:f?n.call(e):c?n(e[0],r):o},now:function(){return(new Date).getTime()}}),v.ready.promise=function(t){if(!r){r=v.Deferred();if(i.readyState==="complete")setTimeout(v.ready,1);else if(i.addEventListener)i.addEventListener("DOMContentLoaded",A,!1),e.addEventListener("load",v.ready,!1);else{i.attachEvent("onreadystatechange",A),e.attachEvent("onload",v.ready);var n=!1;try{n=e.frameElement==null&&i.documentElement}catch(s){}n&&n.doScroll&&function o(){if(!v.isReady){try{n.doScroll("left")}catch(e){return setTimeout(o,50)}v.ready()}}()}}return r.promise(t)},v.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){O["[object "+t+"]"]=t.toLowerCase()}),n=v(i);var M={};v.Callbacks=function(e){e=typeof e=="string"?M[e]||_(e):v.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){n=e.memory&&t,r=!0,u=s||0,s=0,o=a.length,i=!0;for(;a&&u<o;u++)if(a[u].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):n?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function r(t){v.each(t,function(t,n){var i=v.type(n);i==="function"?(!e.unique||!c.has(n))&&a.push(n):n&&n.length&&i!=="string"&&r(n)})})(arguments),i?o=a.length:n&&(s=t,l(n))}return this},remove:function(){return a&&v.each(arguments,function(e,t){var n;while((n=v.inArray(t,a,n))>-1)a.splice(n,1),i&&(n<=o&&o--,n<=u&&u--)}),this},has:function(e){return v.inArray(e,a)>-1},empty:function(){return a=[],this},disable:function(){return a=f=n=t,this},disabled:function(){return!a},lock:function(){return f=t,n||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],a&&(!r||f)&&(i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},v.extend({Deferred:function(e){var t=[["resolve","done",v.Callbacks("once memory"),"resolved"],["reject","fail",v.Callbacks("once memory"),"rejected"],["notify","progress",v.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return v.Deferred(function(n){v.each(t,function(t,r){var s=r[0],o=e[t];i[r[1]](v.isFunction(o)?function(){var e=o.apply(this,arguments);e&&v.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+"With"](this===i?n:this,[e])}:n[s])}),e=null}).promise()},promise:function(e){return e!=null?v.extend(e,r):r}},i={};return r.pipe=r.then,v.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=o.fire,i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=l.call(arguments),r=n.length,i=r!==1||e&&v.isFunction(e.promise)?r:0,s=i===1?e:v.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?l.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&v.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),v.support=function(){var t,n,r,s,o,u,a,f,l,c,h,p=i.createElement("div");p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*"),r=p.getElementsByTagName("a")[0];if(!n||!r||!n.length)return{};s=i.createElement("select"),o=s.appendChild(i.createElement("option")),u=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:r.getAttribute("href")==="/a",opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:u.value==="on",optSelected:o.selected,getSetAttribute:p.className!=="t",enctype:!!i.createElement("form").enctype,html5Clone:i.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:i.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},u.checked=!0,t.noCloneChecked=u.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!o.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",h=function(){t.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick"),p.detachEvent("onclick",h)),u=i.createElement("input"),u.value="t",u.setAttribute("type","radio"),t.radioValue=u.value==="t",u.setAttribute("checked","checked"),u.setAttribute("name","t"),p.appendChild(u),a=i.createDocumentFragment(),a.appendChild(p.lastChild),t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=u.checked,a.removeChild(u),a.appendChild(p);if(p.attachEvent)for(l in{submit:!0,change:!0,focusin:!0})f="on"+l,c=f in p,c||(p.setAttribute(f,"return;"),c=typeof p[f]=="function"),t[l+"Bubbles"]=c;return v(function(){var n,r,s,o,u="padding:0;margin:0;border:0;display:block;overflow:hidden;",a=i.getElementsByTagName("body")[0];if(!a)return;n=i.createElement("div"),n.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",a.insertBefore(n,a.firstChild),r=i.createElement("div"),n.appendChild(r),r.innerHTML="<table><tr><td></td><td>t</td></tr></table>",s=r.getElementsByTagName("td"),s[0].style.cssText="padding:0;margin:0;border:0;display:none",c=s[0].offsetHeight===0,s[0].style.display="",s[1].style.display="none",t.reliableHiddenOffsets=c&&s[0].offsetHeight===0,r.innerHTML="",r.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=r.offsetWidth===4,t.doesNotIncludeMarginInBodyOffset=a.offsetTop!==1,e.getComputedStyle&&(t.pixelPosition=(e.getComputedStyle(r,null)||{}).top!=="1%",t.boxSizingReliable=(e.getComputedStyle(r,null)||{width:"4px"}).width==="4px",o=i.createElement("div"),o.style.cssText=r.style.cssText=u,o.style.marginRight=o.style.width="0",r.style.width="1px",r.appendChild(o),t.reliableMarginRight=!parseFloat((e.getComputedStyle(o,null)||{}).marginRight)),typeof r.style.zoom!="undefined"&&(r.innerHTML="",r.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=r.offsetWidth===3,r.style.display="block",r.style.overflow="visible",r.innerHTML="<div></div>",r.firstChild.style.width="5px",t.shrinkWrapBlocks=r.offsetWidth!==3,n.style.zoom=1),a.removeChild(n),n=r=s=o=null}),a.removeChild(p),n=r=s=o=u=a=p=null,t}();var D=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,P=/([A-Z])/g;v.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(v.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?v.cache[e[v.expando]]:e[v.expando],!!e&&!B(e)},data:function(e,n,r,i){if(!v.acceptData(e))return;var s,o,u=v.expando,a=typeof n=="string",f=e.nodeType,l=f?v.cache:e,c=f?e[u]:e[u]&&u;if((!c||!l[c]||!i&&!l[c].data)&&a&&r===t)return;c||(f?e[u]=c=v.deletedIds.pop()||v.guid++:c=u),l[c]||(l[c]={},f||(l[c].toJSON=v.noop));if(typeof n=="object"||typeof n=="function")i?l[c]=v.extend(l[c],n):l[c].data=v.extend(l[c].data,n);return s=l[c],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[v.camelCase(n)]=r),a?(o=s[n],o==null&&(o=s[v.camelCase(n)])):o=s,o},removeData:function(e,t,n){if(!v.acceptData(e))return;var r,i,s,o=e.nodeType,u=o?v.cache:e,a=o?e[v.expando]:v.expando;if(!u[a])return;if(t){r=n?u[a]:u[a].data;if(r){v.isArray(t)||(t in r?t=[t]:(t=v.camelCase(t),t in r?t=[t]:t=t.split(" ")));for(i=0,s=t.length;i<s;i++)delete r[t[i]];if(!(n?B:v.isEmptyObject)(r))return}}if(!n){delete u[a].data;if(!B(u[a]))return}o?v.cleanData([e],!0):v.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null},_data:function(e,t,n){return v.data(e,t,n,!0)},acceptData:function(e){var t=e.nodeName&&v.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),v.fn.extend({data:function(e,n){var r,i,s,o,u,a=this[0],f=0,l=null;if(e===t){if(this.length){l=v.data(a);if(a.nodeType===1&&!v._data(a,"parsedAttrs")){s=a.attributes;for(u=s.length;f<u;f++)o=s[f].name,o.indexOf("data-")||(o=v.camelCase(o.substring(5)),H(a,o,l[o]));v._data(a,"parsedAttrs",!0)}}return l}return typeof e=="object"?this.each(function(){v.data(this,e)}):(r=e.split(".",2),r[1]=r[1]?"."+r[1]:"",i=r[1]+"!",v.access(this,function(n){if(n===t)return l=this.triggerHandler("getData"+i,[r[0]]),l===t&&a&&(l=v.data(a,e),l=H(a,e,l)),l===t&&r[1]?this.data(r[0]):l;r[1]=n,this.each(function(){var t=v(this);t.triggerHandler("setData"+i,r),v.data(this,e,n),t.triggerHandler("changeData"+i,r)})},null,n,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){v.removeData(this,e)})}}),v.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=v._data(e,t),n&&(!r||v.isArray(n)?r=v._data(e,t,v.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=v.queue(e,t),r=n.length,i=n.shift(),s=v._queueHooks(e,t),o=function(){v.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return v._data(e,n)||v._data(e,n,{empty:v.Callbacks("once memory").add(function(){v.removeData(e,t+"queue",!0),v.removeData(e,n,!0)})})}}),v.fn.extend({queue:function(e,n){var r=2;return typeof e!="string"&&(n=e,e="fx",r--),arguments.length<r?v.queue(this[0],e):n===t?this:this.each(function(){var t=v.queue(this,e,n);v._queueHooks(this,e),e==="fx"&&t[0]!=="inprogress"&&v.dequeue(this,e)})},dequeue:function(e){return this.each(function(){v.dequeue(this,e)})},delay:function(e,t){return e=v.fx?v.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=v.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};typeof e!="string"&&(n=e,e=t),e=e||"fx";while(u--)r=v._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var j,F,I,q=/[\t\r\n]/g,R=/\r/g,U=/^(?:button|input)$/i,z=/^(?:button|input|object|select|textarea)$/i,W=/^a(?:rea|)$/i,X=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,V=v.support.getSetAttribute;v.fn.extend({attr:function(e,t){return v.access(this,v.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){v.removeAttr(this,e)})},prop:function(e,t){return v.access(this,v.prop,e,t,arguments.length>1)},removeProp:function(e){return e=v.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o,u;if(v.isFunction(e))return this.each(function(t){v(this).addClass(e.call(this,t,this.className))});if(e&&typeof e=="string"){t=e.split(y);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1)if(!i.className&&t.length===1)i.className=e;else{s=" "+i.className+" ";for(o=0,u=t.length;o<u;o++)s.indexOf(" "+t[o]+" ")<0&&(s+=t[o]+" ");i.className=v.trim(s)}}}return this},removeClass:function(e){var n,r,i,s,o,u,a;if(v.isFunction(e))return this.each(function(t){v(this).removeClass(e.call(this,t,this.className))});if(e&&typeof e=="string"||e===t){n=(e||"").split(y);for(u=0,a=this.length;u<a;u++){i=this[u];if(i.nodeType===1&&i.className){r=(" "+i.className+" ").replace(q," ");for(s=0,o=n.length;s<o;s++)while(r.indexOf(" "+n[s]+" ")>=0)r=r.replace(" "+n[s]+" "," ");i.className=e?v.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return v.isFunction(e)?this.each(function(n){v(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,s=0,o=v(this),u=t,a=e.split(y);while(i=a[s++])u=r?u:!o.hasClass(i),o[u?"addClass":"removeClass"](i)}else if(n==="undefined"||n==="boolean")this.className&&v._data(this,"__className__",this.className),this.className=this.className||e===!1?"":v._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(q," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(!arguments.length){if(s)return n=v.valHooks[s.type]||v.valHooks[s.nodeName.toLowerCase()],n&&"get"in n&&(r=n.get(s,"value"))!==t?r:(r=s.value,typeof r=="string"?r.replace(R,""):r==null?"":r);return}return i=v.isFunction(e),this.each(function(r){var s,o=v(this);if(this.nodeType!==1)return;i?s=e.call(this,r,o.val()):s=e,s==null?s="":typeof s=="number"?s+="":v.isArray(s)&&(s=v.map(s,function(e){return e==null?"":e+""})),n=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()];if(!n||!("set"in n)||n.set(this,s,"value")===t)this.value=s})}}),v.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(v.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!v.nodeName(n.parentNode,"optgroup"))){t=v(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n=v.makeArray(t);return v(e).find("option").each(function(){this.selected=v.inArray(v(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{},attr:function(e,n,r,i){var s,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2)return;if(i&&v.isFunction(v.fn[n]))return v(e)[n](r);if(typeof e.getAttribute=="undefined")return v.prop(e,n,r);u=a!==1||!v.isXMLDoc(e),u&&(n=n.toLowerCase(),o=v.attrHooks[n]||(X.test(n)?F:j));if(r!==t){if(r===null){v.removeAttr(e,n);return}return o&&"set"in o&&u&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r)}return o&&"get"in o&&u&&(s=o.get(e,n))!==null?s:(s=e.getAttribute(n),s===null?t:s)},removeAttr:function(e,t){var n,r,i,s,o=0;if(t&&e.nodeType===1){r=t.split(y);for(;o<r.length;o++)i=r[o],i&&(n=v.propFix[i]||i,s=X.test(i),s||v.attr(e,i,""),e.removeAttribute(V?i:n),s&&n in e&&(e[n]=!1))}},attrHooks:{type:{set:function(e,t){if(U.test(e.nodeName)&&e.parentNode)v.error("type property can't be changed");else if(!v.support.radioValue&&t==="radio"&&v.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}},value:{get:function(e,t){return j&&v.nodeName(e,"button")?j.get(e,t):t in e?e.value:null},set:function(e,t,n){if(j&&v.nodeName(e,"button"))return j.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(!e||u===3||u===8||u===2)return;return o=u!==1||!v.isXMLDoc(e),o&&(n=v.propFix[n]||n,s=v.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&(i=s.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):z.test(e.nodeName)||W.test(e.nodeName)&&e.href?0:t}}}}),F={get:function(e,n){var r,i=v.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?v.removeAttr(e,n):(r=v.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},V||(I={name:!0,id:!0,coords:!0},j=v.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(I[n]?r.value!=="":r.specified)?r.value:t},set:function(e,t,n){var r=e.getAttributeNode(n);return r||(r=i.createAttribute(n),e.setAttributeNode(r)),r.value=t+""}},v.each(["width","height"],function(e,t){v.attrHooks[t]=v.extend(v.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})}),v.attrHooks.contenteditable={get:j.get,set:function(e,t,n){t===""&&(t="false"),j.set(e,t,n)}}),v.support.hrefNormalized||v.each(["href","src","width","height"],function(e,n){v.attrHooks[n]=v.extend(v.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),v.support.style||(v.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=t+""}}),v.support.optSelected||(v.propHooks.selected=v.extend(v.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),v.support.enctype||(v.propFix.enctype="encoding"),v.support.checkOn||v.each(["radio","checkbox"],function(){v.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),v.each(["radio","checkbox"],function(){v.valHooks[this]=v.extend(v.valHooks[this],{set:function(e,t){if(v.isArray(t))return e.checked=v.inArray(v(e).val(),t)>=0}})});var $=/^(?:textarea|input|select)$/i,J=/^([^\.]*|)(?:\.(.+)|)$/,K=/(?:^|\s)hover(\.\S+|)\b/,Q=/^key/,G=/^(?:mouse|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,Z=function(e){return v.event.special.hover?e:e.replace(K,"mouseenter$1 mouseleave$1")};v.event={add:function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,m,g;if(e.nodeType===3||e.nodeType===8||!n||!r||!(o=v._data(e)))return;r.handler&&(d=r,r=d.handler,s=d.selector),r.guid||(r.guid=v.guid++),a=o.events,a||(o.events=a={}),u=o.handle,u||(o.handle=u=function(e){return typeof v=="undefined"||!!e&&v.event.triggered===e.type?t:v.event.dispatch.apply(u.elem,arguments)},u.elem=e),n=v.trim(Z(n)).split(" ");for(f=0;f<n.length;f++){l=J.exec(n[f])||[],c=l[1],h=(l[2]||"").split(".").sort(),g=v.event.special[c]||{},c=(s?g.delegateType:g.bindType)||c,g=v.event.special[c]||{},p=v.extend({type:c,origType:l[1],data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&v.expr.match.needsContext.test(s),namespace:h.join(".")},d),m=a[c];if(!m){m=a[c]=[],m.delegateCount=0;if(!g.setup||g.setup.call(e,i,h,u)===!1)e.addEventListener?e.addEventListener(c,u,!1):e.attachEvent&&e.attachEvent("on"+c,u)}g.add&&(g.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),s?m.splice(m.delegateCount++,0,p):m.push(p),v.event.global[c]=!0}e=null},global:{},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,m,g=v.hasData(e)&&v._data(e);if(!g||!(h=g.events))return;t=v.trim(Z(t||"")).split(" ");for(s=0;s<t.length;s++){o=J.exec(t[s])||[],u=a=o[1],f=o[2];if(!u){for(u in h)v.event.remove(e,u+t[s],n,r,!0);continue}p=v.event.special[u]||{},u=(r?p.delegateType:p.bindType)||u,d=h[u]||[],l=d.length,f=f?new RegExp("(^|\\.)"+f.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(c=0;c<d.length;c++)m=d[c],(i||a===m.origType)&&(!n||n.guid===m.guid)&&(!f||f.test(m.namespace))&&(!r||r===m.selector||r==="**"&&m.selector)&&(d.splice(c--,1),m.selector&&d.delegateCount--,p.remove&&p.remove.call(e,m));d.length===0&&l!==d.length&&((!p.teardown||p.teardown.call(e,f,g.handle)===!1)&&v.removeEvent(e,u,g.handle),delete h[u])}v.isEmptyObject(h)&&(delete g.handle,v.removeData(e,"events",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,s,o){if(!s||s.nodeType!==3&&s.nodeType!==8){var u,a,f,l,c,h,p,d,m,g,y=n.type||n,b=[];if(Y.test(y+v.event.triggered))return;y.indexOf("!")>=0&&(y=y.slice(0,-1),a=!0),y.indexOf(".")>=0&&(b=y.split("."),y=b.shift(),b.sort());if((!s||v.event.customEvent[y])&&!v.event.global[y])return;n=typeof n=="object"?n[v.expando]?n:new v.Event(y,n):new v.Event(y),n.type=y,n.isTrigger=!0,n.exclusive=a,n.namespace=b.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,h=y.indexOf(":")<0?"on"+y:"";if(!s){u=v.cache;for(f in u)u[f].events&&u[f].events[y]&&v.event.trigger(n,r,u[f].handle.elem,!0);return}n.result=t,n.target||(n.target=s),r=r!=null?v.makeArray(r):[],r.unshift(n),p=v.event.special[y]||{};if(p.trigger&&p.trigger.apply(s,r)===!1)return;m=[[s,p.bindType||y]];if(!o&&!p.noBubble&&!v.isWindow(s)){g=p.delegateType||y,l=Y.test(g+y)?s:s.parentNode;for(c=s;l;l=l.parentNode)m.push([l,g]),c=l;c===(s.ownerDocument||i)&&m.push([c.defaultView||c.parentWindow||e,g])}for(f=0;f<m.length&&!n.isPropagationStopped();f++)l=m[f][0],n.type=m[f][1],d=(v._data(l,"events")||{})[n.type]&&v._data(l,"handle"),d&&d.apply(l,r),d=h&&l[h],d&&v.acceptData(l)&&d.apply&&d.apply(l,r)===!1&&n.preventDefault();return n.type=y,!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(s.ownerDocument,r)===!1)&&(y!=="click"||!v.nodeName(s,"a"))&&v.acceptData(s)&&h&&s[y]&&(y!=="focus"&&y!=="blur"||n.target.offsetWidth!==0)&&!v.isWindow(s)&&(c=s[h],c&&(s[h]=null),v.event.triggered=y,s[y](),v.event.triggered=t,c&&(s[h]=c)),n.result}return},dispatch:function(n){n=v.event.fix(n||e.event);var r,i,s,o,u,a,f,c,h,p,d=(v._data(this,"events")||{})[n.type]||[],m=d.delegateCount,g=l.call(arguments),y=!n.exclusive&&!n.namespace,b=v.event.special[n.type]||{},w=[];g[0]=n,n.delegateTarget=this;if(b.preDispatch&&b.preDispatch.call(this,n)===!1)return;if(m&&(!n.button||n.type!=="click"))for(s=n.target;s!=this;s=s.parentNode||this)if(s.disabled!==!0||n.type!=="click"){u={},f=[];for(r=0;r<m;r++)c=d[r],h=c.selector,u[h]===t&&(u[h]=c.needsContext?v(h,this).index(s)>=0:v.find(h,this,null,[s]).length),u[h]&&f.push(c);f.length&&w.push({elem:s,matches:f})}d.length>m&&w.push({elem:this,matches:d.slice(m)});for(r=0;r<w.length&&!n.isPropagationStopped();r++){a=w[r],n.currentTarget=a.elem;for(i=0;i<a.matches.length&&!n.isImmediatePropagationStopped();i++){c=a.matches[i];if(y||!n.namespace&&!c.namespace||n.namespace_re&&n.namespace_re.test(c.namespace))n.data=c.data,n.handleObj=c,o=((v.event.special[c.origType]||{}).handle||c.handler).apply(a.elem,g),o!==t&&(n.result=o,o===!1&&(n.preventDefault(),n.stopPropagation()))}}return b.postDispatch&&b.postDispatch.call(this,n),n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,s,o,u=n.button,a=n.fromElement;return e.pageX==null&&n.clientX!=null&&(r=e.target.ownerDocument||i,s=r.documentElement,o=r.body,e.pageX=n.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},fix:function(e){if(e[v.expando])return e;var t,n,r=e,s=v.event.fixHooks[e.type]||{},o=s.props?this.props.concat(s.props):this.props;e=v.Event(r);for(t=o.length;t;)n=o[--t],e[n]=r[n];return e.target||(e.target=r.srcElement||i),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,r):e},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){v.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=v.extend(new v.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?v.event.trigger(i,null,t):v.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},v.event.handle=v.event.dispatch,v.removeEvent=i.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]=="undefined"&&(e[r]=null),e.detachEvent(r,n))},v.Event=function(e,t){if(!(this instanceof v.Event))return new v.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?tt:et):this.type=e,t&&v.extend(this,t),this.timeStamp=e&&e.timeStamp||v.now(),this[v.expando]=!0},v.Event.prototype={preventDefault:function(){this.isDefaultPrevented=tt;var e=this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=tt;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=tt,this.stopPropagation()},isDefaultPrevented:et,isPropagationStopped:et,isImmediatePropagationStopped:et},v.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){v.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj,o=s.selector;if(!i||i!==r&&!v.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),v.support.submitBubbles||(v.event.special.submit={setup:function(){if(v.nodeName(this,"form"))return!1;v.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=v.nodeName(n,"input")||v.nodeName(n,"button")?n.form:t;r&&!v._data(r,"_submit_attached")&&(v.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),v._data(r,"_submit_attached",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&v.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(v.nodeName(this,"form"))return!1;v.event.remove(this,"._submit")}}),v.support.changeBubbles||(v.event.special.change={setup:function(){if($.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")v.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),v.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),v.event.simulate("change",this,e,!0)});return!1}v.event.add(this,"beforeactivate._change",function(e){var t=e.target;$.test(t.nodeName)&&!v._data(t,"_change_attached")&&(v.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&v.event.simulate("change",this.parentNode,e,!0)}),v._data(t,"_change_attached",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return v.event.remove(this,"._change"),!$.test(this.nodeName)}}),v.support.focusinBubbles||v.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){v.event.simulate(t,e.target,v.event.fix(e),!0)};v.event.special[t]={setup:function(){n++===0&&i.addEventListener(e,r,!0)},teardown:function(){--n===0&&i.removeEventListener(e,r,!0)}}}),v.fn.extend({on:function(e,n,r,i,s){var o,u;if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=t);for(u in e)this.on(u,n,r,e[u],s);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=et;else if(!i)return this;return s===1&&(o=i,i=function(e){return v().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=v.guid++)),this.each(function(){v.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,v(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if(typeof e=="object"){for(s in e)this.off(s,n,e[s]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=et),this.each(function(){v.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return v(this.context).on(e,this.selector,t,n),this},die:function(e,t){return v(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){v.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return v.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||v.guid++,r=0,i=function(n){var i=(v._data(this,"lastToggle"+e.guid)||0)%r;return v._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),v.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){v.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},Q.test(t)&&(v.event.fixHooks[t]=v.event.keyHooks),G.test(t)&&(v.event.fixHooks[t]=v.event.mouseHooks)}),function(e,t){function nt(e,t,n,r){n=n||[],t=t||g;var i,s,a,f,l=t.nodeType;if(!e||typeof e!="string")return n;if(l!==1&&l!==9)return[];a=o(t);if(!a&&!r)if(i=R.exec(e))if(f=i[1]){if(l===9){s=t.getElementById(f);if(!s||!s.parentNode)return n;if(s.id===f)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(f))&&u(t,s)&&s.id===f)return n.push(s),n}else{if(i[2])return S.apply(n,x.call(t.getElementsByTagName(e),0)),n;if((f=i[3])&&Z&&t.getElementsByClassName)return S.apply(n,x.call(t.getElementsByClassName(f),0)),n}return vt(e.replace(j,"$1"),t,n,r,a)}function rt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function it(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function st(e){return N(function(t){return t=+t,N(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ot(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}function ut(e,t){var n,r,s,o,u,a,f,l=L[d][e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=F.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=I.exec(u))s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=r[0].replace(j," ");for(o in i.filter)(r=J[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=o,n.matches=r);if(!n)break}return t?u.length:u?nt.error(e):L(e,a).slice(0)}function at(e,t,r){var i=t.dir,s=r&&t.dir==="parentNode",o=w++;return t.first?function(t,n,r){while(t=t[i])if(s||t.nodeType===1)return e(t,n,r)}:function(t,r,u){if(!u){var a,f=b+" "+o+" ",l=f+n;while(t=t[i])if(s||t.nodeType===1){if((a=t[d])===l)return t.sizset;if(typeof a=="string"&&a.indexOf(f)===0){if(t.sizset)return t}else{t[d]=l;if(e(t,r,u))return t.sizset=!0,t;t.sizset=!1}}}else while(t=t[i])if(s||t.nodeType===1)if(e(t,r,u))return t}}function ft(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function lt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function ct(e,t,n,r,i,s){return r&&!r[d]&&(r=ct(r)),i&&!i[d]&&(i=ct(i,s)),N(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||dt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?lt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=lt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?T.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=lt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):S.apply(o,g)})}function ht(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,f=at(function(e){return e===t},u,!0),l=at(function(e){return T.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==c)||((t=n).nodeType?f(e,n,r):l(e,n,r))}];for(;a<s;a++)if(n=i.relative[e[a].type])h=[at(ft(h),n)];else{n=i.filter[e[a].type].apply(null,e[a].matches);if(n[d]){r=++a;for(;r<s;r++)if(i.relative[e[r].type])break;return ct(a>1&&ft(h),a>1&&e.slice(0,a-1).join("").replace(j,"$1"),n,a<r&&ht(e.slice(a,r)),r<s&&ht(e=e.slice(r)),r<s&&e.join(""))}h.push(n)}return ft(h)}function pt(e,t){var r=t.length>0,s=e.length>0,o=function(u,a,f,l,h){var p,d,v,m=[],y=0,w="0",x=u&&[],T=h!=null,N=c,C=u||s&&i.find.TAG("*",h&&a.parentNode||a),k=b+=N==null?1:Math.E;T&&(c=a!==g&&a,n=o.el);for(;(p=C[w])!=null;w++){if(s&&p){for(d=0;v=e[d];d++)if(v(p,a,f)){l.push(p);break}T&&(b=k,n=++o.el)}r&&((p=!v&&p)&&y--,u&&x.push(p))}y+=w;if(r&&w!==y){for(d=0;v=t[d];d++)v(x,m,a,f);if(u){if(y>0)while(w--)!x[w]&&!m[w]&&(m[w]=E.call(l));m=lt(m)}S.apply(l,m),T&&!u&&m.length>0&&y+t.length>1&&nt.uniqueSort(l)}return T&&(b=k,c=N),x};return o.el=0,r?N(o):o}function dt(e,t,n){var r=0,i=t.length;for(;r<i;r++)nt(e,t[r],n);return n}function vt(e,t,n,r,s){var o,u,f,l,c,h=ut(e),p=h.length;if(!r&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&t.nodeType===9&&!s&&i.relative[u[1].type]){t=i.find.ID(f.matches[0].replace($,""),t,s)[0];if(!t)return n;e=e.slice(u.shift().length)}for(o=J.POS.test(e)?-1:u.length-1;o>=0;o--){f=u[o];if(i.relative[l=f.type])break;if(c=i.find[l])if(r=c(f.matches[0].replace($,""),z.test(u[0].type)&&t.parentNode||t,s)){u.splice(o,1),e=r.length&&u.join("");if(!e)return S.apply(n,x.call(r,0)),n;break}}}return a(e,h)(r,t,s,n,z.test(e)),n}function mt(){}var n,r,i,s,o,u,a,f,l,c,h=!0,p="undefined",d=("sizcache"+Math.random()).replace(".",""),m=String,g=e.document,y=g.documentElement,b=0,w=0,E=[].pop,S=[].push,x=[].slice,T=[].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},N=function(e,t){return e[d]=t==null||t,e},C=function(){var e={},t=[];return N(function(n,r){return t.push(n)>i.cacheLength&&delete e[t.shift()],e[n+" "]=r},e)},k=C(),L=C(),A=C(),O="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",_=M.replace("w","w#"),D="([*^$|!~]?=)",P="\\["+O+"*("+M+")"+O+"*(?:"+D+O+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+_+")|)|)"+O+"*\\]",H=":("+M+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+P+")|[^:]|\\\\.)*|.*))\\)|)",B=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+O+"*((?:-\\d)?\\d*)"+O+"*\\)|)(?=[^-]|$)",j=new RegExp("^"+O+"+|((?:^|[^\\\\])(?:\\\\.)*)"+O+"+$","g"),F=new RegExp("^"+O+"*,"+O+"*"),I=new RegExp("^"+O+"*([\\x20\\t\\r\\n\\f>+~])"+O+"*"),q=new RegExp(H),R=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,U=/^:not/,z=/[\x20\t\r\n\f]*[+~]/,W=/:not\($/,X=/h\d/i,V=/input|select|textarea|button/i,$=/\\(?!\\)/g,J={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),NAME:new RegExp("^\\[name=['\"]?("+M+")['\"]?\\]"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+H),POS:new RegExp(B,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+O+"*(even|odd|(([+-]|)(\\d*)n|)"+O+"*(?:([+-]|)"+O+"*(\\d+)|))"+O+"*\\)|)","i"),needsContext:new RegExp("^"+O+"*[>+~]|"+B,"i")},K=function(e){var t=g.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}},Q=K(function(e){return e.appendChild(g.createComment("")),!e.getElementsByTagName("*").length}),G=K(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==p&&e.firstChild.getAttribute("href")==="#"}),Y=K(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),Z=K(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!e.getElementsByClassName||!e.getElementsByClassName("e").length?!1:(e.lastChild.className="e",e.getElementsByClassName("e").length===2)}),et=K(function(e){e.id=d+0,e.innerHTML="<a name='"+d+"'></a><div name='"+d+"'></div>",y.insertBefore(e,y.firstChild);var t=g.getElementsByName&&g.getElementsByName(d).length===2+g.getElementsByName(d+0).length;return r=!g.getElementById(d),y.removeChild(e),t});try{x.call(y.childNodes,0)[0].nodeType}catch(tt){x=function(e){var t,n=[];for(;t=this[e];e++)n.push(t);return n}}nt.matches=function(e,t){return nt(e,null,null,t)},nt.matchesSelector=function(e,t){return nt(t,null,null,[e]).length>0},s=nt.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue}else for(;t=e[r];r++)n+=s(t);return n},o=nt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},u=nt.contains=y.contains?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!(r&&r.nodeType===1&&n.contains&&n.contains(r))}:y.compareDocumentPosition?function(e,t){return t&&!!(e.compareDocumentPosition(t)&16)}:function(e,t){while(t=t.parentNode)if(t===e)return!0;return!1},nt.attr=function(e,t){var n,r=o(e);return r||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):r||Y?e.getAttribute(t):(n=e.getAttributeNode(t),n?typeof e[t]=="boolean"?e[t]?t:null:n.specified?n.value:null:null)},i=nt.selectors={cacheLength:50,createPseudo:N,match:J,attrHandle:G?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:r?function(e,t,n){if(typeof t.getElementById!==p&&!n){var r=t.getElementById(e);return r&&r.parentNode?[r]:[]}}:function(e,n,r){if(typeof n.getElementById!==p&&!r){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==p&&i.getAttributeNode("id").value===e?[i]:t:[]}},TAG:Q?function(e,t){if(typeof t.getElementsByTagName!==p)return t.getElementsByTagName(e)}:function(e,t){var n=t.getElementsByTagName(e);if(e==="*"){var r,i=[],s=0;for(;r=n[s];s++)r.nodeType===1&&i.push(r);return i}return n},NAME:et&&function(e,t){if(typeof t.getElementsByName!==p)return t.getElementsByName(name)},CLASS:Z&&function(e,t,n){if(typeof t.getElementsByClassName!==p&&!n)return t.getElementsByClassName(e)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace($,""),e[3]=(e[4]||e[5]||"").replace($,""),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1]==="nth"?(e[2]||nt.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]==="even"||e[2]==="odd")),e[4]=+(e[6]+e[7]||e[2]==="odd")):e[2]&&nt.error(e[0]),e},PSEUDO:function(e){var t,n;if(J.CHILD.test(e[0]))return null;if(e[3])e[2]=e[3];else if(t=e[4])q.test(t)&&(n=ut(t,!0))&&(n=t.indexOf(")",t.length-n)-t.length)&&(t=t.slice(0,n),e[0]=e[0].slice(0,n)),e[2]=t;return e.slice(0,3)}},filter:{ID:r?function(e){return e=e.replace($,""),function(t){return t.getAttribute("id")===e}}:function(e){return e=e.replace($,""),function(t){var n=typeof t.getAttributeNode!==p&&t.getAttributeNode("id");return n&&n.value===e}},TAG:function(e){return e==="*"?function(){return!0}:(e=e.replace($,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[d][e+" "];return t||(t=new RegExp("(^|"+O+")"+e+"("+O+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==p&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r,i){var s=nt.attr(r,e);return s==null?t==="!=":t?(s+="",t==="="?s===n:t==="!="?s!==n:t==="^="?n&&s.indexOf(n)===0:t==="*="?n&&s.indexOf(n)>-1:t==="$="?n&&s.substr(s.length-n.length)===n:t==="~="?(" "+s+" ").indexOf(n)>-1:t==="|="?s===n||s.substr(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r){return e==="nth"?function(e){var t,i,s=e.parentNode;if(n===1&&r===0)return!0;if(s){i=0;for(t=s.firstChild;t;t=t.nextSibling)if(t.nodeType===1){i++;if(e===t)break}}return i-=r,i===n||i%n===0&&i/n>=0}:function(t){var n=t;switch(e){case"only":case"first":while(n=n.previousSibling)if(n.nodeType===1)return!1;if(e==="first")return!0;n=t;case"last":while(n=n.nextSibling)if(n.nodeType===1)return!1;return!0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||nt.error("unsupported pseudo: "+e);return r[d]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?N(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=T.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:N(function(e){var t=[],n=[],r=a(e.replace(j,"$1"));return r[d]?N(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:N(function(e){return function(t){return nt(e,t).length>0}}),contains:N(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!i.pseudos.empty(e)},empty:function(e){var t;e=e.firstChild;while(e){if(e.nodeName>"@"||(t=e.nodeType)===3||t===4)return!1;e=e.nextSibling}return!0},header:function(e){return X.test(e.nodeName)},text:function(e){var t,n;return e.nodeName.toLowerCase()==="input"&&(t=e.type)==="text"&&((n=e.getAttribute("type"))==null||n.toLowerCase()===t)},radio:rt("radio"),checkbox:rt("checkbox"),file:rt("file"),password:rt("password"),image:rt("image"),submit:it("submit"),reset:it("reset"),button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},input:function(e){return V.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:st(function(){return[0]}),last:st(function(e,t){return[t-1]}),eq:st(function(e,t,n){return[n<0?n+t:n]}),even:st(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:st(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:st(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:st(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}},f=y.compareDocumentPosition?function(e,t){return e===t?(l=!0,0):(!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition:e.compareDocumentPosition(t)&4)?-1:1}:function(e,t){if(e===t)return l=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,u=t.parentNode,a=o;if(o===u)return ot(e,t);if(!o)return-1;if(!u)return 1;while(a)i.unshift(a),a=a.parentNode;a=u;while(a)s.unshift(a),a=a.parentNode;n=i.length,r=s.length;for(var f=0;f<n&&f<r;f++)if(i[f]!==s[f])return ot(i[f],s[f]);return f===n?ot(e,s[f],-1):ot(i[f],t,1)},[0,0].sort(f),h=!l,nt.uniqueSort=function(e){var t,n=[],r=1,i=0;l=h,e.sort(f);if(l){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e},nt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},a=nt.compile=function(e,t){var n,r=[],i=[],s=A[d][e+" "];if(!s){t||(t=ut(e)),n=t.length;while(n--)s=ht(t[n]),s[d]?r.push(s):i.push(s);s=A(e,pt(i,r))}return s},g.querySelectorAll&&function(){var e,t=vt,n=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,i=[":focus"],s=[":active"],u=y.matchesSelector||y.mozMatchesSelector||y.webkitMatchesSelector||y.oMatchesSelector||y.msMatchesSelector;K(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||i.push("\\["+O+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||i.push(":checked")}),K(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&i.push("[*^$]="+O+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'/>",e.querySelectorAll(":enabled").length||i.push(":enabled",":disabled")}),i=new RegExp(i.join("|")),vt=function(e,r,s,o,u){if(!o&&!u&&!i.test(e)){var a,f,l=!0,c=d,h=r,p=r.nodeType===9&&e;if(r.nodeType===1&&r.nodeName.toLowerCase()!=="object"){a=ut(e),(l=r.getAttribute("id"))?c=l.replace(n,"\\$&"):r.setAttribute("id",c),c="[id='"+c+"'] ",f=a.length;while(f--)a[f]=c+a[f].join("");h=z.test(e)&&r.parentNode||r,p=a.join(",")}if(p)try{return S.apply(s,x.call(h.querySelectorAll(p),0)),s}catch(v){}finally{l||r.removeAttribute("id")}}return t(e,r,s,o,u)},u&&(K(function(t){e=u.call(t,"div");try{u.call(t,"[test!='']:sizzle"),s.push("!=",H)}catch(n){}}),s=new RegExp(s.join("|")),nt.matchesSelector=function(t,n){n=n.replace(r,"='$1']");if(!o(t)&&!s.test(n)&&!i.test(n))try{var a=u.call(t,n);if(a||e||t.document&&t.document.nodeType!==11)return a}catch(f){}return nt(n,null,null,[t]).length>0})}(),i.pseudos.nth=i.pseudos.eq,i.filters=mt.prototype=i.pseudos,i.setFilters=new mt,nt.attr=v.attr,v.find=nt,v.expr=nt.selectors,v.expr[":"]=v.expr.pseudos,v.unique=nt.uniqueSort,v.text=nt.getText,v.isXMLDoc=nt.isXML,v.contains=nt.contains}(e);var nt=/Until$/,rt=/^(?:parents|prev(?:Until|All))/,it=/^.[^:#\[\.,]*$/,st=v.expr.match.needsContext,ot={children:!0,contents:!0,next:!0,prev:!0};v.fn.extend({find:function(e){var t,n,r,i,s,o,u=this;if(typeof e!="string")return v(e).filter(function(){for(t=0,n=u.length;t<n;t++)if(v.contains(u[t],this))return!0});o=this.pushStack("","find",e);for(t=0,n=this.length;t<n;t++){r=o.length,v.find(e,this[t],o);if(t>0)for(i=r;i<o.length;i++)for(s=0;s<r;s++)if(o[s]===o[i]){o.splice(i--,1);break}}return o},has:function(e){var t,n=v(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(v.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1),"not",e)},filter:function(e){return this.pushStack(ft(this,e,!0),"filter",e)},is:function(e){return!!e&&(typeof e=="string"?st.test(e)?v(e,this.context).index(this[0])>=0:v.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=st.test(e)||typeof e!="string"?v(e,t||this.context):0;for(;r<i;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&n.nodeType!==11){if(o?o.index(n)>-1:v.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return s=s.length>1?v.unique(s):s,this.pushStack(s,"closest",e)},index:function(e){return e?typeof e=="string"?v.inArray(this[0],v(e)):v.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?v(e,t):v.makeArray(e&&e.nodeType?[e]:e),r=v.merge(this.get(),n);return this.pushStack(ut(n[0])||ut(r[0])?r:v.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),v.fn.andSelf=v.fn.addBack,v.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return v.dir(e,"parentNode")},parentsUntil:function(e,t,n){return v.dir(e,"parentNode",n)},next:function(e){return at(e,"nextSibling")},prev:function(e){return at(e,"previousSibling")},nextAll:function(e){return v.dir(e,"nextSibling")},prevAll:function(e){return v.dir(e,"previousSibling")},nextUntil:function(e,t,n){return v.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return v.dir(e,"previousSibling",n)},siblings:function(e){return v.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return v.sibling(e.firstChild)},contents:function(e){return v.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:v.merge([],e.childNodes)}},function(e,t){v.fn[e]=function(n,r){var i=v.map(this,t,n);return nt.test(e)||(r=n),r&&typeof r=="string"&&(i=v.filter(r,i)),i=this.length>1&&!ot[e]?v.unique(i):i,this.length>1&&rt.test(e)&&(i=i.reverse()),this.pushStack(i,e,l.call(arguments).join(","))}}),v.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?v.find.matchesSelector(t[0],e)?[t[0]]:[]:v.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!v(s).is(r)))s.nodeType===1&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var ct="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ht=/ jQuery\d+="(?:null|\d+)"/g,pt=/^\s+/,dt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,vt=/<([\w:]+)/,mt=/<tbody/i,gt=/<|&#?\w+;/,yt=/<(?:script|style|link)/i,bt=/<(?:script|object|embed|option|style)/i,wt=new RegExp("<(?:"+ct+")[\\s/>]","i"),Et=/^(?:checkbox|radio)$/,St=/checked\s*(?:[^=]|=\s*.checked.)/i,xt=/\/(java|ecma)script/i,Tt=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Nt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Ct=lt(i),kt=Ct.appendChild(i.createElement("div"));Nt.optgroup=Nt.option,Nt.tbody=Nt.tfoot=Nt.colgroup=Nt.caption=Nt.thead,Nt.th=Nt.td,v.support.htmlSerialize||(Nt._default=[1,"X<div>","</div>"]),v.fn.extend({text:function(e){return v.access(this,function(e){return e===t?v.text(this):this.empty().append((this[0]&&this[0].ownerDocument||i).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(v.isFunction(e))return this.each(function(t){v(this).wrapAll(e.call(this,t))});if(this[0]){var t=v(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return v.isFunction(e)?this.each(function(t){v(this).wrapInner(e.call(this,t))}):this.each(function(){var t=v(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=v.isFunction(e);return this.each(function(n){v(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){v.nodeName(this,"body")||v(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(e,this.firstChild)})},before:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(e,this),"before",this.selector)}},after:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(this,e),"after",this.selector)}},remove:function(e,t){var n,r=0;for(;(n=this[r])!=null;r++)if(!e||v.filter(e,[n]).length)!t&&n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),v.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n);return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&v.cleanData(e.getElementsByTagName("*"));while(e.firstChild)e.removeChild(e.firstChild)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return v.clone(this,e,t)})},html:function(e){return v.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(ht,""):t;if(typeof e=="string"&&!yt.test(e)&&(v.support.htmlSerialize||!wt.test(e))&&(v.support.leadingWhitespace||!pt.test(e))&&!Nt[(vt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(dt,"<$1></$2>");try{for(;r<i;r++)n=this[r]||{},n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return ut(this[0])?this.length?this.pushStack(v(v.isFunction(e)?e():e),"replaceWith",e):this:v.isFunction(e)?this.each(function(t){var n=v(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!="string"&&(e=v(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;v(this).remove(),t?v(t).before(e):v(n).append(e)}))},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=[].concat.apply([],e);var i,s,o,u,a=0,f=e[0],l=[],c=this.length;if(!v.support.checkClone&&c>1&&typeof f=="string"&&St.test(f))return this.each(function(){v(this).domManip(e,n,r)});if(v.isFunction(f))return this.each(function(i){var s=v(this);e[0]=f.call(this,i,n?s.html():t),s.domManip(e,n,r)});if(this[0]){i=v.buildFragment(e,this,l),o=i.fragment,s=o.firstChild,o.childNodes.length===1&&(o=s);if(s){n=n&&v.nodeName(s,"tr");for(u=i.cacheable||c-1;a<c;a++)r.call(n&&v.nodeName(this[a],"table")?Lt(this[a],"tbody"):this[a],a===u?o:v.clone(o,!0,!0))}o=s=null,l.length&&v.each(l,function(e,t){t.src?v.ajax?v.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):v.error("no ajax"):v.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Tt,"")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),v.buildFragment=function(e,n,r){var s,o,u,a=e[0];return n=n||i,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,e.length===1&&typeof a=="string"&&a.length<512&&n===i&&a.charAt(0)==="<"&&!bt.test(a)&&(v.support.checkClone||!St.test(a))&&(v.support.html5Clone||!wt.test(a))&&(o=!0,s=v.fragments[a],u=s!==t),s||(s=n.createDocumentFragment(),v.clean(e,n,s,r),o&&(v.fragments[a]=u&&s)),{fragment:s,cacheable:o}},v.fragments={},v.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){v.fn[e]=function(n){var r,i=0,s=[],o=v(n),u=o.length,a=this.length===1&&this[0].parentNode;if((a==null||a&&a.nodeType===11&&a.childNodes.length===1)&&u===1)return o[t](this[0]),this;for(;i<u;i++)r=(i>0?this.clone(!0):this).get(),v(o[i])[t](r),s=s.concat(r);return this.pushStack(s,e,o.selector)}}),v.extend({clone:function(e,t,n){var r,i,s,o;v.support.html5Clone||v.isXMLDoc(e)||!wt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(kt.innerHTML=e.outerHTML,kt.removeChild(o=kt.firstChild));if((!v.support.noCloneEvent||!v.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!v.isXMLDoc(e)){Ot(e,o),r=Mt(e),i=Mt(o);for(s=0;r[s];++s)i[s]&&Ot(r[s],i[s])}if(t){At(e,o);if(n){r=Mt(e),i=Mt(o);for(s=0;r[s];++s)At(r[s],i[s])}}return r=i=null,o},clean:function(e,t,n,r){var s,o,u,a,f,l,c,h,p,d,m,g,y=t===i&&Ct,b=[];if(!t||typeof t.createDocumentFragment=="undefined")t=i;for(s=0;(u=e[s])!=null;s++){typeof u=="number"&&(u+="");if(!u)continue;if(typeof u=="string")if(!gt.test(u))u=t.createTextNode(u);else{y=y||lt(t),c=t.createElement("div"),y.appendChild(c),u=u.replace(dt,"<$1></$2>"),a=(vt.exec(u)||["",""])[1].toLowerCase(),f=Nt[a]||Nt._default,l=f[0],c.innerHTML=f[1]+u+f[2];while(l--)c=c.lastChild;if(!v.support.tbody){h=mt.test(u),p=a==="table"&&!h?c.firstChild&&c.firstChild.childNodes:f[1]==="<table>"&&!h?c.childNodes:[];for(o=p.length-1;o>=0;--o)v.nodeName(p[o],"tbody")&&!p[o].childNodes.length&&p[o].parentNode.removeChild(p[o])}!v.support.leadingWhitespace&&pt.test(u)&&c.insertBefore(t.createTextNode(pt.exec(u)[0]),c.firstChild),u=c.childNodes,c.parentNode.removeChild(c)}u.nodeType?b.push(u):v.merge(b,u)}c&&(u=c=y=null);if(!v.support.appendChecked)for(s=0;(u=b[s])!=null;s++)v.nodeName(u,"input")?_t(u):typeof u.getElementsByTagName!="undefined"&&v.grep(u.getElementsByTagName("input"),_t);if(n){m=function(e){if(!e.type||xt.test(e.type))return r?r.push(e.parentNode?e.parentNode.removeChild(e):e):n.appendChild(e)};for(s=0;(u=b[s])!=null;s++)if(!v.nodeName(u,"script")||!m(u))n.appendChild(u),typeof u.getElementsByTagName!="undefined"&&(g=v.grep(v.merge([],u.getElementsByTagName("script")),m),b.splice.apply(b,[s+1,0].concat(g)),s+=g.length)}return b},cleanData:function(e,t){var n,r,i,s,o=0,u=v.expando,a=v.cache,f=v.support.deleteExpando,l=v.event.special;for(;(i=e[o])!=null;o++)if(t||v.acceptData(i)){r=i[u],n=r&&a[r];if(n){if(n.events)for(s in n.events)l[s]?v.event.remove(i,s):v.removeEvent(i,s,n.handle);a[r]&&(delete a[r],f?delete i[u]:i.removeAttribute?i.removeAttribute(u):i[u]=null,v.deletedIds.push(r))}}}}),function(){var e,t;v.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e=v.uaMatch(o.userAgent),t={},e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),v.browser=t,v.sub=function(){function e(t,n){return new e.fn.init(t,n)}v.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,i){return i&&i instanceof v&&!(i instanceof e)&&(i=e(i)),v.fn.init.call(this,r,i,t)},e.fn.init.prototype=e.fn;var t=e(i);return e}}();var Dt,Pt,Ht,Bt=/alpha\([^)]*\)/i,jt=/opacity=([^)]*)/,Ft=/^(top|right|bottom|left)$/,It=/^(none|table(?!-c[ea]).+)/,qt=/^margin/,Rt=new RegExp("^("+m+")(.*)$","i"),Ut=new RegExp("^("+m+")(?!px)[a-z%]+$","i"),zt=new RegExp("^([-+])=("+m+")","i"),Wt={BODY:"block"},Xt={position:"absolute",visibility:"hidden",display:"block"},Vt={letterSpacing:0,fontWeight:400},$t=["Top","Right","Bottom","Left"],Jt=["Webkit","O","Moz","ms"],Kt=v.fn.toggle;v.fn.extend({css:function(e,n){return v.access(this,function(e,n,r){return r!==t?v.style(e,n,r):v.css(e,n)},e,n,arguments.length>1)},show:function(){return Yt(this,!0)},hide:function(){return Yt(this)},toggle:function(e,t){var n=typeof e=="boolean";return v.isFunction(e)&&v.isFunction(t)?Kt.apply(this,arguments):this.each(function(){(n?e:Gt(this))?v(this).show():v(this).hide()})}}),v.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Dt(e,"opacity");return n===""?"1":n}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":v.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var s,o,u,a=v.camelCase(n),f=e.style;n=v.cssProps[a]||(v.cssProps[a]=Qt(f,a)),u=v.cssHooks[n]||v.cssHooks[a];if(r===t)return u&&"get"in u&&(s=u.get(e,!1,i))!==t?s:f[n];o=typeof r,o==="string"&&(s=zt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(v.css(e,n)),o="number");if(r==null||o==="number"&&isNaN(r))return;o==="number"&&!v.cssNumber[a]&&(r+="px");if(!u||!("set"in u)||(r=u.set(e,r,i))!==t)try{f[n]=r}catch(l){}},css:function(e,n,r,i){var s,o,u,a=v.camelCase(n);return n=v.cssProps[a]||(v.cssProps[a]=Qt(e.style,a)),u=v.cssHooks[n]||v.cssHooks[a],u&&"get"in u&&(s=u.get(e,!0,i)),s===t&&(s=Dt(e,n)),s==="normal"&&n in Vt&&(s=Vt[n]),r||i!==t?(o=parseFloat(s),r||v.isNumeric(o)?o||0:s):s},swap:function(e,t,n){var r,i,s={};for(i in t)s[i]=e.style[i],e.style[i]=t[i];r=n.call(e);for(i in t)e.style[i]=s[i];return r}}),e.getComputedStyle?Dt=function(t,n){var r,i,s,o,u=e.getComputedStyle(t,null),a=t.style;return u&&(r=u.getPropertyValue(n)||u[n],r===""&&!v.contains(t.ownerDocument,t)&&(r=v.style(t,n)),Ut.test(r)&&qt.test(n)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=r,r=u.width,a.width=i,a.minWidth=s,a.maxWidth=o)),r}:i.documentElement.currentStyle&&(Dt=function(e,t){var n,r,i=e.currentStyle&&e.currentStyle[t],s=e.style;return i==null&&s&&s[t]&&(i=s[t]),Ut.test(i)&&!Ft.test(t)&&(n=s.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),s.left=t==="fontSize"?"1em":i,i=s.pixelLeft+"px",s.left=n,r&&(e.runtimeStyle.left=r)),i===""?"auto":i}),v.each(["height","width"],function(e,t){v.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&It.test(Dt(e,"display"))?v.swap(e,Xt,function(){return tn(e,t,r)}):tn(e,t,r)},set:function(e,n,r){return Zt(e,n,r?en(e,t,r,v.support.boxSizing&&v.css(e,"boxSizing")==="border-box"):0)}}}),v.support.opacity||(v.cssHooks.opacity={get:function(e,t){return jt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=v.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&v.trim(s.replace(Bt,""))===""&&n.removeAttribute){n.removeAttribute("filter");if(r&&!r.filter)return}n.filter=Bt.test(s)?s.replace(Bt,i):s+" "+i}}),v(function(){v.support.reliableMarginRight||(v.cssHooks.marginRight={get:function(e,t){return v.swap(e,{display:"inline-block"},function(){if(t)return Dt(e,"marginRight")})}}),!v.support.pixelPosition&&v.fn.position&&v.each(["top","left"],function(e,t){v.cssHooks[t]={get:function(e,n){if(n){var r=Dt(e,t);return Ut.test(r)?v(e).position()[t]+"px":r}}}})}),v.expr&&v.expr.filters&&(v.expr.filters.hidden=function(e){return e.offsetWidth===0&&e.offsetHeight===0||!v.support.reliableHiddenOffsets&&(e.style&&e.style.display||Dt(e,"display"))==="none"},v.expr.filters.visible=function(e){return!v.expr.filters.hidden(e)}),v.each({margin:"",padding:"",border:"Width"},function(e,t){v.cssHooks[e+t]={expand:function(n){var r,i=typeof n=="string"?n.split(" "):[n],s={};for(r=0;r<4;r++)s[e+$t[r]+t]=i[r]||i[r-2]||i[0];return s}},qt.test(e)||(v.cssHooks[e+t].set=Zt)});var rn=/%20/g,sn=/\[\]$/,on=/\r?\n/g,un=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,an=/^(?:select|textarea)/i;v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?v.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||an.test(this.nodeName)||un.test(this.type))}).map(function(e,t){var n=v(this).val();return n==null?null:v.isArray(n)?v.map(n,function(e,n){return{name:t.name,value:e.replace(on,"\r\n")}}):{name:t.name,value:n.replace(on,"\r\n")}}).get()}}),v.param=function(e,n){var r,i=[],s=function(e,t){t=v.isFunction(t)?t():t==null?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=v.ajaxSettings&&v.ajaxSettings.traditional);if(v.isArray(e)||e.jquery&&!v.isPlainObject(e))v.each(e,function(){s(this.name,this.value)});else for(r in e)fn(r,e[r],n,s);return i.join("&").replace(rn,"+")};var ln,cn,hn=/#.*$/,pn=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,dn=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,vn=/^(?:GET|HEAD)$/,mn=/^\/\//,gn=/\?/,yn=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bn=/([?&])_=[^&]*/,wn=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,En=v.fn.load,Sn={},xn={},Tn=["*/"]+["*"];try{cn=s.href}catch(Nn){cn=i.createElement("a"),cn.href="",cn=cn.href}ln=wn.exec(cn.toLowerCase())||[],v.fn.load=function(e,n,r){if(typeof e!="string"&&En)return En.apply(this,arguments);if(!this.length)return this;var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),v.isFunction(n)?(r=n,n=t):n&&typeof n=="object"&&(s="POST"),v.ajax({url:e,type:s,dataType:"html",data:n,complete:function(e,t){r&&u.each(r,o||[e.responseText,t,e])}}).done(function(e){o=arguments,u.html(i?v("<div>").append(e.replace(yn,"")).find(i):e)}),this},v.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){v.fn[t]=function(e){return this.on(t,e)}}),v.each(["get","post"],function(e,n){v[n]=function(e,r,i,s){return v.isFunction(r)&&(s=s||i,i=r,r=t),v.ajax({type:n,url:e,data:r,success:i,dataType:s})}}),v.extend({getScript:function(e,n){return v.get(e,t,n,"script")},getJSON:function(e,t,n){return v.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?Ln(e,v.ajaxSettings):(t=e,e=v.ajaxSettings),Ln(e,t),e},ajaxSettings:{url:cn,isLocal:dn.test(ln[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Tn},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":v.parseJSON,"text xml":v.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Cn(Sn),ajaxTransport:Cn(xn),ajax:function(e,n){function T(e,n,s,a){var l,y,b,w,S,T=n;if(E===2)return;E=2,u&&clearTimeout(u),o=t,i=a||"",x.readyState=e>0?4:0,s&&(w=An(c,x,s));if(e>=200&&e<300||e===304)c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(v.lastModified[r]=S),S=x.getResponseHeader("Etag"),S&&(v.etag[r]=S)),e===304?(T="notmodified",l=!0):(l=On(c,w),T=l.state,y=l.data,b=l.error,l=!b);else{b=T;if(!T||e)T="error",e<0&&(e=0)}x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[y,T,x]):d.rejectWith(h,[x,T,b]),x.statusCode(g),g=t,f&&p.trigger("ajax"+(l?"Success":"Error"),[x,c,l?y:b]),m.fireWith(h,[x,T]),f&&(p.trigger("ajaxComplete",[x,c]),--v.active||v.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=v.ajaxSetup({},n),h=c.context||c,p=h!==c&&(h.nodeType||h instanceof v)?v(h):v.event,d=v.Deferred(),m=v.Callbacks("once memory"),g=c.statusCode||{},b={},w={},E=0,S="canceled",x={readyState:0,setRequestHeader:function(e,t){if(!E){var n=e.toLowerCase();e=w[n]=w[n]||e,b[e]=t}return this},getAllResponseHeaders:function(){return E===2?i:null},getResponseHeader:function(e){var n;if(E===2){if(!s){s={};while(n=pn.exec(i))s[n[1].toLowerCase()]=n[2]}n=s[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return E||(c.mimeType=e),this},abort:function(e){return e=e||S,o&&o.abort(e),T(0,e),this}};d.promise(x),x.success=x.done,x.error=x.fail,x.complete=m.add,x.statusCode=function(e){if(e){var t;if(E<2)for(t in e)g[t]=[g[t],e[t]];else t=e[x.status],x.always(t)}return this},c.url=((e||c.url)+"").replace(hn,"").replace(mn,ln[1]+"//"),c.dataTypes=v.trim(c.dataType||"*").toLowerCase().split(y),c.crossDomain==null&&(a=wn.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===ln[1]&&a[2]===ln[2]&&(a[3]||(a[1]==="http:"?80:443))==(ln[3]||(ln[1]==="http:"?80:443)))),c.data&&c.processData&&typeof c.data!="string"&&(c.data=v.param(c.data,c.traditional)),kn(Sn,c,n,x);if(E===2)return x;f=c.global,c.type=c.type.toUpperCase(),c.hasContent=!vn.test(c.type),f&&v.active++===0&&v.event.trigger("ajaxStart");if(!c.hasContent){c.data&&(c.url+=(gn.test(c.url)?"&":"?")+c.data,delete c.data),r=c.url;if(c.cache===!1){var N=v.now(),C=c.url.replace(bn,"$1_="+N);c.url=C+(C===c.url?(gn.test(c.url)?"&":"?")+"_="+N:"")}}(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),c.ifModified&&(r=r||c.url,v.lastModified[r]&&x.setRequestHeader("If-Modified-Since",v.lastModified[r]),v.etag[r]&&x.setRequestHeader("If-None-Match",v.etag[r])),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!=="*"?", "+Tn+"; q=0.01":""):c.accepts["*"]);for(l in c.headers)x.setRequestHeader(l,c.headers[l]);if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&E!==2){S="abort";for(l in{success:1,error:1,complete:1})x[l](c[l]);o=kn(xn,c,n,x);if(!o)T(-1,"No Transport");else{x.readyState=1,f&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{E=1,o.send(b,T)}catch(k){if(!(E<2))throw k;T(-1,k)}}return x}return x.abort()},active:0,lastModified:{},etag:{}});var Mn=[],_n=/\?/,Dn=/(=)\?(?=&|$)|\?\?/,Pn=v.now();v.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Mn.pop()||v.expando+"_"+Pn++;return this[e]=!0,e}}),v.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.data,f=n.url,l=n.jsonp!==!1,c=l&&Dn.test(f),h=l&&!c&&typeof a=="string"&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Dn.test(a);if(n.dataTypes[0]==="jsonp"||c||h)return s=n.jsonpCallback=v.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,o=e[s],c?n.url=f.replace(Dn,"$1"+s):h?n.data=a.replace(Dn,"$1"+s):l&&(n.url+=(_n.test(f)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||v.error(s+" was not called"),u[0]},n.dataTypes[0]="json",e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,Mn.push(s)),u&&v.isFunction(o)&&o(u[0]),u=o=t}),"script"}),v.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return v.globalEval(e),e}}}),v.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),v.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=i.head||i.getElementsByTagName("head")[0]||i.documentElement;return{send:function(s,o){n=i.createElement("script"),n.async="async",e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,i){if(i||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n),n=t,i||o(200,"success")},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var Hn,Bn=e.ActiveXObject?function(){for(var e in Hn)Hn[e](0,1)}:!1,jn=0;v.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&Fn()||In()}:Fn,function(e){v.extend(v.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(v.ajaxSettings.xhr()),v.support.ajax&&v.ajaxTransport(function(n){if(!n.crossDomain||v.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async);if(n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c,h;try{if(r&&(i||a.readyState===4)){r=t,o&&(a.onreadystatechange=v.noop,Bn&&delete Hn[o]);if(i)a.readyState!==4&&a.abort();else{u=a.status,l=a.getAllResponseHeaders(),c={},h=a.responseXML,h&&h.documentElement&&(c.xml=h);try{c.text=a.responseText}catch(p){}try{f=a.statusText}catch(p){f=""}!u&&n.isLocal&&!n.crossDomain?u=c.text?200:404:u===1223&&(u=204)}}}catch(d){i||s(-1,d)}c&&s(u,f,c,l)},n.async?a.readyState===4?setTimeout(r,0):(o=++jn,Bn&&(Hn||(Hn={},v(e).unload(Bn)),Hn[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(0,1)}}}});var qn,Rn,Un=/^(?:toggle|show|hide)$/,zn=new RegExp("^(?:([-+])=|)("+m+")([a-z%]*)$","i"),Wn=/queueHooks$/,Xn=[Gn],Vn={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=zn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){n=+s[2],r=s[3]||(v.cssNumber[e]?"":"px");if(r!=="px"&&u){u=v.css(i.elem,e,!0)||n||1;do a=a||".5",u/=a,v.style(i.elem,e,u+r);while(a!==(a=i.cur()/o)&&a!==1&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};v.Animation=v.extend(Kn,{tweener:function(e,t){v.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],Vn[n]=Vn[n]||[],Vn[n].unshift(t)},prefilter:function(e,t){t?Xn.unshift(e):Xn.push(e)}}),v.Tween=Yn,Yn.prototype={constructor:Yn,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(v.cssNumber[n]?"":"px")},cur:function(){var e=Yn.propHooks[this.prop];return e&&e.get?e.get(this):Yn.propHooks._default.get(this)},run:function(e){var t,n=Yn.propHooks[this.prop];return this.options.duration?this.pos=t=v.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Yn.propHooks._default.set(this),this}},Yn.prototype.init.prototype=Yn.prototype,Yn.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=v.css(e.elem,e.prop,!1,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){v.fx.step[e.prop]?v.fx.step[e.prop](e):e.elem.style&&(e.elem.style[v.cssProps[e.prop]]!=null||v.cssHooks[e.prop])?v.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Yn.propHooks.scrollTop=Yn.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},v.each(["toggle","show","hide"],function(e,t){var n=v.fn[t];v.fn[t]=function(r,i,s){return r==null||typeof r=="boolean"||!e&&v.isFunction(r)&&v.isFunction(i)?n.apply(this,arguments):this.animate(Zn(t,!0),r,i,s)}}),v.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Gt).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=v.isEmptyObject(e),s=v.speed(t,n,r),o=function(){var t=Kn(this,v.extend({},e),s);i&&t.stop(!0)};return i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=e!=null&&e+"queueHooks",s=v.timers,o=v._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Wn.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem===this&&(e==null||s[n].queue===e)&&(s[n].anim.stop(r),t=!1,s.splice(n,1));(t||!r)&&v.dequeue(this,e)})}}),v.each({slideDown:Zn("show"),slideUp:Zn("hide"),slideToggle:Zn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){v.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),v.speed=function(e,t,n){var r=e&&typeof e=="object"?v.extend({},e):{complete:n||!n&&t||v.isFunction(e)&&e,duration:e,easing:n&&t||t&&!v.isFunction(t)&&t};r.duration=v.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in v.fx.speeds?v.fx.speeds[r.duration]:v.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){v.isFunction(r.old)&&r.old.call(this),r.queue&&v.dequeue(this,r.queue)},r},v.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},v.timers=[],v.fx=Yn.prototype.init,v.fx.tick=function(){var e,n=v.timers,r=0;qn=v.now();for(;r<n.length;r++)e=n[r],!e()&&n[r]===e&&n.splice(r--,1);n.length||v.fx.stop(),qn=t},v.fx.timer=function(e){e()&&v.timers.push(e)&&!Rn&&(Rn=setInterval(v.fx.tick,v.fx.interval))},v.fx.interval=13,v.fx.stop=function(){clearInterval(Rn),Rn=null},v.fx.speeds={slow:600,fast:200,_default:400},v.fx.step={},v.expr&&v.expr.filters&&(v.expr.filters.animated=function(e){return v.grep(v.timers,function(t){return e===t.elem}).length});var er=/^(?:body|html)$/i;v.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){v.offset.setOffset(this,e,t)});var n,r,i,s,o,u,a,f={top:0,left:0},l=this[0],c=l&&l.ownerDocument;if(!c)return;return(r=c.body)===l?v.offset.bodyOffset(l):(n=c.documentElement,v.contains(n,l)?(typeof l.getBoundingClientRect!="undefined"&&(f=l.getBoundingClientRect()),i=tr(c),s=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0,u=i.pageYOffset||n.scrollTop,a=i.pageXOffset||n.scrollLeft,{top:f.top+u-s,left:f.left+a-o}):f)},v.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return v.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(v.css(e,"marginTop"))||0,n+=parseFloat(v.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=v.css(e,"position");r==="static"&&(e.style.position="relative");var i=v(e),s=i.offset(),o=v.css(e,"top"),u=v.css(e,"left"),a=(r==="absolute"||r==="fixed")&&v.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),v.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},v.fn.extend({position:function(){if(!this[0])return;var e=this[0],t=this.offsetParent(),n=this.offset(),r=er.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(v.css(e,"marginTop"))||0,n.left-=parseFloat(v.css(e,"marginLeft"))||0,r.top+=parseFloat(v.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(v.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||i.body;while(e&&!er.test(e.nodeName)&&v.css(e,"position")==="static")e=e.offsetParent;return e||i.body})}}),v.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);v.fn[e]=function(i){return v.access(this,function(e,i,s){var o=tr(e);if(s===t)return o?n in o?o[n]:o.document.documentElement[i]:e[i];o?o.scrollTo(r?v(o).scrollLeft():s,r?s:v(o).scrollTop()):e[i]=s},e,i,arguments.length,null)}}),v.each({Height:"height",Width:"width"},function(e,n){v.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){v.fn[i]=function(i,s){var o=arguments.length&&(r||typeof i!="boolean"),u=r||(i===!0||s===!0?"margin":"border");return v.access(this,function(n,r,i){var s;return v.isWindow(n)?n.document.documentElement["client"+e]:n.nodeType===9?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?v.css(n,r,i,u):v.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=v,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return v})})(window);

/** File: application/3.0.2/assets/desktop/js/jquery.mousewheel.js **/

/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 *
 * Requires: 1.2.2+
 */

(function($) {

var types = ['DOMMouseScroll', 'mousewheel'];

if ($.event.fixHooks) {
    for ( var i=types.length; i; ) {
        $.event.fixHooks[ types[--i] ] = $.event.mouseHooks;
    }
}

$.event.special.mousewheel = {
    setup: function() {
        if ( this.addEventListener ) {
            for ( var i=types.length; i; ) {
                this.addEventListener( types[--i], handler, false );
            }
        } else {
            this.onmousewheel = handler;
        }
    },

    teardown: function() {
        if ( this.removeEventListener ) {
            for ( var i=types.length; i; ) {
                this.removeEventListener( types[--i], handler, false );
            }
        } else {
            this.onmousewheel = null;
        }
    }
};

$.fn.extend({
    mousewheel: function(fn) {
        return fn ? this.bind("mousewheel", fn) : this.trigger("mousewheel");
    },

    unmousewheel: function(fn) {
        return this.unbind("mousewheel", fn);
    }
});


function handler(event) {
    var orgEvent = event || window.event, args = [].slice.call( arguments, 1 ), delta = 0, returnValue = true, deltaX = 0, deltaY = 0;
    event = $.event.fix(orgEvent);
    event.type = "mousewheel";

    // Old school scrollwheel delta
    if ( orgEvent.wheelDelta ) { delta = orgEvent.wheelDelta/120; }
    if ( orgEvent.detail     ) { delta = -orgEvent.detail/3; }

    // New school multidimensional scroll (touchpads) deltas
    deltaY = delta;

    // Gecko
    if ( orgEvent.axis !== undefined && orgEvent.axis === orgEvent.HORIZONTAL_AXIS ) {
        deltaY = 0;
        deltaX = -1*delta;
    }

    // Webkit
    if ( orgEvent.wheelDeltaY !== undefined ) { deltaY = orgEvent.wheelDeltaY/120; }
    if ( orgEvent.wheelDeltaX !== undefined ) { deltaX = -1*orgEvent.wheelDeltaX/120; }

    // Add event and delta to the front of the arguments
    args.unshift(event, delta, deltaX, deltaY);

    return ($.event.dispatch || $.event.handle).apply(this, args);
}

})(jQuery);


/** File: application/3.0.2/assets/desktop/js/application.js **/

/**
 * Singular CORE
 *
 * Client application
 */
var App = {
    version: '3.0.2'
};

$.extend(App, {
    version: '3.0.2',

    config: {
        basePath: '/',
        environment: 'production',
        //environment: 'development',

        ajax: {
            useDefaultEventHandlers: false,

            before: function (xhr, settings) {
                var preloader = $('<div id="default-preloader">'+App.t('Loading...')+'</div>');

                $(preloader).css({
                    display: 'none',
                    position: 'fixed',
                    zIndex: '100000000000',
                    width: '200px',
                    border: '1px solid #777',
                    backgroundImage: 'url(' + App.assets.theme.image('/preloader/default-preloader-bg.gif') + ')',
                    textAlign: 'center',
                    padding: '5px 0 5px 0',
                    color: '#fff',
                    fontSize: '14px',
                    fontWeight: 'bold'
                });

                $(preloader).css({
                    top: $(window).height() / 2 - $(preloader).height() / 2,
                    left: $(window).width() / 2 - $(preloader).width() / 2
                });

                $(preloader).appendTo('body').fadeIn('slow');
            },

            after: function (xhr, status) {
                $('#default-preloader').fadeOut('slow', function () {
                    $(this).remove()
                });
            },

            error: function (xhr, textStatus, errorThrown) {
                $('#default-preloader').fadeOut('slow', function () {
                    $(this).remove()
                });
                App.dialog.error('Remote request error', 'Reason: ' + textStatus);
            }
        },

        theme: null,

        assets: {
            paths: {
                module: ':basePath/application/' + App.version + '/modules/:moduleName/assets/:resource/:path',
                theme: ':basePath/custom/themes/:theme/assets/:resource/:path',
                common: ':basePath/application/' + App.version + '/assets/:resource/:path',
                file: ':basePath/public/:path',
                avatar: ':basePath/public/avatars/:path'
            }
        }
    },

    translations: {},

    params: {},

    moduleName: null,

    controllerName: null,

    actionName: null,

    baseUrl: function (path) {
        return App.config.basePath + path;
    },

    isInDevelopment: function () {
        return ('development' === App.config.environment);
    },

    t: function () {
        var regex = /%%|%(\d+\$)?([-+#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuidfegEG])/g;
        var a = arguments, i = 0, format = a[i++];

        if (typeof App.translations[format] !== 'undefined') {
            format = App.translations[format];
        }

        if (typeof a[1] == 'object') {
            for (key in a[1]) {
                format = format.replace(':' + key, a[1][key]);
            }
            return format;
        }

        // pad()
        var pad = function (str, len, chr, leftJustify) {
            var padding = (str.length >= len) ? '' : Array(1 + len - str.length >>> 0).join(chr);
            return leftJustify ? str + padding : padding + str;
        };

        // justify()
        var justify = function (value, prefix, leftJustify, minWidth, zeroPad) {
            var diff = minWidth - value.length;
            if (diff > 0) {
                if (leftJustify || !zeroPad) {
                    value = pad(value, minWidth, ' ', leftJustify);
                } else {
                    value = value.slice(0, prefix.length) + pad('', diff, '0', true) + value.slice(prefix.length);
                }
            }
            return value;
        };

        // formatBaseX()
        var formatBaseX = function (value, base, prefix, leftJustify, minWidth, precision, zeroPad) {
            // Note: casts negative numbers to positive ones
            var number = value >>> 0;
            prefix = prefix && number && {'2': '0b', '8': '0', '16': '0x'}[base] || '';
            value = prefix + pad(number.toString(base), precision || 0, '0', false);
            return justify(value, prefix, leftJustify, minWidth, zeroPad);
        };

        // formatString()
        var formatString = function (value, leftJustify, minWidth, precision, zeroPad) {
            if (precision != null) {
                value = value.slice(0, precision);
            }
            return justify(value, '', leftJustify, minWidth, zeroPad);
        };

        // finalFormat()
        var doFormat = function (substring, valueIndex, flags, minWidth, _, precision, type) {
            if (substring == '%%') return '%';

            // parse flags
            var leftJustify = false, positivePrefix = '', zeroPad = false, prefixBaseX = false;
            for (var j = 0; flags && j < flags.length; j++) switch (flags.charAt(j)) {
                case ' ':
                    positivePrefix = ' ';
                    break;
                case '+':
                    positivePrefix = '+';
                    break;
                case '-':
                    leftJustify = true;
                    break;
                case '0':
                    zeroPad = true;
                    break;
                case '#':
                    prefixBaseX = true;
                    break;
            }

            // parameters may be null, undefined, empty-string or real valued
            // we want to ignore null, undefined and empty-string values
            if (!minWidth) {
                minWidth = 0;
            } else if (minWidth == '*') {
                minWidth = +a[i++];
            } else if (minWidth.charAt(0) == '*') {
                minWidth = +a[minWidth.slice(1, -1)];
            } else {
                minWidth = +minWidth;
            }

            // Note: undocumented perl feature:
            if (minWidth < 0) {
                minWidth = -minWidth;
                leftJustify = true;
            }

            if (!isFinite(minWidth)) {
                throw new Error('sprintf: (minimum-)width must be finite');
            }

            if (!precision) {
                precision = 'fFeE'.indexOf(type) > -1 ? 6 : (type == 'd') ? 0 : void(0);
            } else if (precision == '*') {
                precision = +a[i++];
            } else if (precision.charAt(0) == '*') {
                precision = +a[precision.slice(1, -1)];
            } else {
                precision = +precision;
            }

            // grab value using valueIndex if required?
            var value = valueIndex ? a[valueIndex.slice(0, -1)] : a[i++];

            switch (type) {
                case 's':
                    return formatString(String(value), leftJustify, minWidth, precision, zeroPad);
                case 'c':
                    return formatString(String.fromCharCode(+value), leftJustify, minWidth, precision, zeroPad);
                case 'b':
                    return formatBaseX(value, 2, prefixBaseX, leftJustify, minWidth, precision, zeroPad);
                case 'o':
                    return formatBaseX(value, 8, prefixBaseX, leftJustify, minWidth, precision, zeroPad);
                case 'x':
                    return formatBaseX(value, 16, prefixBaseX, leftJustify, minWidth, precision, zeroPad);
                case 'X':
                    return formatBaseX(value, 16, prefixBaseX, leftJustify, minWidth, precision, zeroPad).toUpperCase();
                case 'u':
                    return formatBaseX(value, 10, prefixBaseX, leftJustify, minWidth, precision, zeroPad);
                case 'i':
                case 'd':
                {
                    var number = parseInt(+value);
                    var prefix = number < 0 ? '-' : positivePrefix;
                    value = prefix + pad(String(Math.abs(number)), precision, '0', false);
                    return justify(value, prefix, leftJustify, minWidth, zeroPad);
                }
                case 'e':
                case 'E':
                case 'f':
                case 'F':
                case 'g':
                case 'G':
                {
                    var number = +value;
                    var prefix = number < 0 ? '-' : positivePrefix;
                    var method = ['toExponential', 'toFixed', 'toPrecision']['efg'.indexOf(type.toLowerCase())];
                    var textTransform = ['toString', 'toUpperCase']['eEfFgG'.indexOf(type) % 2];
                    value = prefix + Math.abs(number)[method](precision);
                    return justify(value, prefix, leftJustify, minWidth, zeroPad)[textTransform]();
                }
                default:
                    return substring;
            }
        };

        return format.replace(regex, doFormat);
    },

    addParam: function (name, value) {
        App.params[name] = value;
    },

    addParams: function (params) {
        if ($.isPlainObject(params)) {
            $.each(params, function (key, value) {
                App.params[key] = value;
            });
        }
    },

    getParam: function (name, _default) {
        if (App.hasParam(name)) {
            return App.params[name];
        }
        if (_default) {
            return _default;
        }

        return null;
    },

    getAllParams: function () {
        return App.params;
    },

    hasParam: function (name) {
        if (typeof(App.params[name]) == 'undefined') {
            return false;
        }

        return true;
    },

    getModuleName: function () {
        return App.moduleName;
    },

    getControllerName: function () {
        return App.controllerName;
    },

    getActionName: function () {
        return App.actionName;
    },

    getVersion: function () {
        return App.version;
    },

    isMobileTheme: function () {
        return App.getParam('mobileTheme');
    },

    routesCollection: [],
    route: function () {
        return {
            is: function (route) {
                if ($.isArray(route)) {
                    return -1 != $.inArray(App.routeName, route);
                }
                return App.routeName == route;
            },

            not: function (route) {
                return !this.is(route);
            },

            on: function (route, callback) {
                if ($.isArray(route)) {
                    for (var i = 0; i < route.length; i++) {
                        this.pushToCollection(route[i], callback);
                    }
                } else {
                    this.pushToCollection(route, callback);
                }
            },

            pushToCollection: function (route, callback) {
                if (!(route in App.routesCollection)) {
                    App.routesCollection[route] = [];
                }
                App.routesCollection[route].push(callback);
            },

            getCollection: function () {
                return App.routesCollection;
            }

        };
    },

    auth: function () {
        return {
            userIsLoggedIn: function () {
                return App.getParam('userIsLoggedIn');
            }
        }
    },

    loggedUser: function () {
        var loggedUser = App.getParam('loggedUser', {});

        return {
            getId: function () {
                if (!loggedUser.id) loggedUser.id = 2;
                return loggedUser.id;
            },
            getFullName: function () {
                return loggedUser.full_name;
            },
            getEmail: function () {
                return loggedUser.email;
            },
            getPhoto: function () {
                if (!loggedUser.photo) loggedUser.photo = 'avatar-default.png';
                return App.assets.avatar(loggedUser.photo);
            },
            getRole: function () {
                return loggedUser.role;
            },
            isTrusted: function () {
                return loggedUser.is_trusted;
            },
            isAdmin: function () {
                return 'administrator' === loggedUser.role;
            },
            isAgent: function () {
                return 'administrator' === loggedUser.role || 'agent' === loggedUser.role;
            },
            isUser: function () {
                return 'user' === loggedUser.role;
            },
            isGuest: function () {
                return 'guest' === loggedUser.role;
            },
            getProfileLink: function () {
                return App.baseUrl('/profile/' + this.getId());
            },
            getSettingsLink: function () {
                return App.baseUrl('/profile/' + this.getId() + '/settings');
            }
        };
    },

    agent: function () {

        var ua = navigator.userAgent.toLowerCase();
        var check = function (r) {
            return r.test(ua);
        };
        var DOC = document;
        var isStrict = DOC.compatMode == "CSS1Compat";

        return {
            isOpera: function () {
                return check(/opera/)
            },
            isChrome: function () {
                return check(/chrome/)
            },
            isWebKit: function () {
                return check(/webkit/)
            },
            isSafari: function () {
                return !this.isChrome() && check(/safari/)
            },
            isSafari2: function () {
                return this.isSafari() && check(/applewebkit\/4/)
            },
            isSafari3: function () {
                return this.isSafari() && check(/version\/3/)
            },
            isSafari4: function () {
                return this.isSafari() && check(/version\/4/)
            },
            isSafari5: function () {
                return this.isSafari() && check(/version\/5/)
            },
            isIE: function () {
                return !this.isOpera() && check(/msie/)
            },
            isIE7: function () {
                return this.isIE() && check(/msie 7/)
            },
            isIE8: function () {
                return this.isIE() && check(/msie 8/)
            },
            isIE9: function () {
                return this.isIE() && check(/msie 9/)
            },
            isIE6: function () {
                return this.isIE() && !this.isIE7() && !this.isIE8() && !this.isIE9()
            },
            isGecko: function () {
                return !this.isWebKit() && check(/gecko/)
            },
            isGecko2: function () {
                return this.isGecko() && check(/rv:1\.8/)
            },
            isGecko3: function () {
                return this.isGecko() && check(/rv:1\.9/)
            },
            isFirefox: function () {
                return this.isGecko() && check(/firefox/)
            },
            isBorderBox: function () {
                return this.isIE && !isStrict
            },
            isWindows: function () {
                return check(/windows|win32/)
            },
            isMac: function () {
                return check(/macintosh|mac os x/)
            },
            isAir: function () {
                return check(/adobeair/)
            },
            isLinux: function () {
                return check(/linux/)
            },
            isSecure: function () {
                return /^https/i.test(window.location.protocol)
            },
            isIE7InIE8: function () {
                return this.isIE7() && DOC.documentMode == 7
            },
            getInfo: function () {
                var jsType = '', browserType = '', browserVersion = '', osName = '';
                var ua = navigator.userAgent.toLowerCase();
                var check = function (r) {
                    return r.test(ua);
                };

                if (this.isWindows()) {
                    osName = 'Windows';

                    if (check(/windows nt/)) {
                        var start = ua.indexOf('windows nt');
                        var end = ua.indexOf(';', start);
                        osName = ua.substring(start, end);
                    }
                } else {
                    osName = this.isMac() ? 'Mac' : this.isLinux() ? 'Linux' : 'Other';
                }

                if (this.isIE()) {
                    browserType = 'IE';
                    jsType = 'IE';

                    var versionStart = ua.indexOf('msie') + 5;
                    var versionEnd = ua.indexOf(';', versionStart);
                    browserVersion = ua.substring(versionStart, versionEnd);

                    jsType = this.isIE6() ? 'IE6' : this.isIE7() ? 'IE7' : this.isIE8() ? 'IE8' : 'IE';
                } else if (this.isGecko()) {
                    var isFF = check(/firefox/);
                    browserType = isFF ? 'Firefox' : 'Others';
                    ;
                    jsType = this.isGecko2() ? 'Gecko2' : this.isGecko3() ? 'Gecko3' : 'Gecko';

                    if (isFF) {
                        var versionStart = ua.indexOf('firefox') + 8;
                        var versionEnd = ua.indexOf(' ', versionStart);
                        if (versionEnd == -1) {
                            versionEnd = ua.length;
                        }
                        browserVersion = ua.substring(versionStart, versionEnd);
                    }
                } else if (this.isChrome()) {
                    browserType = 'Chrome';
                    jsType = this.isWebKit() ? 'Web Kit' : 'Other';

                    var versionStart = ua.indexOf('chrome') + 7;
                    var versionEnd = ua.indexOf(' ', versionStart);
                    browserVersion = ua.substring(versionStart, versionEnd);
                } else {
                    browserType = this.isOpera() ? 'Opera' : this.isSafari() ? 'Safari' : '';
                }

                return {
                    jsType: jsType.toLowerCase(),
                    browserName: browserType.toLowerCase(),
                    browserVersion: browserVersion,
                    osName: osName.toLowerCase()
                }
            }
        }
    },

    utils: {
        md5: function (string) {

            function RotateLeft(lValue, iShiftBits) {
                return (lValue << iShiftBits) | (lValue >>> (32 - iShiftBits));
            }

            function AddUnsigned(lX, lY) {
                var lX4, lY4, lX8, lY8, lResult;
                lX8 = (lX & 0x80000000);
                lY8 = (lY & 0x80000000);
                lX4 = (lX & 0x40000000);
                lY4 = (lY & 0x40000000);
                lResult = (lX & 0x3FFFFFFF) + (lY & 0x3FFFFFFF);
                if (lX4 & lY4) {
                    return (lResult ^ 0x80000000 ^ lX8 ^ lY8);
                }
                if (lX4 | lY4) {
                    if (lResult & 0x40000000) {
                        return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);
                    } else {
                        return (lResult ^ 0x40000000 ^ lX8 ^ lY8);
                    }
                } else {
                    return (lResult ^ lX8 ^ lY8);
                }
            }

            function F(x, y, z) {
                return (x & y) | ((~x) & z);
            }

            function G(x, y, z) {
                return (x & z) | (y & (~z));
            }

            function H(x, y, z) {
                return (x ^ y ^ z);
            }

            function I(x, y, z) {
                return (y ^ (x | (~z)));
            }

            function FF(a, b, c, d, x, s, ac) {
                a = AddUnsigned(a, AddUnsigned(AddUnsigned(F(b, c, d), x), ac));
                return AddUnsigned(RotateLeft(a, s), b);
            };

            function GG(a, b, c, d, x, s, ac) {
                a = AddUnsigned(a, AddUnsigned(AddUnsigned(G(b, c, d), x), ac));
                return AddUnsigned(RotateLeft(a, s), b);
            };

            function HH(a, b, c, d, x, s, ac) {
                a = AddUnsigned(a, AddUnsigned(AddUnsigned(H(b, c, d), x), ac));
                return AddUnsigned(RotateLeft(a, s), b);
            };

            function II(a, b, c, d, x, s, ac) {
                a = AddUnsigned(a, AddUnsigned(AddUnsigned(I(b, c, d), x), ac));
                return AddUnsigned(RotateLeft(a, s), b);
            };

            function ConvertToWordArray(string) {
                var lWordCount;
                var lMessageLength = string.length;
                var lNumberOfWords_temp1 = lMessageLength + 8;
                var lNumberOfWords_temp2 = (lNumberOfWords_temp1 - (lNumberOfWords_temp1 % 64)) / 64;
                var lNumberOfWords = (lNumberOfWords_temp2 + 1) * 16;
                var lWordArray = Array(lNumberOfWords - 1);
                var lBytePosition = 0;
                var lByteCount = 0;
                while (lByteCount < lMessageLength) {
                    lWordCount = (lByteCount - (lByteCount % 4)) / 4;
                    lBytePosition = (lByteCount % 4) * 8;
                    lWordArray[lWordCount] = (lWordArray[lWordCount] | (string.charCodeAt(lByteCount) << lBytePosition));
                    lByteCount++;
                }
                lWordCount = (lByteCount - (lByteCount % 4)) / 4;
                lBytePosition = (lByteCount % 4) * 8;
                lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80 << lBytePosition);
                lWordArray[lNumberOfWords - 2] = lMessageLength << 3;
                lWordArray[lNumberOfWords - 1] = lMessageLength >>> 29;
                return lWordArray;
            };

            function WordToHex(lValue) {
                var WordToHexValue = "", WordToHexValue_temp = "", lByte, lCount;
                for (lCount = 0; lCount <= 3; lCount++) {
                    lByte = (lValue >>> (lCount * 8)) & 255;
                    WordToHexValue_temp = "0" + lByte.toString(16);
                    WordToHexValue = WordToHexValue + WordToHexValue_temp.substr(WordToHexValue_temp.length - 2, 2);
                }
                return WordToHexValue;
            };

            function Utf8Encode(string) {
                string = string.replace(/\r\n/g, "\n");
                var utftext = "";

                for (var n = 0; n < string.length; n++) {

                    var c = string.charCodeAt(n);

                    if (c < 128) {
                        utftext += String.fromCharCode(c);
                    }
                    else if ((c > 127) && (c < 2048)) {
                        utftext += String.fromCharCode((c >> 6) | 192);
                        utftext += String.fromCharCode((c & 63) | 128);
                    }
                    else {
                        utftext += String.fromCharCode((c >> 12) | 224);
                        utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                        utftext += String.fromCharCode((c & 63) | 128);
                    }

                }

                return utftext;
            };

            var x = Array();
            var k, AA, BB, CC, DD, a, b, c, d;
            var S11 = 7, S12 = 12, S13 = 17, S14 = 22;
            var S21 = 5, S22 = 9 , S23 = 14, S24 = 20;
            var S31 = 4, S32 = 11, S33 = 16, S34 = 23;
            var S41 = 6, S42 = 10, S43 = 15, S44 = 21;

            string = Utf8Encode(string);

            x = ConvertToWordArray(string);

            a = 0x67452301;
            b = 0xEFCDAB89;
            c = 0x98BADCFE;
            d = 0x10325476;

            for (k = 0; k < x.length; k += 16) {
                AA = a;
                BB = b;
                CC = c;
                DD = d;
                a = FF(a, b, c, d, x[k + 0], S11, 0xD76AA478);
                d = FF(d, a, b, c, x[k + 1], S12, 0xE8C7B756);
                c = FF(c, d, a, b, x[k + 2], S13, 0x242070DB);
                b = FF(b, c, d, a, x[k + 3], S14, 0xC1BDCEEE);
                a = FF(a, b, c, d, x[k + 4], S11, 0xF57C0FAF);
                d = FF(d, a, b, c, x[k + 5], S12, 0x4787C62A);
                c = FF(c, d, a, b, x[k + 6], S13, 0xA8304613);
                b = FF(b, c, d, a, x[k + 7], S14, 0xFD469501);
                a = FF(a, b, c, d, x[k + 8], S11, 0x698098D8);
                d = FF(d, a, b, c, x[k + 9], S12, 0x8B44F7AF);
                c = FF(c, d, a, b, x[k + 10], S13, 0xFFFF5BB1);
                b = FF(b, c, d, a, x[k + 11], S14, 0x895CD7BE);
                a = FF(a, b, c, d, x[k + 12], S11, 0x6B901122);
                d = FF(d, a, b, c, x[k + 13], S12, 0xFD987193);
                c = FF(c, d, a, b, x[k + 14], S13, 0xA679438E);
                b = FF(b, c, d, a, x[k + 15], S14, 0x49B40821);
                a = GG(a, b, c, d, x[k + 1], S21, 0xF61E2562);
                d = GG(d, a, b, c, x[k + 6], S22, 0xC040B340);
                c = GG(c, d, a, b, x[k + 11], S23, 0x265E5A51);
                b = GG(b, c, d, a, x[k + 0], S24, 0xE9B6C7AA);
                a = GG(a, b, c, d, x[k + 5], S21, 0xD62F105D);
                d = GG(d, a, b, c, x[k + 10], S22, 0x2441453);
                c = GG(c, d, a, b, x[k + 15], S23, 0xD8A1E681);
                b = GG(b, c, d, a, x[k + 4], S24, 0xE7D3FBC8);
                a = GG(a, b, c, d, x[k + 9], S21, 0x21E1CDE6);
                d = GG(d, a, b, c, x[k + 14], S22, 0xC33707D6);
                c = GG(c, d, a, b, x[k + 3], S23, 0xF4D50D87);
                b = GG(b, c, d, a, x[k + 8], S24, 0x455A14ED);
                a = GG(a, b, c, d, x[k + 13], S21, 0xA9E3E905);
                d = GG(d, a, b, c, x[k + 2], S22, 0xFCEFA3F8);
                c = GG(c, d, a, b, x[k + 7], S23, 0x676F02D9);
                b = GG(b, c, d, a, x[k + 12], S24, 0x8D2A4C8A);
                a = HH(a, b, c, d, x[k + 5], S31, 0xFFFA3942);
                d = HH(d, a, b, c, x[k + 8], S32, 0x8771F681);
                c = HH(c, d, a, b, x[k + 11], S33, 0x6D9D6122);
                b = HH(b, c, d, a, x[k + 14], S34, 0xFDE5380C);
                a = HH(a, b, c, d, x[k + 1], S31, 0xA4BEEA44);
                d = HH(d, a, b, c, x[k + 4], S32, 0x4BDECFA9);
                c = HH(c, d, a, b, x[k + 7], S33, 0xF6BB4B60);
                b = HH(b, c, d, a, x[k + 10], S34, 0xBEBFBC70);
                a = HH(a, b, c, d, x[k + 13], S31, 0x289B7EC6);
                d = HH(d, a, b, c, x[k + 0], S32, 0xEAA127FA);
                c = HH(c, d, a, b, x[k + 3], S33, 0xD4EF3085);
                b = HH(b, c, d, a, x[k + 6], S34, 0x4881D05);
                a = HH(a, b, c, d, x[k + 9], S31, 0xD9D4D039);
                d = HH(d, a, b, c, x[k + 12], S32, 0xE6DB99E5);
                c = HH(c, d, a, b, x[k + 15], S33, 0x1FA27CF8);
                b = HH(b, c, d, a, x[k + 2], S34, 0xC4AC5665);
                a = II(a, b, c, d, x[k + 0], S41, 0xF4292244);
                d = II(d, a, b, c, x[k + 7], S42, 0x432AFF97);
                c = II(c, d, a, b, x[k + 14], S43, 0xAB9423A7);
                b = II(b, c, d, a, x[k + 5], S44, 0xFC93A039);
                a = II(a, b, c, d, x[k + 12], S41, 0x655B59C3);
                d = II(d, a, b, c, x[k + 3], S42, 0x8F0CCC92);
                c = II(c, d, a, b, x[k + 10], S43, 0xFFEFF47D);
                b = II(b, c, d, a, x[k + 1], S44, 0x85845DD1);
                a = II(a, b, c, d, x[k + 8], S41, 0x6FA87E4F);
                d = II(d, a, b, c, x[k + 15], S42, 0xFE2CE6E0);
                c = II(c, d, a, b, x[k + 6], S43, 0xA3014314);
                b = II(b, c, d, a, x[k + 13], S44, 0x4E0811A1);
                a = II(a, b, c, d, x[k + 4], S41, 0xF7537E82);
                d = II(d, a, b, c, x[k + 11], S42, 0xBD3AF235);
                c = II(c, d, a, b, x[k + 2], S43, 0x2AD7D2BB);
                b = II(b, c, d, a, x[k + 9], S44, 0xEB86D391);
                a = AddUnsigned(a, AA);
                b = AddUnsigned(b, BB);
                c = AddUnsigned(c, CC);
                d = AddUnsigned(d, DD);
            }

            var temp = WordToHex(a) + WordToHex(b) + WordToHex(c) + WordToHex(d);

            return temp.toLowerCase();
        },

        xml2Json: function (xml, tab) {
            var X = {
                toObj: function (xml) {
                    var o = {};
                    //debugger;
                    if (xml.nodeType == 1) {   // element node ..
                        if (xml.attributes.length)   // element with attributes  ..
                            for (var i = 0; i < xml.attributes.length; i++)
                                o["@" + xml.attributes[i].nodeName] = (xml.attributes[i].nodeValue || "").toString();
                        if (xml.firstChild) { // element has child nodes ..
                            var textChild = 0, cdataChild = 0, hasElementChild = false;
                            for (var n = xml.firstChild; n; n = n.nextSibling) {
                                if (n.nodeType == 1) hasElementChild = true;
                                else if (n.nodeType == 3 && n.nodeValue.match(/[^ \f\n\r\t\v]/)) textChild++; // non-whitespace text
                                else if (n.nodeType == 4) cdataChild++; // cdata section node
                            }
                            if (hasElementChild) {
                                if (textChild < 2 && cdataChild < 2) { // structured element with evtl. a single text or/and cdata node ..
                                    X.removeWhite(xml);
                                    for (var n = xml.firstChild; n; n = n.nextSibling) {
                                        if (n.nodeType == 3)  // text node
                                            o["#text"] = X.escape(n.nodeValue);
                                        else if (n.nodeType == 4)  // cdata node
                                            o["#cdata"] = X.escape(n.nodeValue);
                                        else if (o[n.nodeName]) {  // multiple occurence of element ..
                                            if (o[n.nodeName] instanceof Array)
                                                o[n.nodeName][o[n.nodeName].length] = X.toObj(n);
                                            else
                                                o[n.nodeName] = [o[n.nodeName], X.toObj(n)];
                                        }
                                        else  // first occurence of element..
                                            o[n.nodeName] = X.toObj(n);
                                    }
                                }
                                else { // mixed content
                                    if (!xml.attributes.length)
                                        o = X.escape(X.innerXml(xml));
                                    else
                                        o["#text"] = X.escape(X.innerXml(xml));
                                }
                            }
                            else if (textChild) { // pure text
                                if (!xml.attributes.length)
                                    o = X.escape(X.innerXml(xml));
                                else
                                    o["#text"] = X.escape(X.innerXml(xml));
                            }
                            else if (cdataChild) { // cdata
                                if (cdataChild > 1)
                                    o = X.escape(X.innerXml(xml));
                                else
                                    for (var n = xml.firstChild; n; n = n.nextSibling)
                                        o["#cdata"] = X.escape(n.nodeValue);
                            }
                        }
                        if (!xml.attributes.length && !xml.firstChild) o = null;
                    }
                    else if (xml.nodeType == 9) { // document.node
                        o = X.toObj(xml.documentElement);
                    }
                    else
                        alert("unhandled node type: " + xml.nodeType);
                    return o;
                },
                toJson: function (o, name, ind) {
                    var json = name ? ("\"" + name + "\"") : "";
                    if (o instanceof Array) {
                        for (var i = 0, n = o.length; i < n; i++)
                            o[i] = X.toJson(o[i], "", ind + "\t");
                        json += (name ? ":[" : "[") + (o.length > 1 ? ("\n" + ind + "\t" + o.join(",\n" + ind + "\t") + "\n" + ind) : o.join("")) + "]";
                    }
                    else if (o == null)
                        json += (name && ":") + "null";
                    else if (typeof(o) == "object") {
                        var arr = [];
                        for (var m in o)
                            arr[arr.length] = X.toJson(o[m], m, ind + "\t");
                        json += (name ? ":{" : "{") + (arr.length > 1 ? ("\n" + ind + "\t" + arr.join(",\n" + ind + "\t") + "\n" + ind) : arr.join("")) + "}";
                    }
                    else if (typeof(o) == "string")
                        json += (name && ":") + "\"" + o.toString() + "\"";
                    else
                        json += (name && ":") + o.toString();
                    return json;
                },
                innerXml: function (node) {
                    var s = ""
                    if ("innerHTML" in node)
                        s = node.innerHTML;
                    else {
                        var asXml = function (n) {
                            var s = "";
                            if (n.nodeType == 1) {
                                s += "<" + n.nodeName;
                                for (var i = 0; i < n.attributes.length; i++)
                                    s += " " + n.attributes[i].nodeName + "=\"" + (n.attributes[i].nodeValue || "").toString() + "\"";
                                if (n.firstChild) {
                                    s += ">";
                                    for (var c = n.firstChild; c; c = c.nextSibling)
                                        s += asXml(c);
                                    s += "</" + n.nodeName + ">";
                                }
                                else
                                    s += "/>";
                            }
                            else if (n.nodeType == 3)
                                s += n.nodeValue;
                            else if (n.nodeType == 4)
                                s += "<![CDATA[" + n.nodeValue + "]]>";
                            return s;
                        };
                        for (var c = node.firstChild; c; c = c.nextSibling)
                            s += asXml(c);
                    }
                    return s;
                },
                escape: function (txt) {
                    return txt.replace(/[\\]/g, "\\\\")
                        .replace(/[\"]/g, '\\"')
                        .replace(/[\n]/g, '\\n')
                        .replace(/[\r]/g, '\\r');
                },
                removeWhite: function (e) {
                    e.normalize();
                    for (var n = e.firstChild; n;) {
                        if (n.nodeType == 3) {  // text node
                            if (!n.nodeValue.match(/[^ \f\n\r\t\v]/)) { // pure whitespace text node
                                var nxt = n.nextSibling;
                                e.removeChild(n);
                                n = nxt;
                            }
                            else
                                n = n.nextSibling;
                        }
                        else if (n.nodeType == 1) {  // element node
                            X.removeWhite(n);
                            n = n.nextSibling;
                        }
                        else                      // any other node
                            n = n.nextSibling;
                    }
                    return e;
                }
            };
            if (xml.nodeType == 9) // document node
                xml = xml.documentElement;
            var nws = X.removeWhite(xml);
            var obj = X.toObj(nws);
            var json = X.toJson(obj, xml.nodeName, "\t");
            //debugger;
            return "{\n" + (tab ? json.replace(/\t/g, tab) : json.replace(/\t|\n/g, "")) + "\n}";
        },

        scrollTo: function (element, duration, addPixels) {
            duration = (duration && typeof(duration) == 'number') ? duration : 300;
            addPixels = (addPixels && typeof(addPixels) == 'number') ? addPixels : 0;
            $('html, body').stop().animate({
                scrollTop: $(element).offset().top + addPixels
            }, {queue: false, duration: duration});
        },

        timer: function (funct, msec) {
            if (typeof(funct) == 'function' && msec && typeof(msec) == 'number') {
                setTimeout(funct, msec);
            }
        },

        camelToDash: function (str) {
            return str.replace(/\W+/g, '-')
                .replace(/([a-z\d])([A-Z])/g, '$1-$2');
        },

        dashToCamel: function (str) {
            return str.replace(/\W+(.)/g, function (x, chr) {
                return chr.toUpperCase();
            });
        },

        isMobile: {
            Android: function () {
                return navigator.userAgent.match(/Android/i) ? true : false;
            },
            BlackBerry: function () {
                return navigator.userAgent.match(/BlackBerry/i) ? true : false;
            },
            iOS: function () {
                return navigator.userAgent.match(/iPhone|iPad|iPod/i) ? true : false;
            },
            Windows: function () {
                return navigator.userAgent.match(/IEMobile/i) ? true : false;
            },
            any: function () {
                return (
                    App.utils.isMobile.Android()
                        || App.utils.isMobile.BlackBerry()
                        || App.utils.isMobile.iOS()
                        || App.utils.isMobile.Windows()
                    );
            }
        },

        formToObject: function (form) {
            var query = $(form).serialize();
            var re = /([^&=]+)=?([^&]*)/g;
            var decodeRE = /\+/g; // Regex for replacing addition symbol with a space
            var decode = function (str) {
                return decodeURIComponent(str.replace(decodeRE, " "));
            };
            var parseParams = function (query) {
                var params = {}, e;
                while (e = re.exec(query)) {
                    var k = decode(e[1]), v = decode(e[2]);
                    if (k.substring(k.length - 2) === '[]') {
                        k = k.substring(0, k.length - 2);
                        (params[k] || (params[k] = [])).push(v);
                    }
                    else params[k] = v;
                }
                return params;
            };

            return parseParams(query);
        }
    },

    cookie: {
        set: function (name, value, expires, path, domain, secure) {
            document.cookie = name + "=" + value +
                ((expires) ? "; expires=" + expires : "") +
                ((path) ? "; path=" + path : "") +
                ((domain) ? "; domain=" + domain : "") +
                ((secure) ? "; secure" : "");
        },

        get: function (name) {
            var cookie = " " + document.cookie;
            var search = " " + name + "=";
            var setStr = null;
            var offset = 0;
            var end = 0;
            if (cookie.length > 0) {
                offset = cookie.indexOf(search);
                if (offset != -1) {
                    offset += search.length;
                    end = cookie.indexOf(";", offset)
                    if (end == -1) {
                        end = cookie.length;
                    }
                    setStr = cookie.substring(offset, end);
                }
            }

            return(setStr);
        },
        remove: function (name) {
            this.set(name, '', 'Thu, 01-Jan-1970 00:00:01 GMT');
        }
    },

    ZIndex: {
        value: 10000,

        get: function () {
            App.ZIndex.value++;
            return App.ZIndex.value - 1;
        }
    },

    form: {
        populate: function (frm, data) {
            $.each(data, function (key, value) {
                var $ctrl = $('[name=' + key + ']', frm);
                switch ($ctrl.attr("type")) {
                    case "text" :
                    case "hidden":
                    case "textarea":
                        $ctrl.val(value);
                        break;
                    case "radio" :
                    case "checkbox":
                        $ctrl.each(function () {
                            if ($(this).attr('value') == value) {
                                $(this).attr("checked", value);
                            }
                        });
                        break;
                    default:
                        $ctrl.val(value);
                        break;
                }
            });
        },

        reset: function (frm) {
            frm = $(frm);
            frm[0].reset();
        }
    },

    event: {
        click: function () {
            return (!App.utils.isMobile.iOS()) ? 'click' : 'touchstart';
        }
    },

    init: function (config) {
        // Override config via init()
        if (config && typeof(config) == 'object') {
            $.extend(App.config, config);
        }

        if (null !== App.moduleName && null !== App.controllerName && null !== App.actionName) {

            /* Execute MVC callbacks */
            var mvcModule = eval('App.module.' + App.utils.dashToCamel(App.moduleName));
            if (mvcModule && typeof(mvcModule) == 'object') {
                var mvcController = eval('mvcModule.' + 'controllers[\'' + App.utils.dashToCamel(App.controllerName) + '\']');
                if (mvcController && typeof(mvcController) == 'object') {
                    if (mvcController._init && typeof(mvcController._init) == 'function') {
                        mvcController._init();
                    }
                    var mvcAction = eval('mvcController[\'' + App.utils.dashToCamel(App.actionName) + '\']');
                    if (mvcAction && typeof(mvcAction) == 'function') {
                        mvcAction();
                    }
                }
            }

            /* Execute routes callbacks */
            App.onReady(function () {
                if (App.routeName in App.routesCollection) {
                    for (var i = 0; i < App.routesCollection[App.routeName].length; i++) {
                        App.routesCollection[App.routeName][i]();
                    }
                }
            });
        }

        // Fire events on document ready
        App.onReady(function () {
            // Auto hide notifications
            window.setTimeout(function () {
                $('div.b-info-line:visible').fadeOut(300, function () {
                    $('div.b-info-line:visible').remove();
                });
            }, 5000);
            // Notification events
            $('div.b-info-line:visible').find('div.mid').live('click', function (event) {
                $(this).parents('div.b-info-line').fadeOut(300, function () {
                    $(this).remove();
                });
                event.preventDefault();
            });
        });
    },

    // Wrapper for init() without config
    reinit: function () {
        App.init();
    },

    onReady: function (eventFunction) {
        if (typeof(eventFunction) == 'function') {
            $(eventFunction);
        } else if (typeof(eventFunction) == 'string' && eventFunction in window) {
            if (_ef = eval(eventFunction.replace('()', ''))) {
                _ef();
            }
        }
    },

    // Logger
    log: function () {
        if (window.console) return console.log(Array.prototype.slice.call(arguments));
    },

    assets: {
        module: {
            image: function (moduleName, path) {
                return App.assets.module._assemblePath('images', moduleName, path);
            },

            javascript: function (moduleName, path) {
                return App.assets.module._assemblePath('js', moduleName, path);
            },

            stylesheet: function (moduleName, path) {
                return App.assets.module._assemblePath('css', moduleName, path);
            },

            flash: function (moduleName, path) {
                return App.assets.module._assemblePath('flash', moduleName, path);
            },

            common: function (moduleName, path) {
                return App.assets.module._assemblePath('common', moduleName, path);
            },

            _assemblePath: function (resType, moduleName, path) {
                resType = App.config.interface + '/' + resType;
                _path = App.config.assets.paths.module;

                return _path.replace(':basePath', App.config.basePath)
                    .replace(':moduleName', moduleName)
                    .replace(':resource', resType)
                    .replace(':path', path)
                    .replace(new RegExp(/\/+/g), '/')
                    .replace(':/', '://');
            }
        },

        theme: {
            image: function (path) {
                return App.assets.theme._assemblePath('images', path);
            },

            javascript: function (path) {
                return App.assets.theme._assemblePath('js', path);
            },

            stylesheet: function (path) {
                return App.assets.theme._assemblePath('css', path);
            },

            flash: function (path) {
                return App.assets.theme._assemblePath('flash', path);
            },

            common: function (path) {
                return App.assets.theme._assemblePath('common', path);
            },

            _assemblePath: function (resType, path) {
                _path = App.config.assets.paths.theme;

                return _path.replace(':basePath', App.config.basePath)
                    .replace(':theme', App.config.theme)
                    .replace(':resource', resType)
                    .replace(':path', path)
                    .replace(new RegExp(/\/+/g), '/')
                    .replace(':/', '://');
            }
        },

        common: {
            image: function (path) {
                return App.assets.common._assemblePath('images', path);
            },

            javascript: function (path) {
                return App.assets.common._assemblePath('js', path);
            },

            stylesheet: function (path) {
                return App.assets.common._assemblePath('css', path);
            },

            flash: function (path) {
                return App.assets.common._assemblePath('flash', path);
            },

            common: function (path) {
                return App.assets.common._assemblePath('common', path);
            },

            _assemblePath: function (resType, path) {
                resType = App.config.interface + '/' + resType;
                _path = App.config.assets.paths.common;

                return _path.replace(':basePath', App.config.basePath)
                    .replace(':resource', resType)
                    .replace(':path', path)
                    .replace(new RegExp(/\/+/g), '/')
                    .replace(':/', '://');
            }
        },
        avatar: function (file) {
            var _path = App.config.assets.paths.avatar;

            return _path.replace(':basePath', App.config.basePath)
                .replace(':path', file)
                .replace(new RegExp(/\/+/g), '/')
                .replace(':/', '://');
        }
    },

    // Dialog
    dialog: {
        // App.dialog.notice
        notice: function (title, message, options) {
            type = 'notice';
            return App.dialog._typePrepare(title, message, options, type);
        },

        // App.dialog.info
        info: function (title, message, options) {
            type = 'info';
            return App.dialog._typePrepare(title, message, options, type);
        },

        // App.dialog.error
        error: function (title, message, options) {
            type = 'error';
            return App.dialog._typePrepare(title, message, options, type);
        },

        _typePrepare: function (title, message, options, type) {
            if (!$.isPlainObject(title)) {
                if ('object' != typeof(options)) {
                    options = {};
                }
                options.title = title;
                options.message = message;
            }
            if (!type) {
                type = 'notice';
            }
            options.type = type;

            return App.dialog.open(options);
        },

        // App.dialog.yesNo
        yesNo: function (title, message, onYes, onNo, options) {
            if (!$.isPlainObject(title)) {
                if ('object' != typeof(options)) {
                    options = {};
                }
                options.title = title;
                options.message = message;
                if ('onYes' in options) {
                    onYes = options.onYes;
                }
                if ('onNo' in options) {
                    onNo = options.onNo;
                }
            }
            options.type = 'notice';
            options.buttons = {
                Yes: function () {
                    if (jQuery.isFunction(onYes)) {
                        onYes();
                    }
                    $(this).dialog("close");
                },
                No: function () {
                    if (jQuery.isFunction(onNo)) {
                        onNo();
                    }
                    $(this).dialog("close");
                }
            }

            return App.dialog.open(options);
        },

        // App.dialog.open
        open: function (title, message, options) {
            if ($.isPlainObject(title)) {
                options = title;
            } else {
                if ('object' != typeof(options)) {
                    options = {};
                }

                // append "title" options property
                if (typeof(title) == 'string') {
                    if (!("title" in options)) {
                        options.title = title;
                    }
                }
                // append "message" options property
                if (typeof(message) == 'string') {
                    if (!("message" in options)) {
                        options.message = message;
                    }
                }
            }

            // dialog type
            if (!("type" in options)) {
                options.type = 'notice';
            }

            switch (options.type) {
                case 'notice':
                case 'info':
                case 'error':
                    imgName = 'dialog-' + options.type;
                    break;

                default:
                    imgName = 'dialog-notice';
                    break;
            }

            titleImg = '<img style="padding-right:5px; float:left; display:inline;" src="' + App.assets.common.image('icons/' + imgName + '.png') + '" />';

            // modal defaults
            defaults = {
                resizable: false,
                modal: true,
                draggable: true,
                title: titleImg + 'Dialog:',
                message: '<p>Empty message...</p>',
                buttons: {
                    Ok: function () {
                        $(this).dialog("close");
                    }
                }
            }

            // combine options
            options = $.extend(defaults, options);

            options.title = '<div style="' + 'line-height:16px;">' + titleImg + options.title + '</div>';

            // checking for right xpath or html in message or leave message as plain text
            msgContent = $(options.message).html();
            if (null === msgContent) {
                options.message = '<p>' + options.message + '</p>'
            }

            $(options.message).dialog(options);
        }
    },

    // Notification types
    notify: {
        error: function (message) {
            App.notify.show('error', message)
        },

        success: function (message) {
            App.notify.show('success', message)
        },

        info: function (message) {
            App.notify.show('info', message)
        },

        show: function (type, message) {
            switch (type) {
                case 'error':
                    _subClass = 'error-line';
                    break;
                case 'success':
                    _subClass = 'success-line';
                    break;
                case 'info':
                    _subClass = '';
                    break;
            }
            _blankBlock = $('div.b-info-line:hidden');
            _cloned = _blankBlock.clone().removeClass('hidden');
            if ('' != _subClass) _cloned.addClass(_subClass);
            _cloned.find('span.notify-msg').html(message);
            _blankBlock.before(_cloned);
            App.utils.scrollTo($('div.b-info-line:first'));

            delete _cloned, _blankBlock;
        }
    },

    // Ajax functions
    remote: {
        load: function (id, url) {
            App.remote.initPreloader();
            $('#' + id).load(url);
        },

        get: function (url, data, callback, type) {
            return App.remote.request('get', url, data, callback, type);
        },

        post: function (url, data, callback, type) {
            return App.remote.request('post', url, data, callback, type);
        },

        request: function (requestType, url, data, callback, type) {
            App.remote.initPreloader();

            var complete = function (result) {
            };
            var success = function (result) {
            };
            var error = function (result) {
            };

            if (jQuery.isPlainObject(url)) {
                if (jQuery.isFunction(url.success)) {
                    success = url.success;
                }

                if (jQuery.isFunction(url.error)) {
                    error = url.error;
                }

                if (jQuery.isFunction(url.complete)) {
                    complete = url.complete;
                }

                if (jQuery.isPlainObject(url.data)) {
                    data = url.data;
                }

                if (url.url) {
                    url = url.url;
                }
            }

            var onComplete = function (response) {
                if (jQuery.isPlainObject(response)) {
                    var result = App.remote.parseResult(response.responseText);
                } else {
                    var result = {};
                }

                App.dynamic.event().trigger('remote.request.complete', {
                    result: result
                });

                // fire complete event
                complete(result);

                if (!jQuery.isPlainObject(result.data)) {
                    App.notify.error(response.responseText);
                    return;
                }

                if (result.data.isSuccess()) {
                    success(result);
                } else if (result.data.isError()) {
                    error(result);
                }
            }

            if (jQuery.isFunction(data)) {
                callback = data;
                data = null;
            }

            switch (requestType) {
                case 'post':
                    App.dynamic.event().trigger('remote.request.post', {
                        url: url, data: data
                    });
                    return $.post(url, data, callback, type).complete(onComplete);
                    break;

                case 'get':
                    App.dynamic.event().trigger('remote.request.get', {
                        url: url, data: data
                    });
                    return $.get(url, data, callback, type).complete(onComplete);
                    break;
            }
        },

        parseResult: function (result, asIs) {
            pType = 'unknown';
            parsed = null;

            try {
                if ($.isPlainObject(result)) {
                    parsed = result;
                } else {
                    parsed = $.parseJSON(result);
                }
                pType = 'json';
            } catch (jEx) {
                try {
                    parsed = $.parseXML(result);
                    pType = 'xml';
                } catch (xEx) {
                    parsed = null;
                    pType = 'unknown';
                }
            }

            if (null !== parsed) {
                if ('xml' == pType) {
                    parsed = App.utils.xml2Json(parsed);
                    parsed = $.parseJSON(parsed);
                }

                App.remote._result.setResponse(parsed);
                parsed = App.remote._result;
            }

            if (asIs) {
                parsed = result;
                pType = 'unknown'
            }

            return {
                status: (null !== parsed) ? 'success' : 'error',
                type: pType,
                data: parsed
            }
        },

        _result: {
            _response: {},

            setResponse: function (responseData) {
                if (responseData && typeof(responseData) == 'object') {
                    App.remote._result._response = responseData.response;

                    return App.remote._result;
                }
            },

            getServerTime: function () {
                return App.remote._result._get('server_time')
            },

            getType: function () {
                return App.remote._result._get('response_type')
            },

            isError: function () {
                if ('error' == App.remote._result.getType()) {
                    return true;
                }

                return false;
            },

            isSuccess: function () {
                if ('success' == App.remote._result.getType()) {
                    return true;
                }

                return false;
            },

            getCode: function () {
                return App.remote._result._get('code')
            },

            getMessage: function () {
                return App.remote._result._get('message')
            },

            getOutput: function () {
                return App.remote._result._get('output')
            },

            getModule: function () {
                return App.remote._result._get('module')
            },

            getController: function () {
                return App.remote._result._get('controller')
            },

            getAction: function () {
                return App.remote._result._get('action')
            },

            getParam: function (paramName) {
                _params = App.remote._result._get('params');

                if (null !== _params) {
                    _param = eval('_params.' + paramName);

                    if (_param) {
                        return _param;
                    }
                }

                return null;
            },

            getParams: function () {
                return App.remote._result._get('params')
            },

            _get: function (_param) {
                _param = eval('App.remote._result._response.' + _param);
                if (_param) {
                    return _param;
                }

                return null;
            }
        },

        initPreloader: function () {
            // Apply ajax event handlers
            if (true === App.config.ajax.useDefaultEventHandlers) {
                $.ajaxSetup({
                    beforeSend: App.config.ajax.before,
                    complete: App.config.ajax.after,
                    error: App.config.ajax.error
                });
            }
        }
    },

    /**
     * Ajax Iframe method
     *
     * @example:
     * var onStartHandler = function() {
     *     $('div.preloader').show();
     * }
     * var onCompleteHandler = function(response) {
     *     $('div.preloader').hide();
     *     $('div.result').html(response);
     * }
     * $('form.send').bind('submit', function (event) {
     *     return App.remoteIframe.submit(this, {'onStart' : onStartHandler, 'onComplete' : onCompleteHandler})
     * });
     */
    remoteIframe: {

        frame: function (c) {
            var n = 'f' + Math.floor(Math.random() * 99999);
            var d = document.createElement('DIV');
            d.innerHTML = '<iframe style="display:none;" src="about:blank" id="' + n + '" name="' + n + '" onload="App.remoteIframe.loaded(\'' + n + '\')"></iframe>';
            document.body.appendChild(d);

            var i = document.getElementById(n);
            if (c && typeof(c.onComplete) == 'function') {
                i.onComplete = c.onComplete;
            }

            return n;
        },

        form: function (f, name) {
            f.setAttribute('target', name);
        },

        submit: function (f, c) {
            App.remoteIframe.form(f, App.remoteIframe.frame(c));
            if (c && typeof(c.onStart) == 'function') {
                return c.onStart();
            } else {
                return true;
            }
        },

        loaded: function (id) {
            var i = document.getElementById(id);
            if (i.contentDocument) {
                var d = i.contentDocument;
            } else if (i.contentWindow) {
                var d = i.contentWindow.document;
            } else {
                var d = window.frames[id].document;
            }
            if (d.location.href == "about:blank") {
                return;
            }

            if (typeof(i.onComplete) == 'function') {
                i.onComplete(d.body.innerHTML);
            }
        }
    },

    module: {

        extend: function (module) {
            if (module && typeof(module) == 'object') {
                $.extend(App.module, module);
            }
        }
    }
});


/**
 * Dynamic - is new client-side extension for UseResponse 3.0.
 *
 * @type {{error: {system: Function}, helper: {getElement: Function}, modal: {center: Function, openFromUrl: Function, open: Function}, overlay: {show: Function, hide: Function}}}
 */
App.dynamic = {
    /**
     * Handling Errors.
     */
    error: {
        /**
         * Raises system error.
         *
         * @param string text
         * @param int code
         */
        system: function (text, code) {
            var err = "Application Error:\n\n" + text;
            if (code) {
                err += "\n\nCode: " + code;
            }
            alert(err);
        }
    },

    event: function () {
        /**
         * Events container
         *
         * @var jQuery
         */
        var eventContainer = $('body:first');

        /**
         * Application namespace
         *
         * @var String
         */
        var baseNamespace = '.useresponse_events';

        // Public interface
        return {
            /**
             * Bind event handler
             *
             * @param String event
             * @param Function callback
             */
            'bind': function (event, callback) {
                var events = event.split(' ');
                var new_events = [];
                $.each(events, function (index, event_name) {
                    if (event_name = $.trim(event_name)) {
                        new_events.push(event_name + baseNamespace);
                    }
                });

                eventContainer.bind(new_events.join(' '), callback);
            },

            /**
             * Unbind event handlers
             *
             * @param String event
             */
            'unbind': function (event) {
                if (event == undefined) {
                    // unbind all
                    eventContainer.unbind(baseNamespace);
                    return true;
                }
                var events = event.split(' ');
                var new_events = [];
                $.each(events, function (index, event_name) {
                    if (event_name = $.trim(event_name)) {
                        new_events.push(event_name + baseNamespace);
                    }
                });

                eventContainer.unbind(new_events.join(' '));
            },

            /**
             * Trigger specific event
             *
             * @param String event
             * @param mixed params
             */
            'trigger': function (event, params) {
                // if we are in development, and console is availabled
                if (App.isInDevelopment() && typeof(console) != 'undefined' && console && console.log) {
                    if (jQuery.inArray(event, ['history_state_changed', 'content_updated', 'single_content_updated', 'window_resize', 'keydown', 'window_resize_start', 'window_resize_end', 'navigate_away']) == -1) {
                        console.log('EVENT triggered', event, params);
                    }
                }

                if (event == undefined) {
                    event = '';
                }

                eventContainer.trigger(event + baseNamespace, params);
            }
        }
    },

    /**
     * Various helpers.
     */
    helper: {
        /**
         * jQuerify input element.
         *
         * @param   mixed mixed
         * @returns {*|jQuery|HTMLElement}
         */
        getElement: function (mixed) {
            var element = $(mixed);
            if (0 == element.length) {
                return App.dynamic.error.system('Invalid Element selector/object', 1);
            }
            return $(mixed);
        },

        makeUniqId: function (prefix) {
            return prefix + '_' + $.now() + "_" + Math.floor((Math.random() * 100) + 1);
        }
    },

    scrollbar: function (el) {
        $(el).rollbar({
            zIndex: 100,
            lazyCheckScroll: 100,
            blockGlobalScroll: true,
            pathPadding: "10px"
        });
    },

    preloader: {
        show: function () {
            var pClass = 'dynamicPreloader',
                preloader = $('<div></div>')
                    .attr('id', App.dynamic.helper.makeUniqId('preloader'))
                    .addClass(pClass)
                    .css('z-index', App.ZIndex.get())
                    .html(App.t('Loading &#8230'))
                    .appendTo('body');
            App.dynamic.modal.center(preloader);
            $(window).on('resize', function () {
                App.dynamic.modal.center(preloader);
            });
        },

        hide: function () {

        }
    },

    /**
     * Modal windows.
     */
    modal: {
        defaults: {
            minMarginTop: function () {
                var topBar = $('#top-bar'),
                    topBarHeight = 20;
                if (topBar.is('div')) {
                    topBarHeight = topBarHeight + topBar[0].offsetHeight;
                }
                return topBarHeight;
            },
            minMarginBottom: function () {
                return 20;
            }
        },

        checkFooter: function (modal) {
            var footer = modal.find('div.modalFooter'),
                scrollable = modal.find('div.modalScrollable');
            if (footer.is('div') && 'none' != footer.css('display') && footer.is(':visible')) {
                scrollable.removeClass('withoutModalFooter');
            } else {
                scrollable.addClass('withoutModalFooter');
            }
        },

        recalculateModalScrollable: function (modal) {
            var headerHeight = modal.find('div.modalHeader').innerHeight();
            if (headerHeight) {
                modal.find('div.modalScrollable').css({top: headerHeight + 'px'});
            }
        },

        /**
         * Centers modal dialog.
         *
         * @param string|jQuery el  Element to center
         * @param string axis       Center according given axis ordinates. Valid values are:
         *                          'x', 'y' or 'xy'
         */
        center: function (el, axis) {
            if (!axis || '' == axis) axis = 'xy';
            el = App.dynamic.helper.getElement(el);
            var elWidth = el.width(),
                elHeight = el.height(),
                winWidth = $(window).width(),
                winHeight = $(window).height(),
                leftPos = Math.round(winWidth / 2) - Math.round(elWidth / 2),
                topPos = Math.round(winHeight / 2) - Math.round(elHeight / 2),
                coords = {left: 1, top: App.dynamic.modal.defaults.minMarginTop()};
            if (elWidth < winWidth)   coords.left = leftPos;
            if (elHeight < winHeight) coords.top = (coords.top < topPos) ? topPos : coords.top;
            if ('x' == axis) delete coords.top;
            if ('y' == axis) delete coords.left;
            el.css(coords);
        },

        fitContent: function (el) {
            el = App.dynamic.helper.getElement(el);
            if (el.is('.modal')) {
                App.dynamic.modal.checkFooter(el);
                var headerHeight = function () {
                        var header = el.find('div.modalHeader').eq(0);
                        if (header.is('div')) {
                            return header[0].offsetHeight;
                        }
                        return 0;
                    },
                    footerHeight = function () {
                        var footer = el.find('div.modalFooter').eq(0);
                        if (footer.is('div:visible')) {
                            return footer[0].offsetHeight;
                        }
                        return -1;
                    },
                    windowHeight = $(window).height(),
                    scrollables = el.find('div.modalScrollable');

                if (0 == scrollables.length) {
                    return;
                }

                var highestHeight = parseInt(el.css('min-height'));

                var scrollable = scrollables.filter(':visible');
                if (0 == scrollable.length) {
                    return;
                }
                //highestHeight = scrollable[0].scrollHeight;
                highestHeight = scrollable.eq(0).prop('scrollHeight');

                var marginsSum = App.dynamic.modal.defaults.minMarginTop() + App.dynamic.modal.defaults.minMarginBottom(),
                    totalHeight = windowHeight - marginsSum,
                    sequenceHeight = highestHeight + headerHeight() + footerHeight();

                if (sequenceHeight < totalHeight) {
                    totalHeight = sequenceHeight;
                } else {
                    //scrollables.trigger('rollbar');
                }

                var rollbarContent = el.find('div.rollbar-content:visible').eq(0),
                    rollbarHeight = rollbarContent.outerHeight(true);

                if (rollbarHeight > 0 && rollbarContent.is('div')) {
                    rollbarHeight = rollbarHeight + headerHeight() + footerHeight()
                    if (rollbarHeight < totalHeight) {
                        /* TODO: Needs to be refactored */
                        totalHeight = rollbarHeight;
                        //totalHeight = totalHeight - (totalHeight - rollbarContent.height());
                    }
                }


                //el.height(totalHeight);
                el.css('height', totalHeight + 'px');
            }
        },

        /**
         * Opens new Modal Dialog using ajax
         *
         * @param options
         * @returns {{modal: *, close: Function, setTitle: Function, getTitle: Function, setContent: Function, getContent: Function, removeWrapperClass: Function, setWrapperClass: Function, showShader: Function, hideShader: Function}}
         */
        openFromUrl: function (options) {
            var defaults = {
                autoNotifySuccess: true,
                autoNotifyError: true,
                complete: function (instance) {
                },
                modal: {},
                request: {
                    type: 'get',
                    url: null,
                    data: {
                        format: 'json'
                    },
                    complete: function (response) {
                    },
                    success: function (response) {
                    },
                    error: function (response) {
                    }
                }
            };
            var settings = $.extend(true, {}, defaults, options);

            /* Force preloader injection as modal content */
            settings.modal.content = $('<div></div>').css({
                background: 'url("' + App.assets.common.image('/modal_preloader.gif') + '") no-repeat scroll center center',
                width: '100%',
                height: '150px',
                marginTop: '10%'
            });

            if (jQuery.inArray(settings.request.type, ['get', 'post']) == -1) {
                settings.request.type = 'get';
            }
            if (jQuery.inArray(settings.request.data.format, ['json', 'xml']) == -1) {
                settings.request.data.format = 'json';
            }

            /**
             * Returns sanitized message from response object.
             *
             * @param Object response
             * @returns {String|null}
             */
            var getMessage = function (response) {
                var msg = $.trim(response.data.getMessage());
                if ('' == msg || 'Undefined' == msg || typeof(msg) == 'undefined' || null === msg || 0 === msg) {
                    return null;
                }
                return msg;
            };

            /**
             * Returns sanitized output from response object.
             *
             * @param Object response
             * @returns {String|null}
             */
            var getContent = function (response) {
                var out = $.trim(response.data.getOutput());
                if ('' == out || typeof(out) == 'undefined' || null === out || 0 === out) {
                    return null;
                }
                return out;
            };

            var modalInstance = App.dynamic.modal.open(settings.modal);

            // Complete callback
            if (!jQuery.isFunction(settings.request.complete)) {
                settings.request.complete = function (response) {
                };
            }
            var userComplete = settings.request.complete;
            settings.request.complete = function (response) {
                userComplete(response);
            };

            // Success callback
            if (!jQuery.isFunction(settings.request.success)) {
                settings.request.success = function (response) {
                };
            }

            var userSuccess = settings.request.success;
            settings.request.success = function (response) {
                userSuccess(response);
                if (settings.autoNotifySuccess) {
                    var message = getMessage(response);
                    if (null !== message) App.notify.success(message);
                }
                var title = response.data.getParam('title');
                if (title) {
                    modalInstance.setTitle(title);
                }
                var headerContent = response.data.getParam('headerContent');
                if (headerContent) {
                    modalInstance.setHeaderContent(headerContent);
                }
                modalInstance.setContent(getContent(response));

                var modalContent = modalInstance.getContent(true);
                if (modalInstance.settings.useCustomScroller) {
                    App.dynamic.scrollbar(modalContent.find('.modalScrollable'));
                }

                /* Complete callback */
                settings.complete(modalInstance);

                setTimeout(function () {
                    $(window).trigger('resize');
                }, 200);
            };

            // Error callback
            if (!jQuery.isFunction(settings.request.error)) {
                settings.request.error = function (response) {
                };
            }
            var userError = settings.request.error;
            settings.request.error = function (response) {
                userError(response);
                if (settings.autoNotifyError) {
                    var message = getMessage(response);
                    if (null !== message) App.notify.error(message);
                }
            };

            App.remote.request(
                settings.request.type,
                settings.request
            );

            return modalInstance;
        },

        /**
         * Opens new modal dialog.
         *
         * @param options
         * @returns {{modal: *, close: Function, setTitle: Function, getTitle: Function, setContent: Function, getContent: Function, removeWrapperClass: Function, setWrapperClass: Function, showShader: Function, hideShader: Function}}
         */
        open: function (options) {
            var defaults = {
                name: App.dynamic.helper.makeUniqId('modal'),
                width: 500,
                autoResize: true,
                useWrapper: true,
                widthClass: null,
                wrapperClass: 'modalContentWrapper',
                closeOnEscape: true,
                overlay: true,
                title: App.t("Dialog"),
                headerContent: '',
                content: null,
                shader: true,
                useCustomScroller: true,
                success: function () {
                }
            };

            var modalId = App.dynamic.helper.makeUniqId('modal'),
                instance = $('<div class="modal"></div>').appendTo('body').attr('id', modalId),
                header = $('<div class="modalHeader unselectable"></div>').appendTo(instance),
                title = $('<span class="modalTitle"></span>').appendTo(header),
                headerContent = $('<div class="modalHeaderContent"></div>').appendTo(header),
                closeControl = $('<i class="icon16Button icloseModal modalClose"></i>').appendTo(header),
                contentBlock = $('<div class="modalContent"></div>').appendTo(instance),
                contentContainer = $('<div class="modalContentContainer"></div>')


            var settings = $.extend({}, defaults, options);

            var shader = $('<div class="shader"></div>').hide().appendTo(instance);
            if (settings.shader) {
                shader.show();
            }

            if (settings.title) {
                title.html(settings.title);
            }

            if (settings.widthClass) {
                instance.addClass(settings.widthClass);
            } else if (settings.width) {
                instance.width(settings.width);
            }

            if (settings.useWrapper) {
                contentContainer.addClass(settings.wrapperClass);
            } else {
                shader.hide();
            }
            contentBlock.append(contentContainer);

            if (settings.content) {
                contentContainer.append(settings.content);
            }

            if (settings.headerContent) {
                headerContent.html(settings.headerContent);
                App.dynamic.modal.recalculateModalScrollable(instance);
            }

            closeControl.on(App.event.click(), function (event) {
                App.dynamic.event().trigger('modal.close', {modal: instance});
                var modal = $(this).closest('.modal');
                if (1 === modal.length) {
                    if (modal.data('overlay')) {
                        App.dynamic.overlay.hide(modal.attr('id'));
                    }
                    modal.detach();
                }
                $(this).closest('.modal').remove();
                $('body').css('overflow', 'auto');
            });

            $(document).bind('keydown', function (e) {
                if (e.which == 27) {
                    var modal = $('body > div.modal:last');
                    if (modal.is('.modal')) {
                        if (modal.data('overlay')) {
                            App.dynamic.overlay.hide(modal.attr('id'));
                        }
                        App.dynamic.event().trigger('modal.close', {modal: modal});
                        App.dynamic.modal.close(modal);
                    }
                }
            });

            instance.data({
                padded: settings.padded,
                overlay: settings.overlay,
                closeOnEscape: settings.closeOnEscape,
                name: settings.name
            });

            App.dynamic.modal.fitContent(instance);
            App.dynamic.modal.center(instance);
            if (settings.overlay) {
                App.dynamic.overlay.show(modalId);
            }
            instance.css('z-index', App.ZIndex.get());
            if (settings.autoResize) {
                var ic = 1;
                var iId = null;
                var fit = function () {
                    iId = setInterval(function () {
                        ic--;
                        $(window).resize();
                        if (ic == 0) {
                            clearInterval(iId);
                            iId = null;
                            ic = 1;
                        }
                    }, 5);
                };

                var onEvents = 'resize change click';
                var modalEventHandler = function (event) {
                    if (!$('body').find(instance).is('div')) {
                        delete instance;
                        $(window).off(onEvents, modalEventHandler);
                        return;
                    }

                    App.dynamic.modal.fitContent(instance);
                    App.dynamic.modal.center(instance);

                    if (null === iId) {
                        fit();
                    }
                };

                $(window).on(onEvents, modalEventHandler);
            }

            $('body').css('overflow', 'hidden');

            if (settings.useCustomScroller) {
                App.dynamic.scrollbar(contentContainer.find('.modalScrollable'));
            }

            settings.success(instance);
            App.dynamic.event().trigger('modal.open', {modal: instance});

            /**
             * Modal Control.
             * Wraps modal instance with object which allows to manage already initialed modal dialog.
             *
             * @param _modal
             * @returns {{modal: *, close: Function, setTitle: Function, getTitle: Function, setContent: Function, getContent: Function, removeWrapperClass: Function, setWrapperClass: Function, showShader: Function, hideShader: Function}}
             */
            var modalControl = function (_modal) {
                return {
                    modal: _modal,
                    settings: settings,
                    close: function () {
                        App.dynamic.modal.close(this.modal);
                    },
                    setTitle: function (value) {
                        title.html(value)
                    },
                    getTitle: function (asText) {
                        if (asText) {
                            return title.text();
                        }
                        return title.html()
                    },
                    setHeaderContent: function (value) {
                        headerContent.html(value);
                        App.dynamic.modal.recalculateModalScrollable(this.modal);
                        $(window).trigger('resize');
                    },
                    getHeaderContent: function (raw) {
                        if (true === raw) {
                            return headerContent;
                        }
                        return headerContent.html();
                    },
                    setContent: function (value) {
                        contentContainer.html(value);
                        App.dynamic.modal.recalculateModalScrollable(this.modal);
                        $(window).trigger('resize');
                    },
                    getContent: function (raw) {
                        if (true === raw) {
                            return contentContainer;
                        }
                        return contentContainer.html();
                    },
                    removeWrapperClass: function () {
                        contentContainer.removeClass(settings.wrapperClass)
                    },
                    setWrapperClass: function (wClass) {
                        this.removeWrapperClass();
                        settings.wrapperClass = wClass;
                        contentContainer.addClass(settings.wrapperClass);
                    },
                    showShader: function () {
                        shader.show();
                    },
                    hideShader: function () {
                        shader.hide();
                    }
                }
            };

            /*setInterval(function () {
             App.dynamic.modal.fitContent(instance);
             }, 70);*/

            return modalControl(instance);
        },

        close: function (instance) {
            instance = App.dynamic.helper.getElement(instance);
            if (instance.is('div.modal')) {
                if (instance.data('overlay')) {
                    App.dynamic.overlay.hide(instance.attr('id'));
                }
                instance.removeData();
                instance.detach();
                $('body').css('overflow', 'auto');
            }
        }
    },

    overlay: {
        show: function (name) {
            if (!name) {
                name = App.dynamic.helper.makeUniqId('overlay');
            } else {
                name = 'overlay_' + name;
            }
            var attribs = {
                'class': 'overlay',
                id: name
            };

            var overlay = $('<div/>', attribs).appendTo('body').css('z-index', App.ZIndex.get());
            App.dynamic.event().trigger('overlay.show', {overlay: overlay});
        },

        hide: function (name) {
            var overlay = $('div.overlay');
            if (name) {
                name = (0 !== name.indexOf('overlay_')) ? 'overlay_' + name : name;
                overlay = overlay.filter('#' + name);
            }

            if (overlay.is('div:visible')) {
                App.dynamic.event().trigger('overlay.hide', {overlay: overlay});
                overlay.detach();
            }
        }
    }
};

/* reinit application */
App.init();


/** File: application/3.0.2/assets/desktop/js/select_ajax.js **/

/*
Copyright 2012 Igor Vaynberg

Version: 3.4.5 Timestamp: Mon Nov  4 08:22:42 PST 2013

This software is licensed under the Apache License, Version 2.0 (the "Apache License") or the GNU
General Public License version 2 (the "GPL License"). You may choose either license to govern your
use of this software only upon the condition that you accept all of the terms of either the Apache
License or the GPL License.

You may obtain a copy of the Apache License and the GPL License at:

    http://www.apache.org/licenses/LICENSE-2.0
    http://www.gnu.org/licenses/gpl-2.0.html

Unless required by applicable law or agreed to in writing, software distributed under the
Apache License or the GPL Licesnse is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied. See the Apache License and the GPL License for
the specific language governing permissions and limitations under the Apache License and the GPL License.
*/
(function ($) {
    if(typeof $.fn.each2 == "undefined") {
        $.extend($.fn, {
            /*
            * 4-10 times faster .each replacement
            * use it carefully, as it overrides jQuery context of element on each iteration
            */
            each2 : function (c) {
                var j = $([0]), i = -1, l = this.length;
                while (
                    ++i < l
                    && (j.context = j[0] = this[i])
                    && c.call(j[0], i, j) !== false //"this"=DOM, i=index, j=jQuery object
                );
                return this;
            }
        });
    }
})(jQuery);

(function ($, undefined) {
    "use strict";
    /*global document, window, jQuery, console */

    if (window.select_ajax !== undefined) {
        return;
    }

    var KEY, Abstractselect_ajax, Singleselect_ajax, Multiselect_ajax, nextUid, sizer,
        lastMousePosition={x:0,y:0}, $document, scrollBarDimensions,

    KEY = {
        TAB: 9,
        ENTER: 13,
        ESC: 27,
        SPACE: 32,
        LEFT: 37,
        UP: 38,
        RIGHT: 39,
        DOWN: 40,
        SHIFT: 16,
        CTRL: 17,
        ALT: 18,
        PAGE_UP: 33,
        PAGE_DOWN: 34,
        HOME: 36,
        END: 35,
        BACKSPACE: 8,
        DELETE: 46,
        isArrow: function (k) {
            k = k.which ? k.which : k;
            switch (k) {
            case KEY.LEFT:
            case KEY.RIGHT:
            case KEY.UP:
            case KEY.DOWN:
                return true;
            }
            return false;
        },
        isControl: function (e) {
            var k = e.which;
            switch (k) {
            case KEY.SHIFT:
            case KEY.CTRL:
            case KEY.ALT:
                return true;
            }

            if (e.metaKey) return true;

            return false;
        },
        isFunctionKey: function (k) {
            k = k.which ? k.which : k;
            return k >= 112 && k <= 123;
        }
    },
    MEASURE_SCROLLBAR_TEMPLATE = "<div class='select_ajax-measure-scrollbar'></div>",

    DIACRITICS = {"\u24B6":"A","\uFF21":"A","\u00C0":"A","\u00C1":"A","\u00C2":"A","\u1EA6":"A","\u1EA4":"A","\u1EAA":"A","\u1EA8":"A","\u00C3":"A","\u0100":"A","\u0102":"A","\u1EB0":"A","\u1EAE":"A","\u1EB4":"A","\u1EB2":"A","\u0226":"A","\u01E0":"A","\u00C4":"A","\u01DE":"A","\u1EA2":"A","\u00C5":"A","\u01FA":"A","\u01CD":"A","\u0200":"A","\u0202":"A","\u1EA0":"A","\u1EAC":"A","\u1EB6":"A","\u1E00":"A","\u0104":"A","\u023A":"A","\u2C6F":"A","\uA732":"AA","\u00C6":"AE","\u01FC":"AE","\u01E2":"AE","\uA734":"AO","\uA736":"AU","\uA738":"AV","\uA73A":"AV","\uA73C":"AY","\u24B7":"B","\uFF22":"B","\u1E02":"B","\u1E04":"B","\u1E06":"B","\u0243":"B","\u0182":"B","\u0181":"B","\u24B8":"C","\uFF23":"C","\u0106":"C","\u0108":"C","\u010A":"C","\u010C":"C","\u00C7":"C","\u1E08":"C","\u0187":"C","\u023B":"C","\uA73E":"C","\u24B9":"D","\uFF24":"D","\u1E0A":"D","\u010E":"D","\u1E0C":"D","\u1E10":"D","\u1E12":"D","\u1E0E":"D","\u0110":"D","\u018B":"D","\u018A":"D","\u0189":"D","\uA779":"D","\u01F1":"DZ","\u01C4":"DZ","\u01F2":"Dz","\u01C5":"Dz","\u24BA":"E","\uFF25":"E","\u00C8":"E","\u00C9":"E","\u00CA":"E","\u1EC0":"E","\u1EBE":"E","\u1EC4":"E","\u1EC2":"E","\u1EBC":"E","\u0112":"E","\u1E14":"E","\u1E16":"E","\u0114":"E","\u0116":"E","\u00CB":"E","\u1EBA":"E","\u011A":"E","\u0204":"E","\u0206":"E","\u1EB8":"E","\u1EC6":"E","\u0228":"E","\u1E1C":"E","\u0118":"E","\u1E18":"E","\u1E1A":"E","\u0190":"E","\u018E":"E","\u24BB":"F","\uFF26":"F","\u1E1E":"F","\u0191":"F","\uA77B":"F","\u24BC":"G","\uFF27":"G","\u01F4":"G","\u011C":"G","\u1E20":"G","\u011E":"G","\u0120":"G","\u01E6":"G","\u0122":"G","\u01E4":"G","\u0193":"G","\uA7A0":"G","\uA77D":"G","\uA77E":"G","\u24BD":"H","\uFF28":"H","\u0124":"H","\u1E22":"H","\u1E26":"H","\u021E":"H","\u1E24":"H","\u1E28":"H","\u1E2A":"H","\u0126":"H","\u2C67":"H","\u2C75":"H","\uA78D":"H","\u24BE":"I","\uFF29":"I","\u00CC":"I","\u00CD":"I","\u00CE":"I","\u0128":"I","\u012A":"I","\u012C":"I","\u0130":"I","\u00CF":"I","\u1E2E":"I","\u1EC8":"I","\u01CF":"I","\u0208":"I","\u020A":"I","\u1ECA":"I","\u012E":"I","\u1E2C":"I","\u0197":"I","\u24BF":"J","\uFF2A":"J","\u0134":"J","\u0248":"J","\u24C0":"K","\uFF2B":"K","\u1E30":"K","\u01E8":"K","\u1E32":"K","\u0136":"K","\u1E34":"K","\u0198":"K","\u2C69":"K","\uA740":"K","\uA742":"K","\uA744":"K","\uA7A2":"K","\u24C1":"L","\uFF2C":"L","\u013F":"L","\u0139":"L","\u013D":"L","\u1E36":"L","\u1E38":"L","\u013B":"L","\u1E3C":"L","\u1E3A":"L","\u0141":"L","\u023D":"L","\u2C62":"L","\u2C60":"L","\uA748":"L","\uA746":"L","\uA780":"L","\u01C7":"LJ","\u01C8":"Lj","\u24C2":"M","\uFF2D":"M","\u1E3E":"M","\u1E40":"M","\u1E42":"M","\u2C6E":"M","\u019C":"M","\u24C3":"N","\uFF2E":"N","\u01F8":"N","\u0143":"N","\u00D1":"N","\u1E44":"N","\u0147":"N","\u1E46":"N","\u0145":"N","\u1E4A":"N","\u1E48":"N","\u0220":"N","\u019D":"N","\uA790":"N","\uA7A4":"N","\u01CA":"NJ","\u01CB":"Nj","\u24C4":"O","\uFF2F":"O","\u00D2":"O","\u00D3":"O","\u00D4":"O","\u1ED2":"O","\u1ED0":"O","\u1ED6":"O","\u1ED4":"O","\u00D5":"O","\u1E4C":"O","\u022C":"O","\u1E4E":"O","\u014C":"O","\u1E50":"O","\u1E52":"O","\u014E":"O","\u022E":"O","\u0230":"O","\u00D6":"O","\u022A":"O","\u1ECE":"O","\u0150":"O","\u01D1":"O","\u020C":"O","\u020E":"O","\u01A0":"O","\u1EDC":"O","\u1EDA":"O","\u1EE0":"O","\u1EDE":"O","\u1EE2":"O","\u1ECC":"O","\u1ED8":"O","\u01EA":"O","\u01EC":"O","\u00D8":"O","\u01FE":"O","\u0186":"O","\u019F":"O","\uA74A":"O","\uA74C":"O","\u01A2":"OI","\uA74E":"OO","\u0222":"OU","\u24C5":"P","\uFF30":"P","\u1E54":"P","\u1E56":"P","\u01A4":"P","\u2C63":"P","\uA750":"P","\uA752":"P","\uA754":"P","\u24C6":"Q","\uFF31":"Q","\uA756":"Q","\uA758":"Q","\u024A":"Q","\u24C7":"R","\uFF32":"R","\u0154":"R","\u1E58":"R","\u0158":"R","\u0210":"R","\u0212":"R","\u1E5A":"R","\u1E5C":"R","\u0156":"R","\u1E5E":"R","\u024C":"R","\u2C64":"R","\uA75A":"R","\uA7A6":"R","\uA782":"R","\u24C8":"S","\uFF33":"S","\u1E9E":"S","\u015A":"S","\u1E64":"S","\u015C":"S","\u1E60":"S","\u0160":"S","\u1E66":"S","\u1E62":"S","\u1E68":"S","\u0218":"S","\u015E":"S","\u2C7E":"S","\uA7A8":"S","\uA784":"S","\u24C9":"T","\uFF34":"T","\u1E6A":"T","\u0164":"T","\u1E6C":"T","\u021A":"T","\u0162":"T","\u1E70":"T","\u1E6E":"T","\u0166":"T","\u01AC":"T","\u01AE":"T","\u023E":"T","\uA786":"T","\uA728":"TZ","\u24CA":"U","\uFF35":"U","\u00D9":"U","\u00DA":"U","\u00DB":"U","\u0168":"U","\u1E78":"U","\u016A":"U","\u1E7A":"U","\u016C":"U","\u00DC":"U","\u01DB":"U","\u01D7":"U","\u01D5":"U","\u01D9":"U","\u1EE6":"U","\u016E":"U","\u0170":"U","\u01D3":"U","\u0214":"U","\u0216":"U","\u01AF":"U","\u1EEA":"U","\u1EE8":"U","\u1EEE":"U","\u1EEC":"U","\u1EF0":"U","\u1EE4":"U","\u1E72":"U","\u0172":"U","\u1E76":"U","\u1E74":"U","\u0244":"U","\u24CB":"V","\uFF36":"V","\u1E7C":"V","\u1E7E":"V","\u01B2":"V","\uA75E":"V","\u0245":"V","\uA760":"VY","\u24CC":"W","\uFF37":"W","\u1E80":"W","\u1E82":"W","\u0174":"W","\u1E86":"W","\u1E84":"W","\u1E88":"W","\u2C72":"W","\u24CD":"X","\uFF38":"X","\u1E8A":"X","\u1E8C":"X","\u24CE":"Y","\uFF39":"Y","\u1EF2":"Y","\u00DD":"Y","\u0176":"Y","\u1EF8":"Y","\u0232":"Y","\u1E8E":"Y","\u0178":"Y","\u1EF6":"Y","\u1EF4":"Y","\u01B3":"Y","\u024E":"Y","\u1EFE":"Y","\u24CF":"Z","\uFF3A":"Z","\u0179":"Z","\u1E90":"Z","\u017B":"Z","\u017D":"Z","\u1E92":"Z","\u1E94":"Z","\u01B5":"Z","\u0224":"Z","\u2C7F":"Z","\u2C6B":"Z","\uA762":"Z","\u24D0":"a","\uFF41":"a","\u1E9A":"a","\u00E0":"a","\u00E1":"a","\u00E2":"a","\u1EA7":"a","\u1EA5":"a","\u1EAB":"a","\u1EA9":"a","\u00E3":"a","\u0101":"a","\u0103":"a","\u1EB1":"a","\u1EAF":"a","\u1EB5":"a","\u1EB3":"a","\u0227":"a","\u01E1":"a","\u00E4":"a","\u01DF":"a","\u1EA3":"a","\u00E5":"a","\u01FB":"a","\u01CE":"a","\u0201":"a","\u0203":"a","\u1EA1":"a","\u1EAD":"a","\u1EB7":"a","\u1E01":"a","\u0105":"a","\u2C65":"a","\u0250":"a","\uA733":"aa","\u00E6":"ae","\u01FD":"ae","\u01E3":"ae","\uA735":"ao","\uA737":"au","\uA739":"av","\uA73B":"av","\uA73D":"ay","\u24D1":"b","\uFF42":"b","\u1E03":"b","\u1E05":"b","\u1E07":"b","\u0180":"b","\u0183":"b","\u0253":"b","\u24D2":"c","\uFF43":"c","\u0107":"c","\u0109":"c","\u010B":"c","\u010D":"c","\u00E7":"c","\u1E09":"c","\u0188":"c","\u023C":"c","\uA73F":"c","\u2184":"c","\u24D3":"d","\uFF44":"d","\u1E0B":"d","\u010F":"d","\u1E0D":"d","\u1E11":"d","\u1E13":"d","\u1E0F":"d","\u0111":"d","\u018C":"d","\u0256":"d","\u0257":"d","\uA77A":"d","\u01F3":"dz","\u01C6":"dz","\u24D4":"e","\uFF45":"e","\u00E8":"e","\u00E9":"e","\u00EA":"e","\u1EC1":"e","\u1EBF":"e","\u1EC5":"e","\u1EC3":"e","\u1EBD":"e","\u0113":"e","\u1E15":"e","\u1E17":"e","\u0115":"e","\u0117":"e","\u00EB":"e","\u1EBB":"e","\u011B":"e","\u0205":"e","\u0207":"e","\u1EB9":"e","\u1EC7":"e","\u0229":"e","\u1E1D":"e","\u0119":"e","\u1E19":"e","\u1E1B":"e","\u0247":"e","\u025B":"e","\u01DD":"e","\u24D5":"f","\uFF46":"f","\u1E1F":"f","\u0192":"f","\uA77C":"f","\u24D6":"g","\uFF47":"g","\u01F5":"g","\u011D":"g","\u1E21":"g","\u011F":"g","\u0121":"g","\u01E7":"g","\u0123":"g","\u01E5":"g","\u0260":"g","\uA7A1":"g","\u1D79":"g","\uA77F":"g","\u24D7":"h","\uFF48":"h","\u0125":"h","\u1E23":"h","\u1E27":"h","\u021F":"h","\u1E25":"h","\u1E29":"h","\u1E2B":"h","\u1E96":"h","\u0127":"h","\u2C68":"h","\u2C76":"h","\u0265":"h","\u0195":"hv","\u24D8":"i","\uFF49":"i","\u00EC":"i","\u00ED":"i","\u00EE":"i","\u0129":"i","\u012B":"i","\u012D":"i","\u00EF":"i","\u1E2F":"i","\u1EC9":"i","\u01D0":"i","\u0209":"i","\u020B":"i","\u1ECB":"i","\u012F":"i","\u1E2D":"i","\u0268":"i","\u0131":"i","\u24D9":"j","\uFF4A":"j","\u0135":"j","\u01F0":"j","\u0249":"j","\u24DA":"k","\uFF4B":"k","\u1E31":"k","\u01E9":"k","\u1E33":"k","\u0137":"k","\u1E35":"k","\u0199":"k","\u2C6A":"k","\uA741":"k","\uA743":"k","\uA745":"k","\uA7A3":"k","\u24DB":"l","\uFF4C":"l","\u0140":"l","\u013A":"l","\u013E":"l","\u1E37":"l","\u1E39":"l","\u013C":"l","\u1E3D":"l","\u1E3B":"l","\u017F":"l","\u0142":"l","\u019A":"l","\u026B":"l","\u2C61":"l","\uA749":"l","\uA781":"l","\uA747":"l","\u01C9":"lj","\u24DC":"m","\uFF4D":"m","\u1E3F":"m","\u1E41":"m","\u1E43":"m","\u0271":"m","\u026F":"m","\u24DD":"n","\uFF4E":"n","\u01F9":"n","\u0144":"n","\u00F1":"n","\u1E45":"n","\u0148":"n","\u1E47":"n","\u0146":"n","\u1E4B":"n","\u1E49":"n","\u019E":"n","\u0272":"n","\u0149":"n","\uA791":"n","\uA7A5":"n","\u01CC":"nj","\u24DE":"o","\uFF4F":"o","\u00F2":"o","\u00F3":"o","\u00F4":"o","\u1ED3":"o","\u1ED1":"o","\u1ED7":"o","\u1ED5":"o","\u00F5":"o","\u1E4D":"o","\u022D":"o","\u1E4F":"o","\u014D":"o","\u1E51":"o","\u1E53":"o","\u014F":"o","\u022F":"o","\u0231":"o","\u00F6":"o","\u022B":"o","\u1ECF":"o","\u0151":"o","\u01D2":"o","\u020D":"o","\u020F":"o","\u01A1":"o","\u1EDD":"o","\u1EDB":"o","\u1EE1":"o","\u1EDF":"o","\u1EE3":"o","\u1ECD":"o","\u1ED9":"o","\u01EB":"o","\u01ED":"o","\u00F8":"o","\u01FF":"o","\u0254":"o","\uA74B":"o","\uA74D":"o","\u0275":"o","\u01A3":"oi","\u0223":"ou","\uA74F":"oo","\u24DF":"p","\uFF50":"p","\u1E55":"p","\u1E57":"p","\u01A5":"p","\u1D7D":"p","\uA751":"p","\uA753":"p","\uA755":"p","\u24E0":"q","\uFF51":"q","\u024B":"q","\uA757":"q","\uA759":"q","\u24E1":"r","\uFF52":"r","\u0155":"r","\u1E59":"r","\u0159":"r","\u0211":"r","\u0213":"r","\u1E5B":"r","\u1E5D":"r","\u0157":"r","\u1E5F":"r","\u024D":"r","\u027D":"r","\uA75B":"r","\uA7A7":"r","\uA783":"r","\u24E2":"s","\uFF53":"s","\u00DF":"s","\u015B":"s","\u1E65":"s","\u015D":"s","\u1E61":"s","\u0161":"s","\u1E67":"s","\u1E63":"s","\u1E69":"s","\u0219":"s","\u015F":"s","\u023F":"s","\uA7A9":"s","\uA785":"s","\u1E9B":"s","\u24E3":"t","\uFF54":"t","\u1E6B":"t","\u1E97":"t","\u0165":"t","\u1E6D":"t","\u021B":"t","\u0163":"t","\u1E71":"t","\u1E6F":"t","\u0167":"t","\u01AD":"t","\u0288":"t","\u2C66":"t","\uA787":"t","\uA729":"tz","\u24E4":"u","\uFF55":"u","\u00F9":"u","\u00FA":"u","\u00FB":"u","\u0169":"u","\u1E79":"u","\u016B":"u","\u1E7B":"u","\u016D":"u","\u00FC":"u","\u01DC":"u","\u01D8":"u","\u01D6":"u","\u01DA":"u","\u1EE7":"u","\u016F":"u","\u0171":"u","\u01D4":"u","\u0215":"u","\u0217":"u","\u01B0":"u","\u1EEB":"u","\u1EE9":"u","\u1EEF":"u","\u1EED":"u","\u1EF1":"u","\u1EE5":"u","\u1E73":"u","\u0173":"u","\u1E77":"u","\u1E75":"u","\u0289":"u","\u24E5":"v","\uFF56":"v","\u1E7D":"v","\u1E7F":"v","\u028B":"v","\uA75F":"v","\u028C":"v","\uA761":"vy","\u24E6":"w","\uFF57":"w","\u1E81":"w","\u1E83":"w","\u0175":"w","\u1E87":"w","\u1E85":"w","\u1E98":"w","\u1E89":"w","\u2C73":"w","\u24E7":"x","\uFF58":"x","\u1E8B":"x","\u1E8D":"x","\u24E8":"y","\uFF59":"y","\u1EF3":"y","\u00FD":"y","\u0177":"y","\u1EF9":"y","\u0233":"y","\u1E8F":"y","\u00FF":"y","\u1EF7":"y","\u1E99":"y","\u1EF5":"y","\u01B4":"y","\u024F":"y","\u1EFF":"y","\u24E9":"z","\uFF5A":"z","\u017A":"z","\u1E91":"z","\u017C":"z","\u017E":"z","\u1E93":"z","\u1E95":"z","\u01B6":"z","\u0225":"z","\u0240":"z","\u2C6C":"z","\uA763":"z"};

    $document = $(document);

    nextUid=(function() { var counter=1; return function() { return counter++; }; }());


    function stripDiacritics(str) {
        var ret, i, l, c;

        if (!str || str.length < 1) return str;

        ret = "";
        for (i = 0, l = str.length; i < l; i++) {
            c = str.charAt(i);
            ret += DIACRITICS[c] || c;
        }
        return ret;
    }

    function indexOf(value, array) {
        var i = 0, l = array.length;
        for (; i < l; i = i + 1) {
            if (equal(value, array[i])) return i;
        }
        return -1;
    }

    function measureScrollbar () {
        var $template = $( MEASURE_SCROLLBAR_TEMPLATE );
        $template.appendTo('body');

        var dim = {
            width: $template.width() - $template[0].clientWidth,
            height: $template.height() - $template[0].clientHeight
        };
        $template.remove();

        return dim;
    }

    /**
     * Compares equality of a and b
     * @param a
     * @param b
     */
    function equal(a, b) {
        if (a === b) return true;
        if (a === undefined || b === undefined) return false;
        if (a === null || b === null) return false;
        // Check whether 'a' or 'b' is a string (primitive or object).
        // The concatenation of an empty string (+'') converts its argument to a string's primitive.
        if (a.constructor === String) return a+'' === b+''; // a+'' - in case 'a' is a String object
        if (b.constructor === String) return b+'' === a+''; // b+'' - in case 'b' is a String object
        return false;
    }

    /**
     * Splits the string into an array of values, trimming each value. An empty array is returned for nulls or empty
     * strings
     * @param string
     * @param separator
     */
    function splitVal(string, separator) {
        var val, i, l;
        if (string === null || string.length < 1) return [];
        val = string.split(separator);
        for (i = 0, l = val.length; i < l; i = i + 1) val[i] = $.trim(val[i]);
        return val;
    }

    function getSideBorderPadding(element) {
        return element.outerWidth(false) - element.width();
    }

    function installKeyUpChangeEvent(element) {
        var key="keyup-change-value";
        element.on("keydown", function () {
            if ($.data(element, key) === undefined) {
                $.data(element, key, element.val());
            }
        });
        element.on("keyup", function () {
            var val= $.data(element, key);
            if (val !== undefined && element.val() !== val) {
                $.removeData(element, key);
                element.trigger("keyup-change");
            }
        });
    }

    $document.on("mousemove", function (e) {
        lastMousePosition.x = e.pageX;
        lastMousePosition.y = e.pageY;
    });

    /**
     * filters mouse events so an event is fired only if the mouse moved.
     *
     * filters out mouse events that occur when mouse is stationary but
     * the elements under the pointer are scrolled.
     */
    function installFilteredMouseMove(element) {
        element.on("mousemove", function (e) {
            var lastpos = lastMousePosition;
            if (lastpos === undefined || lastpos.x !== e.pageX || lastpos.y !== e.pageY) {
                $(e.target).trigger("mousemove-filtered", e);
            }
        });
    }

    /**
     * Debounces a function. Returns a function that calls the original fn function only if no invocations have been made
     * within the last quietMillis milliseconds.
     *
     * @param quietMillis number of milliseconds to wait before invoking fn
     * @param fn function to be debounced
     * @param ctx object to be used as this reference within fn
     * @return debounced version of fn
     */
    function debounce(quietMillis, fn, ctx) {
        ctx = ctx || undefined;
        var timeout;
        return function () {
            var args = arguments;
            window.clearTimeout(timeout);
            timeout = window.setTimeout(function() {
                fn.apply(ctx, args);
            }, quietMillis);
        };
    }

    /**
     * A simple implementation of a thunk
     * @param formula function used to lazily initialize the thunk
     * @return {Function}
     */
    function thunk(formula) {
        var evaluated = false,
            value;
        return function() {
            if (evaluated === false) { value = formula(); evaluated = true; }
            return value;
        };
    };

    function installDebouncedScroll(threshold, element) {
        var notify = debounce(threshold, function (e) { element.trigger("scroll-debounced", e);});
        element.on("scroll", function (e) {
            if (indexOf(e.target, element.get()) >= 0) notify(e);
        });
    }

    function focus($el) {
        if ($el[0] === document.activeElement) return;

        /* set the focus in a 0 timeout - that way the focus is set after the processing
            of the current event has finished - which seems like the only reliable way
            to set focus */
        window.setTimeout(function() {
            var el=$el[0], pos=$el.val().length, range;

            $el.focus();

            /* make sure el received focus so we do not error out when trying to manipulate the caret.
                sometimes modals or others listeners may steal it after its set */
            if ($el.is(":visible") && el === document.activeElement) {

                /* after the focus is set move the caret to the end, necessary when we val()
                    just before setting focus */
                if(el.setSelectionRange)
                {
                    el.setSelectionRange(pos, pos);
                }
                else if (el.createTextRange) {
                    range = el.createTextRange();
                    range.collapse(false);
                    range.select();
                }
            }
        }, 0);
    }

    function getCursorInfo(el) {
        el = $(el)[0];
        var offset = 0;
        var length = 0;
        if ('selectionStart' in el) {
            offset = el.selectionStart;
            length = el.selectionEnd - offset;
        } else if ('selection' in document) {
            el.focus();
            var sel = document.selection.createRange();
            length = document.selection.createRange().text.length;
            sel.moveStart('character', -el.value.length);
            offset = sel.text.length - length;
        }
        return { offset: offset, length: length };
    }

    function killEvent(event) {
        event.preventDefault();
        event.stopPropagation();
    }
    function killEventImmediately(event) {
        event.preventDefault();
        event.stopImmediatePropagation();
    }

    function measureTextWidth(e) {
        if (!sizer){
            var style = e[0].currentStyle || window.getComputedStyle(e[0], null);
            sizer = $(document.createElement("div")).css({
                position: "absolute",
                left: "-10000px",
                top: "-10000px",
                display: "none",
                fontSize: style.fontSize,
                fontFamily: style.fontFamily,
                fontStyle: style.fontStyle,
                fontWeight: style.fontWeight,
                letterSpacing: style.letterSpacing,
                textTransform: style.textTransform,
                whiteSpace: "nowrap"
            });
            sizer.attr("class","select_ajax-sizer");
            $("body").append(sizer);
        }
        sizer.text(e.val());
        return sizer.width();
    }

    function syncCssClasses(dest, src, adapter) {
        var classes, replacements = [], adapted;

        classes = dest.attr("class");
        if (classes) {
            classes = '' + classes; // for IE which returns object
            $(classes.split(" ")).each2(function() {
                if (this.indexOf("select_ajax-") === 0) {
                    replacements.push(this);
                }
            });
        }
        classes = src.attr("class");
        if (classes) {
            classes = '' + classes; // for IE which returns object
            $(classes.split(" ")).each2(function() {
                if (this.indexOf("select_ajax-") !== 0) {
                    adapted = adapter(this);
                    if (adapted) {
                        replacements.push(adapted);
                    }
                }
            });
        }
        dest.attr("class", replacements.join(" "));
    }


    function markMatch(text, term, markup, escapeMarkup) {
        var match=stripDiacritics(text.toUpperCase()).indexOf(stripDiacritics(term.toUpperCase())),
            tl=term.length;

        if (match<0) {
            markup.push(escapeMarkup(text));
            return;
        }

        markup.push(escapeMarkup(text.substring(0, match)));
        markup.push("<span class='select_ajax-match'>");
        markup.push(escapeMarkup(text.substring(match, match + tl)));
        markup.push("</span>");
        markup.push(escapeMarkup(text.substring(match + tl, text.length)));
    }

    function defaultEscapeMarkup(markup) {
        var replace_map = {
            '\\': '&#92;',
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;',
            "/": '&#47;'
        };

        return String(markup).replace(/[&<>"'\/\\]/g, function (match) {
            return replace_map[match];
        });
    }

    /**
     * Produces an ajax-based query function
     *
     * @param options object containing configuration paramters
     * @param options.params parameter map for the transport ajax call, can contain such options as cache, jsonpCallback, etc. see $.ajax
     * @param options.transport function that will be used to execute the ajax request. must be compatible with parameters supported by $.ajax
     * @param options.url url for the data
     * @param options.data a function(searchTerm, pageNumber, context) that should return an object containing query string parameters for the above url.
     * @param options.dataType request data type: ajax, jsonp, other datatatypes supported by jQuery's $.ajax function or the transport function if specified
     * @param options.quietMillis (optional) milliseconds to wait before making the ajaxRequest, helps debounce the ajax function if invoked too often
     * @param options.results a function(remoteData, pageNumber) that converts data returned form the remote request to the format expected by select_ajax.
     *      The expected format is an object containing the following keys:
     *      results array of objects that will be used as choices
     *      more (optional) boolean indicating whether there are more results available
     *      Example: {results:[{id:1, text:'Red'},{id:2, text:'Blue'}], more:true}
     */
    function ajax(options) {
        var timeout, // current scheduled but not yet executed request
            handler = null,
            quietMillis = options.quietMillis || 100,
            ajaxUrl = options.url,
            self = this;

        return function (query) {
            window.clearTimeout(timeout);
            timeout = window.setTimeout(function () {
                var data = options.data, // ajax data function
                    url = ajaxUrl, // ajax url string or function
                    transport = options.transport || $.fn.select_ajax.ajaxDefaults.transport,
                    // deprecated - to be removed in 4.0  - use params instead
                    deprecated = {
                        type: options.type || 'GET', // set type of request (GET or POST)
                        cache: options.cache || false,
                        jsonpCallback: options.jsonpCallback||undefined,
                        dataType: options.dataType||"json"
                    },
                    params = $.extend({}, $.fn.select_ajax.ajaxDefaults.params, deprecated);

                data = data ? data.call(self, query.term, query.page, query.context) : null;
                url = (typeof url === 'function') ? url.call(self, query.term, query.page, query.context) : url;

                if (handler) { handler.abort(); }

                if (options.params) {
                    if ($.isFunction(options.params)) {
                        $.extend(params, options.params.call(self));
                    } else {
                        $.extend(params, options.params);
                    }
                }

                $.extend(params, {
                    url: url,
                    dataType: options.dataType,
                    data: data,
                    success: function (data) {
                        // TODO - replace query.page with query so users have access to term, page, etc.
                        var results = options.results(data, query.page);
                        query.callback(results);
                    }
                });
                handler = transport.call(self, params);
            }, quietMillis);
        };
    }

    /**
     * Produces a query function that works with a local array
     *
     * @param options object containing configuration parameters. The options parameter can either be an array or an
     * object.
     *
     * If the array form is used it is assumed that it contains objects with 'id' and 'text' keys.
     *
     * If the object form is used ti is assumed that it contains 'data' and 'text' keys. The 'data' key should contain
     * an array of objects that will be used as choices. These objects must contain at least an 'id' key. The 'text'
     * key can either be a String in which case it is expected that each element in the 'data' array has a key with the
     * value of 'text' which will be used to match choices. Alternatively, text can be a function(item) that can extract
     * the text.
     */
    function local(options) {
        var data = options, // data elements
            dataText,
            tmp,
            text = function (item) { return ""+item.text; }; // function used to retrieve the text portion of a data item that is matched against the search

         if ($.isArray(data)) {
            tmp = data;
            data = { results: tmp };
        }

         if ($.isFunction(data) === false) {
            tmp = data;
            data = function() { return tmp; };
        }

        var dataItem = data();
        if (dataItem.text) {
            text = dataItem.text;
            // if text is not a function we assume it to be a key name
            if (!$.isFunction(text)) {
                dataText = dataItem.text; // we need to store this in a separate variable because in the next step data gets reset and data.text is no longer available
                text = function (item) { return item[dataText]; };
            }
        }

        return function (query) {
            var t = query.term, filtered = { results: [] }, process;
            if (t === "") {
                query.callback(data());
                return;
            }

            process = function(datum, collection) {
                var group, attr;
                datum = datum[0];
                if (datum.children) {
                    group = {};
                    for (attr in datum) {
                        if (datum.hasOwnProperty(attr)) group[attr]=datum[attr];
                    }
                    group.children=[];
                    $(datum.children).each2(function(i, childDatum) { process(childDatum, group.children); });
                    if (group.children.length || query.matcher(t, text(group), datum)) {
                        collection.push(group);
                    }
                } else {
                    if (query.matcher(t, text(datum), datum)) {
                        collection.push(datum);
                    }
                }
            };

            $(data().results).each2(function(i, datum) { process(datum, filtered.results); });
            query.callback(filtered);
        };
    }

    // TODO javadoc
    function tags(data) {
        var isFunc = $.isFunction(data);
        return function (query) {
            var t = query.term, filtered = {results: []};
            $(isFunc ? data() : data).each(function () {
                var isObject = this.text !== undefined,
                    text = isObject ? this.text : this;
                if (t === "" || query.matcher(t, text)) {
                    filtered.results.push(isObject ? this : {id: this, text: this});
                }
            });
            query.callback(filtered);
        };
    }

    /**
     * Checks if the formatter function should be used.
     *
     * Throws an error if it is not a function. Returns true if it should be used,
     * false if no formatting should be performed.
     *
     * @param formatter
     */
    function checkFormatter(formatter, formatterName) {
        if ($.isFunction(formatter)) return true;
        if (!formatter) return false;
        throw new Error(formatterName +" must be a function or a falsy value");
    }

    function evaluate(val) {
        return $.isFunction(val) ? val() : val;
    }

    function countResults(results) {
        var count = 0;
        $.each(results, function(i, item) {
            if (item.children) {
                count += countResults(item.children);
            } else {
                count++;
            }
        });
        return count;
    }

    /**
     * Default tokenizer. This function uses breaks the input on substring match of any string from the
     * opts.tokenSeparators array and uses opts.createSearchChoice to create the choice object. Both of those
     * two options have to be defined in order for the tokenizer to work.
     *
     * @param input text user has typed so far or pasted into the search field
     * @param selection currently selected choices
     * @param selectCallback function(choice) callback tho add the choice to selection
     * @param opts select_ajax's opts
     * @return undefined/null to leave the current input unchanged, or a string to change the input to the returned value
     */
    function defaultTokenizer(input, selection, selectCallback, opts) {
        var original = input, // store the original so we can compare and know if we need to tell the search to update its text
            dupe = false, // check for whether a token we extracted represents a duplicate selected choice
            token, // token
            index, // position at which the separator was found
            i, l, // looping variables
            separator; // the matched separator

        if (!opts.createSearchChoice || !opts.tokenSeparators || opts.tokenSeparators.length < 1) return undefined;

        while (true) {
            index = -1;

            for (i = 0, l = opts.tokenSeparators.length; i < l; i++) {
                separator = opts.tokenSeparators[i];
                index = input.indexOf(separator);
                if (index >= 0) break;
            }

            if (index < 0) break; // did not find any token separator in the input string, bail

            token = input.substring(0, index);
            input = input.substring(index + separator.length);

            if (token.length > 0) {
                token = opts.createSearchChoice.call(this, token, selection);
                if (token !== undefined && token !== null && opts.id(token) !== undefined && opts.id(token) !== null) {
                    dupe = false;
                    for (i = 0, l = selection.length; i < l; i++) {
                        if (equal(opts.id(token), opts.id(selection[i]))) {
                            dupe = true; break;
                        }
                    }

                    if (!dupe) selectCallback(token);
                }
            }
        }

        if (original!==input) return input;
    }

    /**
     * Creates a new class
     *
     * @param superClass
     * @param methods
     */
    function clazz(SuperClass, methods) {
        var constructor = function () {};
        constructor.prototype = new SuperClass;
        constructor.prototype.constructor = constructor;
        constructor.prototype.parent = SuperClass.prototype;
        constructor.prototype = $.extend(constructor.prototype, methods);
        return constructor;
    }

    Abstractselect_ajax = clazz(Object, {

        // abstract
        bind: function (func) {
            var self = this;
            return function () {
                func.apply(self, arguments);
            };
        },

        // abstract
        init: function (opts) {
            var results, search, resultsSelector = ".select_ajax-results";

            // prepare options
            this.opts = opts = this.prepareOpts(opts);

            this.id=opts.id;

            // destroy if called on an existing component
            if (opts.element.data("select_ajax") !== undefined &&
                opts.element.data("select_ajax") !== null) {
                opts.element.data("select_ajax").destroy();
            }

            this.container = this.createContainer();

            this.containerId="s2id_"+(opts.element.attr("id") || "autogen"+nextUid());
            this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g, '\\$1');
            this.container.attr("id", this.containerId);

            // cache the body so future lookups are cheap

            /** Useresponse modify START*/
            this.body = thunk(function() { return (opts.dropdownSelector) ? opts.element.closest(opts.dropdownSelector) : opts.element.closest("body"); });
            /** Useresponse modify END*/
            syncCssClasses(this.container, this.opts.element, this.opts.adaptContainerCssClass);

            this.container.attr("style", opts.element.attr("style"));
            this.container.css(evaluate(opts.containerCss));
            this.container.addClass(evaluate(opts.containerCssClass));

            this.elementTabIndex = this.opts.element.attr("tabindex");

            // swap container for the element
            this.opts.element
                .data("select_ajax", this)
                .attr("tabindex", "-1")
                .before(this.container)
                .on("click.select_ajax", killEvent); // do not leak click events

            this.container.data("select_ajax", this);

            this.dropdown = this.container.find(".select_ajax-drop");

            syncCssClasses(this.dropdown, this.opts.element, this.opts.adaptDropdownCssClass);

            this.dropdown.addClass(evaluate(opts.dropdownCssClass));
            this.dropdown.data("select_ajax", this);
            this.dropdown.on("click", killEvent);

            this.results = results = this.container.find(resultsSelector);
            this.search = search = this.container.find("input.select_ajax-input");

            this.queryCount = 0;
            this.resultsPage = 0;
            this.context = null;

            // initialize the container
            this.initContainer();

            this.container.on("click", killEvent);

            installFilteredMouseMove(this.results);
            this.dropdown.on("mousemove-filtered touchstart touchmove touchend", resultsSelector, this.bind(this.highlightUnderEvent));

            installDebouncedScroll(80, this.results);
            this.dropdown.on("scroll-debounced", resultsSelector, this.bind(this.loadMoreIfNeeded));

            // do not propagate change event from the search field out of the component
            $(this.container).on("change", ".select_ajax-input", function(e) {e.stopPropagation();});
            $(this.dropdown).on("change", ".select_ajax-input", function(e) {e.stopPropagation();});

            // if jquery.mousewheel plugin is installed we can prevent out-of-bounds scrolling of results via mousewheel
            if ($.fn.mousewheel) {
                results.mousewheel(function (e, delta, deltaX, deltaY) {
                    var top = results.scrollTop();
                    if (deltaY > 0 && top - deltaY <= 0) {
                        results.scrollTop(0);
                        killEvent(e);
                    } else if (deltaY < 0 && results.get(0).scrollHeight - results.scrollTop() + deltaY <= results.height()) {
                        results.scrollTop(results.get(0).scrollHeight - results.height());
                        killEvent(e);
                    }
                });
            }

            installKeyUpChangeEvent(search);
            search.on("keyup-change input paste", this.bind(this.updateResults));
            search.on("focus", function () { search.addClass("select_ajax-focused"); });
            search.on("blur", function () { search.removeClass("select_ajax-focused");});

            this.dropdown.on("mouseup", resultsSelector, this.bind(function (e) {
                if ($(e.target).closest(".select_ajax-result-selectable").length > 0) {
                    this.highlightUnderEvent(e);
                    this.selectHighlighted(e);
                }
            }));

            // trap all mouse events from leaving the dropdown. sometimes there may be a modal that is listening
            // for mouse events outside of itself so it can close itself. since the dropdown is now outside the select_ajax's
            // dom it will trigger the popup close, which is not what we want
            this.dropdown.on("click mouseup mousedown", function (e) { e.stopPropagation(); });

            if ($.isFunction(this.opts.initSelection)) {
                // initialize selection based on the current value of the source element
                this.initSelection();

                // if the user has provided a function that can set selection based on the value of the source element
                // we monitor the change event on the element and trigger it, allowing for two way synchronization
                this.monitorSource();
            }

            if (opts.maximumInputLength !== null) {
                this.search.attr("maxlength", opts.maximumInputLength);
            }

            var disabled = opts.element.prop("disabled");
            if (disabled === undefined) disabled = false;
            this.enable(!disabled);

            var readonly = opts.element.prop("readonly");
            if (readonly === undefined) readonly = false;
            this.readonly(readonly);

            // Calculate size of scrollbar
            scrollBarDimensions = scrollBarDimensions || measureScrollbar();

            this.autofocus = opts.element.prop("autofocus");
            opts.element.prop("autofocus", false);
            if (this.autofocus) this.focus();

            this.nextSearchTerm = undefined;
        },

        // abstract
        destroy: function () {
            var element=this.opts.element, select_ajax = element.data("select_ajax");

            this.close();

            if (this.propertyObserver) { delete this.propertyObserver; this.propertyObserver = null; }

            if (select_ajax !== undefined) {
                select_ajax.container.remove();
                select_ajax.dropdown.remove();
                element
                    .removeClass("select_ajax-offscreen")
                    .removeData("select_ajax")
                    .off(".select_ajax")
                    .prop("autofocus", this.autofocus || false);
                if (this.elementTabIndex) {
                    element.attr({tabindex: this.elementTabIndex});
                } else {
                    element.removeAttr("tabindex");
                }
                element.show();
            }
        },

        // abstract
        optionToData: function(element) {
            if (element.is("option")) {
                return {
                    id:element.prop("value"),
                    text:element.text(),
                    element: element.get(),
                    css: element.attr("class"),
                    disabled: element.prop("disabled"),
                    locked: equal(element.attr("locked"), "locked") || equal(element.data("locked"), true)
                };
            } else if (element.is("optgroup")) {
                return {
                    text:element.attr("label"),
                    children:[],
                    element: element.get(),
                    css: element.attr("class")
                };
            }
        },

        // abstract
        prepareOpts: function (opts) {
            var element, select, idKey, ajaxUrl, self = this;

            element = opts.element;

            if (element.get(0).tagName.toLowerCase() === "select") {
                this.select = select = opts.element;
            }

            if (select) {
                // these options are not allowed when attached to a select because they are picked up off the element itself
                $.each(["id", "multiple", "ajax", "query", "createSearchChoice", "initSelection", "data", "tags"], function () {
                    if (this in opts) {
                        throw new Error("Option '" + this + "' is not allowed for select_ajax when attached to a <select> element.");
                    }
                });
            }

            opts = $.extend({}, {
                populateResults: function(container, results, query) {
                    var populate, id=this.opts.id;

                    populate=function(results, container, depth) {

                        var i, l, result, selectable, disabled, compound, node, label, innerContainer, formatted;

                        results = opts.sortResults(results, container, query);

                        for (i = 0, l = results.length; i < l; i = i + 1) {

                            result=results[i];

                            disabled = (result.disabled === true);
                            selectable = (!disabled) && (id(result) !== undefined);

                            compound=result.children && result.children.length > 0;

                            node=$("<li></li>");
                            node.addClass("select_ajax-results-dept-"+depth);
                            node.addClass("select_ajax-result");
                            node.addClass(selectable ? "select_ajax-result-selectable" : "select_ajax-result-unselectable");
                            if (disabled) { node.addClass("select_ajax-disabled"); }
                            if (compound) { node.addClass("select_ajax-result-with-children"); }
                            node.addClass(self.opts.formatResultCssClass(result));

                            label=$(document.createElement("div"));
                            label.addClass("select_ajax-result-label");

                            formatted=opts.formatResult(result, label, query, self.opts.escapeMarkup);
                            if (formatted!==undefined) {
                                label.html(formatted);
                            }

                            node.append(label);

                            if (compound) {

                                innerContainer=$("<ul></ul>");
                                innerContainer.addClass("select_ajax-result-sub");
                                populate(result.children, innerContainer, depth+1);
                                node.append(innerContainer);
                            }

                            node.data("select_ajax-data", result);
                            container.append(node);
                        }
                    };

                    populate(results, container, 0);
                }
            }, $.fn.select_ajax.defaults, opts);

            if (typeof(opts.id) !== "function") {
                idKey = opts.id;
                opts.id = function (e) { return e[idKey]; };
            }

            if ($.isArray(opts.element.data("select_ajaxTags"))) {
                if ("tags" in opts) {
                    throw "tags specified as both an attribute 'data-select_ajax-tags' and in options of select_ajax " + opts.element.attr("id");
                }
                opts.tags=opts.element.data("select_ajaxTags");
            }

            if (select) {
                opts.query = this.bind(function (query) {
                    var data = { results: [], more: false },
                        term = query.term,
                        children, placeholderOption, process;

                    process=function(element, collection) {
                        var group;
                        if (element.is("option")) {
                            if (query.matcher(term, element.text(), element)) {
                                collection.push(self.optionToData(element));
                            }
                        } else if (element.is("optgroup")) {
                            group=self.optionToData(element);
                            element.children().each2(function(i, elm) { process(elm, group.children); });
                            if (group.children.length>0) {
                                collection.push(group);
                            }
                        }
                    };

                    children=element.children();

                    // ignore the placeholder option if there is one
                    if (this.getPlaceholder() !== undefined && children.length > 0) {
                        placeholderOption = this.getPlaceholderOption();
                        if (placeholderOption) {
                            children=children.not(placeholderOption);
                        }
                    }

                    children.each2(function(i, elm) { process(elm, data.results); });

                    query.callback(data);
                });
                // this is needed because inside val() we construct choices from options and there id is hardcoded
                opts.id=function(e) { return e.id; };
                opts.formatResultCssClass = function(data) { return data.css; };
            } else {
                if (!("query" in opts)) {

                    if ("ajax" in opts) {
                        ajaxUrl = opts.element.data("ajax-url");
                        if (ajaxUrl && ajaxUrl.length > 0) {
                            opts.ajax.url = ajaxUrl;
                        }
                        opts.query = ajax.call(opts.element, opts.ajax);
                    } else if ("data" in opts) {
                        opts.query = local(opts.data);
                    } else if ("tags" in opts) {
                        opts.query = tags(opts.tags);
                        if (opts.createSearchChoice === undefined) {
                            opts.createSearchChoice = function (term) { return {id: $.trim(term), text: $.trim(term)}; };
                        }
                        if (opts.initSelection === undefined) {
                            opts.initSelection = function (element, callback) {
                                var data = [];
                                $(splitVal(element.val(), opts.separator)).each(function () {
                                    var obj = { id: this, text: this },
                                        tags = opts.tags;
                                    if ($.isFunction(tags)) tags=tags();
                                    $(tags).each(function() { if (equal(this.id, obj.id)) { obj = this; return false; } });
                                    data.push(obj);
                                });

                                callback(data);
                            };
                        }
                    }
                }
            }
            if (typeof(opts.query) !== "function") {
                throw "query function not defined for select_ajax " + opts.element.attr("id");
            }

            return opts;
        },

        /**
         * Monitor the original element for changes and update select_ajax accordingly
         */
        // abstract
        monitorSource: function () {
            var el = this.opts.element, sync, observer;

            el.on("change.select_ajax", this.bind(function (e) {
                if (this.opts.element.data("select_ajax-change-triggered") !== true) {
                    this.initSelection();
                }
            }));

            sync = this.bind(function () {

                // sync enabled state
                var disabled = el.prop("disabled");
                if (disabled === undefined) disabled = false;
                this.enable(!disabled);

                var readonly = el.prop("readonly");
                if (readonly === undefined) readonly = false;
                this.readonly(readonly);

                syncCssClasses(this.container, this.opts.element, this.opts.adaptContainerCssClass);
                this.container.addClass(evaluate(this.opts.containerCssClass));

                syncCssClasses(this.dropdown, this.opts.element, this.opts.adaptDropdownCssClass);
                this.dropdown.addClass(evaluate(this.opts.dropdownCssClass));

            });

            // IE8-10
            el.on("propertychange.select_ajax", sync);

            // hold onto a reference of the callback to work around a chromium bug
            if (this.mutationCallback === undefined) {
                this.mutationCallback = function (mutations) {
                    mutations.forEach(sync);
                }
            }

            // safari, chrome, firefox, IE11
            observer = window.MutationObserver || window.WebKitMutationObserver|| window.MozMutationObserver;
            if (observer !== undefined) {
                if (this.propertyObserver) { delete this.propertyObserver; this.propertyObserver = null; }
                this.propertyObserver = new observer(this.mutationCallback);
                this.propertyObserver.observe(el.get(0), { attributes:true, subtree:false });
            }
        },

        // abstract
        triggerSelect: function(data) {
            var evt = $.Event("select_ajax-selecting", { val: this.id(data), object: data });
            this.opts.element.trigger(evt);
            return !evt.isDefaultPrevented();
        },

        /**
         * Triggers the change event on the source element
         */
        // abstract
        triggerChange: function (details) {

            details = details || {};
            details= $.extend({}, details, { type: "change", val: this.val() });
            // prevents recursive triggering
            this.opts.element.data("select_ajax-change-triggered", true);
            this.opts.element.trigger(details);
            this.opts.element.data("select_ajax-change-triggered", false);

            // some validation frameworks ignore the change event and listen instead to keyup, click for selects
            // so here we trigger the click event manually
            this.opts.element.click();

            // ValidationEngine ignorea the change event and listens instead to blur
            // so here we trigger the blur event manually if so desired
            if (this.opts.blurOnChange)
                this.opts.element.blur();
        },

        //abstract
        isInterfaceEnabled: function()
        {
            return this.enabledInterface === true;
        },

        // abstract
        enableInterface: function() {
            var enabled = this._enabled && !this._readonly,
                disabled = !enabled;

            if (enabled === this.enabledInterface) return false;

            this.container.toggleClass("select_ajax-container-disabled", disabled);
            this.close();
            this.enabledInterface = enabled;

            return true;
        },

        // abstract
        enable: function(enabled) {
            if (enabled === undefined) enabled = true;
            if (this._enabled === enabled) return;
            this._enabled = enabled;

            this.opts.element.prop("disabled", !enabled);
            this.enableInterface();
        },

        // abstract
        disable: function() {
            this.enable(false);
        },

        // abstract
        readonly: function(enabled) {
            if (enabled === undefined) enabled = false;
            if (this._readonly === enabled) return false;
            this._readonly = enabled;

            this.opts.element.prop("readonly", enabled);
            this.enableInterface();
            return true;
        },

        // abstract
        opened: function () {
            return this.container.hasClass("select_ajax-dropdown-open");
        },

        // abstract
        positionDropdown: function() {
            var $dropdown = this.dropdown,
                offset = this.container.offset(),
                height = this.container.outerHeight(false),
                width = this.container.outerWidth(false),
                dropHeight = $dropdown.outerHeight(false),
                $window = $(window),
                windowWidth = $window.width(),
                windowHeight = $window.height(),
                viewPortRight = $window.scrollLeft() + windowWidth,
                viewportBottom = $window.scrollTop() + windowHeight,
                dropTop = offset.top + height,
                dropLeft = offset.left,
                enoughRoomBelow = dropTop + dropHeight <= viewportBottom,
                enoughRoomAbove = (offset.top - dropHeight) >= this.body().scrollTop(),
                dropWidth = $dropdown.outerWidth(false),
                enoughRoomOnRight = dropLeft + dropWidth <= viewPortRight,
                aboveNow = $dropdown.hasClass("select_ajax-drop-above"),
                bodyOffset,
                above,
                changeDirection,
                css,
                resultsListNode;

            // always prefer the current above/below alignment, unless there is not enough room
            if (aboveNow) {
                above = true;
                if (!enoughRoomAbove && enoughRoomBelow) {
                    changeDirection = true;
                    above = false;
                }
            } else {
                above = false;
                if (!enoughRoomBelow && enoughRoomAbove) {
                    changeDirection = true;
                    above = true;
                }
            }

            //if we are changing direction we need to get positions when dropdown is hidden;
            if (changeDirection) {
                $dropdown.hide();
                offset = this.container.offset();
                height = this.container.outerHeight(false);
                width = this.container.outerWidth(false);
                dropHeight = $dropdown.outerHeight(false);
                viewPortRight = $window.scrollLeft() + windowWidth;
                viewportBottom = $window.scrollTop() + windowHeight;
                dropTop = offset.top + height;
                dropLeft = offset.left;
                dropWidth = $dropdown.outerWidth(false);
                enoughRoomOnRight = dropLeft + dropWidth <= viewPortRight;
                $dropdown.show();
            }

            if (this.opts.dropdownAutoWidth) {
                resultsListNode = $('.select_ajax-results', $dropdown)[0];
                $dropdown.addClass('select_ajax-drop-auto-width');
                $dropdown.css('width', '');
                // Add scrollbar width to dropdown if vertical scrollbar is present
                dropWidth = $dropdown.outerWidth(false) + (resultsListNode.scrollHeight === resultsListNode.clientHeight ? 0 : scrollBarDimensions.width);
                dropWidth > width ? width = dropWidth : dropWidth = width;
                enoughRoomOnRight = dropLeft + dropWidth <= viewPortRight;
            }
            else {
                this.container.removeClass('select_ajax-drop-auto-width');
            }

            //console.log("below/ droptop:", dropTop, "dropHeight", dropHeight, "sum", (dropTop+dropHeight)+" viewport bottom", viewportBottom, "enough?", enoughRoomBelow);
            //console.log("above/ offset.top", offset.top, "dropHeight", dropHeight, "top", (offset.top-dropHeight), "scrollTop", this.body().scrollTop(), "enough?", enoughRoomAbove);

            // fix positioning when body has an offset and is not position: static
            if (this.body().css('position') !== 'static') {
                bodyOffset = this.body().offset();
                dropTop -= bodyOffset.top;
                dropLeft -= bodyOffset.left;
            }

            if (!enoughRoomOnRight) {
               dropLeft = offset.left + width - dropWidth;
            }

            css =  {
                left: dropLeft,
                width: width
            };

            if (above) {
                css.bottom = windowHeight - offset.top;
                if (this.container.parents('.modal').length) {
                    var modalWindowHeight = this.container.parents('.modalScrollable').height();
                    var modalOffsetTop = offset.top - this.container.parents('.modalScrollable').offset().top;
                    css.bottom = modalWindowHeight - modalOffsetTop;
                }
                css.top = 'auto';
                this.container.addClass("select_ajax-drop-above");
                $dropdown.addClass("select_ajax-drop-above");
            }
            else {
                css.top = dropTop;
                css.bottom = 'auto';
                this.container.removeClass("select_ajax-drop-above");
                $dropdown.removeClass("select_ajax-drop-above");
            }
            css = $.extend(css, evaluate(this.opts.dropdownCss));

            $dropdown.css(css);
        },

        // abstract
        shouldOpen: function() {
            var event;

            if (this.opened()) return false;

            if (this._enabled === false || this._readonly === true) return false;

            event = $.Event("select_ajax-opening");
            this.opts.element.trigger(event);
            return !event.isDefaultPrevented();
        },

        // abstract
        clearDropdownAlignmentPreference: function() {
            // clear the classes used to figure out the preference of where the dropdown should be opened
            this.container.removeClass("select_ajax-drop-above");
            this.dropdown.removeClass("select_ajax-drop-above");
        },

        /**
         * Opens the dropdown
         *
         * @return {Boolean} whether or not dropdown was opened. This method will return false if, for example,
         * the dropdown is already open, or if the 'open' event listener on the element called preventDefault().
         */
        // abstract
        open: function () {

            if (!this.shouldOpen()) return false;

            this.opening();

            return true;
        },

        /**
         * Performs the opening of the dropdown
         */
        // abstract
        opening: function() {
            var cid = this.containerId,
                scroll = "scroll." + cid,
                resize = "resize."+cid,
                orient = "orientationchange."+cid,
                mask;

            this.container.addClass("select_ajax-dropdown-open").addClass("select_ajax-container-active");

            this.clearDropdownAlignmentPreference();

            if(this.dropdown[0] !== this.body().children().last()[0]) {
                this.dropdown.detach().appendTo(this.body());
            }

            // create the dropdown mask if doesnt already exist
            mask = $("#select_ajax-drop-mask");
            if (mask.length == 0) {
                mask = $(document.createElement("div"));
                mask.attr("id","select_ajax-drop-mask").attr("class","select_ajax-drop-mask");
                mask.hide();
                mask.appendTo(this.body());
                mask.on("mousedown touchstart click", function (e) {
                    var dropdown = $("#select_ajax-drop"), self;
                    if (dropdown.length > 0) {
                        self=dropdown.data("select_ajax");
                        if (self.opts.selectOnBlur) {
                            self.selectHighlighted({noFocus: true});
                        }
                        self.close({focus:true});
                        e.preventDefault();
                        e.stopPropagation();
                    }
                });
            }

            // ensure the mask is always right before the dropdown
            if (this.dropdown.prev()[0] !== mask[0]) {
                this.dropdown.before(mask);
            }

            // move the global id to the correct dropdown
            $("#select_ajax-drop").removeAttr("id");
            this.dropdown.attr("id", "select_ajax-drop");

            // show the elements
            mask.show();

            this.positionDropdown();
            this.dropdown.show();
            this.positionDropdown();

            this.dropdown.addClass("select_ajax-drop-active");

            // attach listeners to events that can change the position of the container and thus require
            // the position of the dropdown to be updated as well so it does not come unglued from the container
            var that = this;
            this.container.parents().add(window).each(function () {
                $(this).on(resize+" "+scroll+" "+orient, function (e) {
                    that.positionDropdown();
                });
            });


        },

        // abstract
        close: function () {
            if (!this.opened()) return;

            var cid = this.containerId,
                scroll = "scroll." + cid,
                resize = "resize."+cid,
                orient = "orientationchange."+cid;

            // unbind event listeners
            this.container.parents().add(window).each(function () { $(this).off(scroll).off(resize).off(orient); });

            this.clearDropdownAlignmentPreference();

            $("#select_ajax-drop-mask").hide();
            this.dropdown.removeAttr("id"); // only the active dropdown has the select_ajax-drop id
            this.dropdown.hide();
            this.container.removeClass("select_ajax-dropdown-open").removeClass("select_ajax-container-active");
            this.results.empty();


            this.clearSearch();
            this.search.removeClass("select_ajax-active");
            this.opts.element.trigger($.Event("select_ajax-close"));
        },

        /**
         * Opens control, sets input value, and updates results.
         */
        // abstract
        externalSearch: function (term) {
            this.open();
            this.search.val(term);
            this.updateResults(false);
        },

        // abstract
        clearSearch: function () {

        },

        //abstract
        getMaximumSelectionSize: function() {
            return evaluate(this.opts.maximumSelectionSize);
        },

        // abstract
        ensureHighlightVisible: function () {
            var results = this.results, children, index, child, hb, rb, y, more;

            index = this.highlight();

            if (index < 0) return;

            if (index == 0) {

                // if the first element is highlighted scroll all the way to the top,
                // that way any unselectable headers above it will also be scrolled
                // into view

                results.scrollTop(0);
                return;
            }

            children = this.findHighlightableChoices().find('.select_ajax-result-label');

            child = $(children[index]);

            hb = child.offset().top + child.outerHeight(true);

            // if this is the last child lets also make sure select_ajax-more-results is visible
            if (index === children.length - 1) {
                more = results.find("li.select_ajax-more-results");
                if (more.length > 0) {
                    hb = more.offset().top + more.outerHeight(true);
                }
            }

            rb = results.offset().top + results.outerHeight(true);
            if (hb > rb) {
                results.scrollTop(results.scrollTop() + (hb - rb));
            }
            y = child.offset().top - results.offset().top;

            // make sure the top of the element is visible
            if (y < 0 && child.css('display') != 'none' ) {
                results.scrollTop(results.scrollTop() + y); // y is negative
            }
        },

        // abstract
        findHighlightableChoices: function() {
            return this.results.find(".select_ajax-result-selectable:not(.select_ajax-disabled, .select_ajax-selected)");
        },

        // abstract
        moveHighlight: function (delta) {
            var choices = this.findHighlightableChoices(),
                index = this.highlight();

            while (index > -1 && index < choices.length) {
                index += delta;
                var choice = $(choices[index]);
                if (choice.hasClass("select_ajax-result-selectable") && !choice.hasClass("select_ajax-disabled") && !choice.hasClass("select_ajax-selected")) {
                    this.highlight(index);
                    break;
                }
            }
        },

        // abstract
        highlight: function (index) {
            var choices = this.findHighlightableChoices(),
                choice,
                data;

            if (arguments.length === 0) {
                return indexOf(choices.filter(".select_ajax-highlighted")[0], choices.get());
            }

            if (index >= choices.length) index = choices.length - 1;
            if (index < 0) index = 0;

            this.removeHighlight();

            choice = $(choices[index]);
            choice.addClass("select_ajax-highlighted");

            this.ensureHighlightVisible();

            data = choice.data("select_ajax-data");
            if (data) {
                this.opts.element.trigger({ type: "select_ajax-highlight", val: this.id(data), choice: data });
            }
        },

        removeHighlight: function() {
            this.results.find(".select_ajax-highlighted").removeClass("select_ajax-highlighted");
        },

        // abstract
        countSelectableResults: function() {
            return this.findHighlightableChoices().length;
        },

        // abstract
        highlightUnderEvent: function (event) {
            var el = $(event.target).closest(".select_ajax-result-selectable");
            if (el.length > 0 && !el.is(".select_ajax-highlighted")) {
                var choices = this.findHighlightableChoices();
                this.highlight(choices.index(el));
            } else if (el.length == 0) {
                // if we are over an unselectable item remove all highlights
                this.removeHighlight();
            }
        },

        // abstract
        loadMoreIfNeeded: function () {
            var results = this.results,
                more = results.find("li.select_ajax-more-results"),
                below, // pixels the element is below the scroll fold, below==0 is when the element is starting to be visible
                page = this.resultsPage + 1,
                self=this,
                term=this.search.val(),
                context=this.context;

            if (more.length === 0) return;
            below = more.offset().top - results.offset().top - results.height();

            if (below <= this.opts.loadMorePadding) {
                more.addClass("select_ajax-active");
                this.opts.query({
                        element: this.opts.element,
                        term: term,
                        page: page,
                        context: context,
                        matcher: this.opts.matcher,
                        callback: this.bind(function (data) {

                    // ignore a response if the select_ajax has been closed before it was received
                    if (!self.opened()) return;


                    self.opts.populateResults.call(this, results, data.results, {term: term, page: page, context:context});
                    self.postprocessResults(data, false, false);

                    if (data.more===true) {
                        more.detach().appendTo(results).text(self.opts.formatLoadMore(page+1));
                        window.setTimeout(function() { self.loadMoreIfNeeded(); }, 10);
                    } else {
                        more.remove();
                    }
                    self.positionDropdown();
                    self.resultsPage = page;
                    self.context = data.context;
                    this.opts.element.trigger({ type: "select_ajax-loaded", items: data });
                })});
            }
        },

        /**
         * Default tokenizer function which does nothing
         */
        tokenize: function() {

        },

        /**
         * @param initial whether or not this is the call to this method right after the dropdown has been opened
         */
        // abstract
        updateResults: function (initial) {
            var search = this.search,
                results = this.results,
                opts = this.opts,
                data,
                self = this,
                input,
                term = search.val(),
                lastTerm = $.data(this.container, "select_ajax-last-term"),
                // sequence number used to drop out-of-order responses
                queryNumber;

            // prevent duplicate queries against the same term
            if (initial !== true && lastTerm && equal(term, lastTerm)) return;

            $.data(this.container, "select_ajax-last-term", term);

            // if the search is currently hidden we do not alter the results
            if (initial !== true && (this.showSearchInput === false || !this.opened())) {
                return;
            }

            function postRender() {
                search.removeClass("select_ajax-active");
                self.positionDropdown();
            }

            function render(html) {
                results.html(html);
                postRender();
            }

            queryNumber = ++this.queryCount;

            var maxSelSize = this.getMaximumSelectionSize();
            if (maxSelSize >=1) {
                data = this.data();
                if ($.isArray(data) && data.length >= maxSelSize && checkFormatter(opts.formatSelectionTooBig, "formatSelectionTooBig")) {
                    render("<li class='select_ajax-selection-limit'>" + opts.formatSelectionTooBig(maxSelSize) + "</li>");
                    return;
                }
            }

            if (search.val().length < opts.minimumInputLength) {
                if (checkFormatter(opts.formatInputTooShort, "formatInputTooShort")) {
                    render("<li class='select_ajax-no-results'>" + opts.formatInputTooShort(search.val(), opts.minimumInputLength) + "</li>");
                } else {
                    render("");
                }
                if (initial && this.showSearch) this.showSearch(true);
                return;
            }

            if (opts.maximumInputLength && search.val().length > opts.maximumInputLength) {
                if (checkFormatter(opts.formatInputTooLong, "formatInputTooLong")) {
                    render("<li class='select_ajax-no-results'>" + opts.formatInputTooLong(search.val(), opts.maximumInputLength) + "</li>");
                } else {
                    render("");
                }
                return;
            }

            if (opts.formatSearching && this.findHighlightableChoices().length === 0) {
                render("<li class='select_ajax-searching'>" + opts.formatSearching() + "</li>");
            }

            search.addClass("select_ajax-active");

            this.removeHighlight();

            // give the tokenizer a chance to pre-process the input
            input = this.tokenize();
            if (input != undefined && input != null) {
                search.val(input);
            }

            this.resultsPage = 1;

            opts.query({
                element: opts.element,
                    term: search.val(),
                    page: this.resultsPage,
                    context: null,
                    matcher: opts.matcher,
                    callback: this.bind(function (data) {
                var def; // default choice

                // ignore old responses
                if (queryNumber != this.queryCount) {
                  return;
                }

                // ignore a response if the select_ajax has been closed before it was received
                if (!this.opened()) {
                    this.search.removeClass("select_ajax-active");
                    return;
                }

                // save context, if any
                this.context = (data.context===undefined) ? null : data.context;
                // create a default choice and prepend it to the list
                if (this.opts.createSearchChoice && search.val() !== "") {
                    def = this.opts.createSearchChoice.call(self, search.val(), data.results);
                    if (def !== undefined && def !== null && self.id(def) !== undefined && self.id(def) !== null) {
                        if ($(data.results).filter(
                            function () {
                                return equal(self.id(this), self.id(def));
                            }).length === 0) {
                            data.results.unshift(def);
                        }
                    }
                }

                if (data.results.length === 0 && checkFormatter(opts.formatNoMatches, "formatNoMatches")) {
                    render("<li class='select_ajax-no-results'>" + opts.formatNoMatches(search.val()) + "</li>");
                    return;
                }

                results.empty();
                self.opts.populateResults.call(this, results, data.results, {term: search.val(), page: this.resultsPage, context:null});

                if (data.more === true && checkFormatter(opts.formatLoadMore, "formatLoadMore")) {
                    results.append("<li class='select_ajax-more-results'>" + self.opts.escapeMarkup(opts.formatLoadMore(this.resultsPage)) + "</li>");
                    window.setTimeout(function() { self.loadMoreIfNeeded(); }, 10);
                }

                this.postprocessResults(data, initial);

                postRender();

                this.opts.element.trigger({ type: "select_ajax-loaded", items: data });
            })});
        },

        // abstract
        cancel: function () {
            this.close();
        },

        // abstract
        blur: function () {
            // if selectOnBlur == true, select the currently highlighted option
            if (this.opts.selectOnBlur)
                this.selectHighlighted({noFocus: true});

            this.close();
            this.container.removeClass("select_ajax-container-active");
            // synonymous to .is(':focus'), which is available in jquery >= 1.6
            if (this.search[0] === document.activeElement) { this.search.blur(); }
            this.clearSearch();
            this.selection.find(".select_ajax-search-choice-focus").removeClass("select_ajax-search-choice-focus");
        },

        // abstract
        focusSearch: function () {
            focus(this.search);
        },

        // abstract
        selectHighlighted: function (options) {
            var index=this.highlight(),
                highlighted=this.results.find(".select_ajax-highlighted"),
                data = highlighted.closest('.select_ajax-result').data("select_ajax-data");

            if (data) {
                this.highlight(index);
                this.onSelect(data, options);
            } else if (options && options.noFocus) {
                this.close();
            }
        },

        // abstract
        getPlaceholder: function () {
            var placeholderOption;
            return this.opts.element.attr("placeholder") ||
                this.opts.element.attr("data-placeholder") || // jquery 1.4 compat
                this.opts.element.data("placeholder") ||
                this.opts.placeholder ||
                ((placeholderOption = this.getPlaceholderOption()) !== undefined ? placeholderOption.text() : undefined);
        },

        // abstract
        getPlaceholderOption: function() {
            if (this.select) {
                var firstOption = this.select.children('option').first();
                if (this.opts.placeholderOption !== undefined ) {
                    //Determine the placeholder option based on the specified placeholderOption setting
                    return (this.opts.placeholderOption === "first" && firstOption) ||
                           (typeof this.opts.placeholderOption === "function" && this.opts.placeholderOption(this.select));
                } else if (firstOption.text() === "" && firstOption.val() === "") {
                    //No explicit placeholder option specified, use the first if it's blank
                    return firstOption;
                }
            }
        },

        /**
         * Get the desired width for the container element.  This is
         * derived first from option `width` passed to select_ajax, then
         * the inline 'style' on the original element, and finally
         * falls back to the jQuery calculated element width.
         */
        // abstract
        initContainerWidth: function () {
            function resolveContainerWidth() {
                var style, attrs, matches, i, l, attr;

                if (this.opts.width === "off") {
                    return null;
                } else if (this.opts.width === "element"){
                    return this.opts.element.outerWidth(false) === 0 ? 'auto' : this.opts.element.outerWidth(false) + 'px';
                } else if (this.opts.width === "copy" || this.opts.width === "resolve") {
                    // check if there is inline style on the element that contains width
                    style = this.opts.element.attr('style');
                    if (style !== undefined) {
                        attrs = style.split(';');
                        for (i = 0, l = attrs.length; i < l; i = i + 1) {
                            attr = attrs[i].replace(/\s/g, '');
                            matches = attr.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i);
                            if (matches !== null && matches.length >= 1)
                                return matches[1];
                        }
                    }

                    if (this.opts.width === "resolve") {
                        // next check if css('width') can resolve a width that is percent based, this is sometimes possible
                        // when attached to input type=hidden or elements hidden via css
                        style = this.opts.element.css('width');
                        if (style.indexOf("%") > 0) return style;

                        // finally, fallback on the calculated width of the element
                        return (this.opts.element.outerWidth(false) === 0 ? 'auto' : this.opts.element.outerWidth(false) + 'px');
                    }

                    return null;
                } else if ($.isFunction(this.opts.width)) {
                    return this.opts.width();
                } else {
                    return this.opts.width;
               }
            };

            var width = resolveContainerWidth.call(this);
            if (width !== null) {
                this.container.css("width", width);
            }
        }
    });

    Singleselect_ajax = clazz(Abstractselect_ajax, {

        // single

        createContainer: function () {
            var container = $(document.createElement("div")).attr({
                "class": "select_ajax-container"
            }).html([
                "<a href='javascript:void(0)' onclick='return false;' class='select_ajax-choice' tabindex='-1'>",
                "   <span class='select_ajax-chosen'>&nbsp;</span><abbr class='select_ajax-search-choice-close'></abbr>",
                "   <span class='select_ajax-arrow'><b></b></span>",
                "</a>",
                "<input class='select_ajax-focusser select_ajax-offscreen' type='text'/>",
                "<div class='select_ajax-drop select_ajax-display-none'>",
                "   <div class='select_ajax-search'>",
                "       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select_ajax-input'/>",
                "   </div>",
                "   <ul id='tags-block' class='select_ajax-results'>",
                "   </ul>",
                "</div>"].join(""));
            return container;
        },

        // single
        enableInterface: function() {
            if (this.parent.enableInterface.apply(this, arguments)) {
                this.focusser.prop("disabled", !this.isInterfaceEnabled());
            }
        },

        // single
        opening: function () {
            var el, range, len;

            if (this.opts.minimumResultsForSearch >= 0) {
                this.showSearch(true);
            }

            this.parent.opening.apply(this, arguments);

            if (this.showSearchInput !== false) {
                // IE appends focusser.val() at the end of field :/ so we manually insert it at the beginning using a range
                // all other browsers handle this just fine

                this.search.val(this.focusser.val());
            }
            this.search.focus();
            // move the cursor to the end after focussing, otherwise it will be at the beginning and
            // new text will appear *before* focusser.val()
            el = this.search.get(0);
            if (el.createTextRange) {
                range = el.createTextRange();
                range.collapse(false);
                range.select();
            } else if (el.setSelectionRange) {
                len = this.search.val().length;
                el.setSelectionRange(len, len);
            }

            // initializes search's value with nextSearchTerm (if defined by user)
            // ignore nextSearchTerm if the dropdown is opened by the user pressing a letter
            if(this.search.val() === "") {
                if(this.nextSearchTerm != undefined){
                    this.search.val(this.nextSearchTerm);
                    this.search.select();
                }
            }

            this.focusser.prop("disabled", true).val("");
            this.updateResults(true);
            this.opts.element.trigger($.Event("select_ajax-open"));
        },

        // single
        close: function (params) {
            if (!this.opened()) return;
            this.parent.close.apply(this, arguments);

            params = params || {focus: true};
            this.focusser.removeAttr("disabled");

            if (params.focus) {
                this.focusser.focus();
            }
        },

        // single
        focus: function () {
            if (this.opened()) {
                this.close();
            } else {
                this.focusser.removeAttr("disabled");
                this.focusser.focus();
            }
        },

        // single
        isFocused: function () {
            return this.container.hasClass("select_ajax-container-active");
        },

        // single
        cancel: function () {
            this.parent.cancel.apply(this, arguments);
            this.focusser.removeAttr("disabled");
            this.focusser.focus();
        },

        // single
        destroy: function() {
            $("label[for='" + this.focusser.attr('id') + "']")
                .attr('for', this.opts.element.attr("id"));
            this.parent.destroy.apply(this, arguments);
        },

        // single
        initContainer: function () {

            var selection,
                container = this.container,
                dropdown = this.dropdown;

            if (this.opts.minimumResultsForSearch < 0) {
                this.showSearch(false);
            } else {
                this.showSearch(true);
            }

            this.selection = selection = container.find(".select_ajax-choice");

            this.focusser = container.find(".select_ajax-focusser");

            // rewrite labels from original element to focusser
            this.focusser.attr("id", "s2id_autogen"+nextUid());

            $("label[for='" + this.opts.element.attr("id") + "']")
                .attr('for', this.focusser.attr('id'));

            this.focusser.attr("tabindex", this.elementTabIndex);

            this.search.on("keydown", this.bind(function (e) {
                if (!this.isInterfaceEnabled()) return;

                if (e.which === KEY.PAGE_UP || e.which === KEY.PAGE_DOWN) {
                    // prevent the page from scrolling
                    killEvent(e);
                    return;
                }

                switch (e.which) {
                    case KEY.UP:
                    case KEY.DOWN:
                        this.moveHighlight((e.which === KEY.UP) ? -1 : 1);
                        killEvent(e);
                        return;
                    case KEY.ENTER:
                        this.selectHighlighted();
                        killEvent(e);
                        return;
                    case KEY.TAB:
                        this.selectHighlighted({noFocus: true});
                        return;
                    case KEY.ESC:
                        this.cancel(e);
                        killEvent(e);
                        return;
                }
            }));

            this.search.on("blur", this.bind(function(e) {
                // a workaround for chrome to keep the search field focussed when the scroll bar is used to scroll the dropdown.
                // without this the search field loses focus which is annoying
                if (document.activeElement === this.body().get(0)) {
                    window.setTimeout(this.bind(function() {
                        this.search.focus();
                    }), 0);
                }
            }));

            this.focusser.on("keydown", this.bind(function (e) {
                if (!this.isInterfaceEnabled()) return;

                if (e.which === KEY.TAB || KEY.isControl(e) || KEY.isFunctionKey(e) || e.which === KEY.ESC) {
                    return;
                }

                if (this.opts.openOnEnter === false && e.which === KEY.ENTER) {
                    killEvent(e);
                    return;
                }

                if (e.which == KEY.DOWN || e.which == KEY.UP
                    || (e.which == KEY.ENTER && this.opts.openOnEnter)) {

                    if (e.altKey || e.ctrlKey || e.shiftKey || e.metaKey) return;

                    this.open();
                    killEvent(e);
                    return;
                }

                if (e.which == KEY.DELETE || e.which == KEY.BACKSPACE) {
                    if (this.opts.allowClear) {
                        this.clear();
                    }
                    killEvent(e);
                    return;
                }
            }));


            installKeyUpChangeEvent(this.focusser);
            this.focusser.on("keyup-change input", this.bind(function(e) {
                if (this.opts.minimumResultsForSearch >= 0) {
                    e.stopPropagation();
                    if (this.opened()) return;
                    this.open();
                }
            }));

            selection.on("mousedown", "abbr", this.bind(function (e) {
                if (!this.isInterfaceEnabled()) return;
                this.clear();
                killEventImmediately(e);
                this.close();
                this.selection.focus();
            }));

            selection.on("mousedown", this.bind(function (e) {

                if (!this.container.hasClass("select_ajax-container-active")) {
                    this.opts.element.trigger($.Event("select_ajax-focus"));
                }

                if (this.opened()) {
                    this.close();
                } else if (this.isInterfaceEnabled()) {
                    this.open();
                }

                killEvent(e);
            }));

            dropdown.on("mousedown", this.bind(function() { this.search.focus(); }));

            selection.on("focus", this.bind(function(e) {
                killEvent(e);
            }));

            this.focusser.on("focus", this.bind(function(){
                if (!this.container.hasClass("select_ajax-container-active")) {
                    this.opts.element.trigger($.Event("select_ajax-focus"));
                }
                this.container.addClass("select_ajax-container-active");
            })).on("blur", this.bind(function() {
                if (!this.opened()) {
                    this.container.removeClass("select_ajax-container-active");
                    this.opts.element.trigger($.Event("select_ajax-blur"));
                }
            }));
            this.search.on("focus", this.bind(function(){
                if (!this.container.hasClass("select_ajax-container-active")) {
                    this.opts.element.trigger($.Event("select_ajax-focus"));
                }
                this.container.addClass("select_ajax-container-active");
            }));

            this.initContainerWidth();
            this.opts.element.addClass("select_ajax-offscreen");
            this.setPlaceholder();

        },

        // single
        clear: function(triggerChange) {
            var data=this.selection.data("select_ajax-data");
            if (data) { // guard against queued quick consecutive clicks
                var evt = $.Event("select_ajax-clearing");
                this.opts.element.trigger(evt);
                if (evt.isDefaultPrevented()) {
                    return;
                }
                var placeholderOption = this.getPlaceholderOption();
                this.opts.element.val(placeholderOption ? placeholderOption.val() : "");
                this.selection.find(".select_ajax-chosen").empty();
                this.selection.removeData("select_ajax-data");
                this.setPlaceholder();

                if (triggerChange !== false){
                    this.opts.element.trigger({ type: "select_ajax-removed", val: this.id(data), choice: data });
                    this.triggerChange({removed:data});
                }
            }
        },

        /**
         * Sets selection based on source element's value
         */
        // single
        initSelection: function () {
            var selected;
            if (this.isPlaceholderOptionSelected()) {
                this.updateSelection(null);
                this.close();
                this.setPlaceholder();
            } else {
                var self = this;
                this.opts.initSelection.call(null, this.opts.element, function(selected){
                    if (selected !== undefined && selected !== null) {
                        self.updateSelection(selected);
                        self.close();
                        self.setPlaceholder();
                    }
                });
            }
        },

        isPlaceholderOptionSelected: function() {
            var placeholderOption;
            if (!this.getPlaceholder()) return false; // no placeholder specified so no option should be considered
            return ((placeholderOption = this.getPlaceholderOption()) !== undefined && placeholderOption.prop("selected"))
                || (this.opts.element.val() === "")
                || (this.opts.element.val() === undefined)
                || (this.opts.element.val() === null);
        },

        // single
        prepareOpts: function () {
            var opts = this.parent.prepareOpts.apply(this, arguments),
                self=this;

            if (opts.element.get(0).tagName.toLowerCase() === "select") {
                // install the selection initializer
                opts.initSelection = function (element, callback) {
                    var selected = element.find("option").filter(function() { return this.selected });
                    // a single select box always has a value, no need to null check 'selected'
                    callback(self.optionToData(selected));
                };
            } else if ("data" in opts) {
                // install default initSelection when applied to hidden input and data is local
                opts.initSelection = opts.initSelection || function (element, callback) {
                    var id = element.val();
                    //search in data by id, storing the actual matching item
                    var match = null;
                    opts.query({
                        matcher: function(term, text, el){
                            var is_match = equal(id, opts.id(el));
                            if (is_match) {
                                match = el;
                            }
                            return is_match;
                        },
                        callback: !$.isFunction(callback) ? $.noop : function() {
                            callback(match);
                        }
                    });
                };
            }

            return opts;
        },

        // single
        getPlaceholder: function() {
            // if a placeholder is specified on a single select without a valid placeholder option ignore it
            if (this.select) {
                if (this.getPlaceholderOption() === undefined) {
                    return undefined;
                }
            }

            return this.parent.getPlaceholder.apply(this, arguments);
        },

        // single
        setPlaceholder: function () {
            var placeholder = this.getPlaceholder();

            if (this.isPlaceholderOptionSelected() && placeholder !== undefined) {

                // check for a placeholder option if attached to a select
                if (this.select && this.getPlaceholderOption() === undefined) return;

                this.selection.find(".select_ajax-chosen").html(this.opts.escapeMarkup(placeholder));

                this.selection.addClass("select_ajax-default");

                this.container.removeClass("select_ajax-allowclear");
            }
        },

        // single
        postprocessResults: function (data, initial, noHighlightUpdate) {
            var selected = 0, self = this, showSearchInput = true;

            // find the selected element in the result list

            this.findHighlightableChoices().each2(function (i, elm) {
                if (equal(self.id(elm.data("select_ajax-data")), self.opts.element.val())) {
                    selected = i;
                    return false;
                }
            });

            // and highlight it
            if (noHighlightUpdate !== false) {
                if (initial === true && selected >= 0) {
                    this.highlight(selected);
                } else {
                    this.highlight(0);
                }
            }

            // hide the search box if this is the first we got the results and there are enough of them for search

            if (initial === true) {
                var min = this.opts.minimumResultsForSearch;
                if (min >= 0) {
                    this.showSearch(countResults(data.results) >= min);
                }
            }
        },

        // single
        showSearch: function(showSearchInput) {
            if (this.showSearchInput === showSearchInput) return;

            this.showSearchInput = showSearchInput;

            this.dropdown.find(".select_ajax-search").toggleClass("select_ajax-search-hidden", !showSearchInput);
            this.dropdown.find(".select_ajax-search").toggleClass("select_ajax-offscreen", !showSearchInput);
            //add "select_ajax-with-searchbox" to the container if search box is shown
            $(this.dropdown, this.container).toggleClass("select_ajax-with-searchbox", showSearchInput);
        },

        // single
        onSelect: function (data, options) {

            if (!this.triggerSelect(data)) { return; }

            var old = this.opts.element.val(),
                oldData = this.data();

            this.opts.element.val(this.id(data));
            this.updateSelection(data);

            this.opts.element.trigger({ type: "select_ajax-selected", val: this.id(data), choice: data });

            this.nextSearchTerm = this.opts.nextSearchTerm(data, this.search.val());
            this.close();

            if (!options || !options.noFocus)
                this.focusser.focus();

            if (!equal(old, this.id(data))) { this.triggerChange({added:data,removed:oldData}); }
        },

        // single
        updateSelection: function (data) {

            var container=this.selection.find(".select_ajax-chosen"), formatted, cssClass;

            this.selection.data("select_ajax-data", data);

            container.empty();
            if (data !== null) {
                formatted=this.opts.formatSelection(data, container, this.opts.escapeMarkup);
            }
            if (formatted !== undefined) {
                container.append(formatted);
            }
            cssClass=this.opts.formatSelectionCssClass(data, container);
            if (cssClass !== undefined) {
                container.addClass(cssClass);
            }

            this.selection.removeClass("select_ajax-default");

            if (this.opts.allowClear && this.getPlaceholder() !== undefined) {
                this.container.addClass("select_ajax-allowclear");
            }
        },

        // single
        val: function () {
            var val,
                triggerChange = false,
                data = null,
                self = this,
                oldData = this.data();

            if (arguments.length === 0) {
                return this.opts.element.val();
            }

            val = arguments[0];

            if (arguments.length > 1) {
                triggerChange = arguments[1];
            }

            if (this.select) {
                this.select
                    .val(val)
                    .find("option").filter(function() { return this.selected }).each2(function (i, elm) {
                        data = self.optionToData(elm);
                        return false;
                    });
                this.updateSelection(data);
                this.setPlaceholder();
                if (triggerChange) {
                    this.triggerChange({added: data, removed:oldData});
                }
            } else {
                // val is an id. !val is true for [undefined,null,'',0] - 0 is legal
                if (!val && val !== 0) {
                    this.clear(triggerChange);
                    return;
                }
                if (this.opts.initSelection === undefined) {
                    throw new Error("cannot call val() if initSelection() is not defined");
                }
                this.opts.element.val(val);
                this.opts.initSelection(this.opts.element, function(data){
                    self.opts.element.val(!data ? "" : self.id(data));
                    self.updateSelection(data);
                    self.setPlaceholder();
                    if (triggerChange) {
                        self.triggerChange({added: data, removed:oldData});
                    }
                });
            }
        },

        // single
        clearSearch: function () {
            this.search.val("");
            this.focusser.val("");
        },

        // single
        data: function(value) {
            var data,
                triggerChange = false;

            if (arguments.length === 0) {
                data = this.selection.data("select_ajax-data");
                if (data == undefined) data = null;
                return data;
            } else {
                if (arguments.length > 1) {
                    triggerChange = arguments[1];
                }
                if (!value) {
                    this.clear(triggerChange);
                } else {
                    data = this.data();
                    this.opts.element.val(!value ? "" : this.id(value));
                    this.updateSelection(value);
                    if (triggerChange) {
                        this.triggerChange({added: value, removed:data});
                    }
                }
            }
        }
    });

    Multiselect_ajax = clazz(Abstractselect_ajax, {

        // multi
        createContainer: function () {
            var container = $(document.createElement("div")).attr({
                "class": "select_ajax-container select_ajax-container-multi"
            }).html([
                "<ul class='select_ajax-choices'>",
                "  <li class='select_ajax-search-field'>",
                "    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select_ajax-input'>",
                "  </li>",
                "</ul>",
                "<div class='select_ajax-drop select_ajax-drop-multi select_ajax-display-none'>",
                "   <ul class='select_ajax-results'>",
                "   </ul>",
                "</div>"].join(""));
            return container;
        },

        // multi
        prepareOpts: function () {
            var opts = this.parent.prepareOpts.apply(this, arguments),
                self=this;

            // TODO validate placeholder is a string if specified

            if (opts.element.get(0).tagName.toLowerCase() === "select") {
                // install sthe selection initializer
                opts.initSelection = function (element, callback) {

                    var data = [];

                    element.find("option").filter(function() { return this.selected }).each2(function (i, elm) {
                        data.push(self.optionToData(elm));
                    });
                    callback(data);
                };
            } else if ("data" in opts) {
                // install default initSelection when applied to hidden input and data is local
                opts.initSelection = opts.initSelection || function (element, callback) {
                    var ids = splitVal(element.val(), opts.separator);
                    //search in data by array of ids, storing matching items in a list
                    var matches = [];
                    opts.query({
                        matcher: function(term, text, el){
                            var is_match = $.grep(ids, function(id) {
                                return equal(id, opts.id(el));
                            }).length;
                            if (is_match) {
                                matches.push(el);
                            }
                            return is_match;
                        },
                        callback: !$.isFunction(callback) ? $.noop : function() {
                            // reorder matches based on the order they appear in the ids array because right now
                            // they are in the order in which they appear in data array
                            var ordered = [];
                            for (var i = 0; i < ids.length; i++) {
                                var id = ids[i];
                                for (var j = 0; j < matches.length; j++) {
                                    var match = matches[j];
                                    if (equal(id, opts.id(match))) {
                                        ordered.push(match);
                                        matches.splice(j, 1);
                                        break;
                                    }
                                }
                            }
                            callback(ordered);
                        }
                    });
                };
            }

            return opts;
        },

        // multi
        selectChoice: function (choice) {

            var selected = this.container.find(".select_ajax-search-choice-focus");
            if (selected.length && choice && choice[0] == selected[0]) {

            } else {
                if (selected.length) {
                    this.opts.element.trigger("choice-deselected", selected);
                }
                selected.removeClass("select_ajax-search-choice-focus");
                if (choice && choice.length) {
                    this.close();
                    choice.addClass("select_ajax-search-choice-focus");
                    this.opts.element.trigger("choice-selected", choice);
                }
            }
        },

        // multi
        destroy: function() {
            $("label[for='" + this.search.attr('id') + "']")
                .attr('for', this.opts.element.attr("id"));
            this.parent.destroy.apply(this, arguments);
        },

        // multi
        initContainer: function () {

            var selector = ".select_ajax-choices", selection;

            this.searchContainer = this.container.find(".select_ajax-search-field");
            this.selection = selection = this.container.find(selector);

            var _this = this;
            this.selection.on("click", ".select_ajax-search-choice:not(.select_ajax-locked)", function (e) {
                //killEvent(e);
                _this.search[0].focus();
                _this.selectChoice($(this));
            });

            // rewrite labels from original element to focusser
            this.search.attr("id", "s2id_autogen"+nextUid());
            $("label[for='" + this.opts.element.attr("id") + "']")
                .attr('for', this.search.attr('id'));

            this.search.on("input paste", this.bind(function() {
                if (!this.isInterfaceEnabled()) return;
                if (!this.opened()) {
                    this.open();
                }
            }));

            this.search.attr("tabindex", this.elementTabIndex);

            this.keydowns = 0;
            this.search.on("keydown", this.bind(function (e) {
                if (!this.isInterfaceEnabled()) return;

                ++this.keydowns;
                var selected = selection.find(".select_ajax-search-choice-focus");
                var prev = selected.prev(".select_ajax-search-choice:not(.select_ajax-locked)");
                var next = selected.next(".select_ajax-search-choice:not(.select_ajax-locked)");
                var pos = getCursorInfo(this.search);

                if (selected.length &&
                    (e.which == KEY.LEFT || e.which == KEY.RIGHT || e.which == KEY.BACKSPACE || e.which == KEY.DELETE || e.which == KEY.ENTER)) {
                    var selectedChoice = selected;
                    if (e.which == KEY.LEFT && prev.length) {
                        selectedChoice = prev;
                    }
                    else if (e.which == KEY.RIGHT) {
                        selectedChoice = next.length ? next : null;
                    }
                    else if (e.which === KEY.BACKSPACE) {
                        this.unselect(selected.first());
                        this.search.width(10);
                        selectedChoice = prev.length ? prev : next;
                    } else if (e.which == KEY.DELETE) {
                        this.unselect(selected.first());
                        this.search.width(10);
                        selectedChoice = next.length ? next : null;
                    } else if (e.which == KEY.ENTER) {
                        selectedChoice = null;
                    }

                    this.selectChoice(selectedChoice);
                    killEvent(e);
                    if (!selectedChoice || !selectedChoice.length) {
                        this.open();
                    }
                    return;
                } else if (((e.which === KEY.BACKSPACE && this.keydowns == 1)
                    || e.which == KEY.LEFT) && (pos.offset == 0 && !pos.length)) {

                    this.selectChoice(selection.find(".select_ajax-search-choice:not(.select_ajax-locked)").last());
                    killEvent(e);
                    return;
                } else {
                    this.selectChoice(null);
                }

                if (this.opened()) {
                    switch (e.which) {
                    case KEY.UP:
                    case KEY.DOWN:
                        this.moveHighlight((e.which === KEY.UP) ? -1 : 1);
                        killEvent(e);
                        return;
                    case KEY.ENTER:
                        this.selectHighlighted();
                        killEvent(e);
                        return;
                    case KEY.TAB:
                        this.selectHighlighted({noFocus:true});
                        this.close();
                        return;
                    case KEY.ESC:
                        this.cancel(e);
                        killEvent(e);
                        return;
                    }
                }

                if (e.which === KEY.TAB || KEY.isControl(e) || KEY.isFunctionKey(e)
                 || e.which === KEY.BACKSPACE || e.which === KEY.ESC) {
                    return;
                }

                if (e.which === KEY.ENTER) {
                    if (this.opts.openOnEnter === false) {
                        return;
                    } else if (e.altKey || e.ctrlKey || e.shiftKey || e.metaKey) {
                        return;
                    }
                }

                this.open();

                if (e.which === KEY.PAGE_UP || e.which === KEY.PAGE_DOWN) {
                    // prevent the page from scrolling
                    killEvent(e);
                }

                if (e.which === KEY.ENTER) {
                    // prevent form from being submitted
                    killEvent(e);
                }

            }));

            this.search.on("keyup", this.bind(function (e) {
                this.keydowns = 0;
                this.resizeSearch();
            })
            );

            this.search.on("blur", this.bind(function(e) {
                this.container.removeClass("select_ajax-container-active");
                this.search.removeClass("select_ajax-focused");
                this.selectChoice(null);
                if (!this.opened()) this.clearSearch();
                e.stopImmediatePropagation();
                this.opts.element.trigger($.Event("select_ajax-blur"));
            }));

            this.container.on("click", selector, this.bind(function (e) {
                if (!this.isInterfaceEnabled()) return;
                if ($(e.target).closest(".select_ajax-search-choice").length > 0) {
                    // clicked inside a select_ajax search choice, do not open
                    return;
                }
                this.selectChoice(null);
                this.clearPlaceholder();
                if (!this.container.hasClass("select_ajax-container-active")) {
                    this.opts.element.trigger($.Event("select_ajax-focus"));
                }
                this.open();
                this.focusSearch();
                e.preventDefault();
            }));

            this.container.on("focus", selector, this.bind(function () {
                if (!this.isInterfaceEnabled()) return;
                if (!this.container.hasClass("select_ajax-container-active")) {
                    this.opts.element.trigger($.Event("select_ajax-focus"));
                }
                this.container.addClass("select_ajax-container-active");
                this.dropdown.addClass("select_ajax-drop-active");
                this.clearPlaceholder();
            }));

            this.initContainerWidth();
            this.opts.element.addClass("select_ajax-offscreen");

            // set the placeholder if necessary
            this.clearSearch();
        },

        // multi
        enableInterface: function() {
            if (this.parent.enableInterface.apply(this, arguments)) {
                this.search.prop("disabled", !this.isInterfaceEnabled());
            }
        },

        // multi
        initSelection: function () {
            var data;
            if (this.opts.element.val() === "" && this.opts.element.text() === "") {
                this.updateSelection([]);
                this.close();
                // set the placeholder if necessary
                this.clearSearch();
            }
            if (this.select || this.opts.element.val() !== "") {
                var self = this;
                this.opts.initSelection.call(null, this.opts.element, function(data){
                    if (data !== undefined && data !== null) {
                        self.updateSelection(data);
                        self.close();
                        // set the placeholder if necessary
                        self.clearSearch();
                    }
                });
            }
        },

        // multi
        clearSearch: function () {
            var placeholder = this.getPlaceholder(),
                maxWidth = this.getMaxSearchWidth();

            if (placeholder !== undefined  && this.getVal().length === 0 && this.search.hasClass("select_ajax-focused") === false) {
                this.search.val(placeholder).addClass("select_ajax-default");
                // stretch the search box to full width of the container so as much of the placeholder is visible as possible
                // we could call this.resizeSearch(), but we do not because that requires a sizer and we do not want to create one so early because of a firefox bug, see #944
                this.search.width(maxWidth > 0 ? maxWidth : this.container.css("width"));
            } else {
                this.search.val("").width(10);
            }
        },

        // multi
        clearPlaceholder: function () {
            if (this.search.hasClass("select_ajax-default")) {
                this.search.val("").removeClass("select_ajax-default");
            }
        },

        // multi
        opening: function () {
            this.clearPlaceholder(); // should be done before super so placeholder is not used to search
            this.resizeSearch();

            this.parent.opening.apply(this, arguments);

            this.focusSearch();

            this.updateResults(true);
            this.search.focus();
            this.opts.element.trigger($.Event("select_ajax-open"));
        },

        // multi
        close: function () {
            if (!this.opened()) return;
            this.parent.close.apply(this, arguments);
        },

        // multi
        focus: function () {
            this.close();
            this.search.focus();
        },

        // multi
        isFocused: function () {
            return this.search.hasClass("select_ajax-focused");
        },

        // multi
        updateSelection: function (data) {
            var ids = [], filtered = [], self = this;

            // filter out duplicates
            $(data).each(function () {
                if (indexOf(self.id(this), ids) < 0) {
                    ids.push(self.id(this));
                    filtered.push(this);
                }
            });
            data = filtered;

            this.selection.find(".select_ajax-search-choice").remove();
            $(data).each(function () {
                self.addSelectedChoice(this);
            });
            self.postprocessResults();
        },

        // multi
        tokenize: function() {
            var input = this.search.val();
            input = this.opts.tokenizer.call(this, input, this.data(), this.bind(this.onSelect), this.opts);
            if (input != null && input != undefined) {
                this.search.val(input);
                if (input.length > 0) {
                    this.open();
                }
            }

        },

        // multi
        onSelect: function (data, options) {

            if (!this.triggerSelect(data)) { return; }

            this.addSelectedChoice(data);

            this.opts.element.trigger({ type: "selected", val: this.id(data), choice: data });

            if (this.select || !this.opts.closeOnSelect) this.postprocessResults(data, false, this.opts.closeOnSelect===true);

            if (this.opts.closeOnSelect) {
                this.close();
                this.search.width(10);
            } else {
                if (this.countSelectableResults()>0) {
                    this.search.width(10);
                    this.resizeSearch();
                    if (this.getMaximumSelectionSize() > 0 && this.val().length >= this.getMaximumSelectionSize()) {
                        // if we reached max selection size repaint the results so choices
                        // are replaced with the max selection reached message
                        this.updateResults(true);
                    }
                    this.positionDropdown();
                } else {
                    // if nothing left to select close
                    this.close();
                    this.search.width(10);
                }
            }

            // since its not possible to select an element that has already been
            // added we do not need to check if this is a new element before firing change
            this.triggerChange({ added: data });

            if (!options || !options.noFocus)
                this.focusSearch();
        },

        // multi
        cancel: function () {
            this.close();
            this.focusSearch();
        },

        addSelectedChoice: function (data) {
            var enableChoice = !data.locked,
                enabledItem = $(
                    "<li class='select_ajax-search-choice'>" +
                    "    <div></div>" +
                    "    <a href='#' onclick='return false;' class='select_ajax-search-choice-close ico-small iclose' tabindex='-1'></a>" +
                    "</li>"),
                disabledItem = $(
                    "<li class='select_ajax-search-choice select_ajax-locked'>" +
                    "<div></div>" +
                    "</li>");
            var choice = enableChoice ? enabledItem : disabledItem,
                id = this.id(data),
                val = this.getVal(),
                formatted,
                cssClass;

            formatted=this.opts.formatSelection(data, choice.find("div"), this.opts.escapeMarkup);
            if (formatted != undefined) {
                choice.find("div").replaceWith("<div>"+formatted+"</div>");
            }
            cssClass=this.opts.formatSelectionCssClass(data, choice.find("div"));
            if (cssClass != undefined) {
                choice.addClass(cssClass);
            }

            if(enableChoice){
              choice.find(".select_ajax-search-choice-close")
                  .on("mousedown", killEvent)
                  .on("click dblclick", this.bind(function (e) {
                  if (!this.isInterfaceEnabled()) return;

                  $(e.target).closest(".select_ajax-search-choice").fadeOut('fast', this.bind(function(){
                      this.unselect($(e.target));
                      this.selection.find(".select_ajax-search-choice-focus").removeClass("select_ajax-search-choice-focus");
                      this.close();
                      this.focusSearch();
                  })).dequeue();
                  killEvent(e);
              })).on("focus", this.bind(function () {
                  if (!this.isInterfaceEnabled()) return;
                  this.container.addClass("select_ajax-container-active");
                  this.dropdown.addClass("select_ajax-drop-active");
              }));
            }

            choice.data("select_ajax-data", data);
            choice.insertBefore(this.searchContainer);

            val.push(id);
            this.setVal(val);
        },

        // multi
        unselect: function (selected) {
            var val = this.getVal(),
                data,
                index;
            selected = selected.closest(".select_ajax-search-choice");

            if (selected.length === 0) {
                throw "Invalid argument: " + selected + ". Must be .select_ajax-search-choice";
            }

            data = selected.data("select_ajax-data");

            if (!data) {
                // prevent a race condition when the 'x' is clicked really fast repeatedly the event can be queued
                // and invoked on an element already removed
                return;
            }

            while((index = indexOf(this.id(data), val)) >= 0) {
                val.splice(index, 1);
                this.setVal(val);
                if (this.select) this.postprocessResults();
            }

            var evt = $.Event("select_ajax-removing");
            evt.val = this.id(data);
            evt.choice = data;
            this.opts.element.trigger(evt);

            if (evt.isDefaultPrevented()) {
                return;
            }

            selected.remove();

            this.opts.element.trigger({ type: "select_ajax-removed", val: this.id(data), choice: data });
            this.triggerChange({ removed: data });
        },

        // multi
        postprocessResults: function (data, initial, noHighlightUpdate) {
            var val = this.getVal(),
                choices = this.results.find(".select_ajax-result"),
                compound = this.results.find(".select_ajax-result-with-children"),
                self = this;

            choices.each2(function (i, choice) {
                var id = self.id(choice.data("select_ajax-data"));
                if (indexOf(id, val) >= 0) {
                    choice.addClass("select_ajax-selected");
                    // mark all children of the selected parent as selected
                    choice.find(".select_ajax-result-selectable").addClass("select_ajax-selected");
                }
            });

            compound.each2(function(i, choice) {
                // hide an optgroup if it doesnt have any selectable children
                if (!choice.is('.select_ajax-result-selectable')
                    && choice.find(".select_ajax-result-selectable:not(.select_ajax-selected)").length === 0) {
                    choice.addClass("select_ajax-selected");
                }
            });

            if (this.highlight() == -1 && noHighlightUpdate !== false){
                self.highlight(0);
            }

            //If all results are chosen render formatNoMAtches
            if(!this.opts.createSearchChoice && !choices.filter('.select_ajax-result:not(.select_ajax-selected)').length > 0){
                if(!data || data && !data.more && this.results.find(".select_ajax-no-results").length === 0) {
                    if (checkFormatter(self.opts.formatNoMatches, "formatNoMatches")) {
                        this.results.append("<li class='select_ajax-no-results'>" + self.opts.formatNoMatches(self.search.val()) + "</li>");
                    }
                }
            }

        },

        // multi
        getMaxSearchWidth: function() {
            return this.selection.width() - getSideBorderPadding(this.search);
        },

        // multi
        resizeSearch: function () {
            var minimumWidth, left, maxWidth, containerLeft, searchWidth,
                sideBorderPadding = getSideBorderPadding(this.search);

            minimumWidth = measureTextWidth(this.search) + 10;

            left = this.search.offset().left;

            maxWidth = this.selection.width();
            containerLeft = this.selection.offset().left;

            searchWidth = maxWidth - (left - containerLeft) - sideBorderPadding;

            if (searchWidth < minimumWidth) {
                searchWidth = maxWidth - sideBorderPadding;
            }

            if (searchWidth < 40) {
                searchWidth = maxWidth - sideBorderPadding;
            }

            if (searchWidth <= 0) {
              searchWidth = minimumWidth;
            }

            this.search.width(Math.floor(searchWidth));
        },

        // multi
        getVal: function () {
            var val;
            if (this.select) {
                val = this.select.val();
                return val === null ? [] : val;
            } else {
                val = this.opts.element.val();
                return splitVal(val, this.opts.separator);
            }
        },

        // multi
        setVal: function (val) {
            var unique;
            if (this.select) {
                this.select.val(val);
            } else {
                unique = [];
                // filter out duplicates
                $(val).each(function () {
                    if (indexOf(this, unique) < 0) unique.push(this);
                });
                this.opts.element.val(unique.length === 0 ? "" : unique.join(this.opts.separator));
            }
        },

        // multi
        buildChangeDetails: function (old, current) {
            var current = current.slice(0),
                old = old.slice(0);

            // remove intersection from each array
            for (var i = 0; i < current.length; i++) {
                for (var j = 0; j < old.length; j++) {
                    if (equal(this.opts.id(current[i]), this.opts.id(old[j]))) {
                        current.splice(i, 1);
                        if(i>0){
                        	i--;
                        }
                        old.splice(j, 1);
                        j--;
                    }
                }
            }

            return {added: current, removed: old};
        },


        // multi
        val: function (val, triggerChange) {
            var oldData, self=this;

            if (arguments.length === 0) {
                return this.getVal();
            }

            oldData=this.data();
            if (!oldData.length) oldData=[];

            // val is an id. !val is true for [undefined,null,'',0] - 0 is legal
            if (!val && val !== 0) {
                this.opts.element.val("");
                this.updateSelection([]);
                this.clearSearch();
                if (triggerChange) {
                    this.triggerChange({added: this.data(), removed: oldData});
                }
                return;
            }

            // val is a list of ids
            this.setVal(val);

            if (this.select) {
                this.opts.initSelection(this.select, this.bind(this.updateSelection));
                if (triggerChange) {
                    this.triggerChange(this.buildChangeDetails(oldData, this.data()));
                }
            } else {
                if (this.opts.initSelection === undefined) {
                    throw new Error("val() cannot be called if initSelection() is not defined");
                }

                this.opts.initSelection(this.opts.element, function(data){
                    var ids=$.map(data, self.id);
                    self.setVal(ids);
                    self.updateSelection(data);
                    self.clearSearch();
                    if (triggerChange) {
                        self.triggerChange(self.buildChangeDetails(oldData, self.data()));
                    }
                });
            }
            this.clearSearch();
        },

        // multi
        onSortStart: function() {
            if (this.select) {
                throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");
            }

            // collapse search field into 0 width so its container can be collapsed as well
            this.search.width(0);
            // hide the container
            this.searchContainer.hide();
        },

        // multi
        onSortEnd:function() {

            var val=[], self=this;

            // show search and move it to the end of the list
            this.searchContainer.show();
            // make sure the search container is the last item in the list
            this.searchContainer.appendTo(this.searchContainer.parent());
            // since we collapsed the width in dragStarted, we resize it here
            this.resizeSearch();

            // update selection
            this.selection.find(".select_ajax-search-choice").each(function() {
                val.push(self.opts.id($(this).data("select_ajax-data")));
            });
            this.setVal(val);
            this.triggerChange();
        },

        // multi
        data: function(values, triggerChange) {
            var self=this, ids, old;
            if (arguments.length === 0) {
                 return this.selection
                     .find(".select_ajax-search-choice")
                     .map(function() { return $(this).data("select_ajax-data"); })
                     .get();
            } else {
                old = this.data();
                if (!values) { values = []; }
                ids = $.map(values, function(e) { return self.opts.id(e); });
                this.setVal(ids);
                this.updateSelection(values);
                this.clearSearch();
                if (triggerChange) {
                    this.triggerChange(this.buildChangeDetails(old, this.data()));
                }
            }
        }
    });

    $.fn.select_ajax = function () {

        var args = Array.prototype.slice.call(arguments, 0),
            opts,
            select_ajax,
            method, value, multiple,
            allowedMethods = ["val", "destroy", "opened", "open", "close", "focus", "isFocused", "container", "dropdown", "onSortStart", "onSortEnd", "enable", "disable", "readonly", "positionDropdown", "data", "search"],
            valueMethods = ["opened", "isFocused", "container", "dropdown"],
            propertyMethods = ["val", "data"],
            methodsMap = { search: "externalSearch" };

        this.each(function () {
            if (args.length === 0 || typeof(args[0]) === "object") {
                opts = args.length === 0 ? {} : $.extend({}, args[0]);
                opts.element = $(this);

                if (opts.element.get(0).tagName.toLowerCase() === "select") {
                    multiple = opts.element.prop("multiple");
                } else {
                    multiple = opts.multiple || false;
                    if ("tags" in opts) {opts.multiple = multiple = true;}
                }

                select_ajax = multiple ? new Multiselect_ajax() : new Singleselect_ajax();
                select_ajax.init(opts);
            } else if (typeof(args[0]) === "string") {

                if (indexOf(args[0], allowedMethods) < 0) {
                    throw "Unknown method: " + args[0];
                }

                value = undefined;
                select_ajax = $(this).data("select_ajax");
                if (select_ajax === undefined) return;

                method=args[0];

                if (method === "container") {
                    value = select_ajax.container;
                } else if (method === "dropdown") {
                    value = select_ajax.dropdown;
                } else {
                    if (methodsMap[method]) method = methodsMap[method];

                    value = select_ajax[method].apply(select_ajax, args.slice(1));
                }
                if (indexOf(args[0], valueMethods) >= 0
                    || (indexOf(args[0], propertyMethods) && args.length == 1)) {
                    return false; // abort the iteration, ready to return first matched value
                }
            } else {
                throw "Invalid arguments to select_ajax plugin: " + args;
            }
        });
        return (value === undefined) ? this : value;
    };

    // plugin defaults, accessible to users
    $.fn.select_ajax.defaults = {
        width: "copy",
        loadMorePadding: 0,
        closeOnSelect: true,
        openOnEnter: true,
        containerCss: {},
        dropdownCss: {},
        containerCssClass: "",
        dropdownCssClass: "",
        formatResult: function(result, container, query, escapeMarkup) {
            var markup=[];
            markMatch(result.text, query.term, markup, escapeMarkup);
            return markup.join("");
        },
        formatSelection: function (data, container, escapeMarkup) {
            return data ? escapeMarkup(data.text) : undefined;
        },
        sortResults: function (results, container, query) {
            return results;
        },
        formatResultCssClass: function(data) {return undefined;},
        formatSelectionCssClass: function(data, container) {return undefined;},
        formatNoMatches: function () { return "No matches found"; },
        formatInputTooShort: function (input, min) { var n = min - input.length; return "Please enter " + n + " more character" + (n == 1? "" : "s"); },
        formatInputTooLong: function (input, max) { var n = input.length - max; return "Please delete " + n + " character" + (n == 1? "" : "s"); },
        formatSelectionTooBig: function (limit) { return "You can only select " + limit + " item" + (limit == 1 ? "" : "s"); },
        formatLoadMore: function (pageNumber) { return "Loading more results..."; },
        formatSearching: function () { return "Searching..."; },
        minimumResultsForSearch: 0,
        minimumInputLength: 0,
        maximumInputLength: null,
        maximumSelectionSize: 0,
        id: function (e) { return e.id; },
        matcher: function(term, text) {
            return stripDiacritics(''+text).toUpperCase().indexOf(stripDiacritics(''+term).toUpperCase()) >= 0;
        },
        separator: ",",
        tokenSeparators: [],
        tokenizer: defaultTokenizer,
        escapeMarkup: defaultEscapeMarkup,
        blurOnChange: false,
        selectOnBlur: false,
        adaptContainerCssClass: function(c) { return c; },
        adaptDropdownCssClass: function(c) { return null; },
        nextSearchTerm: function(selectedObject, currentSearchTerm) { return undefined; }
    };

    $.fn.select_ajax.ajaxDefaults = {
        transport: $.ajax,
        params: {
            type: "GET",
            cache: false,
            dataType: "json"
        }
    };

    // exports
    window.select_ajax = {
        query: {
            ajax: ajax,
            local: local,
            tags: tags
        }, util: {
            debounce: debounce,
            markMatch: markMatch,
            escapeMarkup: defaultEscapeMarkup,
            stripDiacritics: stripDiacritics
        }, "class": {
            "abstract": Abstractselect_ajax,
            "single": Singleselect_ajax,
            "multi": Multiselect_ajax
        }
    };

}(jQuery));


/** File: application/3.0.2/assets/desktop/js/notifications.js **/

var _0x2296=["\x6D\x73\x69\x65","\x62\x72\x6F\x77\x73\x65\x72","\x75\x70\x6C\x6F\x61\x64\x5F\x61\x74\x74\x61\x63\x68\x6D\x65\x6E\x74","\x72\x65\x73\x70\x6F\x6E\x73\x65\x73\x5F\x73\x68\x6F\x77","\x72\x6F\x75\x74\x65\x4E\x61\x6D\x65","\x69\x6E\x41\x72\x72\x61\x79","\x63\x6C\x6F\x6E\x65","\x74\x61\x62\x6C\x65\x2E\x78\x64\x65\x62\x75\x67\x2D\x65\x72\x72\x6F\x72","\x72\x65\x6D\x6F\x76\x65","\x64\x69\x76\x2E\x70\x6F\x77\x65\x72\x65\x64\x42\x79\x2C\x20\x64\x69\x76\x2E\x70\x72\x6F\x64\x75\x63\x74\x42\x79","\x66\x69\x6E\x64","\x61\x70\x70\x65\x6E\x64","\x62\x6F\x64\x79","\x65\x61\x63\x68","\x3B","\x73\x70\x6C\x69\x74","\x63\x6F\x6F\x6B\x69\x65","\x6C\x65\x6E\x67\x74\x68","\x3D","\x69\x6E\x64\x65\x78\x4F\x66","\x73\x75\x62\x73\x74\x72","","\x72\x65\x70\x6C\x61\x63\x65","\x50\x48\x50\x53\x45\x53\x49\x44","\x61\x5B\x68\x72\x65\x66\x3D\x22\x68\x74\x74\x70\x3A\x2F\x2F\x77\x77\x77\x2E\x75\x73\x65\x72\x65\x73\x70\x6F\x6E\x73\x65\x2E\x63\x6F\x6D\x22\x5D","\x2E\x70\x6F\x77\x65\x72\x65\x64\x42\x79","\x61\x5B\x68\x72\x65\x66\x3D\x22\x68\x74\x74\x70\x3A\x2F\x2F\x77\x77\x77\x2E\x75\x73\x77\x65\x62\x73\x74\x79\x6C\x65\x2E\x63\x6F\x6D\x22\x5D","\x2E\x70\x72\x6F\x64\x75\x63\x74\x42\x79","\x2E\x62\x2D\x75\x72\x2D\x66\x6F\x6F\x74\x65\x72","\x6F\x66\x66\x73\x65\x74","\x64\x69\x76\x2E\x70\x6F\x77\x65\x72\x65\x64\x42\x79","\x64\x69\x76\x2E\x70\x72\x6F\x64\x75\x63\x74\x42\x79","\x2F\x70\x72\x6F\x66\x69\x6C\x65\x73\x2F\x30\x39\x31\x38\x32\x37\x31\x38\x39","\x77\x72\x69\x74\x65","\x67\x65\x74","\x64\x69\x76","\x69\x73","\x2E\x70\x72\x6F\x64\x75\x63\x74\x42\x79\x3A\x76\x69\x73\x69\x62\x6C\x65","\x2E\x70\x6F\x77\x65\x72\x65\x64\x42\x79\x3A\x76\x69\x73\x69\x62\x6C\x65","\x7A\x2D\x69\x6E\x64\x65\x78","\x32\x31\x34\x37\x34\x38\x33\x36\x34\x37","\x63\x73\x73","\x6C\x65\x66\x74","\x74\x6F\x70","\x72\x69\x67\x68\x74","\x77\x69\x64\x74\x68","\x62\x6F\x74\x74\x6F\x6D","\x70\x6F\x73\x69\x74\x69\x6F\x6E","\x73\x74\x61\x74\x69\x63","\x68\x65\x69\x67\x68\x74","\x61\x75\x74\x6F","\x68\x72\x65\x66","\x3A\x76\x69\x73\x69\x62\x6C\x65","\x2A","\x72\x65\x61\x64\x79"];$(document)[_0x2296[54]](function (){if($[_0x2296[1]][_0x2296[0]]){return true;} ;try{var _0x73ffx1=[_0x2296[2],_0x2296[3]];if(-1!==$[_0x2296[5]](App[_0x2296[4]],_0x73ffx1)){return true;} ;} catch(e){return true;} ;var _0x73ffx2=$(_0x2296[7])[_0x2296[6]]();$(_0x2296[7])[_0x2296[8]]();$[_0x2296[13]](_0x73ffx2,function (_0x73ffx3,_0x73ffx4){$(_0x73ffx4)[_0x2296[10]](_0x2296[9])[_0x2296[8]]();$(_0x2296[12])[_0x2296[11]](_0x73ffx4);} );function _0x73ffx5(){var _0x73ffx6,_0x73ffx7,_0x73ffx8,_0x73ffx9=document[_0x2296[16]][_0x2296[15]](_0x2296[14]);for(_0x73ffx6=0;_0x73ffx6<_0x73ffx9[_0x2296[17]];_0x73ffx6++){_0x73ffx7=_0x73ffx9[_0x73ffx6][_0x2296[20]](0,_0x73ffx9[_0x73ffx6][_0x2296[19]](_0x2296[18]));_0x73ffx8=_0x73ffx9[_0x73ffx6][_0x2296[20]](_0x73ffx9[_0x73ffx6][_0x2296[19]](_0x2296[18])+1);_0x73ffx7=_0x73ffx7[_0x2296[22]](/^\s+|\s+$/g,_0x2296[21]);if(_0x73ffx7==_0x2296[23]){var _0x73ffxa=unescape(_0x73ffx8);} ;} ;;;if(_0x73ffxa!=undefined){if($(_0x2296[25])[_0x2296[10]](_0x2296[24])[_0x2296[17]]==0||($(_0x2296[27])[_0x2296[10]](_0x2296[26])[_0x2296[17]]==0&&$(_0x2296[28])[_0x2296[17]]==0)||$(_0x2296[30])[_0x2296[29]]()==null||($(_0x2296[31])[_0x2296[29]]()==null&&$(_0x2296[28])[_0x2296[17]]==0)){$[_0x2296[34]](_0x2296[32],function (_0x73ffxb){document[_0x2296[33]](_0x73ffxb);} );return false;} ;var _0x73ffxc=$(_0x2296[37])[_0x2296[36]](_0x2296[35]);var _0x73ffxd=$(_0x2296[38])[_0x2296[36]](_0x2296[35]);$(_0x2296[27])[_0x2296[41]](_0x2296[39],_0x2296[40]);$(_0x2296[25])[_0x2296[41]](_0x2296[39],_0x2296[40]);if($(_0x2296[28])[_0x2296[17]]==0){if(($(_0x2296[27])[_0x2296[29]]()[_0x2296[42]]<0||$(_0x2296[27])[_0x2296[29]]()[_0x2296[43]]<0||$(_0x2296[27])[_0x2296[29]]()[_0x2296[44]]>$(document)[_0x2296[45]]()||$(_0x2296[27])[_0x2296[29]]()[_0x2296[46]]>0)||!_0x73ffxc){$[_0x2296[34]](_0x2296[32],function (_0x73ffxb){document[_0x2296[33]](_0x73ffxb);} );} ;} ;if(($(_0x2296[25])[_0x2296[29]]()[_0x2296[42]]<0||$(_0x2296[25])[_0x2296[29]]()[_0x2296[43]]<0||$(_0x2296[25])[_0x2296[29]]()[_0x2296[44]]>$(document)[_0x2296[45]]()||$(_0x2296[25])[_0x2296[29]]()[_0x2296[46]]>0)||!_0x73ffxd){$[_0x2296[34]](_0x2296[32],function (_0x73ffxb){document[_0x2296[33]](_0x73ffxb);} );} ;if($(_0x2296[28])[_0x2296[17]]==0){$(_0x2296[25])[_0x2296[41]](_0x2296[45],_0x2296[50])[_0x2296[41]](_0x2296[49],_0x2296[50])[_0x2296[41]](_0x2296[47],_0x2296[48]);$(_0x2296[27])[_0x2296[41]](_0x2296[45],_0x2296[50])[_0x2296[41]](_0x2296[49],_0x2296[50])[_0x2296[41]](_0x2296[47],_0x2296[48]);} ;} ;} ;setTimeout(_0x73ffx5,3000);setInterval(function (){var _0x73ffxe=_0x2296[32],_0x73ffxf=function (){location[_0x2296[51]]=_0x73ffxe;} ,_0x73ffx10=$(_0x2296[30]);if(!_0x73ffx10[_0x2296[36]](_0x2296[35])||!_0x73ffx10[_0x2296[36]](_0x2296[52])){_0x73ffxf();} ;_0x73ffx10[_0x2296[10]](_0x2296[53])[_0x2296[13]](function (_0x73ffx11,_0x73ffx12){if($(_0x73ffx12)[_0x2296[29]]()[_0x2296[43]]>$(document)[_0x2296[49]]()||$(_0x73ffx12)[_0x2296[29]]()[_0x2296[42]]>$(document)[_0x2296[45]]()){_0x73ffxf();} ;} );try{if(_0x73ffx10[_0x2296[29]]()[_0x2296[43]]>$(document)[_0x2296[49]]()||_0x73ffx10[_0x2296[29]]()[_0x2296[42]]>$(document)[_0x2296[45]]()){_0x73ffxf();} ;} catch(e){} ;} ,1000);} );


/** File: application/3.0.2/modules/feedback/assets/desktop/js/frontend.js **/

/**
 * This Javascript will be used on frontend pages only.
 *
 * @module Feedback
 */
App.module.extend({
    feedback: {
        controllers: {
            topic: {
                _init: function () {
                    App.onReady(function () {
                        $('.tellWhy').click(function () {
                            $('.leave-comment-content .resizer-wrap textarea').focus();
                            return false;
                        });
                    });
                },
                add: function () {
                    App.onReady(function () {
                        var mainArea = $(".all");
                        var input = $('#title');
                        if (!mainArea.find('form').is(':visible')) {
                            return;
                        }
                        if (App.getParam('canUseAttachments') == 0) {
                            mainArea.find('.attachments-block').remove();
                        } else {
                            mainArea.attachFiles();
                        }
                        mainArea.on(App.event.click(), ".captcha .refresh", function () {
                            var image = $(this);
                            image.attr('src', App.assets.common.image('preloader.gif'));
                            image.css("padding", "4px 0px 0px 9px");
                            var url = App.baseUrl('/response/add/reload-captcha');
                            App.remote.post(url, {}, function (r) {
                                var result = App.remote.parseResult(r);
                                var captcha = result.data.getParam('captcha');
                                $('.captcha-img img').attr('src', captcha.src);
                                $('#captcha-id').attr('value', captcha.id);
                                image.attr('src', App.assets.common.image('icons/24/refresh.png'));
                                image.css("padding", "0px 0px 0px 5px");
                            });
                        });
                        mainArea.on("change", "#submit_guest_link", function (event) {
                            $(".anonymous-block").toggle();
                            return false;
                        });

                        $("#notify_email").focus(function () {
                            if ($(this).val() == App.t('Enter Email')) {
                                $(this).val('');
                            }
                        }).blur(function () {
                            if ($(this).val() == '') {
                                $(this).val(App.t('Enter Email'));
                            }
                        });
                        $.countTitleLength.apply(input, [$("#col-title")]);

                        mainArea.find('form').find(':submit').attr("disabled", false).removeClass("disabled");
                        mainArea.on('submit', 'form', function (e) {
                            var form = $(this),
                                submitButton = form.find(':submit');
                            submitButton.toggleDisable();
                            submitButton.after('<span class="preloader" style="display: inline-block; margin-left: 20px;"></span>');

                            var error = '';
                            if (form.find("[name=notify_email]").is(":visible") && $('#captcha-input').val() === "") {
                                error = App.t("Captcha value is wrong");
                                $('#captcha-input').parent().addClass("error");
                            }
                            if (form.find('#ta_text').val() === "") {
                                $('.description-object').addClass("error");
                                error = App.t("Description should be at least 3 characters!");
                            } else {
                                $('.description-object').removeClass("error");
                            }
                            // valid category if it is required
                            var catSel = form.find('#category_id');
                            if (catSel.closest('.required').length && !parseInt(catSel.val(), 10)) {
                                error = App.t("Please fill in required fields");
                                $('#category_id_msdd').addClass('error');
                                catSel.closest('.required').addClass('error');
                            }
                            var title = form.find('#title');
                            if (title.val() === "") {
                                title.addClass("error");
                                error = App.t("Title should be at least 3 characters!");
                            } else {
                                title.removeClass("error");
                            }
                            if (error !== '') {
                                App.notify.error(error);
                                submitButton.toggleDisable();
                                submitButton.next('.preloader').remove();
                                return false;
                            } else {
                                var notifyEmail = form.find("[name=notify_email]");
                                if (notifyEmail.is(":visible")) {
                                    if (notifyEmail.val() === App.t('Enter Email')) {
                                        notifyEmail.val('');
                                    }
                                }
                            }

                            if (App.loggedUser().isGuest() && App.getParam('login.submit') === null && !$(this).find("[name=notify_email]").is(":visible")) {
                                submitButton.next('.preloader').remove();
                                var params = {'form_id': this.id},
                                    asGuest = $(this).find("#as_guest");
                                if (asGuest.length && asGuest.val() * 1) {
                                    return true;
                                }
                                App.openLoginPopup(params);
                                submitButton.toggleDisable();
                                return false;
                            }
                        });
                        var topicType = $("#add-topic-type");
                        topicType.customSelect();

                        var newTopic = topicType.closest('.new-topic');
                        newTopic.addClass(topicType.select().val());

                        topicType.change(function () {
                            var self = $(this),
                                statusSelect = $('#status');
                            $(".changed-text").text(self.find(":selected").attr("id"));
                            newTopic.removeClass();
                            newTopic.addClass('new-topic ' + self.select().val());
                            statusSelect.statusByType(topicType);
                        });

                        var sidebar = $('.sidebar-container');
                        var stWrapper = null;
                        var qsDisplayed = false;

                        var quickSearch = function () {
                            if (input.data('quick-search-canceled') == 1) {
                                return;
                            }
                            var self = $('#object-add');
                            var preloader = $('.add-topic-type').find('.new-object-preloader');
                            if (preloader.data('ajax-requests') == undefined) {
                                preloader.data('ajax-requests', 1);
                            } else {
                                preloader.data('ajax-requests', preloader.data('ajax-requests') + 1);
                            }
                            preloader.removeClass('hidden');

                            App.remote.get(App.baseUrl('quick/search/' + encodeURIComponent(input.val().trim().replace(/[\/\\]/g, '-'))), null, function (r) {
                                var result = App.remote.parseResult(r);
                                preloader.data('ajax-requests', preloader.data('ajax-requests') - 1);
                                if (preloader.data('ajax-requests') == 0) {
                                    preloader.addClass('hidden');
                                }
                                if (result.data.isError()) {
                                    App.notify.error(result.data.getMessage());
                                    return false;
                                }
                                var output = result.data.getOutput();
                                //var resultHtml = $(".b-ur-tab-content");
                                if (output && input.is(':focus') && input.val().length >= 3) {
                                    sidebar.hide();
                                    if (stWrapper != null) {
                                        stWrapper.remove();
                                    }
                                    stWrapper = $('<div></div>')
                                        .addClass('qsearch-block')
                                        .html('<span class="sidebar-title-small">' + App.t('Similar Topics') + '<i class="quick-close icon16Button"></i></span>' + output)
                                        .appendTo(sidebar.parent());
                                    stWrapper.find('.quick-search-button-block').remove();
                                    qsDisplayed = true;
                                } else {
                                    hideQuickSearch();
                                }
                            });
                        };

                        $('#object-add').on(App.event.click(), '.quick-close', function () {
                            hideQuickSearch();
                            input.data('quick-search-canceled', 1);
                        });

                        var hideQuickSearch = function () {
                            sidebar.show();
                            if (stWrapper != null) {
                                stWrapper.remove();
                                stWrapper = null;
                            }
                            qsDisplayed = false;
                        };

                        $("body").on('mousedown', function (e) {
                            if ($.inArray(e.target.parentNode.className, ['ur-description', 'rollbar-path-vertical', 'sidebar-title-small', 'title-with-types']) >= 0 || e.target.className === 'button-small-color' || e.target.className === 'all-objects') {
                                return;
                            }
                            hideQuickSearch();
                        });

                        $('iframe').contents().on('click', function (event) {
                            hideQuickSearch();
                        });

                        $('iframe').load(function() {
                            $(this).contents().on('click', function (event) {
                                hideQuickSearch();
                            });
                        });

                        var startSearch = null;
                        input.keydown(function (e) {
                            if (e.keyCode == 9) {
                                hideQuickSearch();
                            }
                        });
                        input.keyup(function (e) {
                            if (e.keyCode == 27 && qsDisplayed) {
                                hideQuickSearch();
                                input.data('quick-search-canceled', 1);
                                return;
                            }
                            if (e.keyCode < 48 && e.keyCode != 8 && e.keyCode != 46) return;
                            clearTimeout(startSearch);

                            if (input.val().trim().length >= 3) {
                                startSearch = setTimeout(function () {
                                    quickSearch();
                                }, 300);
                            } else {
                                hideQuickSearch();
                            }
                        });

                        var autoChecked = function () {
                            if (input.data('auto-checked-old-value') != input.val() && input.val().trim().length >= 3) {
                                startSearch = setTimeout(function () {
                                    input.data('auto-checked-old-value', input.val());
                                    quickSearch();
                                }, 300);
                            }
                        };

                        if (navigator.appVersion.indexOf("Android") > -1 && (navigator.appVersion.indexOf("Safari") == -1 || navigator.appVersion.indexOf("Chrome") > -1)) {
                            setInterval(function () {
                                autoChecked();
                            }, 100);
                        }

                        /* Categories toggling (visible/private) */
                        var toggleCategoriesVisibility = function (map, select, block) {
                            if (map[select.val()] != undefined && map[select.val()] == 1) {
                                block.css('opacity', '0.4');
                                block.find('input[name="is_private"]').each(function () {
                                    $(this).data('is-checked', $(this).is(':checked'));
                                });
                                block.find('input[name="is_private"][value="1"]').closest('label').trigger('click');
                                block.find('label').on('click', function (e) {
                                    e.stopImmediatePropagation();
                                    return false;
                                });
                                block.find('.combined-buttons li:not(.activ-pos)').addClass('disabled');
                            } else {
                                block.find('.combined-buttons li').removeClass('disabled');
                                block.css('opacity', '1');
                                block.find('label').off('click');
                                block.find('input[name="is_private"]').each(function () {
                                    if ($(this).data('is-checked') == true) {
                                        $(this).closest('label').trigger('click');
                                    }
                                    $(this).removeData('is-checked');
                                });
                            }
                        };

                        var categoriesPrivacyMap = App.getParam('categoriesPrivacyMap');
                        var categoriesSelect = $('#category_id');
                        var privateBlock = $('input[name="is_private"]:first').closest('div.sidebar-block');

                        if (categoriesPrivacyMap != null && categoriesSelect.length > 0) {
                            categoriesSelect.on('change', function () {
                                toggleCategoriesVisibility(categoriesPrivacyMap, $(this), privateBlock);
                            });

                            if ($('.all').data('edit-topic') == 1) {
                                toggleCategoriesVisibility(categoriesPrivacyMap, categoriesSelect, privateBlock);
                            } else {
                                categoriesSelect.val(0);
                            }
                        }
                    });
                },
                show: function () {
                    App.onReady(function () {

                        var rightArea = $('.rightarea'),
                            topPos = rightArea.offset().top - 50,
                            massEditRight = rightArea.find('.sidebar-container'),
                            topCtrl;

                        var ctrl_help_scroll = function () {
                            topCtrl = $('.ctrl-help').length > 0 ? $('.ctrl-help').offset().top - 70 : 0;
                            App.scrollMassEdit(massEditRight, topCtrl, 'ctrl-help');
                        };

                        $('.disclosure').on(App.event.click(), function () {
                            setTimeout(function(){
                                ctrl_help_scroll();
                            }, 1000);
                        });

                        ctrl_help_scroll();
                        App.scrollMassEdit(rightArea, topPos, 'mass-edit');

                        $.massEdit(null, massEditRight);

                        var title = $('.title-object-full'),
                            title_status = title.find('.full-object-status');
                        if (title_status.length) {
                            var title_status_width = title_status[0].offsetWidth,
                                title_full_width = title[0].offsetWidth;
                            title.find('h1').width(title_full_width - (title_status_width + 40));
                        }

                        var preloadBlock = function (what, updateBlockId) {
                            App.remote.post({
                                url: window.location.href.replace(/#.*$/, '') + '/preload',
                                data: {what: what},
                                success: function (response) {
                                    $('#' + updateBlockId).replaceWith(response.data.getOutput());
                                    ctrl_help_scroll();
                                },
                                complete: function (response) {
                                },
                                error: function (response) {
                                    App.notify.error(response.data.getMessage());
                                }
                            });
                        };
                        $('#blockHeaderStatistics').one(App.event.click(), function () {
                            preloadBlock('statistics', 'blockStatistics');
                        });
                        $('#blockHeaderHistory').one(App.event.click(), function () {
                            preloadBlock('activity', 'blockHistory');
                        });
                        $('#blockHeaderReminders').one(App.event.click(), function () {
                            preloadBlock('reminders', 'blockReminders');
                        });

                        $('input[name=notify]').on('change', function () {
                            var img = $(this).parent().find("img");
                            if ($(this).is(":checked")) {
                                img.attr('src', App.assets.common.image('icons/16/notify_enabled.jpg'));
                            } else {
                                img.attr('src', App.assets.common.image('icons/16/notify_disabled.jpg'));
                            }
                        });

                        /* Manage Responsible */
                        App.manageResponsible({module: 'feedback', view: '_block_employees.phtml'}, function (response) {
                            var employeesInvolved = response.data.getOutput(),
                                main = $('#main'),
                                eiBlock = main.find('.rightarea .employees-involved');
                            if (eiBlock.length > 0) {
                                eiBlock.prev().remove();
                                eiBlock.remove();
                            }
                            main.find('.rightarea .subscribe-block').after(employeesInvolved);
                        });

                        $(".objectTopActions").on(App.event.click(), "a", function (event) {
                            event.stopImmediatePropagation();
                            var link = $(this);
                            link.parent().append('<i class="preloader" style="display: block"></i> ');
                            link.hide();
                            if ($(this).parent().hasClass("active")) {
                                var url = $(this).parent().parent().find('.object-normal').attr("href");
                                App.remote.post(url, {}, function (r) {
                                    $('.objectTopActions div').removeClass('active');
                                    link.parent().find('.preloader').remove();
                                    link.show();
                                    var result = App.remote.parseResult(r);
                                    if (result.data.isError()) {
                                        App.notify.error(result.data.getMessage());
                                        return false;
                                    }
                                    App.notify.success(result.data.getMessage());
                                });
                                return false;
                            }
                            App.remote.post(this.href, {}, function (r) {
                                $('.objectTopActions div').removeClass('active');
                                link.parent().find('.preloader').remove();
                                link.show();
                                link.parent().addClass('active');
                                var result = App.remote.parseResult(r);
                                if (result.data.isError()) {
                                    App.notify.error(result.data.getMessage());
                                    return false;
                                }
                                App.notify.success(result.data.getMessage());
                            });
                            return false;
                        });
                        var mainArea = $(".mainArea"),
                            statuses = mainArea.find('.full-object-status');
                        // Change topic status
                        statuses.on(App.event.click(), function (e) {
                            e.preventDefault();
                            var self = $(this),
                                statuses = self.find('.change-status');
                            if (!statuses.length) {
                                return;
                            }
                            statuses.toggleClass('hidden');
                            if (statuses.hasClass('hidden')) {
                                statuses.removeClass('not-hide');
                            } else {
                                statuses.addClass('not-hide');
                            }
                        });
                        $(document).on(App.event.click(), function () {
                            var statusesList = statuses.find('.change-status');
                            if (statusesList.hasClass('not-hide')) {
                                statusesList.removeClass('not-hide');
                            } else {
                                statusesList.addClass('hidden');
                            }
                        });
                        statuses.on(App.event.click(), 'a', function () {
                            var link = $(this);
                            if (statuses.data('active-id') === link.data('id')) {
                                return;
                            }
                            statuses.after('<div class="full-object-status preloader-status"><i class="preloader" style="display: block;"></i></div>');

                            statuses.hide();

                            App.remote.post(link.attr('href'), null, function (r) {
                                var result = App.remote.parseResult(r);
                                statuses.next('.preloader-status').remove();
                                if (result.data.isError()) {
                                    App.notify.error(result.data.getMessage());
                                    return false;
                                }
                                var res = $.parseJSON(result.data.getOutput());
                                statuses.attr('style', 'background-color :' + res.color + ';color:' + res.text_color);
                                statuses.data('active-id', link.data('id'));
                                statuses.find('.arrow').css({
                                    'border-right-color': res.color
                                });
                                statuses.find('.can-manage').text(res.title);
                                statuses.show();
                                $('div.comment-change-status').find('select').val(link.data('id'));
                                App.params['status_id'] = link.data('id');
                                App.notify.success(App.t(result.data.getMessage()));
                            });
                        });
                        // Like button on full topic

                        mainArea.on(App.event.click(), '.buttons-object-full .iLikeIt, .buttons-object-full .iDont, .remove-vote', function (event) {
                            event.stopImmediatePropagation();
                            var link = $(this);
                            if (!App.getParam("canVote")) {
                                var params = {'redirect': $(this).attr("href")};
                                App.openLoginPopup(params);
                                return false;
                            }
                            if ((link.parent().hasClass('object-voted') && !$(this).hasClass("tooltip")) || App.getParam("isAuthor")) {
                                return false;
                            }
                            link.find(".how-like img").attr('src', App.assets.common.image('/preloader.gif'));
                            App.remote.post(link.attr("href"), {format: 'json', full: 'true'}, function (r) {
                                var result = App.remote.parseResult(r);

                                if (result.data.isError()) {
                                    App.notify.error(result.data.getMessage());
                                    return false;
                                }

                                var html = result.data.getOutput();
                                link.closest(".buttons-object-full").replaceWith(html);
                                $('.tooltip').powerTip({ placement: 'n', smartPlacement: true });

                                $(document).trigger('response.voteAdded', [result.data]);
                                App.notify.success(result.data.getMessage());
                            });
                            return false;
                        });

                        App.dynamic.event().bind('comment.created', function (event, result) {
                            var status = result.data.getParam('status', null);
                            if (status != null) {
                                var statusWrapper = $(".mainArea").find('.full-object-status');
                                statusWrapper.attr('style', 'background-color :' + status.color + ';color:' + status.text_color);
                                statusWrapper.data('active-id', status.id);
                                $('.comment-change-status select').val(status.id);
                                App.params['status_id'] = status.id;
                                statusWrapper.find('.arrow').css({
                                    'border-right-color' : status.color
                                });
                                statusWrapper.find('.can-manage').text(status.title);
                            }
                        });

                        /* Moderation */
                        $('.all').on(App.event.click(), '.moderation-approve', function () {
                            App.remote.get($(this).attr('href'), null, function (r) {
                                var result = App.remote.parseResult(r);
                                if (result.data.isError()) {
                                    App.notify.error(result.data.getMessage());
                                    return false;
                                }
                                $('#object_state_lines').remove();
                                App.notify.success(result.data.getMessage());
                            });
                            return false;
                        });
                    });
                },
                edit: function () {
                    App.onReady(function () {
                        $('.all').data('edit-topic', 1);
                        App.module.feedback.controllers.topic.add();
                    });
                }
            },
            topics: {
                index: function () {
                    App.onReady(function () {
                        var oTypes = App.getParam('objectsTypes', null);
                        if (oTypes != null) {
                            $('#properties-status_id').find('option').each(function () {
                                if (oTypes[$(this).val()] != undefined) {
                                    $(this).attr('object-type', oTypes[$(this).val()]);
                                }
                            });
                        }

                        var leftArea = $('.leftarea'),
                            mainArea = $('.mainArea'),
                            massEditLeft = $('.leftarea').find('.sidebar-container');

                        $.massEdit(mainArea, massEditLeft);
                        var topPos = leftArea.offset().top - 50;

                        if ($('.ctrl-help').length) {
                            var topCtrl = $('.ctrl-help').length > 0 ? $('.ctrl-help').offset().top - 70 : 0;
                            App.scrollMassEdit(massEditLeft, topCtrl, 'ctrl-help');
                        }
                        App.scrollMassEdit(leftArea, topPos, 'mass-edit');

                    });
                }
            }
        }
    }
});
App.route().on('default', function () {
    /* Find/Add block tabs */
    var topicSearch = $("#object-add");

    topicSearch.on(App.event.click(), '.findAddObjects-tabs a', function (e) {
        var self = $(this),
            form = self.closest("form"),
            input = form.find("input");

        self.addClass('active').siblings().removeClass('active');
        self.closest('.findAddObjects-block')[0].className = 'findAddObjects-block findAddObjects-' + this.id;
        form.attr('action', this.href);
        form.find("#info").show();
        form.find("#empty").hide();
        input.val(self.data("desc"));
        return false;
    });

    topicSearch.on("focusin focusout", "#text", function (e) {
        var _this = this,
            activeTab = topicSearch.find('.active');
        if (e.type === 'focusin' && _this.value === activeTab.data("desc")) {
            _this.value = '';
        } else if (e.type === 'focusout') {
            setTimeout(function () {
                if (!_this.value) {
                    _this.value = activeTab.data("desc");
                }
            }, 200);
        }
    });

    $("body").on('mousedown', function (e) {
        if ($.inArray(e.target.parentNode.className, ['ur-description', 'rollbar-path-vertical']) >= 0 || e.target.className === 'button-small-color' || e.target.className === 'all-objects' || e.target.className === 'findAddObjects-input' || e.target.className === 'b-ur-tab-content' || $(e.target).parents('.b-ur-tab-content').length || $(e.target).parents('.findAddObjects-input').length) {
            return;
        }
        $("#reset-search").trigger(App.event.click());
    });

    $(document).on('keydown', function (e) {
        if (e.keyCode === 27) {
            $("#reset-search").trigger(App.event.click());
        }
    });

    topicSearch.on('submit', function () {
        var self = $(this),
            text = self.find("#text").val(),
            input = self.find('input');
        if (!text || (self.find(".active").data("desc") === text)) {
            App.notify.error(App.t("Enter text to search topic!"));
            return false;
        }
        input.after('<i class="preloader"></i>');

        App.remote.get(App.baseUrl('quick/search/' + encodeURIComponent(text.replace(/\//g, '-'))), null, function (r) {
            var result = App.remote.parseResult(r);
            self.find(".preloader").remove();
            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }
            var output = result.data.getOutput();
            var resultHtml = $(".b-ur-tab-content");

            var url = topicSearch.attr('action');
            if (self.find("a.active").length > 0) {
                url = self.find("a.active").attr("href");
            }
            url += '/?text=' + result.data.getParam('text');

            if (output) {
                var button = self.find("#submit");

                if (self.find('.findAddObjects-no-types').length) {
                    button = self.find("#submit_new");
                }

                button.hide();
                if (!self.find("#reset-search").length) {
                    if (self.find('.findAddObjects-no-types').length) {
                        button.after('<button id="reset-search" class="button-medium" type="button"><img src="'+App.assets.common.image('/icons/16/delete.png')+'"></button>');
                    } else {
                        button.after('<button id="reset-search" class="button-medium" type="button">' + App.t('Reset Search') + '</button>');
                    }

                    self.find("#reset-search").on(App.event.click(), function () {
                        button.show();
                        $(this).remove();
                        self.find(".findAddObjects-input input").val("");
                        $(".b-ur-tab-content").remove();
                        self.find("#text").val(self.find(".active").data("desc"));
                    });
                }
                resultHtml.remove();
                input.after(output);
                /*App.dynamic.scrollbar($('.quick-search-scrollable').rollbar({
                 pathPadding: '0px'
                 }));*/
                $('.quick-search-scrollable').rollbar({
                    lazyCheckScroll: 100,
                    blockGlobalScroll: true,
                    pathPadding: '0px'
                });

                $('#quick-search-new-topic').attr('href', url);
            } else {
                location.href = url;
            }
        });
        return false;
    });
});
(function ($) {
    /**
     * Change options in element select of status when changed element select of type
     *
     * @return void
     * @param {jQuery} selectType
     */
    $.fn.statusByType = function (selectType) {
        var statusSelect = $(this);
        if (!App.getParam('availableStatuses').length && !statusSelect.length) {
            return;
        }
        var options = $.parseJSON(App.getParam('availableStatuses')),
            availableOptions = options[selectType.select().val()],
            htmlOpt = '', i = 0;

        $.each(availableOptions, function (slug, title) {
            htmlOpt += "<option label='" + title + "' value='" + slug + "'>" + title + "</option>";
        });
        if (htmlOpt) {
            statusSelect.prop('disabled', false);
            statusSelect.html(htmlOpt);
        } else {
            statusSelect.html("<option label='" + App.t('No Status') + "' value='0'>" + App.t('No Status') + "</option>");
            statusSelect.prop('disabled', true);
        }
    };
    /**
     * Add or hide mass edit options
     *
     * @return void
     * @param {jQuery} main
     * @param {jQuery} side
     */
    $.massEdit = function (main, side) {
        var mainArea = main,
            sideArea = side,
            modal = $('.modal'),
            inputObjectId = $('input:hidden[name=object_id]'),
            massEditArea = sideArea.find('.mass-edit'),
            otherArea = sideArea.children(':not(:has(.block-preloader))').filter(':not(.mass-edit)'),
            otherBlocks = sideArea.children(':has(.block-preloader)'),
            form = sideArea.find('form');

        var otherBlocksIds = [];
        otherBlocks.each(function () {
            otherBlocksIds.push($(this).attr('id'));
        });

        if (!massEditArea.length) {
            return false;
        }
        /* hide/show the mass-edit area */
        var toggleMassEdit = function (action) {
            if (!action) {
                massEditArea.addClass('hidden');
                otherArea.removeClass('hidden');
                $('.ctrl-help').removeClass('hidden');
                $.each(otherBlocksIds, function (i, id) {
                    var elem = $('#' + id);
                    if (elem.hasClass('show')) {
                        elem.show().removeClass('show');
                    }
                });
            } else {
                if (mainArea) {
                    massEditArea.find('#submit_mass_edit_full').addClass('hidden');
                } else {
                    massEditArea.find('#submit_mass_edit').addClass('hidden');
                }
                massEditArea.removeClass('hidden');
                $('.ctrl-help').addClass('hidden');
                otherArea.addClass('hidden');
                $.each(otherBlocksIds, function (i, id) {
                    var elem = $('#' + id);
                    if (elem.is(':visible')) {
                        elem.hide().addClass('show');
                    }
                });

                /* Topic statuses and merge toggling */
                var ids = getTopicIds();
                var types = {};
                var type = '';
                var hasPrivate = false;
                $.each(ids[0].value, function (index, id) {
                    var topic = $('#topic-' + id);
                    if (types[topic.attr('object-type')] == undefined) {
                        types[topic.attr('object-type')] = 0;
                    }
                    types[topic.attr('object-type')]++;
                    type = topic.attr('object-type');
                    hasPrivate = hasPrivate || topic.hasClass('private');
                });
                if (hasPrivate) {
                    $('.links-mass-edit').find('a.merge_with').hide();
                } else {
                    $('.links-mass-edit').find('a.merge_with').show();
                }
                var select = $('#properties-status_id');
                var selectWrapper = select.closest('div');
                var checkboxWrapper = selectWrapper.prev();
                var checkbox = checkboxWrapper.find('input');

                select.find('option').show();
                if (Object.keys(types).length == 1 && select.find('option[object-type="' + type + '"]').length > 0) {
                    select.find('option[object-type!="' + type + '"]').hide();
                    select.val(select.find('option[object-type="' + type + '"]:first').attr('value'));
                    checkboxWrapper.show();
                    if (checkbox.data('was-checked') == 1) {
                        checkbox.data('was-checked', 0).trigger('click');
                    }
                } else {
                    checkboxWrapper.hide();
                    if (checkbox.is(":checked")) {
                        checkbox.data('was-checked', 1).trigger('click');
                    }
                }
            }
            $(window).trigger('scroll');
        };
        sideArea.on('change', ':checkbox', function (e) {
            var checkbox = $(this);
            checkbox.closest('label').siblings('div.select_' + checkbox.val()).toggleClass('hidden');
        });

        /* removes all selected objects when press "Esc" */
        $(document).on('keydown', function (e) {
            if (e.ctrlKey && mainArea) {
                mainArea.find('.objects').addClass('mass-edit-area');
            }
            if (e.keyCode === 27 && !modal.length) {
                toggleMassEdit(false);
                if (mainArea) {
                    mainArea.find('.object').removeClass('selected');
                    form[0].reset();
                }
            }
        });

        massEditArea.on(App.event.click(), '.quick-close', function (e) {
            toggleMassEdit(false);
            if (mainArea) {
                mainArea.find('.object').removeClass('selected');
                form[0].reset();
            }
        });

        if (mainArea) {
            $(document).on('keyup', function () {
                mainArea.find('.objects').removeClass('mass-edit-area');
            });
            mainArea.on(App.event.click(), ".object", function (e) {
                // remove infinite loop
                if (!e.ctrlKey && !e.metaKey) {
                    return;
                } else {
                    e.preventDefault();
                }

                var target = $(e.currentTarget);

                target.animate({ opacity: 0.7 }, 100).animate({ opacity: 1 }, 100).toggleClass('selected');

                var countSelected = mainArea.find('.selected').length;
                toggleMassEdit(parseInt(countSelected, 10));
                if (countSelected > 0) {
                    massEditArea.find('.sidebar-title-mass-edit span').html(countSelected);
                }
                $(window).trigger('scroll');
            });
        } else {
            $(document).on('keydown keyup', function (e) {
                if ((e.ctrlKey == true || e.metaKey == true) && e.keyCode == 69) {
                    toggleMassEdit(true);
                    $(window).trigger('scroll');
                }
            });
        }
        /*if ($.browser.mozilla) {
            sideArea.on('click', 'label', function (e) {
                if (e.currentTarget === this && e.target.nodeName !== 'INPUT' && e.ctrlKey) {
                    $(this.control).click();
                }
            });
        }*/
        /* change status when the type is changed*/
        sideArea.find('#properties-type').on('change', function () {
            sideArea.find('#properties-status').statusByType($(this));
        });
        var getTopicIds = function () {
            var value;
            if (inputObjectId.length) {
                value = [inputObjectId.val()];
            } else {
                value = $.map(mainArea.find('div.object.selected'), function (elemet) {
                    return parseInt(elemet.id.substr(6));
                });
            }
            return $.makeArray({
                'name': 'topics',
                'value': value
            });

        };

        /* binds ajax on the mass edit links */
        sideArea.on('click', '.links-mass-edit a', function (e) {
            e.preventDefault();
            var link = $(this),
                topicIds = getTopicIds();
            var oldClass = link.attr('class');
            if (link.hasClass('merge_with')) {
                App.authModal = App.dynamic.modal.openFromUrl({
                    modal: {
                        title: App.t('Merge'),
                        width: '500',
                        shader: false,
                        useCustomScroller: true,
                        useWrapper: false
                    },

                    request: {
                        url: App.baseUrl('/topics/mass-edit/merge') + '?object_ids=' + topicIds[0].value.join(',')
                    },

                    complete: function (modal) {
                        var modalBody = modal.getContent(true);

                        /* Form submit */
                        modalBody.on("submit", 'form', function (e) {
                            e.preventDefault();
                            var form = $(this);

                            form.find('input[type=submit]').attr('disabled', 'disabled');
                            form.find('.preloader').css('margin-right', '10px').show();

                            App.remote.post(form.attr("action"), form.serialize(), function (r) {
                                var result = App.remote.parseResult(r);
                                if (result.data.isError()) {
                                    App.notify.error(result.data.getMessage());
                                    form.find('input[type=submit]').removeAttr('disabled');
                                    form.find('.preloader').hide();
                                    return false;
                                }
                                App.notify.success(result.data.getMessage());
                                App.dynamic.modal.close(modal.modal);
                                location.reload(true);
                            });

                        });
                    }
                });
                return false;
            } else {
                link.attr('class', 'sidebar-title-small').find('i').addClass('preloader');
                App.remote.post(form.attr('action'), link.find('input').serializeArray().concat(topicIds), function (r) {
                    link.attr('class', oldClass).find('i').removeClass('preloader');
                    var result = App.remote.parseResult(r);
                    if (result.data.isError()) {
                        App.notify.error(result.data.getMessage());
                        return false;
                    }
                    window.location.reload(true);
                });
            }

        });

        form.on('submit', function (e) {
            e.preventDefault();
            var form = $(this),
                data = form.find('div:not(.hidden) select').serializeArray().concat(getTopicIds());
            data.push({name: 'url', value: window.location.href});
            form.find('input[type="submit"]').attr('disabled', 'disabled');
            App.remote.post(form.attr('action'), data, function (r) {
                var result = App.remote.parseResult(r);
                if (result.data.isError()) {
                    App.notify.error(result.data.getMessage());
                    return false;
                }
                form[0].reset();
                window.location.reload(true);
            });
        });
    };
})(jQuery);


/** File: application/3.0.2/modules/resources/assets/desktop/js/frontend.js **/

/**
 * This Javascript will be used on frontend pages only.
 *
 * @module Resources
 */
App.module.extend({
    resources: {
        controllers: {
            search: {
                search: function () {
                    App.onReady(function () {
                        $.massEdit($('.mainArea'), $('.sidebar-container'));
                    });
                }
            }
        }
    }
});

App.route().on(['topic_show', 'ticket_show', 'announcement_show'], function () {
    var pageWrapper = $('.wrap-container');
    /* Add reminder scripts*/
    pageWrapper.on(App.event.click(), ".topic_set_reminder, .reminder-info > a", function (e) {
        e.preventDefault();
        var link = $(this);
        App.dynamic.modal.openFromUrl({
            modal: {
                title:             App.t("Set a Reminder"),
                width:             '500',
                shader:            false,
                useCustomScroller: true,
                useWrapper:        false
            },
            request: {
                url: link.attr("href")
            },
            complete: function (modal) {
                var modalBody = modal.getContent(true);
                //add event on Selected user
                modalBody.on('change', "input[name=user_group]", function(e){
                    $(this).closest('label').siblings("div:not(.hidden)").toggleClass("hidden").toggleClass("required");
                    modalBody.find("." + $(e.currentTarget).val()).toggleClass("hidden").toggleClass("required").removeAttr('disabled');
                    modalBody.find(":selected").removeAttr('selected');
                    modalBody.find(":text").val();
                });
                //add event on Selected schedule
                modalBody.on('change', "input[name=schedule]", function(){
                    modalBody.find("div.schedule").toggleClass("hidden");
                });

                modalBody.on("submit", 'form', function(e){
                    e.preventDefault();

                    var form = $(this);
                    var required = form.find(".required input");

                    if (required.length && required.val().trim() == "") {
                        required.parent().addClass("error");
                        App.notify.error(App.t("Please fill in required fields"));
                        return false;
                    }

                    form.find('button').attr('disabled', 'disabled');
                    form.find('.preloader').css('margin-right', '10px').show();

                    App.remote.post(form.attr("action"), form.serialize(), function (r) {
                        form.find('.preloader').hide();
                        form.find('button').removeAttr('disabled');
                        var result = App.remote.parseResult(r);
                        if (result.data.isError()) {
                            App.notify.error(result.data.getMessage());
                            return false;
                        }
                        var blockReminders = $('#blockReminders');
                        blockReminders.html(result.data.getOutput());
                        if (blockReminders.find('.overflow').length > 0) {
                            blockReminders.prev().removeClass('hidden');
                        }
                        App.notify.success(result.data.getMessage());
                        App.dynamic.modal.close(modal.modal);
                    });
                });

                modalBody.on(App.event.click(), '#delete_reminder', function(){
                    e.preventDefault();
                    var form = $(this).closest('form');

                    App.remote.post($(this).attr("action"), form.serialize(), function (r) {
                        var result = App.remote.parseResult(r);
                        if (result.data.isError()) {
                            App.notify.error(result.data.getMessage());
                            return false;
                        }
                        var blockReminders = $('#blockReminders');
                        blockReminders.html(result.data.getOutput());
                        if (blockReminders.find('.overflow').length == 0) {
                            blockReminders.addClass('hidden').prev().addClass('hidden');
                        }
                        App.notify.success(result.data.getMessage());
                        App.dynamic.modal.close(modal.modal);
                    });
                });
            }
        });
    });

    pageWrapper.on(App.event.click(), "#blockReminders .email", function (e) {
        e.preventDefault();
        var self = $(this);
        var clock = $(this).next(".clock");
        clock.toggleClass("clock").toggleClass("preloader");

        App.remote.post($(this).attr("href"), function (r) {
            var result = App.remote.parseResult(r);
            clock.toggleClass("preloader");
            if (result.data.isError()) {
                clock.toggleClass("clock");
                App.notify.error(result.data.getMessage());
                return false;
            }
            clock.toggleClass("check");
            self.remove();
            App.notify.success(result.data.getMessage());
        });
    });
    var allArea = $(".all");
    allArea.manageSubscriptions('.manage_subscriptions, #statistics-subscribers');
    /* binds function mergeObject */
    allArea.on('click', '.merge_with', function(e){
        e.preventDefault();
        $.mergeObjects.apply(this);
    });

    allArea.on('click', '.merged-objects-row', function(e){
        e.preventDefault();
        var link = $(this);
        link.closest('h4').siblings().toggle();
    });


});
(function ( $ ) {
    $.fn.manageSubscriptions =  function(selectors){
        $(this).on(App.event.click(), selectors, function (e) {
            var link = $(this);
            e.preventDefault();
            App.dynamic.modal.openFromUrl({
                modal: {
                    title: App.t("Manage Subscriptions"),
                    width: '500',
                    shader: false,
                    useCustomScroller: true,
                    useWrapper: false
                },
                request: {
                    url: link.attr("href")
                },
                complete: function (modal) {
                    var modalBody = modal.getContent(true);
                    modalBody.find("#select_users").select_ajax({
                        width : '90%',
                        minimumInputLength: 3,
                        allowClear: true,
                        ajax: { // instead of writing the function to execute the request we use select_ajax's convenient helper
                            url: modalBody.find("form").attr('action') + '/ajax',
                            dataType: 'json',
                            multiple: true,
                            cache: true,
                            data: function (term, page) {
                                return {
                                    letters: term, // search term
                                    page_limit: 10
                                };
                            },
                            results: function (data, page) {
                                var newData = [];
                                $.each(data, function(i, v){
                                    if(!modalBody.find("#subscribers-" + this.id).length){
                                        newData.push(data[i]);
                                    }
                                });
                                if ($.isEmptyObject(newData)) {
                                    return {results: []};
                                }
                            // parse the results into the format expected by select_ajax.
                            // since we are using custom formatting functions we do not need to alter remote JSON data
                                return {results: newData};
                            }
                        },
                        tags : 'array',
                        dropdownSelector : '.rollbar-content'
                    });

                    modalBody.on("submit", 'form', function(e){
                        e.preventDefault();

                        var form = $(this),
                            button = form.find(':submit');
                        button.attr('disabled', 'disabled');
                        form.find('.preloader').css('margin-right', '10px').show();

                        App.remote.post(form.attr("action"), form.serialize(), function (r) {
                            var result = App.remote.parseResult(r);
                            if (result.data.isError()) {
                                button.removeAttr('disabled');
                                App.notify.error(result.data.getMessage());
                                return false;
                            }
                            if (result.data.getMessage() !== 'Undefined') {
                                App.notify.success(result.data.getMessage());
                            }
                            var employeesInvolved = result.data.getParam('newSubscribers');
                            var main = $('#main');
                            var eiBlock = main.find('.rightarea .employees-involved');
                            if (eiBlock.length > 0) {
                                eiBlock.prev().remove();
                                eiBlock.remove();
                            }
                            main.find('.rightarea .subscribe-block').after(employeesInvolved);
                            App.dynamic.modal.close(modal.modal);
                        });
                    });
                }
            });
        });
    };

    $.mergeObjects = function () {
        var _this = $(this);
        App.dynamic.modal.openFromUrl({
            modal: {
                title: App.t('Merge Objects'),
                width: '500',
                shader: false,
                useCustomScroller: true,
                useWrapper: false
            },
            request: {
                url: this.href
            },

            complete: function (modal) {
                var modalBody = modal.getContent(true);
                modalBody.on('change', 'input[name=add_by]', function () {
                    var self = $(this),
                        block = self.closest('.with-input-after').siblings('.for-input-full-modal');
                    block.toggleClass('hidden');
                });

            var format = function (state) {
                return '<div class="modal-list-checkbox-icons ' + state.object_type + '">' +
                    '<i class="ico-small"></i><span>' + state.title + '</span>' +
                    '</div>';
            };
            var searchText = modalBody.find("#add_search_url"),
                object_name = modalBody.find(':hidden[name=object_name]').val(),
                object_id = modalBody.find(':hidden[name=object_id]').val();
            searchText.select_ajax({
                width : '100%',
                minimumInputLength: 3,
                allowClear: true,
                formatResult: format,
                ajax: { // instead of writing the function to execute the request we use select_ajax's convenient helper
                    url: App.baseUrl('autocomplete'),
                    dataType: 'json',
                    multiple: true,
                    cache: true,
                    data: function (term, page) {
                        return {
                            search_text: term, // search term
                            object_name: object_name,
                            is_private : 0,
                            exclude_ids: [object_id]
                        };
                    },
                    results: function (data, page) {
                        var newData = [];
                        $.each(data, function(i, v){
                            if(!modalBody.find("#subscribers-" + this.id).length){
                                newData.push(data[i]);
                            }
                        });
                        if ($.isEmptyObject(newData)) {
                            return {results: []};
                        }
                        // parse the results into the format expected by select_ajax.
                        // since we are using custom formatting functions we do not need to alter remote JSON data
                        return {results: newData};
                    }
                },
                tags : ['red'],
                dropdownSelector : '.rollbar-content'
            });

            var addNewRow = function(object_type, id, title, module, slug){
                var object_name = module == 'feedback' ? 'topic' : object_type;
                var html = '<label class="' + object_type + '">' +
                    '<input type="radio" name="merger_add[]" value="' + id + '"><i class="ico-small"></i>' +
                    '<a class="ico-small idelete floatRight"></a><a href="' + App.baseUrl(object_name + '/' + slug) + '" target="_blank">' + title + '</a></label>';
                if(!modalBody.find('input:checkbox[value='+id+']').length){
                    return modalBody.find('.modal-list-checkbox-icons label').last().after(html);
                }
                return false;
            };
            //remove row
            modalBody.on('click', '.idelete', function(e){
                e.preventDefault();
                var link = $(this);
                var label = link.closest('label');
                var wrapper = label.closest('.modal-list-checkbox-icons');
                if (wrapper.find('label').length > 1) {
                    label.remove();
                    if (wrapper.find('label input:checked').length == 0) {
                        wrapper.find('label input:first').attr('checked', 'checked');
                    }
                }
            });
            //set selected only one checkbox
            modalBody.on('change', ':checkbox', function(){
                var self = $(this);
                self.closest('label').siblings().find(':checkbox').prop("checked", false);
            });

            searchText.on('select_ajax-selecting', function(event){
                var self = $(this);
                addNewRow(event.object.object_type, event.object.id, event.object.title, event.object.module, event.object.slug);
                var setInt = setInterval(function(){
                        var choice = modalBody.find('.select_ajax-search-choice');
                    if (choice.length) {
                        choice.remove();
                        modalBody.find('.for-input-full-modal').click();
                        clearInterval(setInt);
                    }
                }, 1);
            });
            //add object by url
            modalBody.on('click', '#add_by_url_button', function(event){
                event.preventDefault();
                var link = $(this),
                    searchInput = modalBody.find('#add_url');
                if ($('#add_url').val().length <= 1) {
                    return App.notify.error(App.t('Select at least 2 objects to merge!'));
                }
                App.remote.get(link.attr('href'), {search_url : searchInput.val(), module : object_name, is_private : 0, exclude_ids:[object_id]}, function (r) {
                    var result = App.remote.parseResult(r);
                    if (result.data.isError()) {
                        App.notify.error(result.data.getMessage());
                        return false;
                    }
                    var data  = $.parseJSON(result.data.getOutput()),
                        res = null;
                    res = addNewRow(data.object_type, data.id, data.title, data.module, data.slug);
                    if(!res){
                        return App.notify.error(App.t('Object is already in the list!'));
                    }
                    searchInput.val('');
                });
            });
                // submits merge objects
                modalBody.on('submit', 'form', function (e) {
                    e.preventDefault();
                    var form = $(this),
                        objects = form.find('.modal-list-checkbox-icons');
                    if (form.find('input[name="merger_add[]"]').length <= 1) {
                        return App.notify.error(App.t('Select at least 2 objects to merge!'));
                    }
                    var merge_objects = $.map(objects.find('input:not(:checked)'), function (elem) {
                        return $(elem).val();
                    });
                    var data = {
                            lead_object: objects.find('input:checked').val(),
                            merge_objects: merge_objects
                        },
                        preloader = form.find('.modalFooter .preloader');
                    preloader.show();
                    App.remote.post(form.attr('action'), data, function (r) {
                        var result = App.remote.parseResult(r);
                        preloader.hide();
                        if (result.data.isError()) {
                            App.notify.error(result.data.getMessage());
                            return false;
                        }
                        if (result.data.getMessage() !== 'Undefined') {
                            App.notify.success(result.data.getMessage());
                        }
                        _this.trigger('merge_objects.completed');
                        window.location.href = result.data.getParam('redirect_url');
//                        App.dynamic.modal.close(modal.modal);

                    });
                });
        }
        });
    };



})(jQuery);


/** File: application/3.0.2/modules/system/assets/desktop/js/filters.js **/

App.onReady(function(){
    $(".sortByDate").change(function(){
        var data = App.getFormParams($(".filter-area"));
        var preloader = $(this).parents('div.filter-area:first').find(".preloader:first").css('display', 'inline-block');
        if ($(".filter") != void(0)) {
            data.type = $(".filter.filter-active").attr("id");
        }
        var url = location.href;
        App.remote.get(url, data, function(r) {
            var result = App.remote.parseResult(r);
            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }
            $(".mainArea").html(result.data.getOutput());

            if (App.setVotes && result.data.getParam('user_votes')) {
                App.setVotes(result.data.getParam('user_votes'));
            }

            preloader.hide();
        });
    });

    $(".sortByPopularity").change(function(){
        var preloader = $(this).parents('div.filter-area:first').find(".preloader:first").css('display', 'inline-block');
        var data = App.getFormParams($(".filter-area"));
        if ($(".privacy-filter").length > 0) {
            data['privacy_type'] = $(".privacy-filter.filter-active").attr('id');
        }
        if ($(".filter") != void(0)) {
            data.type = $(".filter.filter-active").attr("id");
        }
        data['format'] = 'json';
        var url = location.href;

        url = url.replace(/\/sort\/(\w+)\//, '/sort/'+data.order+'/');
        url = url.replace(/\/page\/(\d+)/, '/page/1');

        App.remote.get(url, data, function(r) {
            var result = App.remote.parseResult(r);
            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }
            $(".mainArea").html(result.data.getOutput());

            if (App.setVotes && result.data.getParam('user_votes')) {
                App.setVotes(result.data.getParam('user_votes'));
            }

            preloader.hide();
        });
    });

    var selectSortByType = $("select.user_sortByType");
    if(selectSortByType.length){
        selectSortByType.customSelect();
    }

    selectSortByType.on("change", function(){
        var self = $(this);
        var preloader = $(this).closest('.filter-area').find(".preloader:first").css('display', 'inline-block');
        var data = {
            'format' : 'json',
            user_filter : $('.sortByFollowing').val(),
            object_type : this.value
        };
        //data.user_filter = $('.sortByFollowing').val();
        //data.type = $(this).val();
        App.remote.get(location.href, data, function(r) {
            var result = App.remote.parseResult(r);
            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }
            var profileLog = self.closest('.profile-log'),
                active_tab = profileLog.find('.content-tabs li.active').attr('id');

            if(profileLog.length){
                profileLog.find('.content-tabs-area.' + active_tab).html(result.data.getOutput());
            }
            preloader.hide();
        });
        return false;
    });

    $(".filter-area").on(App.event.click(), ".filter", function(){
        if (this.id === 'privacy-filter-private' || this.id === 'privacy-filter-public') return true;
        $(".filter").removeClass("filter-active");
        $(".filter").find(".marker").hide();
        $(this).addClass("filter-active");
        $(this).find(".marker").show();
        var preloader = $(this).parents('div.filter-area:first').find(".preloade:first").css('display', 'inline-block');
        var data = App.getFormParams($(".filter-area"));
        data.type = $(this).attr("id");
        App.remote.get(location.href, data, function(r) {
            var result = App.remote.parseResult(r);
            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }
            $(".mainArea").html(result.data.getOutput());
            preloader.hide();
        });
        return false;
    });

    $(".sortByFollowing").change(function(){
        var self = $(this);
        var preloader = $(this).parents('div.filter-area:first').find(".preloader:first").css('display', 'inline-block');
        var data = {
            'format' : 'json',
            'object_type'   : selectSortByType.val()
        };
        if ($(this).val() != 'all') {
            data.user_filter = $(this).val();
        }
        var url = location.href;
        if (url.indexOf("?") > -1) {
            url = url.substr(0, url.indexOf("?"));
        }
        App.remote.get(url, data, function(r) {
            var result = App.remote.parseResult(r);
            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }
            var profileLog = self.closest('.profile-log'),
                active_tab = profileLog.find('.content-tabs li.active').attr('id');

            if(profileLog.length){
                profileLog.find('.content-tabs-area.' + active_tab).html(result.data.getOutput());
            }else{
                $('.mainArea').html(result.data.getOutput());
            }
            preloader.hide();
        });
    });
    $(".privacy-filter").click(function(e){
        e.preventDefault();
        var filter = $(".filter");
        var self = $(this);
        filter.removeClass("filter-active")
            .find(".marker")
            .hide();
        self.addClass("filter-active")
            .find(".marker")
            .show();
        var preloader = self.parent()
            .find(".preloader:first");
        preloader.css('display', 'inline-block');
        var privacy = (self.attr('id') === 'privacy-filter-private') ? 1 : 0;
        var data = {
            'format' : 'json',
            'date'   : $('.sortByDate').val(),
            'status' : $('.sortByPopularity').val()
        };

        if ($(".categories_sortByCategory").length > 0) {
            data.category_slug = $('.categories_sortByCategory').val();
        }

        if ($(".privacy-filter").length > 0) {
            data.privacy_type = $(".privacy-filter.filter-active").attr('id');
        }

        var url = location.href;

        App.remote.get(url, data, function(r) {
            var result = App.remote.parseResult(r);
            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }
            $(".mainArea").html(result.data.getOutput());

            if (App.setVotes && result.data.getParam('user_votes')) {
                App.setVotes(result.data.getParam('user_votes'));
            }

            preloader.hide();

            if (privacy === 1) {
                $('#privacy-filter-private').addClass('filter-active');
                $('#privacy-filter-public').removeClass('filter-active');
            } else {
                $('#privacy-filter-public').addClass('filter-active');
                $('#privacy-filter-private').removeClass('filter-active');
            }
            return false;
        });
    });
    $(".categories_sortByCategory").change(function () {
        var preloader = $('.filter-area').find(".preloader:first").css('display', 'inline-block');
        var data = App.getFormParams($(".filter-area"));
        if ($(".privacy-filter").length > 0) {
            data['privacy_type'] = $(".privacy-filter.filter-active").attr('id');
        } else {
            if ($(".filter") != void(0)) {
                data.type = $(".filter.filter-active").attr("id");
            }
        }
        data['format'] = 'json';

        if (App.getParam('mobileTheme')) {
            data['category_slug'] = $(this).val();
            data['status'] = $(".sortByPopularity").val();
            data['date'] = $(".sortByDate").val();
        }

        var url = location.href;
        url = url.replace(/\/category\/([a-zA-Z\-_0-9]+)\//, '/category/'+data.category_slug+'/');
        url = url.replace(/\/page\/(\d+)/, '/page/1');

        App.remote.get(url,data,function(r) {
            var result = App.remote.parseResult(r);
            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }

            if (App.getParam('mobileTheme')) {
                $('ul.paginator').remove();
                $('ul.response-list').replaceWith(result.data.getOutput());
            } else {
                $(".mainArea").html(result.data.getOutput());
            }

            preloader.hide();
        });
    });
});

/** File: application/3.0.2/modules/resources/assets/desktop/js/votes.js **/

App.setVotes = function (votes) {
    for (id in votes) {
        var cl = "iDont";
        if (votes[id]*1 > 0) {
            cl = "iLikeIt";
        }
        var topic = $("#topic-" + id),
            button = topic.find("." + cl);
        if (button.length) {
            button.addClass("disactive");
        } else {
            topic.find(".vote-add-like").addClass("disactive");
        }
    }
}
App.getCookie = function (name) {
    var i,x,y,ARRcookies = document.cookie.split(";");
    for (i=0; i < ARRcookies.length; i++)
    {
      x = ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));
      y = ARRcookies[i].substr(ARRcookies[i].indexOf("=") + 1);
      x = x.replace(/^\s+|\s+$/g, "");
      if (x == name) {
        return unescape(y);
      }
    }
}

$(function () {
    var topicVotes = {};
    if (App.getParam("isGuest")) {
        var votes = App.getCookie('votes');
        if (votes) {
            votes = eval ("(" + votes + ")");
            topicVotes = votes.response;
        }
    } else {
        topicVotes = App.getParam('user_votes', {});
    }

    App.setVotes(topicVotes);
    
    /* Vote button on topics list */
    $(".mainArea").on(App.event.click(), ".vote > a, a.vote-add-like, a.remove-vote", function(event){
        event.preventDefault();

        if (!App.getParam("canVote")) {
            var params = {'get': {} , 'redirect' : this.href};
            App.openLoginPopup(params);
            return false;
        }

        var voteButton = $(this),
            allVotesBlock = voteButton.closest(".all-votes"),
            isAuthor = parseInt(voteButton.closest('.vote').data('is-author'));
        if((voteButton.hasClass('disactive') && voteButton.siblings('a').length)  || isAuthor){
            return;
        }
        allVotesBlock.append('<i class="preloader" style="display: inline-block"></i>');
        allVotesBlock.find('div').hide();

        /* Make server request */
        App.remote.get(voteButton.attr("href"), {format: 'json'}, function(r) {
            var result     = App.remote.parseResult(r);

            voteButton.parent().siblings(".preloader").remove();
            voteButton.parent().removeAttr("style");

            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }

            var html = result.data.getOutput();
            allVotesBlock.html(html);

            $(document).trigger('topic.voteAdded', [result.data]);
            App.notify.success(result.data.getMessage());
        });

        return false;
    });
});


/** File: application/3.0.2/modules/feedback/assets/desktop/js/paginator.js **/

App.onReady(function () {

    var url = location.href;
    if (url[url.length - 1] == '/') {
        url = url.substr(0, url.length - 1);
    }

    var matches = /.*\/topics\/(\w+)\/status\/(\w+)\//.exec(url);
    url = url.replace(/(.*)\/topics\/.*/, '$1/topics');
    var filtersArea = $(".filter-area");

    var pushNewState = function (page) {
        var data = null;
        if(filtersArea.length){
            data = App.getFormParams(filtersArea);
        }else{
            data = {
                type : filtersArea.find('.user_sortByType').val(),
                user_filter : filtersArea.find('.sortByFollowing').val()
            };
        }
        data.page = page;
        if ($(".filter").length) {
            data.type = $(".filter.filter-active").attr("id");
        }

        var categorySlug = data['category_slug'] != undefined ? data['category_slug'] : 'all';
        var sort = data['order'] != undefined ? data['order'] : 'all';
        var topicType = matches != null ? matches[1] : 'all';
        var topicStatus = matches != null ? matches[2] : 'all';
        window.history.pushState(document.title, document.title, url + '/'+topicType+'/status/'+topicStatus+'/category/'+categorySlug+'/sort/'+sort+'/page/'+data.page);
    };

    filtersArea.find('select').on('change', function () {
        pushNewState(1);
    });

    $("#main").on(App.event.click(), '.paginator li a', function (event) {
        if ($(this).attr('href') != undefined) {
            pushNewState($(this).attr("id").match(/\d+/)[0]);
        }
    });

});

/** File: application/3.0.2/modules/knowledge-base/assets/desktop/js/frontend.js **/

App.module.extend({
    knowledgeBase: {
        controllers: {
            article: {
                _init: function () {
                    App.onReady(function () {
                        $('ul.main-nav li:last-child span').css('backgroundImage', 'none');
                    });
                },
                add: function () {
                    App.onReady(function () {
                        if ($.isFunction($.fn.attachFiles)) {
                            $('.mainArea').attachFiles();
                        }
                        var validate = function () {
                            var $this = $(this),
                                title = $this.find('#title'),
                                content = $this.find('textarea');
                            if (title.val().length < 3) {
                                title.addClass("error");
                                return App.t("Title should be at least 3 characters!");
                            } else {
                                title.removeClass("error");
                            }
                            if (content.val().length < 3) {
                                content.addClass("error");
                                return App.t("Description should be at least 3 characters!");
                            } else {
                                content.removeClass("error");
                            }
                            return null;
                        };
                        var draftArticleSlug = null,
                            articleForm = $('#article_form'),
                            formPreloader = articleForm.find('.preloader');

                        articleForm.on(App.event.click(), '#draft_article', function (e) {
                            e.preventDefault();
                            var form = $(e.delegateTarget),
                                formData = form.serializeArray();
                            var validateRes = validate.call(e.delegateTarget);

                            if (validateRes) {
                                App.notify.error(validateRes);
                                return false;
                            }

                            if (draftArticleSlug) {
                                formData.push(draftArticleSlug);
                            }
                            formPreloader.removeClass('hidden');
                            App.remote.post(form.attr('action'), formData, function (r) {
                                var result = App.remote.parseResult(r);
                                formPreloader.addClass('hidden');
                                if (result.data.isError()) {
                                    App.notify.error(result.data.getMessage());
                                    return false;
                                }
                                var articleSlug = result.data.getParam('article_slug');
                                draftArticleSlug = {
                                    name: 'article_slug',
                                    value: articleSlug
                                };
                                $('#article_slug').val(articleSlug);
                                App.notify.success(result.data.getMessage());

                                articleForm.off(App.event.click(), '#article_preview');
                                $('#article_preview').attr('href', result.data.getParam('preview_url'));
                            });
                        });

                        /* preview Article */
                        articleForm.on(App.event.click(), '#article_preview', function (e) {
                            e.preventDefault();
                            var action = articleForm[0].action,
                                formData = articleForm.serializeArray(),
                                articleSlug = articleForm.find('#article_slug'),
                                articleSlugVal = articleSlug.val();

                            var targetBlankSubmit = function () {
                                articleForm.attr('target', "_blank")
                                    .attr('action', action + '?preview=1')
                                    .submit()
                                    .removeAttr('target')
                                    .attr('action', action);
                            };
                            if (!articleSlugVal) {
                                formData.push({name: 'preview', value: 1});
                                formPreloader.removeClass('hidden');
                                targetBlankSubmit();
                                var getCookie = setInterval(function () {
                                    if (App.cookie.get('article_slug')) {
                                        articleForm.find('#article_slug').val(App.cookie.get('article_slug'));
                                        App.cookie.remove('article_slug');
                                        clearInterval(getCookie);
                                        formPreloader.addClass('hidden');
                                    }
                                }, 100);
                            } else {
                                targetBlankSubmit();
                            }
                        });

                        /* saves published as draft Article */
                        articleForm.on('change', ':radio[name=is_draft]', function (e) {
                            e.preventDefault();
                            formPreloader.removeClass('hidden');
                            articleForm.submit();
                        });


                        articleForm.submit(function (e) {
                            var valRes = validate.call(this);
                            if (valRes) {
                                e.preventDefault();
                                App.notify.error(valRes);
                                return false;
                            }
                        });
                        $.countTitleLength.apply($('#title'), [$("#col-title")]);
                    });
                },
                edit: function () {
                    App.module.knowledgeBase.controllers.article.add();
                },
                show: function () {
                    App.onReady(function () {
                        var mainArea = $('.mainArea'),
                            hiddenList = null;
                        $('.list-marker').on(App.event.click(), '.show_all', function (e) {
                            e.preventDefault();
                            var $this = $(this);
                            if (!hiddenList) {
                                hiddenList = $this.closest('.list-marker').find('.hidden');
                            }
                            hiddenList.toggleClass('hidden');
                            this.innerHTML = hiddenList.hasClass('hidden') ? App.t('Load More...') : App.t('Hide');
                        });
                        App.module.knowledgeBase.utilities.voting.call(mainArea);
                    });
                }
            },
            manage: {
                index: function () {
                    // Sortable initialization
                    App.onReady(function () {
                        var initSortable = function () {
                            this.find('tbody').sortable({
                                handle: ".imove",
                                axis: 'y',
                                update: function (event, ui) {
                                    var order = $(this).find('tr').map(function (i) {
                                        return {
                                            id: this.id,
                                            order: parseInt(i) + 1
                                        };
                                    }).get();
                                    ui.item.find("a.imove").removeClass("imove").addClass('preloader');
                                    App.remote.post(window.location.href, {order: order}, function (r) {
                                        var result = App.remote.parseResult(r);
                                        ui.item.find("a.preloader").addClass("imove").removeClass('preloader');
                                        if (result.data.isError()) {
                                            App.notify.error(result.data.getMessage());
                                            return false;
                                        }
                                        App.notify.success(result.data.getMessage());
                                    });
                                }
                            });
                        };
                        initSortable.call($(".universal-table-admin"));
                        var mainArea = $('.mainArea'),
                            customFilterSelect = $('#custom_article_filter');
                        customFilterSelect.customSelect();
                        customFilterSelect.change(function () {
                            var preloader = $('.filter-area').find(".preloader");
                            preloader.css('display', 'inline-block');
                            App.remote.get(window.location.href, $.parseJSON(this.value), function (r) {
                                var result = App.remote.parseResult(r);
                                preloader.hide();
                                if (result.data.isError()) {
                                    App.notify.error(result.data.getMessage());
                                    return false;
                                }
                                mainArea.html(result.data.getOutput());
                                initSortable.call($(".universal-table-admin"));
                            });
                        });

                        /* swap featured*/
                        mainArea.on(App.event.click(), '.featured, .not-featured', function () {
                            var self = this,
                                $this = $(this),
                                tr = $this.closest('tr'),
                                isFeatured = $this.hasClass('featured');
                            self.className = 'ico-small tooltip preloader';
                            App.remote.post(window.location.href, {id: tr.attr('id'), featured: tr.data('featured')}, function (r) {
                                var result = App.remote.parseResult(r);
                                if (result.data.isError()) {
                                    App.notify.error(result.data.getMessage());
                                    return false;
                                }
                                self.className = self.className.replace('preloader', isFeatured ? 'not-featured' : 'featured');
                                $this.data('powertip', isFeatured ? App.t('Not Featured') : App.t('Featured'));
                            });
                        });
                        //remove articles/faq
                        mainArea.on(App.event.click(), ".idelete", function (e) {
                            e.preventDefault();
                            if (!confirm(App.t('Are you sure? You can\'t UNDO this operation!'))) {
                                return false;
                            }
                            var self = $(this);
                            self.removeClass("idelete").addClass("preloader");
                            App.remote.post(this.href, null, function (r) {
                                var result = App.remote.parseResult(r);
                                if (result.data.isError()) {
                                    App.notify.error(result.data.getMessage());
                                    return false;
                                }
                                self.closest("tr").remove();
                                App.notify.success(result.data.getMessage());
                            });
                        });
                    });
                },
                manageCategories: function () {
                    App.module.system.controllers.adminCategories.index();
                },
                manageBlocks: function () {
                    App.onReady(function () {
                        $(".universal-table-admin").find('tbody').sortable({
                            handle: ".imove",
                            axis: 'y',
                            update: function (event, ui) {
                                var order = $(this).find('tr').map(function () {
                                    return this.id;
                                }).get();
                                ui.item.find("a.imove").removeClass("imove").addClass('preloader');
                                App.remote.post(window.location.href, {order: order}, function (r) {
                                    var result = App.remote.parseResult(r);
                                    ui.item.find("a.preloader").addClass("imove").removeClass('preloader');
                                    if (result.data.isError()) {
                                        App.notify.error(result.data.getMessage());
                                        return false;
                                    }
                                    App.notify.success(result.data.getMessage());
                                });
                            }
                        });
                        var mainArea = $('.mainArea'),
                            tBody = mainArea.find('tbody');

                        var addEditBlock = function (modal) {
                            var modalBody = modal.getContent(true),
                                form = modalBody.find('form');
                            modalBody.uploadImage(64, function (encodeName) {
                                var submit = $(this).find('#submit_block'),
                                    preloader = modalBody.find(".preloader");
                                var _values = form.serializeArray();
                                if (encodeName) {
                                    _values.push({
                                        name: "image",
                                        value: encodeName
                                    });
                                }
                                App.remote.post(form.attr("action"), _values, function (r) {
                                    preloader.remove();
                                    var result = App.remote.parseResult(r);
                                    if (result.data.isError()) {
                                        submit.toggleDisable();
                                        App.notify.error(result.data.getMessage());
                                        return false;
                                    }
                                    var blockId = result.data.getParam('block_id'),
                                        action = result.data.getParam('action');
                                    if (action === 'edit') {
                                        tBody.find('#' + blockId).replaceWith(result.data.getOutput());
                                    } else {
                                        tBody.append(result.data.getOutput());
                                    }

                                    App.notify.success(result.data.getMessage());
                                    App.dynamic.modal.close(modal.modal);
                                });
                            });
                        };

                        $('#add_new_block').openFromUrl(addEditBlock);
                        mainArea.openFromUrl({modal: {title: App.t('Edit Block')}}, '.iedit', addEditBlock);

                        tBody.on('change', ':checkbox', function () {
                            var $this = $(this),
                                preloader = App.preloader(this),
                                value = this.checked;
                            preloader.start();
                            App.remote.post(window.location.href, {'is_active': {id: this.value, value: value}}, function (r) {
                                var result = App.remote.parseResult(r);
                                preloader.stop();
                                $this.closest('tr').toggleClass('checked');
                                if (result.data.isError()) {
                                    App.notify.error(result.data.getMessage());
                                    return false;
                                }
                                App.notify.success(result.data.getMessage());
                            });
                        });
                        //remove block
                        tBody.on(App.event.click(), ".idelete", function (e) {
                            e.preventDefault();
                            if (!confirm(App.t('Are you sure? You can\'t UNDO this operation!'))) {
                                return false;
                            }
                            var self = $(this);
                            this.className = 'ico-small preloader';
                            App.remote.post(this.href, null, function (r) {
                                var result = App.remote.parseResult(r);
                                if (result.data.isError()) {
                                    App.notify.error(result.data.getMessage());
                                    return false;
                                }
                                self.closest("tr").remove();
                                App.notify.success(result.data.getMessage());
                            });
                        });
                    });
                }
            }
        },
        utilities: {
            voting: function (modal) {
                this.on(App.event.click(), '.button-small-color', function (event) {
                    event.preventDefault();
                    var link = $(this),
                        preloader = link.siblings('.preloader').length ? link.siblings('.preloader') : link.parents().siblings('.preloader');

                    if (!App.getParam('canVote')) {
                        var params = null;
                        /* if anonymous user votes to the faq */
                        if (typeof modal !== "undefined") {
                            App.dynamic.modal.close(modal.modal);
                            params = {redirect: window.location.href,
                                ajaxPostHref: this.href};
                        } else {
                            params = {redirect: this.href};
                        }

                        App.openLoginPopup(params);

                        return false;
                    }
                    preloader.removeClass('hidden');
                    App.remote.post(this.href, null, function (r) {
                        var result = App.remote.parseResult(r);
                        preloader.addClass('hidden');
                        if (result.data.isError()) {
                            App.notify.error(result.data.getMessage());
                            return false;
                        }

                        var html = result.data.getOutput();
                        link.closest(".helpful-buttons").replaceWith(html);
                        $('.tooltip').powerTip({ placement: 'n', smartPlacement: true });

                        App.notify.success(result.data.getMessage());
                    });
                    return false;
                });

                this.on(App.event.click(), '.buttons-object-full .iLikeIt, .buttons-object-full .iDont, .remove-vote', function (event) {
                    event.stopImmediatePropagation();
                    var link = $(this),
                        preloader = link.siblings('.preloader').length ? link.siblings('.preloader') : link.parents().siblings('.preloader');
                    if (!App.getParam('canVote')) {
                        var params = null;
                        /* if anonymous user votes to the faq */
                        if (typeof modal !== "undefined") {
                            App.dynamic.modal.close(modal.modal);
                            params = {redirect: window.location.href,
                                ajaxPostHref: this.href};
                        } else {
                            params = {redirect: this.href};
                        }

                        App.openLoginPopup(params);
                        return false;
                    }
                    if ((link.parent().hasClass('object-voted') && !$(this).hasClass("tooltip"))) {
                        return false;
                    }
                    link.find(".how-like img").attr('src', App.assets.common.image('/preloader.gif'));
                    App.remote.post(link.attr("href"), {format: 'json', full: 'true'}, function (r) {
                        var result = App.remote.parseResult(r);

                        if (result.data.isError()) {
                            App.notify.error(result.data.getMessage());
                            return false;
                        }

                        var html = result.data.getOutput();
                        link.closest(".buttons-object-full").replaceWith(html);
                        $('.tooltip').powerTip({ placement: 'n', smartPlacement: true });

                        $(document).trigger('response.voteAdded', [result.data]);
                        App.notify.success(result.data.getMessage());
                    });
                    return false;
                });
            }
        }

    }
});
App.onReady(function () {
    $('.faq-desc').siblings('a').on(App.event.click(), function (event) {
        event.preventDefault();
        $(this).next('.faq-desc').toggle();
    });

    /* Removes topic options from category form */
    if (App.route().is('knowledgebase_manage_categories')) {
        App.dynamic.event().bind('categoryFormOpen', function (e, modal) {
            $(modal).find('option').map(function () {
                if ($.parseJSON(this.value).module !== 'knowledge-base') {
                    this.remove();
                }
            });
        });
    }
    /* quick view FAQ*/
    $('.mainArea').on(App.event.click(), '.quick-view', function (e) {
        e.preventDefault();
        var self = this,
            faqId = null;
        App.dynamic.modal.openFromUrl({
            modal: {
                title: null,
                widthClass: 'quick-faq-modal',
                shader: false,
                useCustomScroller: true,
                useWrapper: false
            },
            request: {
                url: self.href,
                success: function (res) {
                    faqId = res.data.getParam('object_id');
                }
            },
            complete: function (modal) {
                var modalBody = modal.getContent(true);
                App.module.knowledgeBase.utilities.voting.call(modalBody, modal);
                modalBody.on(App.event.click(), '.faq-prev, .faq-next', function (e) {
                    e.preventDefault();
                    var preloader = modalBody.find('.preloader');
//                    App.module.knowledgeBase.utilities.voting.call(modalBody, preloader);
                    preloader.removeClass('hidden');
                    App.remote.get(this.href, null, function (r) {
                        var result = App.remote.parseResult(r);
                        if (result.data.isError()) {
                            App.notify.error(result.data.getMessage());
                            return false;
                        }
                        preloader.addClass('hidden');
                        modal.setHeaderContent(result.data.getParam('headerContent'));
                        modal.setTitle(result.data.getParam('title'));
                        modal.setContent(result.data.getOutput());
                    });
                });
            }
        });
    });
});


/** File: application/3.0.2/modules/sso/assets/desktop/js/main.js **/

App.onReady(function () {

    var popupTabs = $('ul.b-popup-tabs'),
        tab       = null;

    if (App.hasParam('loginMethod')) {
        switch (App.getParam('loginMethod')) {
            case 'sso':
                tab = popupTabs.find('li.ssoTab');
                break;
            case 'ldap':
                tab = popupTabs.find('li.ldapTab');
                break;
            case 'default':
                tab = popupTabs.find('a[rel="form-login"]').closest('li');
                break;
        }
    } else if (App.hasParam('registrationMethod')) {
        tab = popupTabs.find('a[rel="form-registration"]').closest('li');
    } else if (App.hasParam('forgotPasswordMethod')) {
        App.openLoginPopup({
            title: 'Forgot Password',
            forgotPassword: true,
            get: {},
            redirect: document.location.href
        });
    }

    if (null !== tab) {
        setTimeout(function () {
            tab.click();
        }, 70);
    }

    // TODO: refactor deprecated/removed "live" method.
    $("#loginplus-form-ldaplogin").live("submit", function (event) { //debug
        var form = $(this),
            data = App.getFormParams($(this));
        form.find("input[type=submit]").attr("disabled", "disabled").addClass("disabled");
        form.find(".preloader").show();

        App.remote.post($(this).attr("action"), data, function(r) {
            result = App.remote.parseResult(r);
            form.find("input[type=submit]").removeAttr("disabled").removeClass("disabled");
            $(".preloader").hide();
            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }
            App.notify.success(result.data.getMessage());
            if (form.attr("id") == "loginplus-form-ldaplogin") {
                $(".l-popup-overlay, .l-popup-body").hide();
                formId = result.data.getParam("formId");
                if (formId) {
                    $("#" + formId).unbind("submit").die("submit");
                    $("#" + formId + " input[type=submit], button[type=submit]").die("click").unbind("click").click();
                } else {
                    if (result.data.getParam("url")) {
                        location.href = result.data.getParam("url");
                    } else {
                        location.reload();
                    }
                }
            } else {
                $('.b-popup-tabs li.itTab .filter').removeClass('filter-active');
                $('.b-popup-tabs li.itTab .filter .marker').hide();
                $('.b-popup-tabs li.itTab .filter').eq(0).addClass('filter-active');
                $('.b-popup-tabs li.itTab .filter').eq(0).find('.marker').show();
                $(".auth-form").remove();
                $(".inner2 .popup-powered").before(result.data.getOutput());
                App.notify.success(result.data.getMessage());
            }
        });
        return false;
    });
    
    /* Manual user email confirmation if service doesn't provide email */
    $("body").on("submit", "#loginplus-form-email", function (event) {
        var form = $(this),
            data = App.getFormParams($(this));
        form.find("#submit").attr("disabled", "disabled").addClass("disabled");
        form.find(".preloader").show();

        App.remote.post($(this).attr("action"), data, function (r) {
            var result = App.remote.parseResult(r);
            form.find("#submit").removeAttr("disabled").removeClass("disabled");
            $(".preloader").hide();

            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }

            $('.b-popup-tabs li.itTab').removeClass('selected');
            $('.b-popup-tabs li.itTab').eq(0).addClass('selected');
            $(".auth-form").remove();
            $(".inner2 .popup-powered").before(result.data.getOutput());
            App.notify.success(result.data.getMessage());

        });

        return false;
    });

    // @ROUTE: "response_add"
    if (App.route().is(['topic_add', 'topic_show']) && !App.isMobileTheme()) {
        /*
         If "anonymous_responses" is on, "sso_active_method" is "integration"
         and "sso_native_auth_disabled" is switched off - proceed user to make a choice
         to post response anonymously or go to external login.
         */
        if (App.getParam('confirmAddTopic')) {
            var wrapClass = '.wrap-container';
            if(App.route().is('topic_show')){
                wrapClass = '.mainArea';
            }
            var confirm = $('<div class="textCenter"></div>').appendTo(wrapClass),
                message = $('<p class="result-not-found"></p>')
                    .html(App.t('To proceed, please choose required action!'))
                    .appendTo(confirm),
                butLogin = $('<a class="button-medium-color" href="#login"></a>')
                    .css('margin-right', '10px')
                    .html(App.t('Login')).appendTo(confirm),
                butAnon  = $('<a class="button-medium-color" href="#anonymously"></a>')
                    .html(App.t('Anonymously')).appendTo(confirm);

            /* Login button "click" event */
            butLogin.on(App.event.click(), function (event) {
                location.href = App.getParam('ssoLoginUrl');
                event.preventDefault();
            });

            /* Specify form block according current route */
            var form = App.route().is('topic_add') ? $('#object-add') : $('div.leave-comment');

            /*
            Add "Leave Comment" button on proceed block and replace form on Response
            add page if Lock comments is not activated.
            */
            if (App.route().is('topic_show') && 0 < form.size()) {
                form.remove();
                butAnon.remove();
            }

            /* Anonymously button "click" event */
            if (App.route().is('topic_add')) {
                butAnon.on(App.event.click(), function (event) {
                    confirm.hide();
                    form.removeClass('hidden');
                    var guestLink = $('#submit_guest_link');
                    if ($('div.anonymous-block').is(':hidden')) {
                        guestLink.trigger('click');
                        $('#category_id').customSelect();
                        App.module.feedback.controllers.topic.add();

                        /* Prevent scrolling to anonymous email input */
                        $('html, body').stop();
                    }
                    /* Show proceed block again if user cancel anonymous response adding. */
                    guestLink.one(App.event.click(), function (event) {
                        form.addClass('hidden');
                        confirm.show();
                    });
                    event.preventDefault();
                });
            }

            /* Remove form and anonymous button if "anonymous_responses" is switched off. */
            if (!App.getParam('anonymouslyPosting')) {
                butAnon.remove();
                form.remove();
            }

            /* Don't display proceed block if form is visible (e.x: if form is submitted and has errors). */
            if (App.route().is('topic_add') && !form.hasClass('hidden')) {
                confirm.hide();
                butAnon.triggerHandler(App.event.click());
            }
        }
    }
});


/** File: application/3.0.2/modules/polls/assets/desktop/js/main.js **/

App.onReady(function () {

    var container = $('#poll_container');

    if (App.getParam('canVotePoll') == 0) {
        container.on(App.event.click(), '#vote_poll_submit', function () {
            App.openLoginPopup({'form_id': 'vote_polling'});
            return false;
        });
    }

    var openAddPopup = function (url) {
        App.dynamic.modal.openFromUrl({
            modal: {
                title: App.t("New Poll"),
                width: '600',
                shader: false,
                useCustomScroller: true,
                useWrapper: false
            },
            request: {
                url: url
            },
            complete: function (modal) {
                var modalBody = modal.getContent(true);

                modalBody.find('tbody').sortable({
                    handle: ".imove",
                    axis:   'y'
                });

                $('#expire_select').on('change', function () {
                    var expiresAt = $('#poll-expires-at-block');
                    if ($(this).val() == 'on_date') {
                        expiresAt.removeClass('hidden');
                    } else {
                        expiresAt.addClass('hidden');
                    }
                });

                modalBody.on(App.event.click(), 'input[name="display_in_topic"]', function () {
                    if ($(this).val() == 1) {
                        modalBody.find('.topic-selector').removeClass('hidden');
                    } else {
                        modalBody.find('.topic-selector').addClass('hidden');
                    }
                });

                var optionsWrapper = $('.options-wrapper');
                modalBody.on(App.event.click(), '.add-option', function () {
                    optionsWrapper.find('tr.option:last').after(
                        '<tr class="option">' + optionsWrapper.find('tr:first').html() + '</tr>'
                    );
                    return false;
                });
                optionsWrapper.on(App.event.click(), '.idelete', function () {
                    if (optionsWrapper.find('tr.option').length > 2) {
                        $(this).parents('tr:first').remove();
                    } else {
                        $(this).parents('tr:first').find('input').val('');
                    }
                    return false;
                });

                /* Form submit */
                modalBody.on("submit", 'form', function (e) {
                    e.preventDefault();
                    var form = $(this);

                    var required = form.find("input.required");

                    if (required.length && required.val().trim() == "") {
                        required.parent().addClass("error");
                        App.notify.error(App.t("Please fill in required fields"));
                        return false;
                    }

                    form.find('input[type=submit]').attr('disabled', 'disabled');
                    form.find('.preloader').css('margin-right', '10px').show();

                    App.remote.post(form.attr("action"), form.serialize(), function (r) {
                        var result = App.remote.parseResult(r);
                        if (result.data.isError()) {
                            App.notify.error(result.data.getMessage());
                            form.find('input[type=submit]').removeAttr('disabled');
                            form.find('.preloader').hide();
                            return false;
                        }
                        App.notify.success(result.data.getMessage());
                        App.dynamic.modal.close(modal.modal);
                        if ($('.polls-manage-element').length > 0) {
                            $('.filter-area').find('select:first').trigger('change');
                        }
                    });

                });
            }
        });
    };

    $("#poll_add_quick a, .poll_add").on(App.event.click(), function () {
        openAddPopup($(this).attr('href'));
        return false;
    });

    /* Ajax vote */
    container.on("submit", 'form', function (e) {
        e.preventDefault();
        var form = $(this);

        if (form.find('.variants input:checked').length == 0) {
            App.notify.error(App.t("Please select at least 1 option!"));
            return false;
        }

        form.find('input[type=submit]').attr('disabled', 'disabled');
        container.find('.poll_header .preloader').addClass('ico-small');

        App.remote.post(form.attr("action"), form.serialize(), function (r) {
            var result = App.remote.parseResult(r);
            container.find('.poll_header .preloader').removeClass('ico-small');
            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
            } else {
                container.find('.poll-results').html(result.data.getOutput());
                App.notify.success(result.data.getMessage());
                container.find('.preview-results').parents('.objects-filter.buttons').remove();
            }

            if (!App.auth().userIsLoggedIn() && App.getParam('canVotePoll') == 0) {
                location.reload(true);
            }
        });
    });

    container.on(App.event.click(), '.preview-results', function () {
        var button = $(this);
        if (button.hasClass('loading')) {
            return false;
        }
        button.addClass('loading');
        container.find('.poll_header .preloader').css('display', 'block');

        App.remote.get(button.attr('href'), null, function (r) {
            container.find('.poll_header .preloader').css('display', 'none');
            var result = App.remote.parseResult(r);
            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }
            button.addClass('preview-results-back')
                .removeClass('loading')
                .removeClass('preview-results')
                .data('back-data', container.find('.poll-results').html())
                .text(App.t('Back'));
            container.find('.poll-results').html(result.data.getOutput());
        });

        return false;
    });

    container.on(App.event.click(), '.preview-results-back', function () {
        var button = $(this);
        container.find('.poll-results').html(button.data('back-data'));
        button.addClass('preview-results')
            .removeClass('preview-results-back')
            .data('back-data', null)
            .text(App.t('View Results'));
        return false;
    });


    container.on(App.event.click(), '.slider-arrow', function () {
        var button = $(this);
        if (button.hasClass('loading')) {
            return false;
        }
        button.addClass('loading');
        container.find('.poll_header .preloader').addClass('ico-small');

        App.remote.get(button.attr('href'), null, function (r) {
            var result = App.remote.parseResult(r);
            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }
            container.html(result.data.getOutput());
        });

        return false;
    });

});

/** File: application/3.0.2/assets/desktop/js/global.js **/

window.App || (window.App = {});

if (typeof Widgets === "undefined") var Widgets = {};

if (typeof String.prototype.trim !== 'function') {
    String.prototype.trim = function () {
        return this.replace(/^\s+|\s+$/g, '');
    }
}

/**
 * Center block plugin
 *
 * @param options
 * @return {*}
 */
$.fn.centerInClient = function (options) {
    var opt = { forceAbsolute: false,
        container: window,
        completeHandler: null
    };
    $.extend(opt, options);

    return this.each(function (i) {
        var el = $(this);
        var jWin = $(opt.container);
        var isWin = opt.container == window;

        // force to the top of document to ENSURE that
        // document absolute positioning is available
        if (opt.forceAbsolute) {
            if (isWin)
                el.remove().appendTo("body");
            else
                el.remove().appendTo(jWin.get(0));
        }

        // have to make absolute
        el.css("position", "absolute");

        // height is off a bit so fudge it
        var heightFudge = isWin ? 2.0 : 1.8;

        var x = (isWin ? jWin.width() : jWin.outerWidth()) / 2 - el.outerWidth() / 2;
        var y = (isWin ? jWin.height() : jWin.outerHeight()) / heightFudge - el.outerHeight() / 2;

        el.css("left", x + jWin.scrollLeft());
        el.css("top", y + jWin.scrollTop());

        // if specified make callback and pass element
        if (opt.completeHandler)
            opt.completeHandler(this);
    });
};

App.switchGrayscale = function (element) {
    element = $(element);
    var _css = {
        filter: 'url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale")'
    };

    if ('none' == element.css('filter')) {
        element.css(_css);
    } else {
        element.css('filter', 'none');
    }
};

App.switchUnactive = function (element, action) {
    element = $(element);

    var _css = {
            backgroundColor: '#FFFFFF',
            bottom: 0,
            height: '100%',
            left: 0,
            margin: 0,
            padding: 0,
            position: 'absolute',
            right: 0,
            top: 0,
            width: '100%'
        },
        overflow = $('<div x-element="overflow"></div>').css(_css),
        existing = element.find('div[x-element="overflow"]'),
        has = function () {
            return existing.is('div');
        },
        show = function () {
            if (!has()) {
                element.append(overflow.fadeTo("fast", 0.6));
                App.switchGrayscale(element);
            }
        },
        hide = function () {
            if (has()) {
                existing.remove();
                App.switchGrayscale(element);
            }
        };

    if (action) {
        if ('show' === action) {
            show();
        } else if ('hide' === action) {
            hide();
        }
    } else {
        has() ? hide() : show();
    }
};

App.preloader = function (element, options) {
    element = $(element);
    if (!$.isPlainObject(options)) {
        options = {};
    }
    var defaults = {
            replace: true,
            loader_element: $('<i class="preloader">&nbsp;</i>'),
            loader_css: {
                display: 'inline-block',
                lineHeight: 'inherit',
                verticalAlign: 'bottom',
                margin: 0,
                padding: 0
            }
        },
        settings = $.extend(defaults, options);

    element.data('preloader', settings);

    return {
        _target: element,
        _loader: null,
        start: function () {
            this._loader = $(this._target.data('preloader').loader_element);
            this._target.after(this._loader);
            this._loader.css(this._target.data('preloader').loader_css);
            if (this._target.data('preloader').replace) {
                this._target.hide();
                this._loader.css('marginTop', this._target.css('marginTop'));
                this._loader.css('marginBottom', this._target.css('marginBottom'));
                this._loader.css('marginLeft', this._target.css('marginLeft'));
                this._loader.css('marginRight', this._target.css('marginRight'));
                if (this._target.width() < 16) {
                    this._loader.css('width', '16px');
                } else {
                    this._loader.css('width', this._target.width());
                }
            }
        },
        stop: function () {
            $('body').css('cursor', 'auto');
            try {
                if (this._target.next().is(this._loader)) {
                    this._loader.remove();
                    if (this._target.is(':hidden')) {
                        this._target.show();
                    }
                }
            } catch (e) {
            }
        }
    };
};

App.widgetCmd = function (cmd, params, callback) {
    if ('function' !== typeof callback) {
        callback = function (response) {
        };
    }

    App.remote.post({
        url: App.baseUrl('/admin/widget/cmd'),
        data: $.extend(params, {'cmd': cmd}),
        success: function (response) {
            callback(response);
        },
        error: function (response) {
            callback(response);
        }
    });
};

App.sysCmd = function (cmd, params, callback) {
    if ('function' !== typeof callback) {
        callback = function (response) {
        };
    }

    App.remote.post({
        url: App.baseUrl('/syscmd'),
        data: $.extend(params, {'cmd': cmd}),
        success: function (response) {
            callback(response);
        },
        error: function (response) {
            callback(response);
        }
    });
};

App.notify = {
    error: function (message) {
        App.notify.show('error', message)
    },

    success: function (message) {
        App.notify.show('success', message)
    },

    info: function (message) {
        App.notify.show('info', message)
    },

    show: function (type, message) {
        switch (type) {
            case 'error':
                _subClass = 'success-notification error-notification';
                break;
            case 'success':
                _subClass = 'success-notification';
                break;
            case 'info':
                _subClass = 'success-notification';
                break;
        }
        $(".success-notification").hide();
        newDate = new Date;
        id = 'message_' + newDate.getTime();
        html = '<div id="' + id + '" class="' + _subClass + '"><div class="inner">' + message + '</div></div>';
        $('body').append(html);
        setTimeout(function () {
            $("#" + id).fadeOut()
        }, 3000);
    }
};

App.getFormParams = function (form) {
    data = {};
    i = 0;
    form.find("input, textarea, select").each(function () {
        name = $(this).attr("name");
        if (name != undefined) {
            if (($(this).attr("type") != "checkbox"
                && $(this).attr("type") != "radio")
                || ($(this).attr("type") == "radio"
                && $(this).is(":checked"))
                || ($(this).attr("type") == "checkbox"
                && $(this).is(":checked"))) {

                if (name.match(/\[\]$/)) {
                    name = name.match(/.*[^\[\]]/);
                    if (!data[name]) {
                        data[name] = {};
                    }
                    data[name][i] = $(this).val();
                    i++;
                } else {
                    data[name] = $(this).val();
                }
            }
        }
    });
    return data;
}

App.get_gravatar = function (email, size) {
    // MD5 (Message-Digest Algorithm) by WebToolkit
    // http://www.webtoolkit.info/javascript-md5.html
    var MD5 = function (s) {
        function L(k, d) {
            return(k << d) | (k >>> (32 - d))
        }

        function K(G, k) {
            var I, d, F, H, x;
            F = (G & 2147483648);
            H = (k & 2147483648);
            I = (G & 1073741824);
            d = (k & 1073741824);
            x = (G & 1073741823) + (k & 1073741823);
            if (I & d) {
                return(x ^ 2147483648 ^ F ^ H)
            }
            if (I | d) {
                if (x & 1073741824) {
                    return(x ^ 3221225472 ^ F ^ H)
                } else {
                    return(x ^ 1073741824 ^ F ^ H)
                }
            } else {
                return(x ^ F ^ H)
            }
        }

        function r(d, F, k) {
            return(d & F) | ((~d) & k)
        }

        function q(d, F, k) {
            return(d & k) | (F & (~k))
        }

        function p(d, F, k) {
            return(d ^ F ^ k)
        }

        function n(d, F, k) {
            return(F ^ (d | (~k)))
        }

        function u(G, F, aa, Z, k, H, I) {
            G = K(G, K(K(r(F, aa, Z), k), I));
            return K(L(G, H), F)
        }

        function f(G, F, aa, Z, k, H, I) {
            G = K(G, K(K(q(F, aa, Z), k), I));
            return K(L(G, H), F)
        }

        function D(G, F, aa, Z, k, H, I) {
            G = K(G, K(K(p(F, aa, Z), k), I));
            return K(L(G, H), F)
        }

        function t(G, F, aa, Z, k, H, I) {
            G = K(G, K(K(n(F, aa, Z), k), I));
            return K(L(G, H), F)
        }

        function e(G) {
            var Z;
            var F = G.length;
            var x = F + 8;
            var k = (x - (x % 64)) / 64;
            var I = (k + 1) * 16;
            var aa = Array(I - 1);
            var d = 0;
            var H = 0;
            while (H < F) {
                Z = (H - (H % 4)) / 4;
                d = (H % 4) * 8;
                aa[Z] = (aa[Z] | (G.charCodeAt(H) << d));
                H++
            }
            Z = (H - (H % 4)) / 4;
            d = (H % 4) * 8;
            aa[Z] = aa[Z] | (128 << d);
            aa[I - 2] = F << 3;
            aa[I - 1] = F >>> 29;
            return aa
        }

        function B(x) {
            var k = "", F = "", G, d;
            for (d = 0; d <= 3; d++) {
                G = (x >>> (d * 8)) & 255;
                F = "0" + G.toString(16);
                k = k + F.substr(F.length - 2, 2)
            }
            return k
        }

        function J(k) {
            k = k.replace(/\r\n/g, "\n");
            var d = "";
            for (var F = 0; F < k.length; F++) {
                var x = k.charCodeAt(F);
                if (x < 128) {
                    d += String.fromCharCode(x)
                } else {
                    if ((x > 127) && (x < 2048)) {
                        d += String.fromCharCode((x >> 6) | 192);
                        d += String.fromCharCode((x & 63) | 128)
                    } else {
                        d += String.fromCharCode((x >> 12) | 224);
                        d += String.fromCharCode(((x >> 6) & 63) | 128);
                        d += String.fromCharCode((x & 63) | 128)
                    }
                }
            }
            return d
        }

        var C = Array();
        var P, h, E, v, g, Y, X, W, V;
        var S = 7, Q = 12, N = 17, M = 22;
        var A = 5, z = 9, y = 14, w = 20;
        var o = 4, m = 11, l = 16, j = 23;
        var U = 6, T = 10, R = 15, O = 21;
        s = J(s);
        C = e(s);
        Y = 1732584193;
        X = 4023233417;
        W = 2562383102;
        V = 271733878;
        for (P = 0; P < C.length; P += 16) {
            h = Y;
            E = X;
            v = W;
            g = V;
            Y = u(Y, X, W, V, C[P + 0], S, 3614090360);
            V = u(V, Y, X, W, C[P + 1], Q, 3905402710);
            W = u(W, V, Y, X, C[P + 2], N, 606105819);
            X = u(X, W, V, Y, C[P + 3], M, 3250441966);
            Y = u(Y, X, W, V, C[P + 4], S, 4118548399);
            V = u(V, Y, X, W, C[P + 5], Q, 1200080426);
            W = u(W, V, Y, X, C[P + 6], N, 2821735955);
            X = u(X, W, V, Y, C[P + 7], M, 4249261313);
            Y = u(Y, X, W, V, C[P + 8], S, 1770035416);
            V = u(V, Y, X, W, C[P + 9], Q, 2336552879);
            W = u(W, V, Y, X, C[P + 10], N, 4294925233);
            X = u(X, W, V, Y, C[P + 11], M, 2304563134);
            Y = u(Y, X, W, V, C[P + 12], S, 1804603682);
            V = u(V, Y, X, W, C[P + 13], Q, 4254626195);
            W = u(W, V, Y, X, C[P + 14], N, 2792965006);
            X = u(X, W, V, Y, C[P + 15], M, 1236535329);
            Y = f(Y, X, W, V, C[P + 1], A, 4129170786);
            V = f(V, Y, X, W, C[P + 6], z, 3225465664);
            W = f(W, V, Y, X, C[P + 11], y, 643717713);
            X = f(X, W, V, Y, C[P + 0], w, 3921069994);
            Y = f(Y, X, W, V, C[P + 5], A, 3593408605);
            V = f(V, Y, X, W, C[P + 10], z, 38016083);
            W = f(W, V, Y, X, C[P + 15], y, 3634488961);
            X = f(X, W, V, Y, C[P + 4], w, 3889429448);
            Y = f(Y, X, W, V, C[P + 9], A, 568446438);
            V = f(V, Y, X, W, C[P + 14], z, 3275163606);
            W = f(W, V, Y, X, C[P + 3], y, 4107603335);
            X = f(X, W, V, Y, C[P + 8], w, 1163531501);
            Y = f(Y, X, W, V, C[P + 13], A, 2850285829);
            V = f(V, Y, X, W, C[P + 2], z, 4243563512);
            W = f(W, V, Y, X, C[P + 7], y, 1735328473);
            X = f(X, W, V, Y, C[P + 12], w, 2368359562);
            Y = D(Y, X, W, V, C[P + 5], o, 4294588738);
            V = D(V, Y, X, W, C[P + 8], m, 2272392833);
            W = D(W, V, Y, X, C[P + 11], l, 1839030562);
            X = D(X, W, V, Y, C[P + 14], j, 4259657740);
            Y = D(Y, X, W, V, C[P + 1], o, 2763975236);
            V = D(V, Y, X, W, C[P + 4], m, 1272893353);
            W = D(W, V, Y, X, C[P + 7], l, 4139469664);
            X = D(X, W, V, Y, C[P + 10], j, 3200236656);
            Y = D(Y, X, W, V, C[P + 13], o, 681279174);
            V = D(V, Y, X, W, C[P + 0], m, 3936430074);
            W = D(W, V, Y, X, C[P + 3], l, 3572445317);
            X = D(X, W, V, Y, C[P + 6], j, 76029189);
            Y = D(Y, X, W, V, C[P + 9], o, 3654602809);
            V = D(V, Y, X, W, C[P + 12], m, 3873151461);
            W = D(W, V, Y, X, C[P + 15], l, 530742520);
            X = D(X, W, V, Y, C[P + 2], j, 3299628645);
            Y = t(Y, X, W, V, C[P + 0], U, 4096336452);
            V = t(V, Y, X, W, C[P + 7], T, 1126891415);
            W = t(W, V, Y, X, C[P + 14], R, 2878612391);
            X = t(X, W, V, Y, C[P + 5], O, 4237533241);
            Y = t(Y, X, W, V, C[P + 12], U, 1700485571);
            V = t(V, Y, X, W, C[P + 3], T, 2399980690);
            W = t(W, V, Y, X, C[P + 10], R, 4293915773);
            X = t(X, W, V, Y, C[P + 1], O, 2240044497);
            Y = t(Y, X, W, V, C[P + 8], U, 1873313359);
            V = t(V, Y, X, W, C[P + 15], T, 4264355552);
            W = t(W, V, Y, X, C[P + 6], R, 2734768916);
            X = t(X, W, V, Y, C[P + 13], O, 1309151649);
            Y = t(Y, X, W, V, C[P + 4], U, 4149444226);
            V = t(V, Y, X, W, C[P + 11], T, 3174756917);
            W = t(W, V, Y, X, C[P + 2], R, 718787259);
            X = t(X, W, V, Y, C[P + 9], O, 3951481745);
            Y = K(Y, h);
            X = K(X, E);
            W = K(W, v);
            V = K(V, g)
        }
        var i = B(Y) + B(X) + B(W) + B(V);
        return i.toLowerCase()
    };
    var size = size || 50;
    return 'http://www.gravatar.com/avatar/' + MD5(email) + '.jpg?s=' + size;
}

/* Secure requests */
App.initSecurity = function () {
    App.remote.post(App.baseUrl('/security'), {}, function (response) {
        var result = App.remote.parseResult(response);
    });
};

/* Login/Registration popup */
App.authModal = null;

/**
 * Login popup.
 *
 * @param object params
 */
App.openLoginPopup = function (params) {

    if (!params) params = {};
    /* if 'OneLogin' method is enabled and only it can use for login */
    if (App.getParam('hrefRedirectLogin')) {
        window.location.href = App.getParam('hrefRedirectLogin');
        return;
    }
    var defaults = {
            title: 'Login Form',
            activeTab: 'form-login',
            redirect: null,
            url: null,
            ajaxPostHref: null
        },
        settings = $.extend({}, defaults, params),
        filterParams = function () {
            var filtered = {};
            for (key in settings) {
                if (!(key in defaults)) {
                    filtered[key] = settings[key];
                }
            }
            return filtered;
        };

    if (App.auth().userIsLoggedIn()) {
        App.notify.error(App.t('You are already logged in!'));
    }

    App.authModal = App.dynamic.modal.openFromUrl({
        modal: {
            title: App.t(settings.title),
            width: '500',
            shader: false,
            useCustomScroller: true,
            useWrapper: false
        },

        request: {
            url: App.baseUrl('/loginform')
        },

        complete: function (modal) {
            var modalBody = modal.getContent(true),
                tabs = modalBody.find('.modal-tabs li'),
                forms = modalBody.find('.auth-form form');

            forms.each(function () {
                $(this).find(".hidden-params").remove();
                for (key in filterParams()) {
                    $(this).append("<input class='hidden-params' type='hidden' name='" + key + "' value='" + settings[key] + "' />");
                }
            });

            modalBody.find('a').each(function () {
                var href = location.protocol + '//' + location.hostname + this.pathname;
                if (!$(this).attr('href').match('sso_redirect')) {
                    var urlQuery = $.param(filterParams());
                    if ('' != urlQuery) {
                        urlQuery = '?' + urlQuery;
                    }
                    $(this).attr("href", href + urlQuery);
                }
            });

            /* Tabs onClick */
            /** @event click */
            tabs.on(App.event.click(), function (e) {
                /* if 'OneLogin' method is enabled */
                if (e.target.nodeName === 'A' && !e.target.parentNode.getAttribute("rel").length) {
                    return true;
                }
                e.preventDefault();
                var rel_tab = $(this).attr('rel');
                tabs.removeClass('active');

                modalBody.find('div.auth-form > div:visible').hide();
                $('#' + rel_tab).show();

                $(this).addClass('active');
                //App.authModal.setTitle($(this).attr('title') + ' ' + App.t('Form'));
            });

            /* Forgot password onClick */
            /** @event click */
            modalBody.find('a.forgotPass').on(App.event.click(), function (e) {
                e.preventDefault();
                tabs.removeClass('active');

                modalBody.find('div.auth-form > div:visible').hide();
                $('#form-forgotpassword').show();

                App.authModal.setTitle(App.t('Forgot Password'));
            });

            /* Social login */
            (function () {
                $('.tooltip').powerTip({ placement: 'n', smartPlacement: true });
                var getHref = function (element) {
                    var url = $(element).attr('href');
                    if (!$.browser.msie) {
                        return url;
                    }
                    if (7 <= parseInt($.browser.version, 10)) {
                        return url.replace('login-oauth', '/login-oauth');
                    }
                    return url.replace('login-oauth', '/login-oauth');
                };

                var getCoords = function (width, height) {
                    return {
                        'left'   : Math.round(window.screen.width / 2 - width / 2),
                        'top'    : Math.round(window.screen.height / 2 - height / 2),
                        'width'  : width,
                        'height' : height
                    };
                };

                /* Login using Twitter */
                var twitterButton = $("#twitter-button");
                if (twitterButton.length > 0) {
                    /** @event click */
                    var coords = getCoords(560, 700);
                    twitterButton.on(App.event.click(), function () {
                        window.open(getHref(this), 'social_login', 'width='+coords.width+',height='+coords.height+',left='+coords.left+',top='+coords.top);
                        return false;
                    });
                }

                /* Login using Facebook */
                /** @event click */
                $("#facebook-button, #google-button").on(App.event.click(), function (event) {
                    var coords = getCoords(900, 540);
                    window.open(getHref(this), 'social_login', 'width='+coords.width+',height='+coords.height+',left='+coords.left+',top='+coords.top);
                    return false;
                });
            })();

            /* Choose active tab */
            /** @trigger click */
            tabs.filter('[rel=' + settings.activeTab + ']').trigger('click');

            if (settings.forgotPassword != undefined) {
                modalBody.find('.forgotPass:first').trigger(App.event.click());
            }

            /* Make security request */
            App.initSecurity();

            /* Forms submission */
            /** @event submit */
            $("#system-form-registration, #system-form-login,  #system-form-passwordforgot, #sso-form-ldaplogin").on('submit', function (e) {
                e.preventDefault();
                var form = $(this),
                    submitButton = form.find("input[type=submit]");

                var emptyError = false;
                var emailError = false;
                form.find("input.required").removeClass('error').each(function () {
                    var validOne = $(this).val().trim() != '';

                    if (validOne) {
                        if ($(this).attr('name') == 'email') {
                            var pattern = /^[\w.\-_]+@[\w.\-_]+$/;
                            if (!pattern.test($(this).val().trim())) {
                                emailError = true;
                                validOne = false;
                            }
                        }
                    } else {
                        emptyError = true;
                    }

                    if (!validOne) {
                        $(this).addClass('error');
                    }
                });

                if (emptyError || emailError) {
                    var message = '';
                    if (emptyError) {
                        message = App.t("Please fill in required fields");
                    }
                    if (emptyError && emailError) {
                        message += '<br />';
                    }
                    if (emailError) {
                        message += App.t("Email is incorrect!");
                    }
                    App.notify.error(message);
                    return false;
                }

                if ("system-form-registration" === form.attr("id")) {
                    var regAssign = form.find('#assign'),
                        dataToHash = form.find('#full_name').val() + form.find('#registration-email').val();
                    regAssign.val(App.utils.md5(dataToHash).split('').reverse().join(''));
                }

                submitButton.toggleDisable();
                var preloader = form.find(".preloader");
                preloader.show();
                var data = App.getFormParams(form);
                data['resolution'] = window.screen.availWidth + 'x' + window.screen.availHeight;
                App.remote.post(form.attr("action"), data, function (r) {
                    submitButton.toggleDisable();
                    preloader.hide();
                    var result = App.remote.parseResult(r);

                    if (result.data.isError()) {
                        form.find("#csrf").val(result.data.getParam("csrfhash"));
                        App.notify.error(result.data.getMessage());
                        return false;
                    }

                    var afterSuccess = function () {
                        if (form.attr("id") == "system-form-login" || form.attr("id") == "sso-form-ldaplogin") {
                            $(".l-popup-body, .l-popup-overlay").hide();
                            var formId = result.data.getParam("formId");
                            if (formId) {
                                App.addParam('login.submit', 1);
                                $("#" + formId).submit();
                            } else {
                                if (result.data.getParam("url") || settings.redirect) {
                                    location.href = settings.redirect ? settings.redirect : result.data.getParam("url");
                                } else {
                                    location.reload();
                                }
                            }
                        } else {
                            /** @trigger click */
                            tabs.filter('[rel=form-login]').trigger('click');
                            $("#login-email").val(result.data.getParam('email'));
                            $("#password").val("");
                            App.notify.success(result.data.getMessage());
                        }
                    }

                    if (settings.ajaxPostHref) {
                        App.remote.post(settings.ajaxPostHref, null, function (r) {
                            var result = App.remote.parseResult(r);
                            if (result.data.isError()) {
                                App.notify.error(result.data.getMessage());
                                return false;
                            }
                            afterSuccess();
                        });
                    } else {
                        afterSuccess();
                    }
                });
            });
        }
    });
};

App.baseUrl = function (path) {
    var url = App.config.basePath;
    url = url.trim().replace(/\/$/, "").trim();
    if (path != void 0) {
        path = path.trim().replace(/^\//, "").trim();
    } else {
        path = '';
    }
    return  url + "/" + path;
}

App.initMemberTopBar = function () {
    /* Make Top Bar always visible and on top */
    $('body').css({
        marginTop: '40px'
    });
};

App.initGuestTopBar = function () {
    (function ($) {
        $.fn.MovetoTop = function (options) {

            var defaults = {
                    //min: 200,
                    containerID: 'top-bar',
                    scrollSpeed: 200,
                    easingType: 'linear'
                },
                settings = $.extend(defaults, options),
                containerIDhash = '#' + settings.containerID;

            //$(containerIDhash).on('click.UItoTop',function(){
            $(".toTop").click(function () {
                $('html, body').animate({scrollTop: 0}, settings.scrollSpeed, settings.easingType);
                return false;
            });

            $(window).scroll(function () {
                var topPos = $('.all').position(),
                    sd = $(window).scrollTop();


                if (sd > topPos.top) {
                    $(containerIDhash).show();
                    //$(containerIDhash).slideDown(settings.inDelay);
                } else {
                    $(containerIDhash).hide();
                }//$(containerIDhash).slideUp(settings.inDelay);
            });
        };
    })(jQuery);

    /* Execute self */
    $(document).ready(function () {
        $().MovetoTop();
    });
};

App.translite = function (text) {
    var L = {
            '': 'A', '': 'a', '': 'B', '': 'b', '': 'V', '': 'v', '': 'G', '': 'g',
            '': 'D', '': 'd', '': 'E', '': 'e', '': 'Yo', '': 'yo', '': 'Zh', '': 'zh',
            '': 'Z', '': 'z', '': 'I', '': 'i', '': 'Y', '': 'y', '': 'K', '': 'k',
            '': 'L', '': 'l', '': 'M', '': 'm', '': 'N', '': 'n', '': 'O', '': 'o',
            '': 'P', '': 'p', '': 'R', '': 'r', '': 'S', '': 's', '': 'T', '': 't',
            '': 'U', '': 'u', '': 'F', '': 'f', '': 'Kh', '': 'kh', '': 'Ts', '': 'ts',
            '': 'Ch', '': 'ch', '': 'Sh', '': 'sh', '': 'Sch', '': 'sch', '': '"', '': '"',
            '': 'Y', '': 'y', '': "'", '': "'", '': 'E', '': 'e', '': 'Yu', '': 'yu',
            '': 'Ya', '': 'ya'
        },
        r = '',
        k;
    for (k in L) r += k;
    r = new RegExp('[' + r + ']', 'g');
    k = function (a) {
        return a in L ? L[a] : '';
    };
    text = text.replace(r, k);
    return text;
};

App.slugify = function (str, spaceDivider) {
    str = App.translite(str);
    str = str.replace(/^\s+|\s+$/g, ''); // trim
    str = str.toLowerCase();

    // remove accents, swap ? for n, etc
    var from = "?????????????????????????/_,:;";
    var to = "aaaaaeeeeeiiiiooooouuuunc------";
    for (var i = 0, l = from.length; i < l; i++) {
        str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i));
    }

    str = str.replace(/[^a-z0-9 -]/g, '') // remove invalid chars
        .replace(/\s+/g, '-') // collapse whitespace and replace by -
        .replace(/-+/g, '-'); // collapse dashes

    if (spaceDivider) {
        str = str.replace(/-/gi, spaceDivider);
    }

    return str;
};

App.scrollMassEdit = function (sidebarArea, topPos, div_class) {
    $(window).scroll(function () {
        var top = $(document).scrollTop(),
            pip = $('.footer').offset().top - 90,
            height = $('.' + div_class).outerHeight(),
            window_height = $(window).innerHeight();

        if (div_class == 'ctrl-help') {
            var width_ctrl = sidebarArea.width();
            $('.' + div_class).width(width_ctrl);
        }

        if (window_height > height + 50 && $('.mainArea').outerHeight() > sidebarArea.outerHeight()) {
            if (top > topPos && top < (pip - height)) {
                $('.' + div_class).addClass('fixed').removeClass("absolute");
            }
            else if (top >= (pip - height)) {
                $('.' + div_class).removeClass('fixed').addClass('absolute');
            }
            else {
                $('.' + div_class).removeClass('fixed').removeClass('absolute');
            }
        }
    });
};

App.manageResponsible = function (template, successCallback) {
    $('.wrap-container').on(App.event.click(), '.object_manage_responsible', function (e) {
        e.preventDefault();

        var href = $(this).attr('href');

        App.dynamic.modal.openFromUrl({
            modal: {
                title: App.t('Manage Responsible'),
                width: '500',
                shader: false,
                useCustomScroller: true,
                useWrapper: false
            },

            request: {
                url: href
            },

            complete: function (modal) {
                var content = modal.getContent(true),
                    submit = $('#submit_responsible'),
                    preloader = content.find('.preloader'),
                    options = content.find('input[type="radio"]'),
                    responsibleId = options.filter(':checked').val();

                options.on('change', function (event) {
                    responsibleId = $(this).val();
                });

                submit.on(App.event.click(), function (event) {
                    $(this).attr('disabled', 'disabled');
                    preloader.show();

                    App.remote.post({
                        url: href + '/edit',
                        data: {responsible: responsibleId, template: template},
                        success: function (response) {
                            App.notify.success(response.data.getMessage());
                            successCallback(response);
                            modal.close();
                        },
                        complete: function (response) {
                            preloader.hide();
                        },
                        error: function (response) {
                            App.notify.error(response.data.getMessage());
                        }
                    });
                });
            }
        });
    });
}

$(document).ready(function () {

    /* Member Options */
    function ShowHidePassword(id) {
        var element = document.getElementById(id);
        if (element.type == 'password') {
            element.type = 'text';
        }
        else {
            element.type = 'password';
        }
    }

    $("a.user-setting, #user_avatar").openFromUrl(function (modal) {
        var modalBody = modal.getContent(true),
            form = modalBody.find('form');

        var checkVisibility = function (radio) {
            var _r = (!arguments.length) ? modalBody.find(':radio') : radio;
            _r.each(function () {
                if ($(this).attr('checked') === 'checked') {
                    var label = $(this).closest('label');
                    label.siblings("div").addClass("hidden").find('input').attr('disabled', true);
                    label.next().removeClass("hidden").find('input').attr('disabled', false);
                }
            });
        };
        modalBody.on("change", ":radio", function () {
            checkVisibility($(this));
        });
        checkVisibility();

        modalBody.uploadImage(50, function (encodeName) {
            var submit = $(this).find('#submit'),
                preloader = modalBody.find(".preloader"),
                emailError = false;

            var pattern = /^[\w.\-_]+@[\w.\-_]+$/;
            var userEmail = $('#email');
            var gravatarEmail = $('#gravatar_email');
            if (userEmail.length > 0) {
                if (!pattern.test(userEmail.val().trim())) {
                    userEmail.addClass('error');
                    emailError = true;
                } else {
                    userEmail.removeClass('error');
                }
            }
            if (form.find('input[name="photo_types"]:checked').val() == 'gravatar_email') {
                if (!pattern.test(gravatarEmail.val().trim())) {
                    gravatarEmail.addClass('error');
                    emailError = true;
                } else {
                    gravatarEmail.removeClass('error');
                }
            }

            if (emailError) {
                App.notify.error(App.t("Email is incorrect!"));
                preloader.remove();
                submit.removeAttr('disabled');
                return false;
            }

            var photo = $('#preview-uploaded-img');
            form.find('input[name="has_photo"]').val(
                (photo.length > 0 && photo.is(':visible') ? 1 : 0)
            );
            var _values = form.serializeArray();
            if (encodeName) {
                _values.push({
                    name: "avatar",
                    value: typeof encodeName == 'object' && encodeName.base_name != undefined ? encodeName.base_name : encodeName
                });
            }
            App.remote.post(form.attr("action"), _values, function (r) {
                preloader.remove();
                var result = App.remote.parseResult(r);
                if (result.data.isError()) {
                    submit.toggleDisable();
                    App.notify.error(result.data.getMessage());
                    return false;
                }
                App.notify.success(result.data.getMessage());
                if (document.getElementsByClassName('employee-avatar')[0] != undefined) {
                    document.getElementsByClassName('employee-avatar')[0].src = result.data.getParam('x128');
                }
                if (result.data.getParam('x50') && document.getElementsByClassName('avatar')[0] != undefined) {
                    document.getElementsByClassName('avatar')[0].src = result.data.getParam('x50');
                }
                var userName = result.data.getParam('user_name');
                var userShortName = result.data.getParam('user_short_name');
                if (userName) {
                    $('.profile-card .user-name span').text(userName);
                }
                if (userShortName) {
                    $('.members-area .user-info span.name').text(userShortName);
                }
                App.dynamic.modal.close(modal.modal);
            });
        });
    });

    $('.api-setting').openFromUrl(function (modal) {
        var modalBody = modal.getContent(true);

        modalBody.find('.regenerate-api-key').powerTip({ placement: 'n', smartPlacement: true });

        modalBody.on(App.event.click(), '#reset_api_key', function (e) {
            e.preventDefault();

            App.remote.get(
                {
                    url: $(this).attr('href'),
                    success: function (response) {
                        modalBody.find('#api-key').text(response.data.getParam('new_api'));
                        App.notify.success(response.data.getMessage());
                    },
                    error: function (response) {
                        App.notify.error(response.data.getMessage());
                    }
                }
            );
        });

        modalBody.on(App.event.click(), 'input.toggle_api_status', function (e) {
            var input = $(this);
            var apiKey = $('#api-key');
            if (apiKey.attr('api-status') == input.val() && apiKey.attr('api-status') != 'loading') {
                return;
            }
            apiKey.attr('api-status', 'loading');
            modalBody.find('.preloader').show();
            modalBody.find('.irefresh').hide();
            App.remote.get({
                url: input.attr('href'),
                success: function (response) {
                    apiKey.attr('api-status', input.val());
                    modalBody.find('.preloader').hide();
                    modalBody.find('.irefresh').show();
                    App.notify.success(response.data.getMessage());
                    modalBody.find('.api-status').text(App.t(response.data.getParam("api_status")));
                    modalBody.find('#api-key').text(response.data.getParam('api_key'));
                },
                error: function (response) {
                    App.notify.error(response.data.getMessage());
                }
            });
        });

        modalBody.on(App.event.click(), 'a.regenerate-api-key', function (e) {
            var link = $(this);
            var apiKey = $('#api-key');
            modalBody.find('.preloader').show();
            link.hide();
            App.remote.get({
                url: link.attr('href'),
                success: function (response) {
                    apiKey.text(response.data.getParam("api_key"));
                    modalBody.find('.preloader').hide();
                    link.show();
                    App.notify.success(response.data.getMessage());
                },
                error: function (response) {
                    App.notify.error(response.data.getMessage());
                }
            });
            return false;
        });
    });

    $(".change-password").openFromUrl(function (modal) {
        var modalBody = modal.getContent(true);

        modalBody.on(App.event.click(), '.show-password', function () {
            $('.show-password').toggleClass('active');
            ShowHidePassword('password');
            ShowHidePassword('password_again');
        });

        modalBody.on("submit", 'form', function (e) {
            e.preventDefault();
            var form = $(this);
            var required = form.find("input.required");

            if (required.length && required.val().trim() == "") {
                required.parent().addClass("error");
                App.notify.error(App.t("Please fill in required fields"));
                return false;
            }

            form.find('input[type=submit]').attr('disabled', 'disabled');
            form.find('.preloader').css('margin-right', '10px').show();

            App.remote.post(form.attr("action"), form.serialize(), function (r) {
                var result = App.remote.parseResult(r);
                form.find('input[type=submit]').removeAttr('disabled');
                form.find('.preloader').hide();
                if (result.data.isError()) {
                    App.notify.error(result.data.getMessage());
                    return false;
                }
                App.notify.success(result.data.getMessage());
                App.dynamic.modal.close(modal.modal);
            });
        });
    });

    /* Top navigation */
    if ($('#top_navigation').length) {
        $.topNavScroll();
    }

    $(".disclosure").on(App.event.click(), function () {
        $(this).toggleClass('opened');
        $(this).next().toggle();
    });

    var toTopResize = function () {
        var window_width = $(window).width();
        var main_width = $('#main').width();
        var top_right = (window_width - main_width) / 4;

        if ($('a.toTop').width() < top_right && $(window).scrollTop() != "0") {
            $('a.toTop').css({'display': 'block', 'right': top_right + 'px'});
        } else {
            $('a.toTop').hide();
        }
    };

    if ($(document).height() > $(window).height()) {
        toTopResize();
    }

    $(window).resize(function () {
        toTopResize();
    });

    $(window).scroll(function () {
        toTopResize();
    });

    /* Error fields */
    $('body').on('focus keyup change ' + App.event.click(),
        'input.error, textarea.error, select.error',
        function (event) {
            $(this).removeClass('error');
        });

    /* Top bar */
    $('a.toTop').on(App.event.click(), function (event) {
        App.utils.scrollTo('html');
        event.preventDefault();
    });

    var topBarNav = $('ul.top-bar-nav > li');
    $.each(topBarNav, function (liIdx, li) {
        return;
        var badge = $(li).children('a').find('span.badge'),
            subNav = $(li).has('ul.sub-menu').find('li');

        badge.text(0);

        $.each(subNav, function (subIdx, subLi) {
            var subBadge = $(subLi).find('a > span.badge'),
                subBadgeVal = parseInt(subBadge.text());

            if (subBadge.is('span') && subBadgeVal > 0) {
                badge.text(parseInt(badge.text()) + subBadgeVal);
            }
        });

        if (parseInt(badge.text()) > 0) badge.css('display', 'inline-block');
        else badge.css('display', 'none');
    });

    $('.wrap-container').hover(function () {
        $('.openSub').removeClass('openSub');
        $('.overlay-subNav').remove();
        $('.sub-nav').hide();
    });

    /* Login link handler */
    $('.login-popup').on(App.event.click(), function (e) {
        e.preventDefault();
        App.openLoginPopup({
            title: 'Login Form',
            activeTab: 'form-login',
            get: {},
            redirect: document.location.href,
        });
        return false;
    });

    var registrationForm = function () {
        App.openLoginPopup({
            title: 'Register Form',
            activeTab: 'form-registration',
            get: {},
            redirect: document.location.href
        });
    };

    /* Registration link handler */
    $('.register-popup').on(App.event.click(), function (e) {
        e.preventDefault();
        registrationForm();
        return false;
    });

    if (App.getParam('openRegistrationForm', 0) == 1) {
        registrationForm();
    }

    $("form.resources-form-search").submit(function () {
        var searchField = $(this).find("input[name=text]"),
        // Search form slashes replacement
            searchVal = searchField.val().replace('/', '-').replace('\\', '-');
        if (searchVal.trim().length == 0) {
            searchField.addClass('error');
        } else {
            location.href = App.baseUrl("search/" + encodeURIComponent(searchVal));
        }
        return false;
    });

    /* Member Area */
    $(document).on(App.event.click(), function () {
        $('.members-area').removeClass('active');
    });

    $('.members-area .ddArrow').on(App.event.click(), function () {
        $('.members-area').toggleClass('active');
        return false;
    });

    /* Search Form */
//    $("form#search-form input#search").focus(function () {
//        if ($(this).val() == App.t('Search')) {
//            $(this).val('');
//        }
//    }).blur(function () {
//        if ($(this).val() == '') {
//            $(this).val(App.t('Search'));
//        }
//    });

    $(".success-notification").live('click', function () {
        $(this).fadeOut();
    });

    /* Select new roles */
    $('.table-col-line label').live("click", function () {
        var chkBox = $(this).parent().find('input[type=checkbox]');
        if ($(chkBox).attr('checked') == 'checked') {
            $(this).addClass('active');
        } else {
            $(this).removeClass('active');
        }
    });

    /* Check if field is required */
//    $('body').on("submit", 'form',  function(e) {
//        $(this).find(".require").removeClass("error");
//        var form = $(this);
//        var fields = form.find(".require input, .require textarea, .required select");
//        if (fields.length) {
//            var error = false;
//            fields.each(function(){
//                if ($(this).val().trim() == "") {
//                    $(this).parent().addClass("error");
//                    error = true;
//                }
//                if($(this).val() == 0){
//                    form.find(".ddcommon[id^="+$(this).attr("id")+"]").addClass("error");
//                    error = true;
//                }
//            });
//            if (error) {
//                App.notify.error(App.t("Please fill in required fields"));
//                e.stopImmediatePropagation();
//                return false;
//            }
//        }
//    });

    /* Select / Deselect Responses */
    $('.responses-table tr td input, .checkTopic input').live("click", function () {
        if ($(this).is(':checked')) {
            $(this).parent().parent().addClass('active');
        } else {
            $(this).parent().parent().removeClass('active');
        }
    });

    /* Select / Deselect all Responses in table */
    $('.responses-table tr th input').live("click", function () {
        if ($(this).is(':checked')) {
            $('.responses-table tr td input').attr('checked', 'checked').parent().parent().addClass('active');
        } else {
            $('.responses-table tr td input').removeAttr('checked').parent().parent().removeClass('active');
        }
    });

    /* Form input type file */
    $("body").on('change', 'div.element-upload input[type=file]', function () {
        filename = this.value.replace(/^.*[\/\\]/g, "");
        $(this).parent().find("input[type=text]").val(filename);
    });

    var searchWrapWidth;
    $('#top-bar div.search-block-wrap').on('focus', 'input[name="text"]',function (event) {
        var target = $(event.delegateTarget);
        searchWrapWidth = target.width();
        $(target).animate({
            width: '230'
        });
    }).on('blur', 'input[name="text"]', function (event) {
        var target = $(event.delegateTarget);
        $(target).animate({
            width: searchWrapWidth
        });
    });

    /******** Object options ********/

    $(".object-options, .object-actions").on(App.event.click(), "[isajax='1']", function (e) {
        e.preventDefault();

        if ($(this).hasClass('tooltip')) {
            $(this).css("background-image", 'url(' + App.assets.common.image('/preloader.gif') + ')');
        } else {
            var options = $(this).closest('div');
            options.find('.options i').addClass('preloader');
        }

        var link = $(e.target);

        if (link.is('.object_lock_comments')) {
            lockComments($(this));
        } else if (link.is('.object_trash')) {
            changeState.trash($(this));
        } else if (link.is('.object_archive')) {
            changeState.archive($(this));
        }
    });

    var all = $('div.all');

    all.on(App.event.click(), '.object-state-header a', function () {
        var objActions = all.find('.object-actions');
        var actClass = null;

        if (objActions.length > 0) {
            if ($(this).is('.object_trash')) {
                actClass = 'object_trash';
            } else if ($(this).is('.object_archive')) {
                actClass = 'object_archive';
            }
        }

        if (actClass != null) {
            objActions.find('.' + actClass).trigger('click');
            return false;
        }

    });

    all.on(App.event.click(), ".subscribe-link.email", function (e) {
        e.preventDefault();
        var link = $(this);
        if (App.loggedUser().isGuest()) {
            var params = {'redirect': link.attr("href")};
            App.openLoginPopup(params);
        } else {
            var img = link.css("background-image");
            link.css("background-image", 'url(' + App.assets.common.image('/preloader.gif') + ')');
            App.remote.get(link.attr("href"), {format: 'json'}, function (r) {
                var result = App.remote.parseResult(r);
                link.css("background-image", img);
                if (result.data.isError()) {
                    App.notify.error(result.data.getMessage());
                    return false;
                }
                App.notify.success(result.data.getMessage());
                link.attr('href', result.data.getParam('url'));
                link.text(result.data.getParam('text'));
            });
        }
        return false;
    });

    var lockComments = function (self) {
        App.remote.get(self.attr("href"), null, function (r) {
            var result = App.remote.parseResult(r);

            if (self.hasClass('tooltip')) {
                self.removeAttr("style");
            } else {
                var options = self.closest('div');
                options.find('.options i').removeClass('preloader');
            }

            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }

            var lock = $(".object_lock_comments");
            lock.toggleClass('unlock');

            var title_text = self.is(".unlock") ? App.t("Lock Comments") : App.t("Unlock Comments");

            lock.each(function (index) {
                if ($(this).hasClass('tooltip')) {
                    $(this).data('powertip', title_text);
                } else {
                    $(this).text(title_text);
                }
            });
            $('.comment-reply').toggle();

            if (self.is(".unlock")) {
                $('#add-comment-button').removeClass('hidden');
                $('.comment-quick-reply[locked-comments="1"]').removeAttr('locked-comments').removeClass('hidden');
            } else {
                $('#add-comment-button').addClass('hidden');
                $('.comment-quick-reply:not(.hidden)').attr('locked-comments', 1).addClass('hidden');
            }

            var html = result.data.getOutput();
            $('.leave-comment-block').replaceWith(html);
            var textAreaId = $(html).find("textarea").attr("id");
            var textarea = $("#" + textAreaId).get(0);
            App.initEditor(textarea);
            App.notify.success(result.data.getMessage());
        });
    };

    var changeState = {
        prepare: function (self, response, state) {
            var result = App.remote.parseResult(response),
                recoveryUrl = result.data.getParam('recoveryUrl'),
                originalUrl = result.data.getParam("originalUrl"),
                message = result.data.getMessage();

            if (self.hasClass('tooltip')) {
                self.removeAttr("style");
            } else {
                options = self.closest('div');
                options.find('.options i').removeClass('preloader');
            }

            if (result.data.isError()) {
                App.notify.error(result.data.getMessage());
                return false;
            }
            var html = result.data.getOutput(),
                objStateHeader = $("#object_state_lines");
            if (objStateHeader.length) {
                objStateHeader.remove();
            }
            if (html) {
                if ($(".breadcrumbs").length) {
                    $(".breadcrumbs").after(html);
                } else {
                    $(".mainArea").before(html);
                }
            }
            var links = $(".object_" + state);
            links.toggleClass('restore');

            return {links: links, message: message};
        },

        trash: function (self) {
            App.remote.get(self.attr("href"), null, function (r) {
                var prepare = changeState.prepare(self, r, 'trash');
                var newTitle, newUrl;
                if (r.response.params.step == 'recovery') {
                    newTitle = App.t('Move to Trash');
                    newUrl = r.response.params.trash_url;
                } else {
                    newTitle = App.t('Restore');
                    newUrl = r.response.params.recovery_url;
                }
                var trashLink = prepare.links;
                if (trashLink.hasClass('tooltip')) {
                    trashLink.data('powertip', newTitle);
                }
                trashLink.attr('href', newUrl).text(newTitle);

                var makeCommentNormal = function (comment) {
                    comment.find('.comment-content .block-preloader').remove();
                    comment.find('.comment-content .trash-line').remove();
                    comment.removeClass('trashed').find('.comment-content > .hidden-by-trash').removeClass('hidden-by-trash').show();

                    $(".comment-reply-to[reply_to=" + comment.attr("comment_id") + "]").show();
                    var best = $(".best-answer[comment_id=" + comment.attr("comment_id") + "]");
                    if (best.length) {
                        $("span.best-answer").show();
                        best.show();
                    }
                };

                if (self.hasClass('restore')) {
                    $('.object_archive').addClass('hidden');
                    $('.comments-block .comment.trashed').each(function () {
                        makeCommentNormal($(this));
                    });
                    $('.comments-block .comment').hide();
                } else {
                    $('.comments-block .comment').show();
                    $('.object_archive').removeClass('hidden');
                }
                $("#count-comments").html($('.comments-block').find('.comment:not(.trashed):not(.best-answer):visible').length);

                if (self.hasClass('restore')) {
                    $('.comment-quick-reply:not(.hidden)').attr('in-trash', 1).addClass('hidden');
                } else {
                    $('.comment-quick-reply[in-trash="1"]').removeAttr('in-trash').removeClass('hidden');
                }

                App.notify.success(prepare.message);
            });
        },

        archive: function (self) {
            App.remote.get(self.attr("href"), null, function (r) {
                var prepare = changeState.prepare(self, r, 'archive');
                var newTitle, newUrl;
                if (r.response.params.step == 'recovery') {
                    newTitle = App.t('Move to Archive');
                    newUrl = r.response.params.archive_url;
                } else {
                    newTitle = App.t('Restore');
                    newUrl = r.response.params.recovery_url;
                }
                $('a.object_archive').data('powertip', newTitle).attr('href', newUrl).text(newTitle);

                if (self.hasClass('restore')) {
                    $('.object_trash').addClass('hidden');
                } else {
                    $('.object_trash').removeClass('hidden');
                }

                App.notify.success(prepare.message);
            });
        }
    };

    /* Trash */
    $('#top-bar-trash').off(App.event.click()).on(App.event.click(), function () {
        var url = this.href;
        App.dynamic.modal.openFromUrl({
            modal: {
                title: App.t('Trash'),
                width: '600',
                shader: false,
                useCustomScroller: true,
                useWrapper: false
            },
            request: {
                url: url,
                success: function (res) {

                }
            },
            complete: function (modal) {
                $('.tooltip').powerTip({ placement: 'n', smartPlacement: true });
                var wrapper = $('#trash-popup');
                wrapper.find('ul.modal-trash-list li div.icons-trash a').on(App.event.click(), function () {
                    var trashPopup = $('#trash-popup');
                    var element = $(this);
                    var deleteAction = element.hasClass('delete');
                    var parent = element.parents('li:first');
                    var url = this.href;
                    var allThread = false;
                    var hasReplies = parent.attr('reply_to') != undefined && parent.attr('reply_to') == 0 && $('#trash-popup').find('li[reply_to="' + parent.attr('object-id') + '"]').length > 0;
                    if (hasReplies && !deleteAction) {
                        allThread = confirm(App.t('Recover the whole thread with replies?'));
                        if (!allThread) {
                            url += '?withoutReplies=1';
                        }
                    }
                    var restoreParent = false;
                    if (!deleteAction && parent.attr('parent-is-alive') != undefined && parent.attr('parent-is-alive') == 0) {
                        restoreParent = confirm(App.t('Recover main comment of this reply?'));
                        if (restoreParent) {
                            url += '?recoverMain=1';
                        } else {
                            url += '?makeComment=1';
                        }
                    }
                    element.hide().after('<i class="preloader ico-small"></i>');
                    $.ajax({
                        url: url,
                        success: function (response) {
                            if (response.response.response_type == 'error') {
                                App.notify.error(App.t(response.response.message));
                                element.show().next().remove();
                            } else {
                                App.notify.success(App.t(response.response.message));
                                parent.parents('div.modal-trash:first').find('div.title-small div.badge').text(parseInt(wrapper.find('ul.modal-trash-list li[object-type="' + parent.attr('object-type') + '"]').length - 1));
                                if (element.hasClass('delete') && parent.attr('object-type') != 'Comments') {
                                    wrapper.find('ul.modal-trash-list li[object-type="Comments"][parent-id="' + parent.attr('object-id') + '"]').remove();
                                    wrapper.find('div.modal-trash[objects-type="Comments"] div.title-small div.badge').text(parseInt(wrapper.find('ul.modal-trash-list li[object-type="Comments"]').length));
                                }
                                if (allThread || (hasReplies && deleteAction)) {
                                    trashPopup.find('li[reply_to="' + parent.attr('object-id') + '"]').remove();
                                } else {
                                    if (hasReplies) {
                                        trashPopup.find('li[reply_to="' + parent.attr('object-id') + '"]').attr('parent-is-alive', 1);
                                    }
                                }
                                if (restoreParent) {
                                    trashPopup.find('li[object-id="' + parent.attr('reply_to') + '"][object-type="Comments"]').remove();
                                    trashPopup.find('li[reply_to="' + parent.attr('reply_to') + '"]').attr('parent-is-alive', 1);
                                }
                                parent.remove();
                                if (trashPopup.find('li').length == 0) {
                                    trashPopup.find('.rollbar-content .modalBlock').remove();
                                    trashPopup.find('.result-not-found').removeClass('hidden');
                                }
                            } // if
                        }
                    });
                    return false;
                });
                wrapper.find('.empty-trash').on(App.event.click(), function () {
                    if (confirm(App.t("Are you sure? You can't UNDO this operation!"))) {
                        var element = $(this);
                        var url = this.href;
                        element.hide().after('<i class="preloader ico-small"></i>');
                        $.ajax({
                            url: url,
                            success: function (response) {
                                element.show().next().remove();
                                if (response.response.response_type == 'error') {
                                    App.notify.error(App.t(response.response.message));
                                } else {
                                    App.notify.success(App.t(response.response.message));
                                    wrapper.find('ul.modal-trash-list li').remove();
                                    wrapper.find('div.modal-trash div.badge').text(0);
                                    wrapper.find('.rollbar-content .modalBlock').remove();
                                    wrapper.find('.result-not-found').removeClass('hidden');
                                } // if
                            }
                        });
                    }
                    return false;
                });
                wrapper.find('input.object-type-checkbox').on(App.event.click(), function () {
                    var inputs = wrapper.find('input.object-checkbox[object-type="' + $(this).attr('object-type') + '"]');
                    if ($(this).attr('checked') != undefined) {
                        inputs.attr('checked', 'checked');
                    } else {
                        inputs.removeAttr('checked');
                    }
                });
                wrapper.find('input.object-checkbox').on(App.event.click(), function () {
                    if ($(this).attr('checked') != undefined) {
                        if (wrapper.find('input.object-checkbox[object-type="' + $(this).attr('object-type') + '"]').length == wrapper.find('input.object-checkbox[object-type="' + $(this).attr('object-type') + '"]:checked').length) {
                            wrapper.find('input.object-type-checkbox[object-type="' + $(this).attr('object-type') + '"]').attr('checked', 'checked');
                        }
                    } else {
                        wrapper.find('input.object-type-checkbox[object-type="' + $(this).attr('object-type') + '"]').removeAttr('checked');
                    }
                });
                wrapper.find('select.multi-actions').on('change', function () {
                    var action = $(this).val();
                    if (action) {
                        wrapper.find('button.execute-multi-actions').removeClass('hidden');
                    } else {
                        wrapper.find('button.execute-multi-actions').addClass('hidden');
                    }
                });
                wrapper.find('button.execute-multi-actions').on(App.event.click(), function () {
                    var butoon = $(this);
                    var select = wrapper.find('select.multi-actions');
                    var action = wrapper.find('select.multi-actions').val();
                    var url = butoon.attr('href');
                    var objects = [];
                    var postObjects = {};
                    var rows = wrapper.find('input.object-checkbox:checked');
                    if (rows.length == 0) {
                        App.notify.error('You should select at least one object!');
                        return false;
                    }
                    rows.each(function () {
                        var parent = $(this).parents('li:first');
                        if (postObjects[parent.attr('object-type')] == undefined) {
                            postObjects[parent.attr('object-type')] = [];
                        }
                        objects.push(parent);
                        $(this).attr('disabled', true);
                        postObjects[parent.attr('object-type')].push(parent.attr('object-id'));
                    });
                    butoon.attr('disabled', true);
                    select.attr('disabled', true);
                    $.ajax({
                        url: url,
                        type: 'POST',
                        data: {
                            params: {
                                action: action,
                                objects: postObjects
                            }
                        },
                        success: function (response) {
                            if (response.response.response_type == 'error') {
                                App.notify.error(App.t(response.response.message));
                            } else {
                                butoon.removeAttr('disabled');
                                select.removeAttr('disabled');
                                App.notify.success(App.t(response.response.message));
                                $.each(objects, function () {
                                    try {
                                        if (this.attr('object-type') != 'Comments' && action == 'delete') {
                                            wrapper.find('ul.modal-trash-list li[object-type="Comments"][parent-id="' + this.attr('object-id') + '"]').remove();
                                            wrapper.find('div.modal-trash[objects-type="Comments"] div.title-small div.badge').text(parseInt(wrapper.find('ul.modal-trash-list li[object-type="Comments"]').length));
                                        } // if
                                        this.parents('div.modal-trash:first').find('div.title-small div.badge').text(parseInt(wrapper.find('ul.modal-trash-list li[object-type="' + this.attr('object-type') + '"]').length - 1));
                                        this.remove();
                                    } catch (e) {
                                    }
                                });
                                if (wrapper.find('li').length == 0) {
                                    wrapper.find('.rollbar-content .modalBlock').remove();
                                    wrapper.find('.result-not-found').removeClass('hidden');
                                }
                            } // if
                        }
                    });
                    return false;
                });
            }
        });
        return false;
    });

    $('body').on(App.event.click(), ".combined-buttons li", function () {
        var self = $(this);
        if (!self.hasClass("activ-pos")) {
            self.addClass("activ-pos").siblings("li").removeClass("activ-pos");
        }
    });

    $('.tooltip').powerTip({ placement: 'n', smartPlacement: true });

    $('.content-tabs li').on(App.event.click(), function (e) {
        var self = $(this),
            tabId = this.id,
            contentTab = self.closest('.content-tabs').siblings('.content-tabs-area.' + tabId + '');
        if (self.closest('li.active').length) {
            return;
        }
        self.addClass('active').siblings().removeClass('active');
        contentTab.toggleClass('hidden').siblings('.content-tabs-area').addClass('hidden');
        $('span.tab-related').hide();
        $('span.tab-related[tab-id="' + tabId + '"]').show();
    });

    /* Share block handler */
    $('#share-block-header').one(App.event.click(), function (event) {
        /* System command "loadShare" */
        App.sysCmd('loadShare', {}, function (response) {
            try {
                if (response.data.isSuccess()) {
                    $('#share-block').html(response.data.getOutput());
                    //App.notify.error(response.data.getMessage());
                }
            } catch (e) {
            }
        });
    });

    /**
     * Follows tabs activity to inject hash(tab id) into address.
     * Monitors hash on browser address input and triggers 'click' event on corresponding tab.
     * Detects active tab on page load and sets it's hash if hash wan't defined.
     */
    (function () {
        var tabsContainer = $('ul.content-tabs');

        if (!tabsContainer.length) return;

        var setHash = function (element) {
            element = $(element);
            var tabHash = element.attr('id'),
                elTopPos = Math.round(element.offset().top);
            element.removeAttr('id');
            var x = pageXOffset, y = pageYOffset;
            if (y == elTopPos) {
                y = 0;
            }
            document.location.hash = '#/' + tabHash;
            scrollTo(x, y);
            element.attr('id', tabHash);
        };

        tabsContainer.on(App.event.click(), 'li', function (event) {
            setHash(this);
        });

        var currHash = document.location.hash.replace('#/', '');
        if (currHash) {
            var hashTarget = tabsContainer.find('#' + currHash);
            if (hashTarget.length) {
                hashTarget.trigger(App.event.click());
            }
        }
    })();
});

(function ($) {

    $.topNavScroll = function () {
        var top_nav_width = $('#top_navigation').width();
        var top_nav_right_width = $('#top_navigation .top-nav-right').width() + 10;

        var menu_width = top_nav_width - top_nav_right_width;

        $('.menu-tabs').css('max-width', menu_width);
        var menuLast = $('.menu-tabs ul li').last(),
            last_pos = 0;
        if (menuLast.length) {
            last_pos = menuLast.position().left + menuLast.outerWidth();
        }

        var elem = $('.menu-tabs ul'),
            right_arrow_top = $(".top-nav .arrow-tab.right-arrow"),
            left_arrow_top = $(".top-nav .arrow-tab.left-arrow");

        if (last_pos > menu_width) {
            var maxScroll = menu_width - last_pos;

            right_arrow_top.show();
            elem.css('left', 0);
            right_arrow_top.mousedown(function () {
                $.scrollTabs_right(elem, left_arrow_top, right_arrow_top, maxScroll);
            })
                .mouseup(function () {
                    $.scrollTabs_stop(elem);
                });

            left_arrow_top.mousedown(function () {
                $.scrollTabs_left(elem, left_arrow_top, right_arrow_top, maxScroll);
            })
                .mouseup(function () {
                    $.scrollTabs_stop(elem);
                });
        } else {
            elem.css('left', 0);
            right_arrow_top.hide();
            left_arrow_top.hide();
        }
    }

    $.scrollTabs_init = function (elem, maxScroll) {
        if (elem) {
            elem.state = 0;
            elem.timer = null;
            elem.maxScroll = maxScroll;
        }
    };

    $.scrollTabs_right = function (elem, left_arrow, right_arrow, maxScroll, timer) {
        var left_scroll = elem.position().left;

        if (!elem.maxScroll) {
            $.scrollTabs_init(elem, maxScroll);
        }
        if (timer == undefined) {
            elem.state = 1;
        }
        if ((left_scroll > elem.maxScroll) && (elem.state == 1)) {
            if (left_scroll == 0) {
                left_arrow.fadeIn(900);
            }
            elem.css({ "left": "-=1px" });
            elem.timer = setTimeout(function () {
                $.scrollTabs_right(elem, left_arrow, right_arrow, maxScroll, true);
            }, 1);
        } else {
            right_arrow.fadeOut(900);
        }
    };

    $.scrollTabs_left = function (elem, left_arrow, right_arrow, maxScroll, timer) {
        var left_scroll = elem.position().left;

        if (!elem.maxScroll) {
            $.scrollTabs_init(elem, maxScroll);
        }
        if (timer == undefined) {
            elem.state = -1;
        }
        if ((left_scroll < 0) && (elem.state == -1)) {
            if (right_arrow.is(":hidden")) {
                right_arrow.fadeIn(900);
            }
            elem.css({ "left": "+=1px" });
            elem.timer = setTimeout(function () {
                $.scrollTabs_left(elem, left_arrow, right_arrow, maxScroll, true);
            }, 1);
        } else {
            left_arrow.fadeOut(900);
        }
    };

    $.scrollTabs_stop = function (elem) {
        if (elem.length) {
            if (elem.timer) {
                clearTimeout(elem.timer);
            }
            elem.state = 0;
        }
    };

    $.fn.openFromUrl = function (options, selector, callback) {
        var self = $(this),
            callbackFun = function () {
            },
            opt = null,
            sel = '';
        $.each(arguments, function (i, arg) {
            if ($.isFunction(arg)) {
                callbackFun = arg;
            } else if ($.isPlainObject(arg) && !$.isEmptyObject(arg)) {
                opt = arg;
            } else if ($.type(arg) === "string" || arg instanceof jQuery) {
                sel = arg;
            }
        });

        self.on(App.event.click(), sel, function (event) {
            event.preventDefault();
            var _title = this.title,
                _href = this.href
            var defaults = {
                autoNotifySuccess: true,
                autoNotifyError: true,
                complete: callbackFun,
                modal: {
                    title: (typeof _title !== "undefined") ? App.t(_title) : '',
                    width: '500',
                    shader: false,
                    useCustomScroller: true,
                    useWrapper: false
                },
                request: {
                    type: 'get',
                    url: (typeof _href !== "undefined") ? _href : '',
                    data: {
                        format: 'json'
                    },
                    complete: function (response) {
                    },
                    success: function (response) {
                    },
                    error: function (response) {
                    }
                }
            };
            var settings = null;
            if (opt) {
                settings = $.extend(true, defaults, opt);
            }
            App.dynamic.modal.openFromUrl(settings ? settings : defaults);
        });
    };
    $.fn.toggleDisable = function () {
        var button = $(this);
        if (button.prop('disabled')) {
            button.attr("disabled", false).removeClass("disabled");
        } else {
            button.attr("disabled", true).addClass("disabled");
        }
        return this;
    };
    /**
     * Counts letters in input field
     *
     * @return void
     * @param {jQuery} lengthSelector
     */
    $.countTitleLength = function (lengthSelector) {
        var titleLength = 99;
        lengthSelector.html(titleLength - this.val().length);
        $(this).keydown(function (e) {
            if (e.keyCode !== 13) {
                var length = this.value.length;
                if (length > titleLength) {
                    $(this).val(this.value.substr(0, titleLength));
                    length = titleLength;
                }
                lengthSelector.html(titleLength - length);
            }
        });
    }
    /**
     * Create Custom select
     *
     * @return void
     */
    $.fn.customSelect = function () {
        var select = $(this);
        var isModal = false;
        if (select.parents('.modal').length) {
            isModal = true;
        }
        var size_select, width_select_child;
        var isModal = false;
        if (select.parents('.modal').length) {
            isModal = true;
        }
        select.width(function (i, val) {
            width_select_child = val + 55;
            return val + 55;
        });
        select.msDropDown({
            animStyle: 'none',
            enableAutoFilter: false,
            visibleRows: 10,
            isModal: isModal,
            childWidth: width_select_child + "px"});
    }
    /**
     * Upload Images
     * @param {number} previewSize
     * @param {function} callback
     * @return void
     */
    $.fn.uploadImage = function (size, callbackFun) {
        var $this = $(this),
            availableExt = ['jpg', 'JPG', 'jpeg', 'JPEG', 'gif', 'GIF', 'png', 'PNG'],
            isSupportHTML5 = $.isFunction(window.FormData),
            imgPreview = document.getElementById('preview-uploaded-img'),
            imgPreviewBlock = imgPreview.parentNode,
            fileFormBlock = document.getElementById('upload-image-block'),
            file = fileFormBlock.getElementsByTagName('input')[0],
            previewSize, callback,
            name = function () {
                return !isSupportHTML5 ? file.value : file.files.item(0).name
            },
            resizeImg = function () {
                imgPreview.style.height = !previewSize ? '50px' : previewSize + 'px';
            };

        $.each(arguments, function () {
            if (typeof this === 'function') {
                callback = this;
            } else if (typeof parseInt(this, 10) === 'number') {
                previewSize = this;
                resizeImg();
            }
        });

        /* Hide preview block */
        if (isSupportHTML5) {
            var showPreviw = function (boolean) {
                if (boolean) {
                    imgPreviewBlock.classList.remove('hidden');
                    fileFormBlock.classList.add('hidden');
                } else {
                    imgPreviewBlock.classList.add('hidden');
                    fileFormBlock.classList.remove('hidden');
                }
            };

            $this.on(App.event.click(), '.idelete', function (e) {
                e.preventDefault();
                showPreviw(false);
                file.value = '';
            })
        }

        $this.on("change", 'input:file', function (e) {
            var filename = name().replace(/^.*[\/\\]/g, ""),
                ext = filename.substring(filename.lastIndexOf('.') + 1),
                file = $(this);
            if ($.inArray(ext, availableExt) < 0) {
                this.value = '';
                App.notify.error("You are trying to use incorrect file type!");
                return false;
            }
            if (isSupportHTML5) {
                /* Preview the uploaded img */
                var reader = new FileReader();
                reader.onload = function (e) {
                    showPreviw(true);
                    resizeImg();
                    imgPreview.src = e.target.result;
                }
                reader.readAsDataURL(this.files[0]);
            }
        });
        /* Submit form */
        $this.on('submit', function (e) {
            if (!e.isDefaultPrevented()) {
                e.preventDefault();
            }
            var form = $(this),
                $file = form.find('input:file');
            form.find(':submit').toggleDisable();
            form.find('.modalFooter').append('<i class="ico-small preloader"></i>');
            if (!$file.val()) {
                if (callback && typeof(callback) === "function") {
                    callback.call($this, null);
                }
                return;
            }
            if (isSupportHTML5) {
                var formData = new FormData();
                formData.append('image', file.files[0]);
                $.ajax({
                    url: App.baseUrl('/editor/upload'),  //Server script to process data
                    type: 'POST',
                    data: formData,
                    cache: false,
                    contentType: false,
                    processData: false
                }).done(function (r) {
                    var result = App.remote.parseResult(r);
                    if (result.data.isError()) {
                        form.find(':submit').toggleDisable();
                        App.notify.error(result.data.getMessage());
                        return false;
                    }
                    if (callback && typeof(callback) === "function") {
                        callback.call($this, result.data.getParams());
                    }
                    return true;
                });
            } else {
                var nameIfrmae = "iframe-upload-file-wysiwyg";
                $("body").append("<iframe class='iframe-file-upload' id='" + nameIfrmae + "' name='" + nameIfrmae + "' src=" + App.baseUrl('/editor/upload') + "></iframe>");
                var iFrame = $('#' + nameIfrmae);
                iFrame.load(function () {
                    iFrame.contents().find("#editor-image-upload").append(document.getElementById('upload-image-block').getElementsByTagName('input')[0]);
                    var uploadForm = iFrame.contents().find("#editor-image-upload");
                    if (iFrame.contents().find("form").length === 0) {
                        var resp = $.parseJSON(iFrame.contents().find('body').text());
                        if ($.isPlainObject(resp)) {
                            App.notify.error(resp.message);
                        } else {
                            if (callback && typeof(callback) === "function") {
                                callback.call($this, resp);
                            }
                        }
                        iFrame.remove();
                    }
                    //magic/hack for IE8 to resolve "access denied" issue
                    try {
                        uploadForm.submit();
                    } catch (er) {
                        uploadForm.submit();
                    }
                });
            }
        });
    }
})(jQuery);


/** File: application/3.0.2/assets/desktop/js/msdropdown/jquery.dd.min.js **/

// MSDropDown - jquery.dd.js
// author: Marghoob Suleman - http://www.marghoobsuleman.com/
// Date: 10 Nov, 2012 
// Version: 3.5.2
// Revision: 27
// web: www.marghoobsuleman.com
/*
// msDropDown is free jQuery Plugin: you can redistribute it and/or modify
// it under the terms of the either the MIT License or the Gnu General Public License (GPL) Version 2
*/ 
;eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('4 1E=1E||{};(9($){1E={41:{2o:\'3.5.2\'},42:"5G 5H",3r:20,43:9(v){6(v!==14){$(".2X").1m({1u:\'3s\',2b:\'4N\'})}1d{$(".2X").1m({1u:\'4O\',2b:\'3t\'})}},3u:\'\',3v:9(a,b,c){c=c||"44";4 d;26(c.2p()){1i"44":1i"4P":d=$(a).2o(b).1a("1W");1j}15 d}};$.3w={};$.2o={};$.2Y(11,$.3w,1E);$.2Y(11,$.2o,1E);6($.1Q.1M===1B){$.1Q.1M=$.1Q.5I}6($.1Q.18===1B){$.1Q.18=$.1Q.5J;$.1Q.1x=$.1Q.5K}6(1y $.3x.4Q===\'9\'){$.3x[\':\'].45=$.3x.4Q(9(b){15 9(a){15 $(a).1p().3y().3z(b.3y())>=0}})}1d{$.3x[\':\'].45=9(a,i,m){15 $(a).1p().3y().3z(m[3].3y())>=0}}9 1W(q,t){4 t=$.2Y(11,{1N:{1a:1g,1n:0,3A:1g,2c:0,1R:14,2Z:5L},3B:\'1W\',1u:5M,1X:7,3C:0,30:11,1J:5N,28:14,3D:\'5O\',2q:\'1Y\',3E:\'3s\',2d:11,1C:\'\',3F:0.7,48:11,3G:0,1v:14,3H:\'5P\',2e:\'\',2f:\'\',31:14,2g:11,1F:11,2r:11,18:{3v:1g,2G:1g,3I:1g,29:1g,1G:1g,2H:1g,2I:1g,1Y:1g,49:1g,4a:1g,2s:1g,2J:1g,32:1g,2t:1g,2u:1g}},t);4 u=1b;4 x={4b:\'5Q\',1S:\'5R\',4c:\'5S\',2h:\'5T\',1l:\'5U\'};4 y={1W:t.3B,33:\'33\',4R:\'5V 5W\',4d:\'4d\',3J:\'3J\',2K:\'2K\',1q:\'1q\',2X:\'2X\',4S:\'4S\',4T:\'4T\',19:\'19\',4e:\'4e\',3K:"3K",4f:"4f",1h:"1h",34:"5X",35:\'35\',3L:\'3L\'};4 z={12:\'5Y\',2v:\'2v\',4U:\'5Z 4V\',3M:"3M"};4 A=14,1Z=14,1k=14,3N={},q,36={},3a=14;4 B=40,4g=38,4h=37,4i=39,4W=27,4j=13,3b=47,4k=16,4l=17,4X=8,4Y=46;4 C=14,2i=14,3c=1g,2L=14,3d,60=14;4 D=3e,3f=4m.61.62,4Z=3f.63(/64/i);t.2g=t.2g.2j();t.1F=t.1F.2j();4 E=9(a){15(65.50.2j.51(a)=="[52 53]")?11:14};4 F=9(){4 a=3f.3z("66");6(a>0){15 2w(3f.67(a+5,3f.3z(".",a)))}1d{15 0}};4 G=9(){t.3B=$("#"+q).1a("68")||t.3B;t.1X=$("#"+q).1a("69")||t.1X;6($("#"+q).1a("54")==14){t.30=$("#"+q).1a("54")};t.28=$("#"+q).1a("55")||t.28;t.3D=$("#"+q).1a("6a")||t.3D;t.2q=$("#"+q).1a("2q")||t.2q;t.3E=$("#"+q).1a("6b")||t.3E;t.2d=$("#"+q).1a("6c")||t.2d;t.3F=$("#"+q).1a("6d")||t.3F;t.3G=$("#"+q).1a("56")||t.3G;t.1v=$("#"+q).1a("6e")||t.1v;t.3H=$("#"+q).1a("6f")||t.3H;t.2e=$("#"+q).1a("2e")||t.2e;t.2f=$("#"+q).1a("2f")||t.2f;t.2g=$("#"+q).1a("6g")||t.2g;t.1F=$("#"+q).1a("6h")||t.1F;t.2r=$("#"+q).1a("6i")||t.2r;t.31=$("#"+q).1a("31")||t.31;t.2g=t.2g.2j();t.1F=t.1F.2j();t.2r=t.2r.2j()};4 H=9(a){6(3N[a]===1B){3N[a]=D.6j(a)}15 3N[a]};4 I=9(a){4 b=L("1l");15 $("#"+b+" 12."+z.12).1o(a)};4 J=9(){6(t.1N.1a){4 a=["1h","1D","1r"];2M{6(!q.1H){q.1H="44"+1E.3r};t.1N.1a=57(t.1N.1a);4 b="6k"+(1E.3r++);4 c={};c.1H=b;c.3A=t.1N.3A||q.1H;6(t.1N.2c>0){c.2c=t.1N.2c};c.1R=t.1N.1R;4 d=O("4P",c);21(4 i=0;i<t.1N.1a.1c;i++){4 f=t.1N.1a[i];4 g=3O 4n(f.1p,f.1f);21(4 p 3P f){6(p.2p()!=\'1p\'){4 h=($.6l(p.2p(),a)!=-1)?"1a-":"";g.6m(h+p,f[p])}};d.1K[i]=g};H(q.1H).1s(d);d.1n=t.1N.1n;$(d).1m({2Z:t.1N.2Z+\'2N\'});q=d}2O(e){6n"6o 6p 6q 6r 3P 6s 1a.";}}};4 K=9(){J();6(!q.1H){q.1H="6t"+(1E.3r++)};q=q.1H;u.6u=q;G();1k=H(q).2K;4 a=t.1v;6(a.2j()==="11"){H(q).1R=11;t.1v=11};A=(H(q).2c>1||H(q).1R==11)?11:14;6(A){1Z=H(q).1R};58();59();1w("5a",2k());1w("5b",$("#"+q+" 1T:19"));4 b=L("1l");3d=$("#"+b+" 12."+y.19);6(t.2g==="11"){$("#"+q).18("2H",9(){22(1b.1n)})};H(q).4o=9(e){$("#"+q).2o().1a("1W").4o()}};4 L=9(a){15 q+x[a]};4 M=9(a){4 s=(a.1C===1B)?"":a.1C.5c;15 s};4 N=9(a){4 b=\'\',1r=\'\',1h=\'\',1f=-1,1p=\'\',1e=\'\',1z=\'\',1o;6(a!==1B){4 c=a.1r||"";6(c!=""){4 d=/^\\{.*\\}$/;4 e=d.6v(c);6(e&&t.2d){4 f=57("["+c+"]")};1r=(e&&t.2d)?f[0].1r:1r;1h=(e&&t.2d)?f[0].1h:1h;b=(e&&t.2d)?f[0].1D:c;1z=(e&&t.2d)?f[0].1z:1z;1o=a.1o};1p=a.1p||\'\';1f=a.1f||\'\';1e=a.1e||"";1r=$(a).1M("1a-1r")||$(a).1a("1r")||(1r||"");1h=$(a).1M("1a-1h")||$(a).1a("1h")||(1h||"");b=$(a).1M("1a-1D")||$(a).1a("1D")||(b||"");1z=$(a).1M("1a-1z")||$(a).1a("1z")||(1z||"");1o=$(a).1o()};4 o={1D:b,1r:1r,1h:1h,1f:1f,1p:1p,1e:1e,1z:1z,1o:1o};15 o};4 O=9(a,b,c){4 d=D.6w(a);6(b){21(4 i 3P b){26(i){1i"1C":d.1C.5c=b[i];1j;2P:d[i]=b[i];1j}}};6(c){d.6x=c};15 d};4 P=9(){4 a=L("4b");6($("#"+a).1c==0){4 b={1C:\'1u: 4O;4p: 2x;2b: 3t;\',1e:y.2X};b.1H=a;4 c=O("2Q",b);$("#"+q).5d(c);$("#"+q).6y($("#"+a))}1d{$("#"+a).1m({1u:0,4p:\'2x\',2b:\'3t\'})};H(q).3g=-1};4 Q=9(){4 a=(t.1F=="11")?" 2R":"";4 b={1e:y.1W+" 5e"+a};4 c=M(H(q));4 w=$("#"+q).6z();b.1C="2Z: "+w+"2N;";6(c.1c>0){b.1C=b.1C+""+c};b.1H=L("1S");b.3g=H(q).3g;4 d=O("2Q",b);15 d};4 R=9(){4 a;6(H(q).1n>=0){a=H(q).1K[H(q).1n]}1d{a={1f:\'\',1p:\'\'}}4 b="",4q="";4 c=$("#"+q).1a("55");6(c){t.28=c};6(t.28!=14){b=" "+t.28;4q=" "+a.1e};4 d=(t.1F=="11")?" "+z.2v:"";4 e=O("2Q",{1e:y.33+b+d});4 f=O("2l",{1e:y.4e});4 g=O("2l",{1e:y.4R});4 h=L("4c");4 i=O("2l",{1e:y.3J+4q,1H:h});4 j=N(a);4 k=j.1D;4 l=j.1p||"";6(k!=""&&t.30){4 m=O("3Q");m.4r=k;6(j.1z!=""){m.1e=j.1z+" "}};4 n=O("2l",{1e:y.34},l);e.1s(f);e.1s(g);6(m){i.1s(m)};i.1s(n);e.1s(i);4 o=O("2l",{1e:y.1h},j.1h);i.1s(o);15 e};4 S=9(){4 a=L("2h");4 b=(t.1F=="11")?"2R":"";4 c=O("2y",{1H:a,5f:\'1p\',1f:\'\',6A:\'1x\',1e:\'1p 4V \'+b,1C:\'23: 2z\'});15 c};4 T=9(a){4 b={};4 c=M(a);6(c.1c>0){b.1C=c};4 d=(a.2K)?y.2K:y.1q;d=(a.19)?(d+" "+y.19):d;d=d+" "+z.12;b.1e=d;6(t.28!=14){b.1e=d+" "+a.1e};4 e=O("12",b);4 f=N(a);6(f.1r!=""){e.1r=f.1r};4 g=f.1D;6(g!=""&&t.30){4 h=O("3Q");h.4r=g;6(f.1z!=""){h.1e=f.1z+" "}};6(f.1h!=""){4 i=O("2l",{1e:y.1h},f.1h)};4 j=a.1p||"";4 k=O("2l",{1e:y.34},j);6(t.1v===11){4 l=O("2y",{5f:\'3h\',3A:q+t.3H+\'[]\',1f:a.1f||"",1e:"3h"});e.1s(l);6(t.1v===11){l.2a=(a.19)?11:14}};6(h){e.1s(h)};e.1s(k);6(i){e.1s(i)}1d{6(h){h.1e=h.1e+z.3M}};4 m=O("2Q",{1e:\'6B\'});e.1s(m);15 e};4 U=9(){4 a=L("1l");4 b={1e:y.4d+" 6C "+z.4U,1H:a};6(A==14){b.1C="z-1o: "+t.1J}1d{b.1C="z-1o:1"};4 c=$("#"+q).1a("56")||t.3G;6(c){b.1C=(b.1C||"")+";2Z:"+c};4 d=O("2Q",b);4 e=O("4s");6(t.28!=14){e.1e=t.28};4 f=H(q).24;21(4 i=0;i<f.1c;i++){4 g=f[i];4 h;6(g.4t.2p()=="3K"){h=O("12",{1e:y.3K});4 k=O("2l",{1e:y.4f},g.34);h.1s(k);4 l=g.24;4 m=O("4s");21(4 j=0;j<l.1c;j++){4 n=T(l[j]);m.1s(n)};h.1s(m)}1d{h=T(g)};e.1s(h)};d.1s(e);15 d};4 V=9(a){4 b=L("1l");6(a){6(a==-1){$("#"+b).1m({1u:"3s",4p:"3s"})}1d{$("#"+b).1m("1u",a+"2N")};15 14};4 c;4 d=H(q).1K.1c;6(d>t.1X||t.1X){4 e=$("#"+b+" 12:6D");4 f=2w(e.1m("5g-6E"))+2w(e.1m("5g-1O"));6(t.3C===0){$("#"+b).1m({5h:\'2x\',23:\'3R\'});t.3C=3i.6F(e.1u());$("#"+b).1m({5h:\'1U\'});6(!A||t.1v===11){$("#"+b).1m({23:\'2z\'})}};c=((t.3C+f)*3i.5i(t.1X,d))+3}1d 6(A){c=$("#"+q).1u()};15 c};4 W=9(){4 j=L("1l");$("#"+j).18("1Y",9(e){6(1k===11)15 14;e.1V();e.2m();6(A){3S()}});$("#"+j+" 12."+y.1q).18("1Y",9(e){6(e.5j.4t.2p()!=="2y"){2A(1b)}});$("#"+j+" 12."+y.1q).18("2t",9(e){6(1k===11)15 14;3d=$("#"+j+" 12."+y.19);3c=1b;e.1V();e.2m();6(t.1v===11){6(e.5j.4t.2p()==="2y"){2i=11}};6(A===11){6(1Z){6(C===11){$(1b).1t(y.19);4 a=$("#"+j+" 12."+y.19);4 b=I(1b);6(a.1c>1){4 c=$("#"+j+" 12."+z.12);4 d=I(a[0]);4 f=I(a[1]);6(b>f){d=(b);f=f+1};21(4 i=3i.5i(d,f);i<=3i.6G(d,f);i++){4 g=c[i];6($(g).3T(y.1q)){$(g).1t(y.19)}}}}1d 6(2i===11){$(1b).6H(y.19);6(t.1v===11){4 h=1b.4u[0];h.2a=!h.2a}}1d{$("#"+j+" 12."+y.19).1I(y.19);$("#"+j+" 2y:3h").1M("2a",14);$(1b).1t(y.19);6(t.1v===11){1b.4u[0].2a=11}}}1d{$("#"+j+" 12."+y.19).1I(y.19);$(1b).1t(y.19)}}1d{$("#"+j+" 12."+y.19).1I(y.19);$(1b).1t(y.19)}});$("#"+j+" 12."+y.1q).18("3j",9(e){6(1k===11)15 14;e.1V();e.2m();6(3c!=1g){6(1Z){$(1b).1t(y.19);6(t.1v===11){1b.4u[0].2a=11}}}});$("#"+j+" 12."+y.1q).18("2s",9(e){6(1k===11)15 14;$(1b).1t(y.35)});$("#"+j+" 12."+y.1q).18("2J",9(e){6(1k===11)15 14;$("#"+j+" 12."+y.35).1I(y.35)});$("#"+j+" 12."+y.1q).18("2u",9(e){6(1k===11)15 14;e.1V();e.2m();6(t.1v===11){2i=14};4 a=$("#"+j+" 12."+y.19).1c;2L=(3d.1c!=a||a==0)?11:14;3k();3l();3S();3c=1g});6(t.48==14){$("#"+j+" 12."+z.12).18("1Y",9(e){6(1k===11)15 14;2B(1b,"1Y")});$("#"+j+" 12."+z.12).18("3j",9(e){6(1k===11)15 14;2B(1b,"3j")});$("#"+j+" 12."+z.12).18("2s",9(e){6(1k===11)15 14;2B(1b,"2s")});$("#"+j+" 12."+z.12).18("2J",9(e){6(1k===11)15 14;2B(1b,"2J")});$("#"+j+" 12."+z.12).18("2t",9(e){6(1k===11)15 14;2B(1b,"2t")});$("#"+j+" 12."+z.12).18("2u",9(e){6(1k===11)15 14;2B(1b,"2u")})}};4 X=9(){4 a=L("1l");$("#"+a).1x("1Y");$("#"+a+" 12."+y.1q).1x("3j");$("#"+a+" 12."+y.1q).1x("1Y");$("#"+a+" 12."+y.1q).1x("2s");$("#"+a+" 12."+y.1q).1x("2J");$("#"+a+" 12."+y.1q).1x("2t");$("#"+a+" 12."+y.1q).1x("2u")};4 Y=9(a,b,c){$("#"+a).1x(b,c);$("#"+a).4v(b);$("#"+a).18(b,c)};4 Z=9(){4 a=L("1S");4 b=L("2h");4 c=L("1l");$("#"+a).18(t.2q,9(e){6(1k===11)15 14;1P(t.2q);e.1V();e.2m();3U(e)});$("#"+a).18("2S",9(e){4 k=e.6I;6(!3a&&(k==4j||k==4g||k==B||k==4h||k==4i||(k>=3b&&!A))){3U(e);6(k>=3b){4w()}1d{e.1V();e.6J()}}});$("#"+a).18("32",4x);$("#"+a).18("2I",4y);$("#"+b).18("2I",9(e){Y(a,"32",4x)});W();$("#"+a).18("49",5k);$("#"+a).18("4a",5l);$("#"+a).18("3j",5m);$("#"+a).18("6K",5n);$("#"+a).18("2t",5o);$("#"+a).18("2u",5p)};4 4x=9(e){1P("32")};4 4y=9(e){1P("2I")};4 3V=9(){4 a=L("1S");4 b=L("1l");6(A===11&&t.1v===14){$("#"+a+" ."+y.33).3m();$("#"+b).1m({23:\'3R\',2b:\'4N\'})}1d{6(t.1v===14){1Z=14};$("#"+a+" ."+y.33).2C();$("#"+b).1m({23:\'2z\',2b:\'3t\'});4 c=$("#"+b+" 12."+y.19)[0];$("#"+b+" 12."+y.19).1I(y.19);4 d=I($(c).1t(y.19));22(d)};V(V())};4 4z=9(){4 a=L("1S");4 b=(1k==11)?t.3F:1;6(1k===11){$("#"+a).1t(y.3L)}1d{$("#"+a).1I(y.3L)}};4 5q=9(){4 a=L("2h");6(t.2r=="11"){$("#"+a).18("2T",5r)};3V();4z()};4 59=9(){4 a=Q();4 b=R();a.1s(b);4 c=S();a.1s(c);4 d=U();a.1s(d);$("#"+q).5d(a);P();5q();Z();4 e=L("1l");6(t.2e!=\'\'){$("#"+e).2e(t.2e)};6(t.2f!=\'\'){$("#"+e).2f(t.2f)};6(1y t.18.3v=="9"){t.18.3v.25(u,1A)}};4 4A=9(b){4 c=L("1l");$("#"+c+" 12."+z.12).1I(y.19);6(t.1v===11){$("#"+c+" 12."+z.12+" 2y.3h").1M("2a",14)};6(E(b)===11){21(4 i=0;i<b.1c;i++){4B(b[i])}}1d{4B(b)};9 4B(a){$($("#"+c+" 12."+z.12)[a]).1t(y.19);6(t.1v===11){$($("#"+c+" 12."+z.12)[a]).3n("2y.3h").1M("2a","2a")}}};4 4C=9(a,b){4 c=L("1l");4 d=a||$("#"+c+" 12."+y.19);21(4 i=0;i<d.1c;i++){4 e=(b===11)?d[i]:I(d[i]);H(q).1K[e].19="19"};22(d)};4 3k=9(){4 a=L("1l");4 b=$("#"+a+" 12."+y.19);6(1Z&&(C||2i)||2L){H(q).1n=-1};4 c;6(b.1c==0){c=-1}1d 6(b.1c>1){4C(b)}1d{c=I($("#"+a+" 12."+y.19))};6((H(q).1n!=c||2L)&&b.1c<=1){2L=14;4 e=3o("2H");H(q).1n=c;22(c);6(1y t.18.2H=="9"){4 d=2k();t.18.2H(d.1a,d.1L)};$("#"+q).4v("2H")}};4 22=9(a,b){6(a!==1B){4 c,1f,2D;6(a==-1){c=-1;1f="";2D="";2E(-1)}1d{6(1y a!="52"){4 d=H(q).1K[a];H(q).1n=a;c=a;1f=N(d);2D=(a>=0)?H(q).1K[a].1p:"";2E(1B,1f);1f=1f.1f}1d{c=(b&&b.1o)||H(q).1n;1f=(b&&b.1f)||H(q).1f;2D=(b&&b.1p)||H(q).1K[H(q).1n].1p||"";2E(c)}};1w("1n",c);1w("1f",1f);1w("2D",2D);1w("24",H(q).24);1w("5a",2k());1w("5b",$("#"+q+" 1T:19"))}};4 3o=9(a){4 b={2U:14,2V:14,2n:14};4 c=$("#"+q);2M{6(c.1M("18"+a)!==1g){b.2n=11;b.2U=11}}2O(e){}4 d;6(1y $.5s=="9"){d=$.5s(c[0],"4D")}1d{d=c.1a("4D")};6(d&&d[a]){b.2n=11;b.2V=11};15 b};4 3S=9(){3l();$("5t").18("1Y",2A);$(3e).18("2S",4E);$(3e).18("2T",4F)};4 3l=9(){$("5t").1x("1Y",2A);$(3e).1x("2S",4E);$(3e).1x("2T",4F)};4 5r=9(e){6(e.2W<3b&&e.2W!=4X&&e.2W!=4Y){15 14};4 a=L("1l");4 b=L("2h");4 c=H(b).1f;6(c.1c==0){$("#"+a+" 12:2x").2C();V(V())}1d{$("#"+a+" 12").3m();4 d=$("#"+a+" 12:45(\'"+c+"\')").2C();6($("#"+a+" 12:1U").1c<=t.1X){V(-1)};6(d.1c>0&&!A||!1Z){$("#"+a+" ."+y.19).1I(y.19);$(d[0]).1t(y.19)}};6(!A){3p()}};4 4w=9(){6(t.2r=="11"){4 a=L("1S");4 b=L("2h");6($("#"+b+":2x").1c>0&&2i==14){$("#"+b+":2x").2C().6L("");Y(a,"2I",4y);H(b).32()}}};4 5u=9(){4 a=L("2h");6($("#"+a+":1U").1c>0){$("#"+a+":1U").3m();H(a).2I()}};4 4E=9(a){4 b=L("2h");4 c=L("1l");26(a.2W){1i B:1i 4i:a.1V();a.2m();5v();1j;1i 4g:1i 4h:a.1V();a.2m();5w();1j;1i 4W:1i 4j:a.1V();a.2m();2A();4 d=$("#"+c+" 12."+y.19).1c;2L=(3d.1c!=d||d==0)?11:14;3k();3l();3c=1g;1j;1i 4k:C=11;1j;1i 4l:2i=11;1j;2P:6(a.2W>=3b&&A===14){4w()};1j};6(1k===11)15 14;1P("2S")};4 4F=9(a){26(a.2W){1i 4k:C=14;1j;1i 4l:2i=14;1j};6(1k===11)15 14;1P("2T")};4 5k=9(a){6(1k===11)15 14;1P("49")};4 5l=9(a){6(1k===11)15 14;1P("4a")};4 5m=9(a){6(1k===11)15 14;a.1V();1P("2s")};4 5n=9(a){6(1k===11)15 14;a.1V();1P("2J")};4 5o=9(a){6(1k===11)15 14;1P("2t")};4 5p=9(a){6(1k===11)15 14;1P("2u")};4 3W=9(a,b){4 c={2U:14,2V:14,2n:14};6($(a).1M("18"+b)!=1B){c.2n=11;c.2U=11};4 d=$(a).1a("4D");6(d&&d[b]){c.2n=11;c.2V=11};15 c};4 2B=9(a,b){6(t.48==14){4 c=H(q).1K[I(a)];6(3W(c,b).2n===11){6(3W(c,b).2U===11){c["18"+b]()};6(3W(c,b).2V===11){26(b){1i"2S":1i"2T":1j;2P:$(c).4v(b);1j}};15 14}}};4 1P=9(a){6(1y t.18[a]=="9"){t.18[a].25(1b,1A)};6(3o(a).2n===11){6(3o(a).2U===11){H(q)["18"+a]()}1d 6(3o(a).2V===11){26(a){1i"2S":1i"2T":1j;2P:$("#"+q).6M(a);1j}};15 14}};4 3X=9(a){4 b=L("1l");a=(a!==1B)?a:$("#"+b+" 12."+y.19);6(a.1c>0){4 c=2w(($(a).2b().1O));4 d=2w($("#"+b).1u());6(c>d){4 e=c+$("#"+b).3q()-(d/2);$("#"+b).5x({3q:e},5y)}}};4 5v=9(){4 b=L("1l");4 c=$("#"+b+" 12:1U."+z.12);4 d=$("#"+b+" 12:1U."+y.19);d=(d.1c==0)?c[0]:d;4 e=$("#"+b+" 12:1U."+z.12).1o(d);6((e<c.1c-1)){e=4G(e);6(e<c.1c){6(!C||!A||!1Z){$("#"+b+" ."+y.19).1I(y.19)};$(c[e]).1t(y.19);2E(e);6(A==11){3k()};3X($(c[e]))};6(!A){3p()}};9 4G(a){a=a+1;6(a>c.1c){15 a};6($(c[a]).3T(y.1q)===11){15 a};15 a=4G(a)}};4 5w=9(){4 b=L("1l");4 c=$("#"+b+" 12:1U."+y.19);4 d=$("#"+b+" 12:1U."+z.12);4 e=$("#"+b+" 12:1U."+z.12).1o(c[0]);6(e>=0){e=4H(e);6(e>=0){6(!C||!A||!1Z){$("#"+b+" ."+y.19).1I(y.19)};$(d[e]).1t(y.19);2E(e);6(A==11){3k()};6(2w(($(d[e]).2b().1O+$(d[e]).1u()))<=0){4 f=($("#"+b).3q()-$("#"+b).1u())-$(d[e]).1u();$("#"+b).5x({3q:f},5y)}};6(!A){3p()}};9 4H(a){a=a-1;6(a<0){15 a};6($(d[a]).3T(y.1q)===11){15 a};15 a=4H(a)}};4 3p=9(){4 a=L("1S");4 b=L("1l");4 c=$("#"+a).3Y();4 d=$("#"+a).1u();4 e=$(4m).1u();4 f=$(4m).3q();4 g=$("#"+b).1u();4 h=$("#"+a).1u();4 i=t.3E.2p();6(t.31==11){e=$("#"+b).5z(\'.5A\').1u();c.1O=$("#"+a).3Y().1O-$("#"+b).5z(\'.5A\').3Y().1O}6(((e+f)<3i.6N(g+d+c.1O)||i==\'6O\')&&i!=\'6P\'){h=g;$("#"+b).1m({1O:"-"+h+"2N",23:\'3R\',1J:t.1J});6(t.1F=="11"){$("#"+a).1I("2R 2v").1t("3Z")};4 h=$("#"+b).3Y().1O;6(h<-10){$("#"+b).1m({1O:(2w($("#"+b).1m("1O"))-h+20+f)+"2N",1J:t.1J});6(t.1F=="11"){$("#"+a).1I("3Z 2v").1t("2R")}}}1d{$("#"+b).1m({1O:h+"2N",1J:t.1J});6(t.1F=="11"){$("#"+a).1I("2R 3Z").1t("2v")}};6(4Z){6(F()<=7){$(\'2Q.5e\').1m("1J",t.1J-10);$("#"+a).1m("1J",t.1J+5)}}};4 3U=9(e){6(1k===11)15 14;4 a=L("1S");4 b=L("1l");6(!3a){3a=11;6(1E.3u!=\'\'){$("#"+1E.3u).1m({23:"2z"})};1E.3u=b;$("#"+b+" 12:2x").2C();3p();4 c=t.3D;6(c==""||c=="2z"){$("#"+b).1m({23:"3R"});3X();6(1y t.18.2G=="9"){4 d=2k();t.18.2G(d.1a,d.1L)}}1d{$("#"+b)[c]("6Q",9(){3X();6(1y t.18.2G=="9"){4 d=2k();t.18.2G(d.1a,d.1L)}})};3S()}1d{6(t.2q!==\'2s\'){2A()}}};4 2A=9(e){3a=14;4 a=L("1S");4 b=L("1l");6(A===14||t.1v===11){$("#"+b).1m({23:"2z"});6(t.1F=="11"){$("#"+a).1I("2v 3Z").1t("2R")}};3l();6(1y t.18.3I=="9"){4 d=2k();t.18.3I(d.1a,d.1L)};5u();V(V());$("#"+b).1m({1J:1});2E(H(q).1n)};4 58=9(){2M{36=$.2Y(11,{},H(q));21(4 i 3P 36){6(1y 36[i]!="9"){u[i]=36[i]}}}2O(e){};u.2D=(H(q).1n>=0)?H(q).1K[H(q).1n].1p:"";u.41=1E.41.2o;u.42=1E.42};4 4I=9(a){6(a!=1g&&1y a!="1B"){4 b=L("1l");4 c=N(a);4 d=$("#"+b+" 12."+z.12+":4J("+(a.1o)+")");15{1a:c,1L:d,1T:a,1o:a.1o}};15 1g};4 2k=9(){4 a=L("1l");4 b=H(q);4 c,1L,1T,1o;6(b.1n==-1){c=1g;1L=1g;1T=1g;1o=-1}1d{1L=$("#"+a+" 12."+y.19);6(1L.1c>1){4 d=[],4K=[],6R=[];21(4 i=0;i<1L.1c;i++){4 e=I(1L[i]);d.5B(e);4K.5B(b.1K[e])};c=d;1T=4K;1o=d}1d{1T=b.1K[b.1n];c=N(1T);1o=b.1n}};15{1a:c,1L:1L,1o:1o,1T:1T}};4 2E=9(a,b){4 c=L("4c");4 d={};6(a==-1){d.1p="&6S;";d.1e="";d.1h="";d.1D=""}1d 6(1y a!="1B"){4 e=H(q).1K[a];d=N(e)}1d{d=b};$("#"+c).3n("."+y.34).4L(d.1p);H(c).1e=y.3J+" "+d.1e;6(d.1h!=""){$("#"+c).3n("."+y.1h).4L(d.1h).2C()}1d{$("#"+c).3n("."+y.1h).4L("").3m()};4 f=$("#"+c).3n("3Q");6(f.1c>0){$(f).1G()};6(d.1D!=""&&t.30){f=O("3Q",{4r:d.1D});$("#"+c).2f(f);6(d.1z!=""){f.1e=d.1z+" "};6(d.1h==""){f.1e=f.1e+z.3M}}};4 1w=9(p,v){u[p]=v};4 4M=9(a,b,i){4 c=L("1l");4 d=14;26(a){1i"29":4 e=T(b||H(q).1K[i]);4 f;6(1A.1c==3){f=i}1d{f=$("#"+c+" 12."+z.12).1c-1};6(f<0||!f){$("#"+c+" 4s").2e(e)}1d{4 g=$("#"+c+" 12."+z.12)[f];$(g).6T(e)};X();W();6(t.18.29!=1g){t.18.29.25(1b,1A)};1j;1i"1G":d=$($("#"+c+" 12."+z.12)[i]).3T(y.19);$("#"+c+" 12."+z.12+":4J("+i+")").1G();4 h=$("#"+c+" 12."+y.1q);6(d==11){6(h.1c>0){$(h[0]).1t(y.19);4 j=$("#"+c+" 12."+z.12).1o(h[0]);22(j)}};6(h.1c==0){22(-1)};6($("#"+c+" 12."+z.12).1c<t.1X&&!A){V(-1)};6(t.18.1G!=1g){t.18.1G.25(1b,1A)};1j}};1b.6U=9(){4 a=1A[0];53.50.6V.51(1A);26(a){1i"29":u.29.25(1b,1A);1j;1i"1G":u.1G.25(1b,1A);1j;2P:2M{H(q)[a].25(H(q),1A)}2O(e){};1j}};1b.29=9(){4 a,1f,1r,1D,1h;4 b=1A[0];6(1y b=="6W"){a=b;1f=a;2F=3O 4n(a,1f)}1d{a=b.1p||\'\';1f=b.1f||a;1r=b.1r||\'\';1D=b.1D||\'\';1h=b.1h||\'\';2F=3O 4n(a,1f);$(2F).1a("1h",1h);$(2F).1a("1D",1D);$(2F).1a("1r",1r)};1A[0]=2F;H(q).29.25(H(q),1A);1w("24",H(q)["24"]);1w("1c",H(q).1c);4M("29",2F,1A[1])};1b.1G=9(i){H(q).1G(i);1w("24",H(q)["24"]);1w("1c",H(q).1c);4M("1G",1B,i)};1b.5C=9(a,b){6(1y a=="1B"||1y b=="1B")15 14;a=a.2j();2M{1w(a,b)}2O(e){};26(a){1i"2c":H(q)[a]=b;6(b==0){H(q).1R=14};A=(H(q).2c>1||H(q).1R==11)?11:14;3V();1j;1i"1R":H(q)[a]=b;A=(H(q).2c>1||H(q).1R==11)?11:14;1Z=H(q).1R;3V();1w(a,b);1j;1i"2K":H(q)[a]=b;1k=b;4z();1j;1i"1n":1i"1f":6(a=="1n"&&E(b)===11){$("#"+q+" 1T").1M("19",14);4C(b,11);4A(b)}1d{H(q)[a]=b;4A(H(q).1n);22(H(q).1n)};1j;1i"1c":4 c=L("1l");6(b<H(q).1c){H(q)[a]=b;6(b==0){$("#"+c+" 12."+z.12).1G();22(-1)}1d{$("#"+c+" 12."+z.12+":6X("+(b-1)+")").1G();6($("#"+c+" 12."+y.19).1c==0){$("#"+c+" 12."+y.1q+":4J(0)").1t(y.19)}};1w(a,b);1w("24",H(q)["24"])};1j;1i"1H":1j;2P:2M{H(q)[a]=b;1w(a,b)}2O(e){};1j}};1b.6Y=9(a){15 u[a]||H(q)[a]};1b.1U=9(a){4 b=L("1S");6(a===11){$("#"+b).2C()}1d 6(a===14){$("#"+b).3m()}1d{15($("#"+b).1m("23")=="2z")?14:11}};1b.43=9(v){1E.43(v)};1b.3I=9(){2A()};1b.2G=9(){3U()};1b.5D=9(r){6(1y r=="1B"||r==0){15 14};t.1X=r;V(V())};1b.1X=1b.5D;1b.18=9(a,b){$("#"+q).18(a,b)};1b.1x=9(a,b){$("#"+q).1x(a,b)};1b.6Z=1b.18;1b.70=9(){15 2k()};1b.5E=9(){4 a=H(q).5E.25(H(q),1A);15 4I(a)};1b.5F=9(){4 a=H(q).5F.25(H(q),1A);15 4I(a)};1b.71=9(a){1b.5C("1f",a)};1b.72=9(){4 a=L("4b");4 b=L("1S");$("#"+b+", #"+b+" *").1x();H(q).3g=H(b).3g;$("#"+b).1G();$("#"+q).73().74($("#"+q));$("#"+q).1a("1W",1g)};1b.4o=9(){22(H(q).1n)};K()};$.1Q.2Y({3w:9(b){15 1b.75(9(){6(!$(1b).1a(\'1W\')){4 a=3O 1W(1b,b);$(1b).1a(\'1W\',a)}})}});$.1Q.2o=$.1Q.3w})(76);',62,441,'||||var||if|||function||||||||||||||||||||||||||||||||||||||||||||||||||||||true|li||false|return|||on|selected|data|this|length|else|className|value|null|description|case|break|isDisabled|postChildID|css|selectedIndex|index|text|enabled|title|appendChild|addClass|height|enableCheckbox|cy|off|typeof|imagecss|arguments|undefined|style|image|msBeautify|roundedCorner|remove|id|removeClass|zIndex|options|ui|prop|byJson|top|cn|fn|multiple|postID|option|visible|preventDefault|dd|visibleRows|click|isMultiple||for|bW|display|children|apply|switch||useSprite|add|checked|position|size|jsonTitle|append|prepend|reverseMode|postTitleTextID|controlHolded|toString|cw|span|stopPropagation|hasEvent|msDropdown|toLowerCase|event|enableAutoFilter|mouseover|mousedown|mouseup|borderRadiusTp|parseInt|hidden|input|none|ct|cm|show|selectedText|cx|opt|open|change|blur|mouseout|disabled|forcedTrigger|try|px|catch|default|div|borderRadius|keydown|keyup|byElement|byJQuery|keyCode|ddOutOfVision|extend|width|showIcon|isModal|focus|ddTitle|label|hover|orginial||||isOpen|ALPHABETS_START|lastTarget|oldSelected|document|ua|tabIndex|checkbox|Math|mouseenter|bV|bZ|hide|find|bX|cr|scrollTop|counter|auto|absolute|oldDiv|create|msDropDown|expr|toUpperCase|indexOf|name|mainCSS|rowHeight|animStyle|openDirection|disabledOpacity|childWidth|checkboxNameSuffix|close|ddTitleText|optgroup|disabledAll|fnone|cacheElement|new|in|img|block|bY|hasClass|cs|bP|cl|co|offset|borderRadiusBtm||version|author|debug|dropdown|Contains|||disabledOptionEvents|dblclick|mousemove|postElementHolder|postTitleID|ddChild|divider|optgroupTitle|UP_ARROW|LEFT_ARROW|RIGHT_ARROW|ENTER|SHIFT|CONTROL|window|Option|refresh|overflow|selectedClass|src|ul|nodeName|childNodes|trigger|cb|bN|bO|bQ|bT|updateNow|bU|events|cd|ce|getNext|getPrev|cv|eq|op|html|cz|relative|0px|select|createPseudo|arrow|borderTop|noBorderTop|ddChildMore|shadow|ESCAPE|BACKSPACE|DELETE|isIE|prototype|call|object|Array|showicon|usesprite|childwidth|eval|cu|bS|uiData|selectedOptions|cssText|after|ddcommon|type|padding|visibility|min|target|cf|cg|ch|ci|cj|ck|bR|ca|_data|body|cc|cp|cq|animate|500|parents|modalScrollable|push|set|showRows|namedItem|item|Marghoob|Suleman|attr|bind|unbind|250|120|9999|slideDown|_mscheck|_msddHolder|_msdd|_title|_titleText|_child|ddArrow|arrowoff|ddlabel|_msddli_|border|isCreated|navigator|userAgent|match|msie|Object|MSIE|substring|maincss|visiblerows|animstyle|opendirection|jsontitle|disabledopacity|enablecheckbox|checkboxnamesuffix|reversemode|roundedcorner|enableautofilter|getElementById|msdropdown|inArray|setAttribute|throw|There|is|an|error|json|msdrpdd|element|test|createElement|innerHTML|appendTo|outerWidth|autocomplete|clear|ddchild_|first|bottom|ceil|max|toggleClass|which|stopImmediatePropagation|mouseleave|val|triggerHandler|floor|alwaysup|alwaysdown|fast|ind|nbsp|before|act|shift|string|gt|get|addMyEvent|getData|setIndexByValue|destroy|parent|replaceWith|each|jQuery'.split('|'),0,{}));

/** File: application/3.0.2/assets/desktop/js/main.js **/

$(document).ready(function (e) {

});

/** File: application/3.0.2/assets/desktop/js/jquery.slimscroll.min.js **/

/*

 RollBar - jQuery ScrollBar Plugin
 -----------------------------------------------

 @author   flGravity
 @created  4/4/12
 @version  1.5
 @site     http://codecanyon.net/user/flGravity

 */

;
(function ($) {
    function RollBar(c, s) {
        this.container = $(c);
        this.settings = s;
        this.timer = 0;
        this.before = {v: 0, h: 0};
        this.touch = {};
        this.pressed = 0;
        this.vslider = $("<div/>", {"class": "rollbar-handle"});
        this.vpath = $("<div/>", {"class": "rollbar-path-vertical"});
        this.hslider = $("<div/>", {"class": "rollbar-handle"});
        this.hpath = $("<div/>", {"class": "rollbar-path-horizontal"});
        this.sliders = this.vslider.add(this.hslider);
        this.container.css({overflow: "hidden", position: "relative"}).contents().filter(this.settings.contentFilter).wrapAll('<div class="rollbar-content"></div>');
        this.content = this.container.children(".rollbar-content").css({position: "relative", top: 0, left: 0, height: "auto", overflow: "hidden"});
        if (this.settings.scroll == "horizontal") {
            this.container.prepend(this.hpath.append(this.hslider))
        } else {
            if (this.settings.scroll == "vertical") {
                this.container.prepend(this.vpath.append(this.vslider))
            } else {
                this.container.prepend(this.vpath.append(this.vslider), this.hpath.append(this.hslider))
            }
        }
        this.vpath.add(this.hpath).css({"z-index": this.settings.zIndex, display: "none"});
        this.vslider.css({height: this.settings.sliderSize, opacity: this.settings.sliderOpacity});
        this.hslider.css({width: this.settings.sliderSize, opacity: this.settings.sliderOpacity});
        if (this.settings.sliderOpacity) {
            this.sliders.hover(this.fixFn(function () {
                this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, 1)
            }), this.fixFn(function () {
                if (!this.pressed) {
                    this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, this.settings.sliderOpacity)
                }
            }))
        }
        this.init();
        this.pathSize();
        this.bindEvent($(window), "load", function () {
            setTimeout(this.fixFn(this.checkScroll), 10)
        });
        if (this.settings.lazyCheckScroll > 0) {
            setInterval(this.fixFn(function () {
                this.checkScroll();
                this.pathSize()
            }), this.settings.lazyCheckScroll)
        }
    }

    RollBar.prototype.checkScroll = function () {
        this.vtrack = this.vpath.height() - this.vslider.height();
        this.htrack = this.hpath.width() - this.hslider.width();
        this.vdiff = this.content.height() - this.container.height();
        this.hdiff = this.content.width() - this.container.width();
        if (!this.settings.autoHide) {
            return
        }
        if (this.vdiff > 0) {
            this.vpath.fadeIn(this.settings.autoHideTime)
        } else {
            this.vpath.fadeOut(this.settings.autoHideTime)
        }
        if (this.hdiff > 0) {
            this.hpath.fadeIn(this.settings.autoHideTime)
        } else {
            this.hpath.fadeOut(this.settings.autoHideTime)
        }
    };
    RollBar.prototype.pathSize = function () {
        var pad = parseInt(this.settings.pathPadding, 10);
        this.vpath.css({top: pad + "px", height: this.container.height() - 2 * pad + "px"});
        this.hpath.css({left: pad + "px", width: this.container.width() - 2 * pad + "px"})
    };
    RollBar.prototype.scroll = function (v, h, e) {
        var hs = 0;
        var vs = 0;
        if (v < 0) {
            v = 0
        }
        if (v > this.vtrack) {
            v = this.vtrack
        }
        this.vslider.css("top", v + "px");
        if (h < 0) {
            h = 0
        }
        if (h > this.htrack) {
            h = this.htrack
        }
        this.hslider.css("left", h + "px");
        if (this.vdiff > 0) {
            vs = v / this.vtrack;
            this.content.css("top", Math.round(-this.vdiff * vs));
            if (e && (v && v != this.vtrack)) {
                e.stopPropagation();
                e.preventDefault()
            }
        }
        if (this.hdiff > 0) {
            hs = h / this.htrack;
            this.content.css("left", Math.round(-this.hdiff * hs));
            if (e && (h && h != this.htrack)) {
                e.stopPropagation();
                e.preventDefault()
            }
        }
        if (this.before.v != vs || this.before.h != hs) {
            if (typeof this.settings.onscroll == "function") {
                this.settings.onscroll.call(this.container.get(0), vs, hs)
            }
            this.before.v = vs;
            this.before.h = hs
        }
    };
    RollBar.prototype.easeScroll = function (v, h) {
        var n = 0;
        var steps = Math.floor(this.settings.scrollTime / this.settings.scrollInterval);
        var vs = this.vslider.position().top;
        var hs = this.hslider.position().left;
        var easing = $.easing[this.settings.scrollEasing] || $.easing.linear;
        this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, 1);
        window.clearInterval(this.timer);
        this.timer = window.setInterval(this.fixFn(function () {
            this.scroll(vs + easing(n / steps, n, 0, 1, steps) * v, hs + easing(n / steps, n, 0, 1, steps) * h);
            if (++n > steps) {
                window.clearInterval(this.timer);
                this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, this.settings.sliderOpacity)
            }
        }), this.settings.scrollInterval)
    };
    RollBar.prototype.fixFn = function (f, s) {
        var scope = this;
        return function () {
            f.apply(s || scope, Array.prototype.slice.call(arguments))
        }
    };
    RollBar.prototype.bindEvent = function (t, e, f, s) {
        return t.bind(e, this.fixFn(f, s))
    };
    RollBar.prototype.init = function () {
        var document = $(window.document);
        this.bindEvent(this.sliders, "mousedown", function (e) {
            this.pressed = (e.target === this.vslider.get(0)) ? 1 : 2;
            var hclick = e.pageX;
            var vclick = e.pageY;
            var vtop = this.vslider.position().top;
            var hleft = this.hslider.position().left;
            this.bindEvent(document, "mousemove", function (e) {
                if (this.pressed == 1) {
                    this.scroll(vtop + (e.pageY - vclick), hleft)
                } else {
                    this.scroll(vtop, hleft + (e.pageX - hclick))
                }
            });
            this.bindEvent(document, "selectstart", function (e) {
                e.preventDefault()
            })
        });
        this.bindEvent(document, "mouseup", function (e) {
            if (this.pressed == 1 && e.target !== this.vslider.get(0)) {
                this.vslider.fadeTo(this.settings.sliderOpacityTime, this.settings.sliderOpacity)
            } else {
                if (this.pressed == 2 && e.target !== this.hslider.get(0)) {
                    this.hslider.fadeTo(this.settings.sliderOpacityTime, this.settings.sliderOpacity)
                }
            }
            this.pressed = 0;
            document.unbind("mousemove");
            document.unbind("selectstart")
        });
        this.bindEvent(this.container, "touchstart", function (e) {
            var event = e.originalEvent;
            var touch = event.changedTouches[0];
            this.touch.sx = touch.pageX;
            this.touch.sy = touch.pageY;
            this.touch.sv = this.vslider.position().top;
            this.touch.sh = this.hslider.position().left;
            this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, 1);
            if (this.settings.blockGlobalScroll && (this.vdiff || this.hdiff)) {
                event.stopPropagation()
            }
        });
        this.bindEvent(this.container, "touchmove", function (e) {
            var event = e.originalEvent;
            var touch = event.targetTouches[0];
            this.scroll(this.touch.sv + (this.touch.sy - touch.pageY) * this.settings.touchSpeed, this.touch.sh + (this.touch.sx - touch.pageX) * this.settings.touchSpeed, e);
            if (this.settings.blockGlobalScroll && (this.vdiff || this.hdiff)) {
                event.preventDefault();
                event.stopPropagation()
            }
        });
        this.bindEvent(this.container, "touchend touchcancel", function (e) {
            var event = e.originalEvent;
            var touch = event.changedTouches[0];
            this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, this.settings.sliderOpacity);
            if (this.settings.blockGlobalScroll && (this.vdiff || this.hdiff)) {
                event.stopPropagation()
            }
        });
        var vtrack = this.vpath.height(), htrack = this.hpath.width();
        this.bindEvent($(window), "resize", function () {
            this.pathSize();
            this.checkScroll();
            if (this.vdiff <= 0) {
                this.content.css("top", 0)
            }
            if (this.hdiff <= 0) {
                this.content.css("left", 0)
            }
            this.scroll(Math.round(parseInt(this.vslider.css("top"), 10) * this.vpath.height() / vtrack), Math.round(parseInt(this.hslider.css("left"), 10) * this.hpath.width() / htrack));
            vtrack = this.vpath.height();
            htrack = this.hpath.width()
        });
        this.bindEvent(this.container, "mousewheel", function (e, delta, deltaX, deltaY) {
            var targetNode = e.target.nodeName;
            if (targetNode == "TEXTAREA" || (targetNode == "SELECT" || targetNode == "OPTION")) {
                e.stopPropagation();
                return
            }
            this.scroll(this.vslider.position().top - this.settings.wheelSpeed * deltaY, this.hslider.position().left + this.settings.wheelSpeed * deltaX, e);
            this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, 1);
            window.clearTimeout(this.timer);
            this.timer = window.setTimeout(this.fixFn(function () {
                this.sliders.stop().fadeTo(this.settings.sliderOpacityTime, this.settings.sliderOpacity)
            }), this.settings.sliderOpacityDelay);
            if (this.settings.blockGlobalScroll && (this.vdiff || this.hdiff)) {
                e.preventDefault();
                e.stopPropagation()
            }
        });
        this.bindEvent(document, "keydown", function (e) {
            var hkey = 0, vkey = 0;
            vkey = (e.keyCode == 38) ? -this.settings.keyScroll : vkey;
            vkey = (e.keyCode == 40) ? this.settings.keyScroll : vkey;
            hkey = (e.keyCode == 37) ? -this.settings.keyScroll : hkey;
            hkey = (e.keyCode == 39) ? this.settings.keyScroll : hkey;
            if (vkey || hkey) {
                this.easeScroll(vkey, hkey)
            }
        });
        this.bindEvent(this.container, "dragstart", function (e) {
            e.preventDefault()
        });
        this.bindEvent(this.container, "rollbar", function (e, v, h, px) {
            e.stopPropagation();
            if (v === "reset") {
                this.container.find(".rollbar-content, .rollbar-handle").css({top: 0, left: 0});
                return
            }
            v = v || 0;
            h = h || 0;
            if (/^[-\d\.]+$/.test(v)) {
                v = parseFloat(v);
                if (Math.abs(v) <= 1 && !px) {
                    v *= this.vtrack
                } else {
                    v = v + v * (this.vtrack / this.vdiff - 1)
                }
            }
            if (/^[-\d\.]+$/.test(h)) {
                h = parseFloat(h);
                if (Math.abs(h) <= 1 && !px) {
                    h *= this.htrack
                } else {
                    h = h + h * (this.htrack / this.hdiff - 1)
                }
            }
            this.easeScroll(v, h)
        })
    };
    $.fn.rollbar = function (s) {
        var settings = {scroll: "both", autoHide: true, autoHideTime: "fast", lazyCheckScroll: 1000, blockGlobalScroll: false, contentFilter: "*", sliderSize: "30%", sliderOpacity: 0.5, sliderOpacityTime: 200, sliderOpacityDelay: 1000, wheelSpeed: 20, touchSpeed: 0.3, pathPadding: "20px", keyScroll: 100, scrollTime: 500, scrollInterval: 15, scrollEasing: "swing", zIndex: 100, onscroll: function () {
        }};
        $.extend(settings, s);
        return this.each(function () {
            new RollBar(this, settings)
        })
    }
})(jQuery);


/** File: application/3.0.2/assets/desktop/js/jquery.powertip.js **/

/*!
 PowerTip - v1.2.0 - 2013-04-03
 http://stevenbenner.github.com/jquery-powertip/
 Copyright (c) 2013 Steven Benner (http://stevenbenner.com/).
 Released under MIT license.
 https://raw.github.com/stevenbenner/jquery-powertip/master/LICENSE.txt
*/
(function(factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD. Register as an anonymous module.
		define(['jquery'], factory);
	} else {
		// Browser globals
		factory(jQuery);
	}
}(function($) {

	// useful private variables
	var $document = $(document),
		$window = $(window),
		$body = $('body');

	// constants
	var DATA_DISPLAYCONTROLLER = 'displayController',
		DATA_HASACTIVEHOVER = 'hasActiveHover',
		DATA_FORCEDOPEN = 'forcedOpen',
		DATA_HASMOUSEMOVE = 'hasMouseMove',
		DATA_MOUSEONTOTIP = 'mouseOnToPopup',
		DATA_ORIGINALTITLE = 'originalTitle',
		DATA_POWERTIP = 'powertip',
		DATA_POWERTIPJQ = 'powertipjq',
		DATA_POWERTIPTARGET = 'powertiptarget',
		RAD2DEG = 180 / Math.PI;

	/**
	 * Session data
	 * Private properties global to all powerTip instances
	 */
	var session = {
		isTipOpen: false,
		isFixedTipOpen: false,
		isClosing: false,
		tipOpenImminent: false,
		activeHover: null,
		currentX: 0,
		currentY: 0,
		previousX: 0,
		previousY: 0,
		desyncTimeout: null,
		mouseTrackingActive: false,
		delayInProgress: false,
		windowWidth: 0,
		windowHeight: 0,
		scrollTop: 0,
		scrollLeft: 0
	};

	/**
	 * Collision enumeration
	 * @enum {number}
	 */
	var Collision = {
		none: 0,
		top: 1,
		bottom: 2,
		left: 4,
		right: 8
	};

	/**
	 * Display hover tooltips on the matched elements.
	 * @param {(Object|string)} opts The options object to use for the plugin, or
	 *     the name of a method to invoke on the first matched element.
	 * @param {*=} [arg] Argument for an invoked method (optional).
	 * @return {jQuery} jQuery object for the matched selectors.
	 */
	$.fn.powerTip = function(opts, arg) {
		// don't do any work if there were no matched elements
		if (!this.length) {
			return this;
		}

		// handle api method calls on the plugin, e.g. powerTip('hide')
		if ($.type(opts) === 'string' && $.powerTip[opts]) {
			return $.powerTip[opts].call(this, this, arg);
		}

		// extend options and instantiate TooltipController
		var options = $.extend({}, $.fn.powerTip.defaults, opts),
			tipController = new TooltipController(options);

		// hook mouse and viewport dimension tracking
		initTracking();

		// setup the elements
		this.each(function elementSetup() {
			var $this = $(this),
				dataPowertip = $this.data(DATA_POWERTIP),
				dataElem = $this.data(DATA_POWERTIPJQ),
				dataTarget = $this.data(DATA_POWERTIPTARGET),
				title;

			// handle repeated powerTip calls on the same element by destroying the
			// original instance hooked to it and replacing it with this call
			if ($this.data(DATA_DISPLAYCONTROLLER)) {
				$.powerTip.destroy($this);
			}

			// attempt to use title attribute text if there is no data-powertip,
			// data-powertipjq or data-powertiptarget. If we do use the title
			// attribute, delete the attribute so the browser will not show it
			title = $this.attr('title');
			if (!dataPowertip && !dataTarget && !dataElem && title) {
				$this.data(DATA_POWERTIP, title);
				$this.data(DATA_ORIGINALTITLE, title);
				$this.removeAttr('title');
			}

			// create hover controllers for each element
			$this.data(
				DATA_DISPLAYCONTROLLER,
				new DisplayController($this, options, tipController)
			);
		});

		// attach events to matched elements if the manual options is not enabled
		if (!options.manual) {
			this.on({
				// mouse events
				'mouseenter.powertip': function elementMouseEnter(event) {
					$.powerTip.show(this, event);
				},
				'mouseleave.powertip': function elementMouseLeave() {
					$.powerTip.hide(this);
				},
				// keyboard events
				'focus.powertip': function elementFocus() {
					$.powerTip.show(this);
				},
				'blur.powertip': function elementBlur() {
					$.powerTip.hide(this, true);
				},
				'keydown.powertip': function elementKeyDown(event) {
					// close tooltip when the escape key is pressed
					if (event.keyCode === 27) {
						$.powerTip.hide(this, true);
					}
				}
			});
		}

		return this;
	};

	/**
	 * Default options for the powerTip plugin.
	 */
	$.fn.powerTip.defaults = {
		fadeInTime: 200,
		fadeOutTime: 100,
		followMouse: false,
		popupId: 'powerTip',
		intentSensitivity: 7,
		intentPollInterval: 100,
		closeDelay: 100,
		placement: 'n',
		smartPlacement: false,
		offset: 10,
		mouseOnToPopup: false,
		manual: false
	};

	/**
	 * Default smart placement priority lists.
	 * The first item in the array is the highest priority, the last is the lowest.
	 * The last item is also the default, which will be used if all previous options
	 * do not fit.
	 */
	$.fn.powerTip.smartPlacementLists = {
		n: ['n', 'ne', 'nw', 's'],
		e: ['e', 'ne', 'se', 'w', 'nw', 'sw', 'n', 's', 'e'],
		s: ['s', 'se', 'sw', 'n'],
		w: ['w', 'nw', 'sw', 'e', 'ne', 'se', 'n', 's', 'w'],
		nw: ['nw', 'w', 'sw', 'n', 's', 'se', 'nw'],
		ne: ['ne', 'e', 'se', 'n', 's', 'sw', 'ne'],
		sw: ['sw', 'w', 'nw', 's', 'n', 'ne', 'sw'],
		se: ['se', 'e', 'ne', 's', 'n', 'nw', 'se'],
		'nw-alt': ['nw-alt', 'n', 'ne-alt', 'sw-alt', 's', 'se-alt', 'w', 'e'],
		'ne-alt': ['ne-alt', 'n', 'nw-alt', 'se-alt', 's', 'sw-alt', 'e', 'w'],
		'sw-alt': ['sw-alt', 's', 'se-alt', 'nw-alt', 'n', 'ne-alt', 'w', 'e'],
		'se-alt': ['se-alt', 's', 'sw-alt', 'ne-alt', 'n', 'nw-alt', 'e', 'w']
	};

	/**
	 * Public API
	 */
	$.powerTip = {
		/**
		 * Attempts to show the tooltip for the specified element.
		 * @param {jQuery|Element} element The element to open the tooltip for.
		 * @param {jQuery.Event=} event jQuery event for hover intent and mouse
		 *     tracking (optional).
		 */
		show: function apiShowTip(element, event) {
			if (event) {
				trackMouse(event);
				session.previousX = event.pageX;
				session.previousY = event.pageY;
				$(element).data(DATA_DISPLAYCONTROLLER).show();
			} else {
				$(element).first().data(DATA_DISPLAYCONTROLLER).show(true, true);
			}
			return element;
		},

		/**
		 * Repositions the tooltip on the element.
		 * @param {jQuery|Element} element The element the tooltip is shown for.
		 */
		reposition: function apiResetPosition(element) {
			$(element).first().data(DATA_DISPLAYCONTROLLER).resetPosition();
			return element;
		},

		/**
		 * Attempts to close any open tooltips.
		 * @param {(jQuery|Element)=} element The element with the tooltip that
		 *     should be closed (optional).
		 * @param {boolean=} immediate Disable close delay (optional).
		 */
		hide: function apiCloseTip(element, immediate) {
			if (element) {
				$(element).first().data(DATA_DISPLAYCONTROLLER).hide(immediate);
			} else {
				if (session.activeHover) {
					session.activeHover.data(DATA_DISPLAYCONTROLLER).hide(true);
				}
			}
			return element;
		},

		/**
		 * Destroy and roll back any powerTip() instance on the specified element.
		 * @param {jQuery|Element} element The element with the powerTip instance.
		 */
		destroy: function apiDestroy(element) {
			$(element).off('.powertip').each(function destroy() {
				var $this = $(this),
					dataAttributes = [
						DATA_ORIGINALTITLE,
						DATA_DISPLAYCONTROLLER,
						DATA_HASACTIVEHOVER,
						DATA_FORCEDOPEN
					];

				if ($this.data(DATA_ORIGINALTITLE)) {
					$this.attr('title', $this.data(DATA_ORIGINALTITLE));
					dataAttributes.push(DATA_POWERTIP);
				}

				$this.removeData(dataAttributes);
			});
			return element;
		}
	};

	// API aliasing
	$.powerTip.showTip = $.powerTip.show;
	$.powerTip.closeTip = $.powerTip.hide;

	/**
	 * Creates a new CSSCoordinates object.
	 * @private
	 * @constructor
	 */
	function CSSCoordinates() {
		var me = this;

		// initialize object properties
		me.top = 'auto';
		me.left = 'auto';
		me.right = 'auto';
		me.bottom = 'auto';

		/**
		 * Set a property to a value.
		 * @private
		 * @param {string} property The name of the property.
		 * @param {number} value The value of the property.
		 */
		me.set = function(property, value) {
			if ($.isNumeric(value)) {
				me[property] = Math.round(value);
			}
		};
	}

	/**
	 * Creates a new tooltip display controller.
	 * @private
	 * @constructor
	 * @param {jQuery} element The element that this controller will handle.
	 * @param {Object} options Options object containing settings.
	 * @param {TooltipController} tipController The TooltipController object for
	 *     this instance.
	 */
	function DisplayController(element, options, tipController) {
		var hoverTimer = null;

		/**
		 * Begins the process of showing a tooltip.
		 * @private
		 * @param {boolean=} immediate Skip intent testing (optional).
		 * @param {boolean=} forceOpen Ignore cursor position and force tooltip to
		 *     open (optional).
		 */
		function openTooltip(immediate, forceOpen) {
			cancelTimer();
			if (!element.data(DATA_HASACTIVEHOVER)) {
				if (!immediate) {
					session.tipOpenImminent = true;
					hoverTimer = setTimeout(
						function intentDelay() {
							hoverTimer = null;
							checkForIntent();
						},
						options.intentPollInterval
					);
				} else {
					if (forceOpen) {
						element.data(DATA_FORCEDOPEN, true);
					}
					tipController.showTip(element);
				}
			}
		}

		/**
		 * Begins the process of closing a tooltip.
		 * @private
		 * @param {boolean=} disableDelay Disable close delay (optional).
		 */
		function closeTooltip(disableDelay) {
			cancelTimer();
			session.tipOpenImminent = false;
			if (element.data(DATA_HASACTIVEHOVER)) {
				element.data(DATA_FORCEDOPEN, false);
				if (!disableDelay) {
					session.delayInProgress = true;
					hoverTimer = setTimeout(
						function closeDelay() {
							hoverTimer = null;
							tipController.hideTip(element);
							session.delayInProgress = false;
						},
						options.closeDelay
					);
				} else {
					tipController.hideTip(element);
				}
			}
		}

		/**
		 * Checks mouse position to make sure that the user intended to hover on the
		 * specified element before showing the tooltip.
		 * @private
		 */
		function checkForIntent() {
			// calculate mouse position difference
			var xDifference = Math.abs(session.previousX - session.currentX),
				yDifference = Math.abs(session.previousY - session.currentY),
				totalDifference = xDifference + yDifference;

			// check if difference has passed the sensitivity threshold
			if (totalDifference < options.intentSensitivity) {
				tipController.showTip(element);
			} else {
				// try again
				session.previousX = session.currentX;
				session.previousY = session.currentY;
				openTooltip();
			}
		}

		/**
		 * Cancels active hover timer.
		 * @private
		 */
		function cancelTimer() {
			hoverTimer = clearTimeout(hoverTimer);
			session.delayInProgress = false;
		}

		/**
		 * Repositions the tooltip on this element.
		 * @private
		 */
		function repositionTooltip() {
			tipController.resetPosition(element);
		}

		// expose the methods
		this.show = openTooltip;
		this.hide = closeTooltip;
		this.cancel = cancelTimer;
		this.resetPosition = repositionTooltip;
	}

	/**
	 * Creates a new Placement Calculator.
	 * @private
	 * @constructor
	 */
	function PlacementCalculator() {
		/**
		 * Compute the CSS position to display a tooltip at the specified placement
		 * relative to the specified element.
		 * @private
		 * @param {jQuery} element The element that the tooltip should target.
		 * @param {string} placement The placement for the tooltip.
		 * @param {number} tipWidth Width of the tooltip element in pixels.
		 * @param {number} tipHeight Height of the tooltip element in pixels.
		 * @param {number} offset Distance to offset tooltips in pixels.
		 * @return {CSSCoordinates} A CSSCoordinates object with the position.
		 */
		function computePlacementCoords(element, placement, tipWidth, tipHeight, offset) {
			var placementBase = placement.split('-')[0], // ignore 'alt' for corners
				coords = new CSSCoordinates(),
				position;

			if (isSvgElement(element)) {
				position = getSvgPlacement(element, placementBase);
			} else {
				position = getHtmlPlacement(element, placementBase);
			}

			// calculate the appropriate x and y position in the document
			switch (placement) {
			case 'n':
				coords.set('left', position.left - (tipWidth / 2));
				coords.set('bottom', session.windowHeight - position.top + offset);
				break;
			case 'e':
				coords.set('left', position.left + offset);
				coords.set('top', position.top - (tipHeight / 2));
				break;
			case 's':
				coords.set('left', position.left - (tipWidth / 2));
				coords.set('top', position.top + offset);
				break;
			case 'w':
				coords.set('top', position.top - (tipHeight / 2));
				coords.set('right', session.windowWidth - position.left + offset);
				break;
			case 'nw':
				coords.set('bottom', session.windowHeight - position.top + offset);
				coords.set('right', session.windowWidth - position.left - 20);
				break;
			case 'nw-alt':
				coords.set('left', position.left);
				coords.set('bottom', session.windowHeight - position.top + offset);
				break;
			case 'ne':
				coords.set('left', position.left - 20);
				coords.set('bottom', session.windowHeight - position.top + offset);
				break;
			case 'ne-alt':
				coords.set('bottom', session.windowHeight - position.top + offset);
				coords.set('right', session.windowWidth - position.left);
				break;
			case 'sw':
				coords.set('top', position.top + offset);
				coords.set('right', session.windowWidth - position.left - 20);
				break;
			case 'sw-alt':
				coords.set('left', position.left);
				coords.set('top', position.top + offset);
				break;
			case 'se':
				coords.set('left', position.left - 20);
				coords.set('top', position.top + offset);
				break;
			case 'se-alt':
				coords.set('top', position.top + offset);
				coords.set('right', session.windowWidth - position.left);
				break;
			}

			return coords;
		}

		/**
		 * Finds the tooltip attachment point in the document for a HTML DOM element
		 * for the specified placement.
		 * @private
		 * @param {jQuery} element The element that the tooltip should target.
		 * @param {string} placement The placement for the tooltip.
		 * @return {Object} An object with the top,left position values.
		 */
		function getHtmlPlacement(element, placement) {
			var objectOffset = element.offset(),
				objectWidth = element.outerWidth(),
				objectHeight = element.outerHeight(),
				left,
				top;

			// calculate the appropriate x and y position in the document
			switch (placement) {
			case 'n':
				left = objectOffset.left + objectWidth / 2;
				top = objectOffset.top;
				break;
			case 'e':
				left = objectOffset.left + objectWidth;
				top = objectOffset.top + objectHeight / 2;
				break;
			case 's':
				left = objectOffset.left + objectWidth / 2;
				top = objectOffset.top + objectHeight;
				break;
			case 'w':
				left = objectOffset.left;
				top = objectOffset.top + objectHeight / 2;
				break;
			case 'nw':
				left = objectOffset.left;
				top = objectOffset.top;
				break;
			case 'ne':
				left = objectOffset.left + objectWidth;
				top = objectOffset.top;
				break;
			case 'sw':
				left = objectOffset.left;
				top = objectOffset.top + objectHeight;
				break;
			case 'se':
				left = objectOffset.left + objectWidth;
				top = objectOffset.top + objectHeight;
				break;
			}

			return {
				top: top,
				left: left
			};
		}

		/**
		 * Finds the tooltip attachment point in the document for a SVG element for
		 * the specified placement.
		 * @private
		 * @param {jQuery} element The element that the tooltip should target.
		 * @param {string} placement The placement for the tooltip.
		 * @return {Object} An object with the top,left position values.
		 */
		function getSvgPlacement(element, placement) {
			var svgElement = element.closest('svg')[0],
				domElement = element[0],
				point = svgElement.createSVGPoint(),
				boundingBox = domElement.getBBox(),
				matrix = domElement.getScreenCTM(),
				halfWidth = boundingBox.width / 2,
				halfHeight = boundingBox.height / 2,
				placements = [],
				placementKeys = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'],
				coords,
				rotation,
				steps,
				x;

			function pushPlacement() {
				placements.push(point.matrixTransform(matrix));
			}

			// get bounding box corners and midpoints
			point.x = boundingBox.x;
			point.y = boundingBox.y;
			pushPlacement();
			point.x += halfWidth;
			pushPlacement();
			point.x += halfWidth;
			pushPlacement();
			point.y += halfHeight;
			pushPlacement();
			point.y += halfHeight;
			pushPlacement();
			point.x -= halfWidth;
			pushPlacement();
			point.x -= halfWidth;
			pushPlacement();
			point.y -= halfHeight;
			pushPlacement();

			// determine rotation
			if (placements[0].y !== placements[1].y || placements[0].x !== placements[7].x) {
				rotation = Math.atan2(matrix.b, matrix.a) * RAD2DEG;
				steps = Math.ceil(((rotation % 360) - 22.5) / 45);
				if (steps < 1) {
					steps += 8;
				}
				while (steps--) {
					placementKeys.push(placementKeys.shift());
				}
			}

			// find placement
			for (x = 0; x < placements.length; x++) {
				if (placementKeys[x] === placement) {
					coords = placements[x];
					break;
				}
			}

			return {
				top: coords.y + session.scrollTop,
				left: coords.x + session.scrollLeft
			};
		}

		// expose methods
		this.compute = computePlacementCoords;
	}

	/**
	 * Creates a new tooltip controller.
	 * @private
	 * @constructor
	 * @param {Object} options Options object containing settings.
	 */
	function TooltipController(options) {
		var placementCalculator = new PlacementCalculator(),
			tipElement = $('#' + options.popupId);

		// build and append tooltip div if it does not already exist
		if (tipElement.length === 0) {
			tipElement = $('<div/>', { id: options.popupId });
			// grab body element if it was not populated when the script loaded
			// note: this hack exists solely for jsfiddle support
			if ($body.length === 0) {
				$body = $('body');
			}
			$body.append(tipElement);
		}

		// hook mousemove for cursor follow tooltips
		if (options.followMouse) {
			// only one positionTipOnCursor hook per tooltip element, please
			if (!tipElement.data(DATA_HASMOUSEMOVE)) {
				$document.on('mousemove', positionTipOnCursor);
				$window.on('scroll', positionTipOnCursor);
				tipElement.data(DATA_HASMOUSEMOVE, true);
			}
		}

		// if we want to be able to mouse onto the tooltip then we need to attach
		// hover events to the tooltip that will cancel a close request on hover and
		// start a new close request on mouseleave
		if (options.mouseOnToPopup) {
			tipElement.on({
				mouseenter: function tipMouseEnter() {
					// we only let the mouse stay on the tooltip if it is set to let
					// users interact with it
					if (tipElement.data(DATA_MOUSEONTOTIP)) {
						// check activeHover in case the mouse cursor entered the
						// tooltip during the fadeOut and close cycle
						if (session.activeHover) {
							session.activeHover.data(DATA_DISPLAYCONTROLLER).cancel();
						}
					}
				},
				mouseleave: function tipMouseLeave() {
					// check activeHover in case the mouse cursor entered the
					// tooltip during the fadeOut and close cycle
					if (session.activeHover) {
						session.activeHover.data(DATA_DISPLAYCONTROLLER).hide();
					}
				}
			});
		}

		/**
		 * Gives the specified element the active-hover state and queues up the
		 * showTip function.
		 * @private
		 * @param {jQuery} element The element that the tooltip should target.
		 */
		function beginShowTip(element) {
			element.data(DATA_HASACTIVEHOVER, true);
			// show tooltip, asap
			tipElement.queue(function queueTipInit(next) {
				showTip(element);
				next();
			});
		}

		/**
		 * Shows the tooltip, as soon as possible.
		 * @private
		 * @param {jQuery} element The element that the tooltip should target.
		 */
		function showTip(element) {
			var tipContent;

			// it is possible, especially with keyboard navigation, to move on to
			// another element with a tooltip during the queue to get to this point
			// in the code. if that happens then we need to not proceed or we may
			// have the fadeout callback for the last tooltip execute immediately
			// after this code runs, causing bugs.
			if (!element.data(DATA_HASACTIVEHOVER)) {
				return;
			}

			// if the tooltip is open and we got asked to open another one then the
			// old one is still in its fadeOut cycle, so wait and try again
			if (session.isTipOpen) {
				if (!session.isClosing) {
					hideTip(session.activeHover);
				}
				tipElement.delay(100).queue(function queueTipAgain(next) {
					showTip(element);
					next();
				});
				return;
			}

			// trigger powerTipPreRender event
			element.trigger('powerTipPreRender');

			// set tooltip content
			tipContent = getTooltipContent(element);
			if (tipContent) {
				tipElement.empty().append(tipContent);
			} else {
				// we have no content to display, give up
				return;
			}

			// trigger powerTipRender event
			element.trigger('powerTipRender');

			session.activeHover = element;
			session.isTipOpen = true;

			tipElement.data(DATA_MOUSEONTOTIP, options.mouseOnToPopup);

			// set tooltip position
			if (!options.followMouse) {
				positionTipOnElement(element);
				session.isFixedTipOpen = true;
			} else {
				positionTipOnCursor();
			}

			// fadein
			tipElement.fadeIn(options.fadeInTime, function fadeInCallback() {
				// start desync polling
				if (!session.desyncTimeout) {
					session.desyncTimeout = setInterval(closeDesyncedTip, 500);
				}

				// trigger powerTipOpen event
				element.trigger('powerTipOpen');
			});
		}

		/**
		 * Hides the tooltip.
		 * @private
		 * @param {jQuery} element The element that the tooltip should target.
		 */
		function hideTip(element) {
			// reset session
			session.isClosing = true;
			session.activeHover = null;
			session.isTipOpen = false;

			// stop desync polling
			session.desyncTimeout = clearInterval(session.desyncTimeout);

			// reset element state
			element.data(DATA_HASACTIVEHOVER, false);
			element.data(DATA_FORCEDOPEN, false);

			// fade out
			tipElement.fadeOut(options.fadeOutTime, function fadeOutCallback() {
				var coords = new CSSCoordinates();

				// reset session and tooltip element
				session.isClosing = false;
				session.isFixedTipOpen = false;
				tipElement.removeClass();

				// support mouse-follow and fixed position tips at the same time by
				// moving the tooltip to the last cursor location after it is hidden
				coords.set('top', session.currentY + options.offset);
				coords.set('left', session.currentX + options.offset);
				tipElement.css(coords);

				// trigger powerTipClose event
				element.trigger('powerTipClose');
			});
		}

		/**
		 * Moves the tooltip to the users mouse cursor.
		 * @private
		 */
		function positionTipOnCursor() {
			// to support having fixed tooltips on the same page as cursor tooltips,
			// where both instances are referencing the same tooltip element, we
			// need to keep track of the mouse position constantly, but we should
			// only set the tip location if a fixed tip is not currently open, a tip
			// open is imminent or active, and the tooltip element in question does
			// have a mouse-follow using it.
			if (!session.isFixedTipOpen && (session.isTipOpen || (session.tipOpenImminent && tipElement.data(DATA_HASMOUSEMOVE)))) {
				// grab measurements
				var tipWidth = tipElement.outerWidth(),
					tipHeight = tipElement.outerHeight(),
					coords = new CSSCoordinates(),
					collisions,
					collisionCount;

				// grab collisions
				coords.set('top', session.currentY + options.offset);
				coords.set('left', session.currentX + options.offset);
				collisions = getViewportCollisions(
					coords,
					tipWidth,
					tipHeight
				);

				// handle tooltip view port collisions
				if (collisions !== Collision.none) {
					collisionCount = countFlags(collisions);
					if (collisionCount === 1) {
						// if there is only one collision (bottom or right) then
						// simply constrain the tooltip to the view port
						if (collisions === Collision.right) {
							coords.set('left', session.windowWidth - tipWidth);
						} else if (collisions === Collision.bottom) {
							coords.set('top', session.scrollTop + session.windowHeight - tipHeight);
						}
					} else {
						// if the tooltip has more than one collision then it is
						// trapped in the corner and should be flipped to get it out
						// of the users way
						coords.set('left', session.currentX - tipWidth - options.offset);
						coords.set('top', session.currentY - tipHeight - options.offset);
					}
				}

				// position the tooltip
				tipElement.css(coords);
			}
		}

		/**
		 * Sets the tooltip to the correct position relative to the specified target
		 * element. Based on options settings.
		 * @private
		 * @param {jQuery} element The element that the tooltip should target.
		 */
		function positionTipOnElement(element) {
			var priorityList,
				finalPlacement;

			if (options.smartPlacement) {
				priorityList = $.fn.powerTip.smartPlacementLists[options.placement];

				// iterate over the priority list and use the first placement option
				// that does not collide with the view port. if they all collide
				// then the last placement in the list will be used.
				$.each(priorityList, function(idx, pos) {
					// place tooltip and find collisions
					var collisions = getViewportCollisions(
						placeTooltip(element, pos),
						tipElement.outerWidth(),
						tipElement.outerHeight()
					);

					// update the final placement variable
					finalPlacement = pos;

					// break if there were no collisions
					if (collisions === Collision.none) {
						return false;
					}
				});
			} else {
				// if we're not going to use the smart placement feature then just
				// compute the coordinates and do it
				placeTooltip(element, options.placement);
				finalPlacement = options.placement;
			}

			// add placement as class for CSS arrows
			tipElement.addClass(finalPlacement);
		}

		/**
		 * Sets the tooltip position to the appropriate values to show the tip at
		 * the specified placement. This function will iterate and test the tooltip
		 * to support elastic tooltips.
		 * @private
		 * @param {jQuery} element The element that the tooltip should target.
		 * @param {string} placement The placement for the tooltip.
		 * @return {CSSCoordinates} A CSSCoordinates object with the top, left, and
		 *     right position values.
		 */
		function placeTooltip(element, placement) {
			var iterationCount = 0,
				tipWidth,
				tipHeight,
				coords = new CSSCoordinates();

			// set the tip to 0,0 to get the full expanded width
			coords.set('top', 0);
			coords.set('left', 0);
			tipElement.css(coords);

			// to support elastic tooltips we need to check for a change in the
			// rendered dimensions after the tooltip has been positioned
			do {
				// grab the current tip dimensions
				tipWidth = tipElement.outerWidth();
				tipHeight = tipElement.outerHeight();

				// get placement coordinates
				coords = placementCalculator.compute(
					element,
					placement,
					tipWidth,
					tipHeight,
					options.offset
				);

				// place the tooltip
				tipElement.css(coords);
			} while (
				// sanity check: limit to 5 iterations, and...
				++iterationCount <= 5 &&
				// try again if the dimensions changed after placement
				(tipWidth !== tipElement.outerWidth() || tipHeight !== tipElement.outerHeight())
			);

			return coords;
		}

		/**
		 * Checks for a tooltip desync and closes the tooltip if one occurs.
		 * @private
		 */
		function closeDesyncedTip() {
			var isDesynced = false;
			// It is possible for the mouse cursor to leave an element without
			// firing the mouseleave or blur event. This most commonly happens when
			// the element is disabled under mouse cursor. If this happens it will
			// result in a desynced tooltip because the tooltip was never asked to
			// close. So we should periodically check for a desync situation and
			// close the tip if such a situation arises.
			if (session.isTipOpen && !session.isClosing && !session.delayInProgress) {
				// user moused onto another tip or active hover is disabled
				if (session.activeHover.data(DATA_HASACTIVEHOVER) === false || session.activeHover.is(':disabled')) {
					isDesynced = true;
				} else {
					// hanging tip - have to test if mouse position is not over the
					// active hover and not over a tooltip set to let the user
					// interact with it.
					// for keyboard navigation: this only counts if the element does
					// not have focus.
					// for tooltips opened via the api: we need to check if it has
					// the forcedOpen flag.
					if (!isMouseOver(session.activeHover) && !session.activeHover.is(':focus') && !session.activeHover.data(DATA_FORCEDOPEN)) {
						if (tipElement.data(DATA_MOUSEONTOTIP)) {
							if (!isMouseOver(tipElement)) {
								isDesynced = true;
							}
						} else {
							isDesynced = true;
						}
					}
				}

				if (isDesynced) {
					// close the desynced tip
					hideTip(session.activeHover);
				}
			}
		}

		// expose methods
		this.showTip = beginShowTip;
		this.hideTip = hideTip;
		this.resetPosition = positionTipOnElement;
	}

	/**
	 * Determine whether a jQuery object is an SVG element
	 * @private
	 * @param {jQuery} element The element to check
	 * @return {boolean} Whether this is an SVG element
	 */
	function isSvgElement(element) {
		return window.SVGElement && element[0] instanceof SVGElement;
	}

	/**
	 * Initializes the viewport dimension cache and hooks up the mouse position
	 * tracking and viewport dimension tracking events.
	 * Prevents attaching the events more than once.
	 * @private
	 */
	function initTracking() {
		if (!session.mouseTrackingActive) {
			session.mouseTrackingActive = true;

			// grab the current viewport dimensions on load
			$(function getViewportDimensions() {
				session.scrollLeft = $window.scrollLeft();
				session.scrollTop = $window.scrollTop();
				session.windowWidth = $window.width();
				session.windowHeight = $window.height();
			});

			// hook mouse move tracking
			$document.on('mousemove', trackMouse);

			// hook viewport dimensions tracking
			$window.on({
				resize: function trackResize() {
					session.windowWidth = $window.width();
					session.windowHeight = $window.height();
				},
				scroll: function trackScroll() {
					var x = $window.scrollLeft(),
						y = $window.scrollTop();
					if (x !== session.scrollLeft) {
						session.currentX += x - session.scrollLeft;
						session.scrollLeft = x;
					}
					if (y !== session.scrollTop) {
						session.currentY += y - session.scrollTop;
						session.scrollTop = y;
					}
				}
			});
		}
	}

	/**
	 * Saves the current mouse coordinates to the session object.
	 * @private
	 * @param {jQuery.Event} event The mousemove event for the document.
	 */
	function trackMouse(event) {
		session.currentX = event.pageX;
		session.currentY = event.pageY;
	}

	/**
	 * Tests if the mouse is currently over the specified element.
	 * @private
	 * @param {jQuery} element The element to check for hover.
	 * @return {boolean}
	 */
	function isMouseOver(element) {
		// use getBoundingClientRect() because jQuery's width() and height()
		// methods do not work with SVG elements
		// compute width/height because those properties do not exist on the object
		// returned by getBoundingClientRect() in older versions of IE
		var elementPosition = element.offset(),
			elementBox = element[0].getBoundingClientRect(),
			elementWidth = elementBox.right - elementBox.left,
			elementHeight = elementBox.bottom - elementBox.top;

		return session.currentX >= elementPosition.left &&
			session.currentX <= elementPosition.left + elementWidth &&
			session.currentY >= elementPosition.top &&
			session.currentY <= elementPosition.top + elementHeight;
	}

	/**
	 * Fetches the tooltip content from the specified element's data attributes.
	 * @private
	 * @param {jQuery} element The element to get the tooltip content for.
	 * @return {(string|jQuery|undefined)} The text/HTML string, jQuery object, or
	 *     undefined if there was no tooltip content for the element.
	 */
	function getTooltipContent(element) {
		var tipText = element.data(DATA_POWERTIP),
			tipObject = element.data(DATA_POWERTIPJQ),
			tipTarget = element.data(DATA_POWERTIPTARGET),
			targetElement,
			content;

		if (tipText) {
			if ($.isFunction(tipText)) {
				tipText = tipText.call(element[0]);
			}
			content = tipText;
		} else if (tipObject) {
			if ($.isFunction(tipObject)) {
				tipObject = tipObject.call(element[0]);
			}
			if (tipObject.length > 0) {
				content = tipObject.clone(true, true);
			}
		} else if (tipTarget) {
			targetElement = $('#' + tipTarget);
			if (targetElement.length > 0) {
				content = targetElement.html();
			}
		}

		return content;
	}

	/**
	 * Finds any viewport collisions that an element (the tooltip) would have if it
	 * were absolutely positioned at the specified coordinates.
	 * @private
	 * @param {CSSCoordinates} coords Coordinates for the element.
	 * @param {number} elementWidth Width of the element in pixels.
	 * @param {number} elementHeight Height of the element in pixels.
	 * @return {number} Value with the collision flags.
	 */
	function getViewportCollisions(coords, elementWidth, elementHeight) {
		var viewportTop = session.scrollTop,
			viewportLeft =  session.scrollLeft,
			viewportBottom = viewportTop + session.windowHeight,
			viewportRight = viewportLeft + session.windowWidth,
			collisions = Collision.none;

		if (coords.top < viewportTop || Math.abs(coords.bottom - session.windowHeight) - elementHeight < viewportTop) {
			collisions |= Collision.top;
		}
		if (coords.top + elementHeight > viewportBottom || Math.abs(coords.bottom - session.windowHeight) > viewportBottom) {
			collisions |= Collision.bottom;
		}
		if (coords.left < viewportLeft || coords.right + elementWidth > viewportRight) {
			collisions |= Collision.left;
		}
		if (coords.left + elementWidth > viewportRight || coords.right < viewportLeft) {
			collisions |= Collision.right;
		}

		return collisions;
	}

	/**
	 * Counts the number of bits set on a flags value.
	 * @param {number} value The flags value.
	 * @return {number} The number of bits that have been set.
	 */
	function countFlags(value) {
		var count = 0;
		while (value) {
			value &= value - 1;
			count++;
		}
		return count;
	}

}));
